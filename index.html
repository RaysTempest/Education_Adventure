<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Petualangan Pengetahuan Ultimate - Edisi Sempurna</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/tone/14.7.77/Tone.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&family=Fredoka+One&display=swap" rel="stylesheet">
    <style>
        /* achievements unlock animation and helper styles */
        .unlocked-badge { animation: badge-pop 900ms ease both; box-shadow: 0 8px 20px rgba(96,165,250,0.18); }
        @keyframes badge-pop { 0% { transform: scale(.8); opacity: 0 } 50% { transform: scale(1.08); opacity: 1 } 100% { transform: scale(1); opacity: 1 } }
        #achievements-modal .force-award { margin-top: 10px; display:flex; gap:8px; align-items:center }
        #hint-modal { display:flex; }
    .confetti-piece { position: fixed; width: 10px; height: 12px; border-radius: 2px; opacity: 0.95; animation: conf-fall 1200ms cubic-bezier(.2,.8,.3,1); }
    @keyframes conf-fall { 0% { transform: translateY(-10px) rotate(0deg); opacity: 1 } 100% { transform: translateY(120px) rotate(360deg); opacity: 0 } }
    .achievement-glow { box-shadow: inset 0 0 180px rgba(96,165,250,0.08); transition: box-shadow 320ms ease; }
        /* New: confetti particles */
        .confetti-piece { position: fixed; width: 10px; height: 14px; opacity: 0.95; z-index: 1000; transform: translateY(0) rotate(0); animation: confetti-fall 1800ms linear forwards; }
        @keyframes confetti-fall { to { transform: translateY(120vh) rotate(720deg); opacity: 0; } }
        /* modal overlay smoother transitions */
        .modal-overlay { align-items: center; justify-content: center; transition: opacity 260ms ease; }
        .modal-overlay .modal-content { transform-origin: center; transition: transform 260ms cubic-bezier(.2,.9,.3,1), opacity 260ms ease; }
        .modal-overlay:not(.active) { opacity: 0; pointer-events: none; }
        .modal-overlay.active { opacity: 1; pointer-events: auto; }
        /* world complete pulse */
        .world-complete { animation: pulse 1.2s ease-in-out; box-shadow: 0 12px 32px rgba(99,102,241,0.18); border-color: #60a5fa !important; }
        /* quiz feedback flash */
        .quiz-correct { animation: quiz-correct 700ms ease forwards; }
        .quiz-wrong { animation: quiz-wrong 700ms ease forwards; }
        @keyframes quiz-correct { 0% { background-color: transparent; } 50% { background-color: rgba(34,197,94,0.15); transform: scale(1.02); } 100% { background-color: transparent; transform: scale(1); } }
        @keyframes quiz-wrong { 0% { background-color: transparent; } 50% { background-color: rgba(239,68,68,0.12); transform: scale(0.98); } 100% { background-color: transparent; transform: scale(1); } }
        /* jenjang transition overlay */
        .jenjang-overlay { position: fixed; inset: 0; background: radial-gradient(circle at center, rgba(59,130,246,0.12), rgba(2,6,23,0.85)); z-index: 900; display: none; align-items: center; justify-content: center; }
        .jenjang-overlay.active { display: flex; animation: jenjang-fade 700ms ease forwards; }
        @keyframes jenjang-fade { 0% { opacity: 0; transform: scale(0.98); } 50% { opacity: 1; transform: scale(1.02); } 100% { opacity: 0; transform: scale(1); } }
        /* level-up popup */
        .levelup-popup { position: fixed; left: 50%; top: 20%; transform: translateX(-50%); z-index: 1001; padding: 14px 20px; background: linear-gradient(90deg,#f59e0b,#f97316); color: white; border-radius: 12px; box-shadow: 0 10px 30px rgba(0,0,0,0.25); font-weight:700; animation: levelup-pop 1200ms cubic-bezier(.2,.9,.3,1); }
        @keyframes levelup-pop { 0% { transform: translate(-50%, -10px) scale(0.9); opacity: 0; } 50% { transform: translate(-50%, 4px) scale(1.05); opacity: 1; } 100% { transform: translate(-50%, 0) scale(1); opacity: 1; } }
        /* --- Root Variables for Theming --- */
        :root {
            --bg-color: #f0f9ff;
            --text-color: #0c4a6e;
            --card-bg-color: #ffffff;
            --modal-bg-color: #ffffff;
            --border-color: #e0e7ff;
            --header-bg: rgba(255, 255, 255, 0.7);
            --locked-filter: grayscale(1);
            --pattern-url: url('data:image/svg+xml;utf8,<svg width="100" height="100" viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg"><g fill="%23a8c5ff" fill-opacity="0.1"><circle cx="50" cy="50" r="5" /><circle cx="10" cy="10" r="2" /><circle cx="90" cy="90" r="3" /><circle cx="10" cy="90" r="4" /><circle cx="90" cy="10" r="2" /></g></svg>');
        }
        /* --- Dark Theme --- */
        body.dark {
            --bg-color: #071022;
            --text-color: #e6eef8;
            --card-bg-color: #0f1724;
            --modal-bg-color: #0b1220;
            --border-color: #24303c;
            --header-bg: rgba(15, 23, 36, 0.85);
            --locked-filter: grayscale(1) invert(0.75);
            --pattern-url: url('data:image/svg+xml;utf8,<svg width="100" height="100" viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg"><g fill="%23343f4a" fill-opacity="0.18"><circle cx="50" cy="50" r="5" /><circle cx="10" cy="10" r="2" /><circle cx="90" cy="90" r="3" /><circle cx="10" cy="90" r="4" /><circle cx="90" cy="10" r="2" /></g></svg>');
        }
        /* --- High Contrast Theme --- */
       body.high-contrast {
           --bg-color: #000000;
           --text-color: #ffff00;
           --card-bg-color: #000000;
           --modal-bg-color: #000000;
           --border-color: #ffff00;
           --header-bg: rgba(0, 0, 0, 0.95);
       }

        /* --- General Styling --- */
        body { 
            font-family: 'Inter', sans-serif; 
            background-color: var(--bg-color); 
            color: var(--text-color); 
            transition: background-color 0.5s, color 0.5s;
            background-image: var(--pattern-url);
        }
        .font-brand { font-family: 'Fredoka One', cursive; }
        .card-hover { transition: transform 0.3s ease, box-shadow 0.3s ease; }
        .card-hover:hover { transform: translateY(-10px) scale(1.05); box-shadow: 0 20px 25px -5px rgb(0 0 0 / 0.1), 0 8px 10px -6px rgb(0 0 0 / 0.1); }
        .screen, .modal-overlay { display: none; }
        .screen.active, .modal-overlay.active { display: flex; }
        
        /* --- Animations --- */
        .screen.active { animation: fadeIn 0.6s cubic-bezier(0.25, 0.46, 0.45, 0.94) forwards; }
        .modal-overlay.active > .modal-content { animation: scaleUp 0.4s cubic-bezier(0.34, 1.56, 0.64, 1) forwards; }
        .star-animation { animation: star-pop 0.8s cubic-bezier(0.25, 0.46, 0.45, 0.94); }
        .point-animation { 
            position: fixed; top: 50%; left: 50%; 
            font-size: 2.5rem; font-weight: bold; color: #f59e0b; 
            z-index: 100; pointer-events: none; 
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
            animation: floatUpAndFade 1.5s ease-out forwards;
        }
        .mascot-tip { position: fixed; bottom: 20px; left: 20px; background-color: var(--modal-bg-color); padding: 15px; border-radius: 15px; box-shadow: 0 5px 15px rgba(0,0,0,0.2); z-index: 100; display: flex; align-items: center; max-width: 300px; animation: slideInLeft 0.5s ease-out; }
    .badge-pop { animation: badge-pop 900ms cubic-bezier(.2,.9,.3,1); transform-origin: center; }
    @keyframes badge-pop { 0% { transform: scale(0) rotate(-30deg); opacity: 0; } 60% { transform: scale(1.15) rotate(8deg); opacity: 1; } 100% { transform: scale(1) rotate(0); opacity: 1; } }
        .event-banner { background: linear-gradient(45deg, #f87171, #fb923c); color: white; text-shadow: 1px 1px 2px rgba(0,0,0,0.3); animation: pulse-bg 3s infinite; }
        .animate-shake { animation: shake 0.5s cubic-bezier(.36,.07,.19,.97) both; }

        /* --- Keyframes --- */
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
        @keyframes slideInLeft { from { transform: translateX(-100px); opacity: 0; } to { transform: translateX(0); opacity: 1; } }
        @keyframes scaleUp { from { transform: scale(0.7); opacity: 0; } to { transform: scale(1); opacity: 1; } }
        @keyframes floatUpAndFade { from { opacity: 1; transform: translate(-50%, -50%) scale(1); } to { opacity: 0; transform: translate(-50%, -250%) scale(1.5); } }
        @keyframes star-pop { 0% { transform: scale(0) rotate(-180deg); opacity: 0; } 60% { transform: scale(1.5) rotate(15deg); } 100% { transform: scale(1) rotate(0deg); opacity: 1; } }
        @keyframes pulse-bg { 0% { opacity: 0.8; } 50% { opacity: 1; } 100% { opacity: 0.8; } }
        @keyframes shake { 10%, 90% { transform: translate3d(-1px, 0, 0); } 20%, 80% { transform: translate3d(2px, 0, 0); } 30%, 50%, 70% { transform: translate3d(-4px, 0, 0); } 40%, 60% { transform: translate3d(4px, 0, 0); } }

        /* --- Component Specific Styles --- */
        .avatar { width: 60px; height: 60px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 2rem; color: white; transition: transform 0.3s; }
        .avatar:hover { transform: scale(1.1); }
        .avatar-selection { cursor: pointer; border: 4px solid transparent; border-radius: 50%; transition: all 0.2s ease; position: relative; }
        .avatar-selection.selected { border-color: #2563eb; transform: scale(1.1); box-shadow: 0 0 15px rgba(37, 99, 235, 0.5); }
    .shop-item { cursor: pointer; border: 4px solid var(--border-color); border-radius: 1.5rem; transition: all 0.2s ease; position: relative; background-color: var(--card-bg-color); }
    .shop-item:hover { transform: scale(1.05); box-shadow: 0 4px 10px rgba(0,0,0,0.1); }
    .shop-item.owned { border-color: #16a34a; }
    .shop-item.equipped { border-color: #2563eb; box-shadow: 0 0 20px rgba(37, 99, 235, 0.6); }
    .shop-item.locked::after { content: '🔒'; position: absolute; top: 8px; right: 8px; font-size: 1.5rem; background: rgba(0,0,0,0.4); color: white; border-radius: 50%; width: 30px; height: 30px; display: flex; align-items: center; justify-content: center; }
    .price-tag { position: absolute; bottom: -10px; left: 50%; transform: translateX(-50%); background: #fbbf24; color: #78350f; font-weight: bold; padding: 2px 10px; border-radius: 99px; font-size: 0.9rem; border: 2px solid white; }
    /* transient confirmation for purchases */
    .shop-confirm { position: fixed; z-index: 300; pointer-events: none; background: linear-gradient(90deg,#059669,#10b981); color: white; padding: 8px 12px; border-radius: 999px; font-weight: 700; box-shadow: 0 8px 24px rgba(0,0,0,0.25); transform: translate(-50%, -50%); animation: floatUpAndFade 1s ease-out forwards; }
    .shake { animation: shake 0.45s cubic-bezier(.36,.07,.19,.97) both; }
        .bonus-world-badge { position: absolute; top: -10px; right: -10px; background-color: #ef4444; color: white; font-weight: bold; font-size: 0.75rem; padding: 2px 8px; border-radius: 99px; transform: rotate(15deg); animation: pulse 1.5s infinite; }
    @keyframes pulse { 0%, 100% { transform: scale(1) rotate(15deg); } 50% { transform: scale(1.1) rotate(15deg); } }
    @keyframes jenjang-swap { 0% { transform: translateY(0) scale(1); opacity: 1; } 50% { transform: translateY(-18px) scale(1.02); opacity: 0.6; } 100% { transform: translateY(0) scale(1); opacity: 1; } }
    .jenjang-anim { animation: jenjang-swap 700ms ease-in-out; }
        /* Toggle Switch Style */
        .toggle-checkbox { transition: all 0.2s ease; }
        .toggle-checkbox:checked { transform: translateX(100%); border-color: #2563eb; }
        .toggle-checkbox:checked + .toggle-label { background-color: #2563eb; }
        .zen-mode #points-display, .zen-mode #streak-display { display: none; }
        .favorite-btn.favorited svg { fill: #facc15; stroke: #f59e0b; }
    /* --- Achievements card styles (borrowed from index.html) --- */
    .achievement-card { display:flex; gap:12px; align-items:flex-start; padding:14px; border-radius:10px; background:var(--card-bg-color); border:1px solid #e8edf2; box-shadow: none; }
    .achievement-card.locked { filter: var(--locked-filter); opacity: 0.95; }
    .achievement-icon { width:44px; height:44px; border-radius:8px; display:flex; align-items:center; justify-content:center; font-size:18px; background:#f1f5f9; border:1px solid rgba(0,0,0,0.03); flex-shrink:0; }
    .achievement-icon svg { width:28px; height:28px; display:block; }
    .achievement-body { flex:1; min-width:0; }
    .achievement-title { font-weight:700; font-size:1.05rem; color:#2b6ea3; margin-bottom:6px; }
    .achievement-desc { font-size:0.95rem; color:#7ea6bf; line-height:1.25; }
    .achievement-meta { display:none; }
    .achievement-badge { display:none; }
    /* stack list style */
    #achievements-list { display:block; }
    #achievements-list > div.achievement-card { margin-bottom:12px; }
    /* --- Modal header and share button styling to match index.html example --- */
    #achievements-modal .modal-content { position:relative; padding-top:18px; }
    #achievements-modal h3#achievements-title { font-size:1.6rem; color:#fb923c; letter-spacing:0.4px; margin:6px 0 10px 0; }
    #achievements-modal .share-btn { position:absolute; right:18px; top:12px; width:44px; height:44px; border-radius:999px; background:linear-gradient(180deg,#1d4ed8,#2563eb); display:flex; align-items:center; justify-content:center; color:white; box-shadow: 0 6px 18px rgba(37,99,235,0.18); border:4px solid rgba(255,255,255,0.6); cursor:pointer; }
    #achievements-modal .share-btn svg { width:20px; height:20px; }
    /* Rounded large close button at bottom like the screenshot */
    #close-achievements-btn { background: linear-gradient(180deg,#6b7280,#4b5563); color:white; padding:14px 18px; border-radius:999px; font-weight:700; box-shadow: 0 8px 20px rgba(15,23,42,0.18); }
    #close-achievements-btn:hover { transform: translateY(-1px); }
    /* custom scrollbar for achievements list */
    #achievements-list { scrollbar-width: thin; scrollbar-color: rgba(99,102,241,0.3) transparent; }
    #achievements-list::-webkit-scrollbar { width: 10px; }
    #achievements-list::-webkit-scrollbar-track { background: transparent; }
    #achievements-list::-webkit-scrollbar-thumb { background: linear-gradient(180deg,#c7d2fe,#a5b4fc); border-radius:999px; border: 2px solid rgba(255,255,255,0.6); }
    /* card hover effect and subtle border */
    .achievement-card { transition: transform 220ms ease, box-shadow 220ms ease, border-color 220ms ease; }
    .achievement-card:hover { transform: translateY(-6px); box-shadow: 0 12px 30px rgba(2,6,23,0.12); border-color: rgba(96,165,250,0.28); }
    </style>
</head>
<body class="text-gray-800">
    <audio id="background-music" loop>
        <source src="https://www.chosic.com/wp-content/uploads/2021/04/purrple-cat-wondering.mp3" type="audio/mpeg">
    </audio>

    <div id="app" class="min-h-screen flex flex-col items-center justify-center p-4 overflow-hidden">

        <!-- ===== SCREENS ===== -->
        <div id="loading-screen" class="screen active text-center flex-col w-full">
            <h1 class="font-brand text-5xl md:text-7xl text-sky-700 mb-4">Petualangan Pengetahuan</h1>
            <div class="animate-pulse text-2xl" style="color: var(--text-color);">Mempersiapkan Petualangan...</div>
        </div>
        
        <div id="user-selection-screen" class="screen text-center flex-col w-full max-w-4xl">
            <h1 class="font-brand text-5xl md:text-7xl text-sky-700 mb-4">Petualangan Pengetahuan</h1>
            <p class="text-lg md:text-xl mb-8" style="color: var(--text-color);">Siapa yang akan berpetualang hari ini?</p>
            <div id="user-list-container" class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-6 mb-8"></div>
            <button id="add-new-user-btn" class="bg-green-500 hover:bg-green-600 text-white font-bold py-4 px-8 rounded-full shadow-lg transform hover:scale-110 transition-transform duration-300 text-xl">+ Tambah Pengguna Baru</button>
        </div>

        <div id="name-entry-screen" class="screen flex-col w-full max-w-lg">
            <div class="p-8 rounded-3xl shadow-2xl w-full text-center" style="background-color: var(--card-bg-color);">
                 <h1 class="font-brand text-4xl text-sky-700 mb-2">Buat Profil Baru</h1>
                 <p class="mb-6" style="color: var(--text-color);">Masukkan nama dan pilih avatarmu!</p>
                 <input type="text" id="player-name-input" placeholder="Contoh: Budi" class="text-center text-2xl p-4 border-2 rounded-xl shadow-inner focus:border-orange-500 focus:ring-orange-500 mb-6 w-full" style="border-color: var(--border-color); background-color: var(--bg-color);">
                 <p class="font-semibold mb-4">Pilih Avatar:</p>
                 <div id="avatar-selection-container" class="flex justify-center gap-4 mb-8"></div>
                 <div class="flex gap-4">
                    <button id="cancel-new-user-btn" class="w-full bg-gray-200 hover:bg-gray-300 text-gray-700 font-bold py-3 px-6 rounded-xl shadow-md transition-transform duration-300">Batal</button>
                    <button id="next-to-level-btn" class="w-full bg-orange-500 hover:bg-orange-600 text-white font-bold py-3 px-6 rounded-xl shadow-lg transition-transform duration-300 disabled:bg-gray-400" disabled>Lanjut</button>
                 </div>
            </div>
        </div>
        
        <div id="jenjang-screen" class="screen text-center flex-col w-full max-w-3xl">
            <h1 class="font-brand text-4xl md:text-6xl text-sky-700 mb-2">Pilih Jenjangmu</h1>
            <p class="text-lg md:text-xl mb-8" id="jenjang-prompt-name" style="color: var(--text-color);"></p>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6 w-full max-w-2xl">
                <button data-jenjang="sd" class="jenjang-btn bg-green-500 hover:bg-green-600 text-white font-bold py-6 px-8 rounded-2xl shadow-lg transform hover:scale-105 transition-transform duration-300 text-2xl"><span class="text-4xl block mb-2">🎓</span> SD</button>
                <button data-jenjang="smp" class="jenjang-btn bg-blue-500 hover:bg-blue-600 text-white font-bold py-6 px-8 rounded-2xl shadow-lg transform hover:scale-105 transition-transform duration-300 text-2xl"><span class="text-4xl block mb-2">📚</span> SMP</button>
                <button data-jenjang="sma" class="jenjang-btn bg-purple-500 hover:bg-purple-600 text-white font-bold py-6 px-8 rounded-2xl shadow-lg transform hover:scale-105 transition-transform duration-300 text-2xl"><span class="text-4xl block mb-2">🔬</span> SMA</button>
                <button data-jenjang="kuliah" class="jenjang-btn bg-red-500 hover:bg-red-600 text-white font-bold py-6 px-8 rounded-2xl shadow-lg transform hover:scale-105 transition-transform duration-300 text-2xl"><span class="text-4xl block mb-2">💼</span> Mahasiswa</button>
            </div>
        </div>

        <!-- Inventory Modal -->
        <div id="inventory-modal" class="modal-overlay">
            <div class="modal-content p-6 rounded-2xl" style="background-color:var(--modal-bg-color);">
                <h2 class="font-semibold text-2xl mb-4">Inventori Kamu</h2>
                <div id="inventory-list" class="grid grid-cols-2 gap-4"></div>
                <div class="mt-4 flex justify-end gap-2">
                    <button onclick="hideModals()" class="px-4 py-2 rounded-lg bg-gray-200">Tutup</button>
                </div>
            </div>
        </div>

        <!-- Purchase History (small hidden modal) -->
        <div id="purchase-history-modal" class="modal-overlay">
            <div class="modal-content p-4 rounded-2xl" style="background-color:var(--modal-bg-color);">
                <h3 class="font-semibold">Riwayat Pembelian</h3>
                <div id="purchase-history-list" class="mt-2 max-h-48 overflow-auto text-sm"></div>
                <div class="mt-3 text-right"><button onclick="hideModals()" class="px-3 py-1 rounded bg-gray-200">Tutup</button></div>
            </div>
        </div>

        <!-- Autosave Indicator -->
        <div id="autosave-indicator" style="position:fixed;right:16px;bottom:16px;background:rgba(0,0,0,0.6);color:white;padding:8px 10px;border-radius:10px;z-index:200;display:none;font-size:0.9rem;">Tersimpan</div>

        <!-- Tooltip host -->
        <div id="tooltip-host" style="position:fixed;z-index:400;pointer-events:none;display:none;padding:6px 8px;background:rgba(0,0,0,0.8);color:white;border-radius:6px;font-size:0.9rem;">Tooltip</div>

        <div id="map-screen" class="screen w-full max-w-7xl mx-auto flex-col">
            <!-- CARI & GANTI KODE INI DI DALAM: <div id="map-screen" ...> -->

<header class="flex flex-wrap justify-between items-center mb-6 px-4 gap-4 w-full backdrop-blur-sm p-4 rounded-2xl shadow" style="background-color: var(--header-bg)">
    <!-- Bagian ini tetap sama, hanya untuk konteks -->
    <div class="flex items-center gap-4">
        <div id="user-avatar-header" class="avatar w-16 h-16 cursor-pointer" title="Ganti Pengguna"></div>
        <div>
            <h2 class="font-brand text-2xl md:text-4xl" style="color: var(--text-color);" id="welcome-message"></h2>
            <h3 class="font-semibold text-lg text-amber-700" id="user-title-display"></h3>
            <div class="flex items-center gap-4">
                <p class="text-md md:text-lg font-bold text-amber-600" id="points-display"></p>
                <p class="text-md md:text-lg font-bold text-red-500" id="streak-display" title="Bonus login beruntun!"></p>
            </div>
        </div>
    </div>

    <!-- audio debug removed (moved to settings on demand) -->
    <!-- Tombol-tombol navigasi -->
    <div class="flex items-center gap-2 flex-wrap justify-center">
       <button id="shop-hub-btn" class="bg-violet-500 hover:bg-violet-600 text-white font-semibold py-2 px-4 rounded-lg shadow-md transition-transform hover:scale-105">🛍️ Toko</button>
       <button id="daily-mission-btn" class="bg-cyan-500 hover:bg-cyan-600 text-white font-semibold py-2 px-4 rounded-lg shadow-md transition-transform hover:scale-105">🎯 Misi</button>
       <button id="leaderboard-btn" class="bg-yellow-500 hover:bg-yellow-600 text-white font-semibold py-2 px-4 rounded-lg shadow-md transition-transform hover:scale-105">🥇 Peringkat</button>
       <button id="achievements-btn" class="bg-amber-500 hover:bg-amber-600 text-white font-semibold py-2 px-4 rounded-lg shadow-md transition-transform hover:scale-105">🏆 Prestasi</button>
    <button id="settings-btn" class="bg-gray-700 hover:bg-gray-800 text-white font-semibold py-2 px-4 rounded-lg shadow-md transition-transform hover:scale-105">⚙️</button>
    <button id="inventory-btn" class="bg-indigo-600 hover:bg-indigo-700 text-white font-semibold py-2 px-4 rounded-lg shadow-md transition-transform hover:scale-105">🎒 Inventori</button>
       
    <!-- AWAL KODE BARU: Tombol Fullscreen -->
    <button id="fullscreen-btn" class="bg-gray-700 hover:bg-gray-800 text-white font-semibold py-2 px-4 rounded-lg shadow-md transition-transform hover:scale-105">⛶</button>
       <!-- AKHIR KODE BARU -->
    </div>
</header>

            <div id="event-banner-container" class="w-full mb-4 px-2"></div>
            <div class="w-full mb-4 px-2">
                 <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
                    <div class="p-3 rounded-lg shadow" style="background-color: var(--card-bg-color);">
                         <h3 class="font-bold text-center" style="color: var(--text-color);">📚 Kata Hari Ini</h3>
                         <p id="word-of-the-day" class="text-center text-sm"></p>
                    </div>
                    <div class="p-3 rounded-lg shadow flex items-center justify-around" style="background-color: var(--card-bg-color);">
                        <button id="review-mode-btn" class="bg-teal-500 hover:bg-teal-600 text-white font-semibold py-2 px-3 rounded-lg text-sm transition-transform hover:scale-105">🔁 Favorit</button>
                        <button id="timed-challenge-btn" class="bg-rose-500 hover:bg-rose-600 text-white font-semibold py-2 px-3 rounded-lg text-sm transition-transform hover:scale-105">⏱️ Tantangan Waktu</button>
                    </div>
                </div>
                <input type="text" id="search-bar" placeholder="🔍 Cari dunia atau topik..." class="w-full p-3 rounded-lg border-2 shadow-sm" style="border-color: var(--border-color); background-color: var(--card-bg-color);">
            </div>
            <div id="dunia-container" class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 xl:grid-cols-5 gap-6 md:gap-8 w-full p-2 overflow-y-auto"></div>
        </div>
        
        <div id="submateri-screen" class="screen w-full max-w-5xl mx-auto flex-col">
             <div class="flex justify-between items-center w-full mb-10">
                <button id="back-to-worlds-btn" class="bg-gray-500 hover:bg-gray-600 text-white font-bold p-3 rounded-full shadow-lg transform hover:scale-105 transition-transform">&larr;</button>
                <h2 id="submateri-title" class="font-brand text-4xl md:text-5xl text-center"></h2>
                <div class="flex items-center gap-2 p-2 rounded-full" style="background-color: var(--card-bg-color);">
                    <label for="progress-tree-toggle" class="text-sm font-semibold hidden sm:inline">Pohon Progres</label>
                    <div class="relative inline-block w-10 mr-2 align-middle select-none transition duration-200 ease-in">
                        <input type="checkbox" name="progress-tree-toggle" id="progress-tree-toggle" class="toggle-checkbox absolute block w-6 h-6 rounded-full bg-white border-4 appearance-none cursor-pointer" style="border-color: var(--border-color);"/>
                        <label for="progress-tree-toggle" class="toggle-label block overflow-hidden h-6 rounded-full bg-gray-300 cursor-pointer"></label>
                    </div>
                </div>
            </div>
             <div id="submateri-container" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 w-full p-2 overflow-y-auto"></div>
       </div>

       <div id="materi-screen" class="screen w-full max-w-4xl mx-auto p-6 md:p-10 rounded-2xl shadow-2xl flex-col" style="background-color: var(--card-bg-color);">
           <div id="materi-content" class="w-full"></div>
            <div class="text-center mt-8 w-full"><button id="back-to-submateri-btn" class="bg-gray-500 hover:bg-gray-600 text-white font-bold py-3 px-6 rounded-full shadow-lg transform hover:scale-105 transition-transform">&larr; Kembali Pilih Materi</button></div>
       </div>
    </div>

    <!-- ===== MODALS ===== -->
    <div id="shop-hub-modal" class="modal-overlay fixed inset-0 bg-black bg-opacity-70 items-center justify-center p-4 z-50">
        <div class="modal-content p-8 shadow-2xl w-full max-w-2xl rounded-2xl" style="background-color: var(--modal-bg-color);">
            <h3 class="font-brand text-4xl text-violet-600 text-center mb-6">Pusat Perbelanjaan</h3>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6 text-center">
                <div id="open-avatar-shop" class="p-6 bg-rose-100 rounded-2xl cursor-pointer card-hover border-2 border-rose-300">
                    <div class="text-5xl mb-2">👕</div>
                    <h4 class="font-bold text-xl text-rose-800">Toko Avatar</h4>
                    <p class="text-sm text-rose-600">Ganti penampilanmu!</p>
                </div>
                <div id="open-customization-shop" class="p-6 bg-sky-100 rounded-2xl cursor-pointer card-hover border-2 border-sky-300">
                    <div class="text-5xl mb-2">🎨</div>
                    <h4 class="font-bold text-xl text-sky-800">Warung Kustomisasi</h4>
                    <p class="text-sm text-sky-600">Ubah tema & warna.</p>
                </div>
                <div id="open-burunghantu-shop" class="p-6 bg-amber-100 rounded-2xl cursor-pointer card-hover border-2 border-amber-300">
                    <div class="text-5xl mb-2">🦉</div>
                    <h4 class="font-bold text-xl text-amber-800">Butik Burung Hantu</h4>
                    <p class="text-sm text-amber-600">Aksesoris & pakaian keren.</p>
                </div>
                <div id="open-bonus-shop" class="p-6 bg-yellow-100 rounded-2xl cursor-pointer card-hover border-2 border-yellow-300">
                    <div class="text-5xl mb-2">⭐</div>
                    <h4 class="font-bold text-xl text-yellow-800">Toko Bonus</h4>
                    <p class="text-sm text-yellow-600">Power-up dan paket istimewa.</p>
                </div>
                <div id="open-bgm-shop" class="p-6 bg-indigo-100 rounded-2xl cursor-pointer card-hover border-2 border-indigo-300">
                    <div class="text-5xl mb-2">🎧</div>
                    <h4 class="font-bold text-xl text-indigo-800">Toko Musik</h4>
                    <p class="text-sm text-indigo-600">Beli musik latar untuk suasana belajar.</p>
                </div>
                <div id="open-sfx-shop" class="p-6 bg-emerald-100 rounded-2xl cursor-pointer card-hover border-2 border-emerald-300">
                    <div class="text-5xl mb-2">🔊</div>
                    <h4 class="font-bold text-xl text-emerald-800">Toko Efek Suara</h4>
                    <p class="text-sm text-emerald-600">Beli paket efek klik & navigasi.</p>
                </div>
            </div>
            <button id="close-shop-hub-btn" class="mt-8 bg-gray-500 hover:bg-gray-600 text-white font-bold py-2 px-6 rounded-full w-full transition-transform hover:scale-105">Tutup</button>
        </div>
    </div>
    
    <div id="avatar-shop-modal" class="modal-overlay fixed inset-0 bg-black bg-opacity-70 items-center justify-center p-4 z-50">
        <div class="modal-content p-8 shadow-2xl w-full max-w-3xl rounded-2xl" style="background-color: var(--modal-bg-color);">
            <div class="flex justify-between items-center mb-6">
                <h3 class="font-brand text-3xl text-violet-600">👕 Toko Avatar 👕</h3>
                <div class="font-bold text-amber-600 text-xl bg-amber-100 px-4 py-2 rounded-full" id="shop-points-display"></div>
            </div>
            <div id="avatar-shop-container" class="grid grid-cols-3 sm:grid-cols-4 md:grid-cols-5 gap-6 max-h-80 overflow-y-auto p-4 bg-gray-50 rounded-lg" style="background-color: var(--bg-color);"></div>
            <button id="close-avatar-shop-btn" class="mt-6 bg-gray-500 hover:bg-gray-600 text-white font-bold py-2 px-6 rounded-full shadow-lg w-full transition-transform hover:scale-105">Tutup</button>
        </div>
    </div>

    <div id="customize-mascot-modal" class="modal-overlay fixed inset-0 bg-black bg-opacity-60 items-center justify-center p-4 z-50" style="display:none;">
        <div class="modal-content p-6 shadow-2xl w-full max-w-md rounded-2xl" style="background-color: var(--modal-bg-color);">
            <h3 class="font-brand text-3xl text-fuchsia-600 text-center mb-4">🎭 Kostumisasi Maskot</h3>
            <p class="text-sm mb-4">Pilih kostum atau warna maskotmu (placeholder - integrasi shop tersedia).</p>
            <div class="grid grid-cols-2 gap-3 mb-4">
                <button class="mascot-style-btn p-3 rounded-lg" data-style="default">Default</button>
                <button class="mascot-style-btn p-3 rounded-lg" data-style="space">Luar Angkasa</button>
            </div>
            <button id="close-customize-mascot" class="mt-2 bg-gray-500 hover:bg-gray-600 text-white font-bold py-2 px-4 rounded-full w-full">Tutup</button>
        </div>
    </div>
    
    <div id="generic-shop-modal" class="modal-overlay fixed inset-0 bg-black bg-opacity-70 items-center justify-center p-4 z-50">
        <div class="modal-content p-8 shadow-2xl w-full max-w-3xl rounded-2xl" style="background-color: var(--modal-bg-color);">
            <div class="flex justify-between items-center mb-2">
                <div>
                    <h3 id="generic-shop-title" class="font-brand text-3xl">Nama Toko</h3>
                    <div id="generic-shop-subtitle" class="text-sm text-gray-500">Suara standar sudah aktif — toko berisi variasi. Tekan "Pilih" untuk mengganti.</div>
                </div>
                <div class="font-bold text-amber-600 text-xl bg-amber-100 px-4 py-2 rounded-full" id="generic-shop-points"></div>
            </div>
            <div id="generic-shop-container" class="grid grid-cols-2 md:grid-cols-3 gap-4 max-h-80 overflow-y-auto p-4 rounded-lg" style="background-color: var(--bg-color);"></div>
            <button class="generic-shop-close-btn mt-6 bg-gray-500 hover:bg-gray-600 text-white font-bold py-2 px-6 rounded-full shadow-lg w-full transition-transform hover:scale-105">Tutup</button>
        </div>
    </div>
    
    <div id="settings-modal" class="modal-overlay fixed inset-0 bg-black bg-opacity-70 items-center justify-center p-4 z-50">
        <div class="modal-content p-6 shadow-2xl w-full max-w-md rounded-2xl" style="background-color: var(--modal-bg-color);">
            <h3 class="font-brand text-3xl text-sky-800 text-center mb-4">Pengaturan</h3>
            <div class="w-full">
                <div class="border-b" style="border-color: var(--border-color);">
                    <nav class="-mb-px flex space-x-4" aria-label="Tabs">
                        <button class="settings-tab whitespace-nowrap py-3 px-1 border-b-2 font-medium text-sm border-sky-500 text-sky-600" data-tab="general">Umum</button>
                        <button class="settings-tab whitespace-nowrap py-3 px-1 border-b-2 font-medium text-sm border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300" data-tab="appearance">Tampilan</button>
                        <button class="settings-tab whitespace-nowrap py-3 px-1 border-b-2 font-medium text-sm border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300" data-tab="account">Akun</button>
                    </nav>
                </div>
                <div id="settings-tab-content" class="py-4">
                    <div class="settings-tab-pane active" id="tab-general">
                        <div class="flex justify-between items-center p-3 rounded-lg mb-3" style="background-color: var(--bg-color);">
                            <label for="sound-toggle" class="font-semibold">Efek Suara</label>
                            <button id="sound-toggle" class="text-2xl">🔊</button>
                        </div>
                         <div class="flex justify-between items-center p-3 rounded-lg mb-3" style="background-color: var(--bg-color);">
                            <label for="music-toggle" class="font-semibold">Musik Latar</label>
                            <button id="music-toggle" class="text-2xl">🎵</button>
                        </div>
                        <div class="flex justify-between items-center p-3 rounded-lg" style="background-color: var(--bg-color);">
                            <label for="zen-mode-toggle" class="font-semibold">Mode Zen (Tanpa Skor)</label>
                            <div class="relative inline-block w-10 mr-2 align-middle select-none">
                                <input type="checkbox" name="zen-mode-toggle" id="zen-mode-toggle" class="toggle-checkbox absolute block w-6 h-6 rounded-full bg-white border-4 appearance-none cursor-pointer" style="border-color: var(--border-color);"/>
                                <label for="zen-mode-toggle" class="toggle-label block overflow-hidden h-6 rounded-full bg-gray-300 cursor-pointer"></label>
                            </div>
                        </div>
                    </div>
                    <div class="settings-tab-pane" id="tab-appearance" style="display: none;">
                         <span class="block font-semibold mb-2">Tema Tampilan</span>
                         <div class="grid grid-cols-2 gap-2" id="theme-selector">
                             <button data-theme="light" class="w-full p-2 border-2 rounded-lg font-semibold">☀️ Terang</button>
                             <button data-theme="dark" class="w-full p-2 border-2 rounded-lg font-semibold">🌙 Gelap</button>
                             <button data-theme="high-contrast" class="col-span-2 w-full p-2 border-2 rounded-lg font-semibold">Kontras Tinggi</button>
                             <div class="col-span-2 mt-3 p-3 rounded-lg" style="background-color:var(--card-bg-color);">
                                 <label class="font-semibold">Tampilkan Konfirmasi Pembelian</label>
                                 <input id="confirm-toggle" type="checkbox" checked style="margin-left:8px;" />
                             </div>
                         </div>
                    </div>
                    <div class="settings-tab-pane" id="tab-account" style="display: none;">
                        <div class="space-y-4">
                             <div>
                                <label for="edit-name-input" class="block font-semibold mb-2">Ganti Nama</label>
                                <div class="flex gap-2">
                                    <input type="text" id="edit-name-input" class="w-full p-2 border-2 rounded-lg" style="border-color: var(--border-color); background-color: var(--bg-color);">
                                    <button id="save-name-btn" class="bg-blue-500 hover:bg-blue-600 text-white font-bold py-2 px-4 rounded-lg">Simpan</button>
                                </div>
                            </div>
                             <div>
                                <label for="change-jenjang-select" class="block font-semibold mb-2">Ganti Jenjang</label>
                                <select id="change-jenjang-select" class="w-full p-2 border-2 rounded-lg" style="border-color: var(--border-color); background-color: var(--bg-color); color: var(--text-color);">
                                    <option value="sd">SD</option><option value="smp">SMP</option><option value="sma">SMA</option><option value="kuliah">Mahasiswa</option>
                                </select>
                            </div>
                             <hr style="border-color: var(--border-color);"/>
                            <button id="reset-progress-btn" class="w-full text-left p-3 bg-red-100 hover:bg-red-200 text-red-700 rounded-lg font-bold">🗑️ Reset Progres Pengguna Ini</button>
                        </div>
                    </div>
                </div>
            </div>
            <button id="close-settings-btn" class="mt-4 bg-gray-500 hover:bg-gray-600 text-white font-bold py-2 px-6 rounded-full w-full transition-transform hover:scale-105">Tutup</button>
        </div>
    </div>
    
    <div id="daily-bonus-modal" class="modal-overlay fixed inset-0 bg-black bg-opacity-70 items-center justify-center p-4 z-50">
        <div class="modal-content p-8 shadow-2xl w-full max-w-sm text-center rounded-2xl" style="background-color: var(--modal-bg-color);">
            <h3 class="font-brand text-3xl text-yellow-500">Bonus Login Harian!</h3>
            <div class="text-7xl my-4 animate-bounce">💰</div>
            <p class="text-lg mb-2">Kamu mendapatkan <strong class="text-amber-600" id="daily-bonus-amount">50 Poin</strong>!</p>
            <p class="text-lg mb-4" id="daily-streak-bonus-text"></p>
            <button id="close-daily-bonus-btn" class="bg-green-500 hover:bg-green-600 text-white font-bold py-2 px-6 rounded-full w-full">Asyik!</button>
        </div>
    </div>

    <div id="confirm-reset-modal" class="modal-overlay fixed inset-0 bg-black bg-opacity-70 items-center justify-center p-4 z-50">
        <div class="modal-content p-8 shadow-2xl w-full max-w-sm text-center rounded-2xl" style="background-color: var(--modal-bg-color);">
            <h3 class="font-bold text-2xl text-red-700">PERINGATAN!</h3>
            <p class="my-4">Yakin ingin mereset progres untuk <strong id="reset-username-confirm"></strong>? Semua poin & lencana akan hilang.</p>
            <div class="flex justify-center gap-4 mt-6">
                <button id="cancel-reset-btn" class="bg-gray-300 hover:bg-gray-400 text-gray-800 font-bold py-2 px-6 rounded-full">Batal</button>
                <button id="confirm-reset-btn" class="bg-red-600 hover:bg-red-700 text-white font-bold py-2 px-6 rounded-full">Ya, Yakin</button>
            </div>
        </div>
    </div>

    <div id="fun-fact-modal" class="modal-overlay fixed inset-0 bg-black bg-opacity-60 items-center justify-center p-4 z-50">
        <div class="modal-content p-8 shadow-2xl w-full max-w-md text-center rounded-2xl" style="background-color: var(--modal-bg-color);">
            <div id="mascot-container" class="w-24 h-24 mx-auto mb-4"></div>
            <h3 class="font-brand text-2xl text-sky-700">Fakta Seru!</h3>
            <p id="fun-fact-text" class="my-4"></p>
            <button id="close-fun-fact-btn" class="bg-green-500 hover:bg-green-600 text-white font-bold py-2 px-6 rounded-full shadow-lg">Lanjut!</button>
        </div>
    </div>
    
    <div id="achievements-modal" class="modal-overlay fixed inset-0 bg-black bg-opacity-60 items-center justify-center p-4 z-50" role="dialog" aria-modal="true" aria-labelledby="achievements-title" aria-hidden="true">
        <div class="modal-content p-8 shadow-2xl w-full max-w-lg rounded-2xl" style="background-color: var(--modal-bg-color);" role="document">
             <h3 id="achievements-title" class="font-brand text-3xl text-amber-600 text-center">🏆 Prestasiku 🏆</h3>
            <div class="share-btn" title="Bagikan prestasi" onclick="navigator.clipboard?.writeText && navigator.clipboard.writeText('Lihat prestasiku di Edu Adventure!') && showMascotTip('Link prestasi disalin ke clipboard')">
                <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M12 3v12" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/><path d="M8 7l4-4 4 4" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg>
            </div>
            <div class="mb-3 grid grid-cols-3 gap-2">
                <label class="col-span-1 text-sm font-semibold">Jenjang</label>
                <select id="achievements-jenjang-select" class="col-span-2 p-2 rounded-lg border-2" style="border-color: var(--border-color); background-color: var(--card-bg-color);">
                    <option value="sd">SD</option>
                    <option value="smp">SMP</option>
                    <option value="sma">SMA</option>
                    <option value="kuliah">Kuliah</option>
                </select>
            </div>
            <div class="mb-3 grid grid-cols-3 gap-2 items-center">
                <label class="col-span-1 text-sm font-semibold">Filter</label>
                <select id="achievements-filter-select" class="col-span-2 p-2 rounded-lg border-2" style="border-color: var(--border-color); background-color: var(--card-bg-color);">
                    <option value="all">Semua</option>
                    <option value="locked">Terkunci</option>
                    <option value="unlocked">Terklaim</option>
                </select>
            </div>
            <div class="mb-2 flex items-center justify-between gap-3">
                <p class="text-sm text-gray-600">Tunjukkan prestasi yang sudah kamu kumpulkan. Klik untuk detail atau klaim reward.</p>
                <div class="text-sm text-gray-500">Total: <span id="achievements-count">0</span></div>
            </div>
            <div id="achievements-list" class="grid max-h-80 overflow-y-auto mt-2 p-1" tabindex="0" role="list"></div>
            <!-- live region for screen readers -->
            <div id="aria-live-announcer" aria-live="polite" aria-atomic="true" class="sr-only" style="position:absolute;left:-9999px;top:auto;width:1px;height:1px;overflow:hidden;"></div>
            <div class="force-award">
                <label class="text-sm text-gray-500">(Debug) Force Award:</label>
                <select id="force-award-jenjang" class="p-1 rounded border">
                    <option value="sd">SD</option>
                    <option value="smp">SMP</option>
                    <option value="sma">SMA</option>
                    <option value="kuliah">Kuliah</option>
                </select>
                <select id="force-award-select" class="p-1 rounded border flex-1"></select>
                <button id="force-award-btn" class="px-3 py-1 bg-amber-400 rounded">Award</button>
            </div>
            <button id="close-achievements-btn" class="mt-6 bg-gray-500 hover:bg-gray-600 text-white font-bold py-2 px-6 rounded-full shadow-lg w-full">Tutup</button>
        </div>
    </div>

    <div id="leaderboard-modal" class="modal-overlay fixed inset-0 bg-black bg-opacity-60 items-center justify-center p-4 z-50">
        <div class="modal-content p-8 shadow-2xl w-full max-w-lg rounded-2xl" style="background-color: var(--modal-bg-color);">
            <h3 class="font-brand text-3xl text-yellow-600 text-center mb-4">🥇 Papan Peringkat 🥇</h3>
            <div id="leaderboard-list" class="space-y-2 max-h-80 overflow-y-auto"></div>
            <button id="close-leaderboard-btn" class="mt-6 bg-gray-500 hover:bg-gray-600 text-white font-bold py-2 px-6 rounded-full shadow-lg w-full">Tutup</button>
        </div>
    </div>
    
    <div id="stats-modal" class="modal-overlay fixed inset-0 bg-black bg-opacity-60 items-center justify-center p-4 z-50">
        <div class="modal-content bg-white rounded-2xl p-8 shadow-2xl w-full max-w-md scale-up">
            <h3 class="font-brand text-3xl text-sky-800 text-center mb-4" id="stats-username">Statistik Budi</h3>
            <div id="stats-content" class="space-y-3"></div>
            <button id="close-stats-btn" class="mt-6 bg-gray-500 hover:bg-gray-600 text-white font-bold py-2 px-6 rounded-full w-full">Tutup</button>
        </div>
    </div>

    <div id="daily-mission-modal" class="modal-overlay fixed inset-0 bg-black bg-opacity-60 items-center justify-center p-4 z-50">
        <div class="modal-content p-8 shadow-2xl w-full max-w-md text-center rounded-2xl" style="background-color: var(--modal-bg-color);">
            <h3 class="font-brand text-3xl text-cyan-600 text-center mb-4">🎯 Misi Harian 🎯</h3>
            <p id="daily-mission-text" class="text-lg my-4"></p>
            <div id="mission-progress-container" class="w-full bg-gray-200 rounded-full h-6 my-4">
                <div id="mission-progress-bar" class="bg-cyan-500 h-6 rounded-full text-white flex items-center justify-center text-sm font-bold transition-all duration-500" style="width: 0%;">0%</div>
            </div>
            <button id="claim-mission-reward-btn" class="bg-green-500 hover:bg-green-600 text-white font-bold py-3 px-6 rounded-full shadow-lg w-full disabled:bg-gray-400 disabled:cursor-not-allowed">Klaim Hadiah</button>
            <button id="close-daily-mission-btn" class="mt-4 bg-gray-500 hover:bg-gray-600 text-white font-bold py-2 px-6 rounded-full shadow-lg w-full">Tutup</button>
        </div>
    </div>

    <div id="timed-challenge-modal" class="modal-overlay fixed inset-0 bg-black bg-opacity-70 items-center justify-center p-4 z-50">
        <div class="modal-content p-8 shadow-2xl w-full max-w-xl text-center rounded-2xl" style="background-color: var(--modal-bg-color);">
            <h3 class="font-brand text-3xl text-rose-600">⏱️ Tantangan Waktu ⏱️</h3>
            <div id="challenge-header" class="my-2 flex items-center justify-between">
                <div id="challenge-timer" class="text-2xl font-bold">00:00</div>
                <div id="challenge-score" class="text-lg font-semibold">Skor: 0</div>
            </div>
            <div id="challenge-question-area" class="my-4 text-left"></div>
            <div id="challenge-feedback" class="mt-4 font-bold h-6"></div>
            <div class="grid grid-cols-2 gap-3 mt-4">
                <button id="start-challenge-btn" class="bg-emerald-500 hover:bg-emerald-600 text-white font-bold py-2 px-4 rounded-full">Mulai</button>
                <button id="stop-challenge-btn" class="bg-red-500 hover:bg-red-600 text-white font-bold py-2 px-4 rounded-full">Berhenti</button>
            </div>
            <button id="close-timed-challenge-btn" class="mt-4 bg-gray-500 hover:bg-gray-600 text-white font-bold py-2 px-6 rounded-full w-full">Tutup</button>
        </div>
    </div>

     <div id="favorites-modal" class="modal-overlay fixed inset-0 bg-black bg-opacity-60 items-center justify-center p-4 z-50">
        <div class="modal-content p-8 shadow-2xl w-full max-w-lg rounded-2xl" style="background-color: var(--modal-bg-color);">
            <h3 class="font-brand text-3xl text-teal-600 text-center mb-4">🔁 Latihan Favorit 🔁</h3>
            <div id="favorites-list" class="space-y-2 max-h-80 overflow-y-auto"></div>
            <button id="close-favorites-btn" class="mt-6 bg-gray-500 hover:bg-gray-600 text-white font-bold py-2 px-6 rounded-full shadow-lg w-full">Tutup</button>
        </div>
    </div>

    <!-- ===== Container for Animations ===== -->
    <div id="animation-container" class="pointer-events-none"></div>
    <div id="mascot-tip-container"></div>
    <!-- jenjang transition overlay -->
    <div id="jenjang-overlay" class="jenjang-overlay" aria-hidden="true"><div style="color:white;text-align:center;"><h2 class="font-brand text-4xl">Mengubah jenjang...</h2><p class="mt-2">Memuat konten sesuai jenjangmu</p></div></div>

    <script>
        // --- DATA APLIKASI ---

        const avatarData = {
            'avatar1': { svg: `<svg viewBox="0 0 36 36" fill="none" role="img" xmlns="http://www.w3.org/2000/svg" width="80" height="80"><mask id="mask__beam" maskUnits="userSpaceOnUse" x="0" y="0" width="36" height="36"><rect width="36" height="36" fill="#FFFFFF" rx="72"></rect></mask><g mask="url(#mask__beam)"><rect width="36" height="36" fill="#75d475"></rect><rect x="0" y="0" width="36" height="36" transform="translate(4 4) rotate(268 18 18) scale(1.2)" fill="#248038" rx="36"></rect><g transform="translate(-4 -1) rotate(8 18 18)"><path d="M15 21c2 1 4 1 6 0" stroke="#000000" fill="none" stroke-linecap="round"></path><rect x="10" y="14" width="1.5" height="2" rx="1" stroke="none" fill="#000000"></rect><rect x="24" y="14" width="1.5" height="2" rx="1" stroke="none" fill="#000000"></rect></g></g></svg>`, price: 0, isStarter: true },
            'avatar2': { svg: `<svg viewBox="0 0 36 36" fill="none" role="img" xmlns="http://www.w3.org/2000/svg" width="80" height="80"><mask id="mask__beam" maskUnits="userSpaceOnUse" x="0" y="0" width="36" height="36"><rect width="36" height="36" fill="#FFFFFF" rx="72"></rect></mask><g mask="url(#mask__beam)"><rect width="36" height="36" fill="#84b6e0"></rect><rect x="0" y="0" width="36" height="36" transform="translate(0 0) rotate(329 18 18) scale(1.2)" fill="#25648a" rx="36"></rect><g transform="translate(0 5) rotate(-9 18 18)"><path d="M15 21c2 1 4 1 6 0" stroke="#FFFFFF" fill="none" stroke-linecap="round"></path><rect x="14" y="14" width="1.5" height="2" rx="1" stroke="none" fill="#FFFFFF"></rect><rect x="20" y="14" width="1.5" height="2" rx="1" stroke="none" fill="#FFFFFF"></rect></g></g></svg>`, price: 0, isStarter: true },
            'avatar3': { svg: `<svg viewBox="0 0 36 36" fill="none" role="img" xmlns="http://www.w3.org/2000/svg" width="80" height="80"><mask id="mask__beam" maskUnits="userSpaceOnUse" x="0" y="0" width="36" height="36"><rect width="36" height="36" fill="#f0c38e"></rect></mask><g mask="url(#mask__beam)"><rect width="36" height="36" fill="#f0c38e"></rect><rect x="0" y="0" width="36" height="36" transform="translate(8 -6) rotate(114 18 18) scale(1.2)" fill="#a07d58" rx="36"></rect><g transform="translate(4 -4) rotate(-4 18 18)"><path d="M13,21 a8,8 0 0,0 10,0" fill="#000000"></path><rect x="14" y="14" width="1.5" height="2" rx="1" stroke="none" fill="#000000"></rect><rect x="20" y="14" width="1.5" height="2" rx="1" stroke="none" fill="#000000"></rect></g></g></svg>`, price: 0, isStarter: true },
            'avatar4': { svg: `<svg viewBox="0 0 36 36" fill="none" role="img" xmlns="http://www.w3.org/2000/svg" width="80" height="80"><mask id="mask__beam" maskUnits="userSpaceOnUse" x="0" y="0" width="36" height="36"><rect width="36" height="36" fill="#FFFFFF" rx="72"></rect></mask><g mask="url(#mask__beam)"><rect width="36" height="36" fill="#e0a3a3"></rect><rect x="0" y="0" width="36" height="36" transform="translate(-4 -4) rotate(278 18 18) scale(1.1)" fill="#9c5656" rx="64"></rect><g transform="translate(-4 0) rotate(8 18 18)"><path d="M15 19c2 1 4 1 6 0" stroke="#FFFFFF" fill="none" stroke-linecap="round"></path><rect x="11" y="14" width="1.5" height="2" rx="1" stroke="none" fill="#FFFFFF"></rect><rect x="23" y="14" width="1.5" height="2" rx="1" stroke="none" fill="#FFFFFF"></rect></g></g></svg>`, price: 0, isStarter: true },
            'avatar5': { name: "Kucing Lucu", svg: `<svg width="80" height="80" viewBox="0 0 36 36" fill="none" xmlns="http://www.w3.org/2000/svg"><mask id="mask0_33_33" style="mask-type:alpha" maskUnits="userSpaceOnUse" x="0" y="0" width="36" height="36"><circle cx="18" cy="18" r="18" fill="#D9D9D9"/></mask><g mask="url(#mask0_33_33)"><rect width="36" height="36" fill="#F2D4A7"/><ellipse cx="18" cy="33.5" rx="18" ry="13.5" fill="#3B2219"/><path d="M-5 13C-5 5.8203 0.8203 -1.13379e-06 8 -1.13379e-06V13H-5Z" fill="#6A463A"/><path d="M41 13C41 5.8203 35.1797 -1.13379e-06 28 -1.13379e-06V13H41Z" fill="#6A463A"/><rect x="11" y="16" width="3" height="4" rx="1.5" fill="white"/><rect x="22" y="16" width="3" height="4" rx="1.5" fill="white"/><path d="M13 23C13 23 15 25 18 25C21 25 23 23 23 23" stroke="white" stroke-width="2" stroke-linecap="round"/></g></svg>`, price: 200 },
        };
        // helper: produce a small inline SVG for achievements (simple set of icons)
        // accepts optional jenjang so icons can match per-jenjang palettes
        function defaultAchievementIconSVG(index, jenjang) {
            const palette = (jenjang && jenjangPalettes[jenjang]) ? jenjangPalettes[jenjang] : defaultPalette;
            const i = (index || 0) % palette.length;
            const fill = palette[i];
            switch(i) {
                case 0: return `<svg viewBox="0 0 64 64" xmlns="http://www.w3.org/2000/svg"><circle cx="32" cy="16" r="4" fill="${fill}"/><rect x="16" y="30" width="32" height="4" rx="2" fill="${fill}"/><circle cx="32" cy="48" r="4" fill="${fill}"/></svg>`; /* division */
                case 1: return `<svg viewBox="0 0 64 64" xmlns="http://www.w3.org/2000/svg"><path d="M12 16c6 6 12 6 18 0 6-6 12-6 18 0v16c-6 6-12 6-18 0-6-6-12-6-18 0z" fill="${fill}"/></svg>`; /* stylized helix */
                case 2: return `<svg viewBox="0 0 64 64" xmlns="http://www.w3.org/2000/svg"><circle cx="32" cy="32" r="10" fill="${fill}" opacity="0.14"/><path d="M8 32c8-12 40-12 48 0-8 12-40 12-48 0z" fill="${fill}"/></svg>`; /* atom */
                case 3: return `<svg viewBox="0 0 64 64" xmlns="http://www.w3.org/2000/svg"><circle cx="32" cy="28" r="12" fill="${fill}"/><path d="M20 46l4 8h16l4-8z" fill="${fill}" opacity="0.94"/></svg>`; /* medal */
                case 4: return `<svg viewBox="0 0 64 64" xmlns="http://www.w3.org/2000/svg"><rect x="12" y="12" width="40" height="28" rx="4" fill="${fill}"/><path d="M20 44h24v4H20z" fill="${fill}"/></svg>`; /* book */
                default: return `<svg viewBox="0 0 64 64" xmlns="http://www.w3.org/2000/svg"><path d="M32 8l8 24H24L32 8z" fill="${fill}"/><rect x="16" y="36" width="32" height="12" rx="3" fill="${fill}"/></svg>`; /* idea */
            }
        }

        // ensure each jenjang has up to 15 achievement definitions (fill with sensible placeholders)
        function ensureAchievementDefinitions(targetCount = 15) {
            ['sd','smp','sma','kuliah'].forEach(j => {
                achievementsDefinitions[j] = achievementsDefinitions[j] || [];
                const defs = achievementsDefinitions[j];
                const baseIndex = defs.length + 1;
                for (let i = defs.length; i < targetCount; i++) {
                    const id = `${j}_placeholder_${i+1}`;
                    const title = defs[i] && defs[i].title ? defs[i].title : `Prestasi ${i+1}`;
                    const desc = defs[i] && defs[i].desc ? defs[i].desc : `Capai target untuk prestasi nomor ${i+1} pada jenjang ${j.toUpperCase()}`;
                    // simple placeholder condition: based on total completed submateri
                    const targetNumber = Math.max(1, Math.round((i+1) * 1.5));
                    const newDef = { id, title, desc, condition: (u, jen) => {
                        try { const totalDone = Object.values((u.progress && u.progress[jen])||{}).reduce((acc,cur)=>acc + (Object.values(cur).filter(p=>p.done).length||0),0); return totalDone >= targetNumber; } catch(e) { return false; }
                    }};
                    newDef.iconSVG = defaultAchievementIconSVG(i, j);
                    defs.push(newDef);
                }
            });

            // update achievements count summary
            try { const cntEl = document.getElementById('achievements-count'); if (cntEl) cntEl.textContent = container.querySelectorAll('[id^="achievement-"]').length; } catch(e){}
        }
        const shopData = {
            tokoAvatar: {
                title: "Toko Avatar",
                icon: "👕",
                bgColor: "bg-rose-100",
                items: {
                    'avatar5': { name: "Kucing Lucu", price: 250, icon: "🐱" },
                    'avatar6': { name: "Anjing Ceria", price: 250, icon: "🐶" },
                    'avatar7': { name: "Panda Santai", price: 300, icon: "🐼" },
                    'avatar8': { name: "Robot Masa Depan", price: 500, icon: "🤖" },
                    'avatar9': { name: "Rubah Cerdik", price: 350, icon: "🦊" },
                    'avatar10': { name: "Hantu Imut", price: 200, icon: "👻" },
                    'avatar11': { name: "Peri Bunga", price: 400, icon: "🧚‍♀️" },
                    'avatar12': { name: "Alien Hijau", price: 450, icon: "👽" },
                    'avatar13': { name: "Naga Perkasa", price: 600, icon: "🐉" },
                    'avatar14': { name: "Penyihir Bijak", price: 550, icon: "🧙‍♂️" }
                }
            },
            customization: {
                title: "Warung Kustomisasi",
                icon: "🎨",
                bgColor: "bg-sky-100",
                items: {
                    'theme_dark': { name: "Tema Gelap", price: 300, icon: "🌙", type: "theme" },
                    'theme_contrast': { name: "Kontras Tinggi", price: 350, icon: "⚫️⚪️", type: "theme" },
                    'theme_forest': { name: "Tema Hutan", price: 400, icon: "🌲", type: "theme" },
                    'theme_ocean': { name: "Tema Lautan", price: 400, icon: "🌊", type: "theme" },
                    'theme_sunset': { name: "Tema Senja", price: 450, icon: "🌅", type: "theme" },
                    'theme_space': { name: "Tema Luar Angkasa", price: 500, icon: "🚀", type: "theme" },
                    'theme_retro': { name: "Tema Retro", price: 350, icon: "🕹️", type: "theme" },
                    'theme_candy': { name: "Tema Permen", price: 400, icon: "🍬", type: "theme" },
                    'theme_minimalist': { name: "Tema Minimalis", price: 300, icon: "⚪", type: "theme" },
                    'theme_gold': { name: "Tema Emas", price: 1000, icon: "✨", type: "theme" }
                }
            },
            tokoBurungHantu: {
                title: "Butik Burung Hantu",
                icon: "🦉",
                bgColor: "bg-amber-100",
                items: {
                    'owl_tophat': { name: "Topi Pesulap", price: 200, icon: "🎩" },
                    'owl_wizard_hat': { name: "Topi Penyihir", price: 350, icon: "🪄" },
                    'owl_monocle': { name: "Monocle", price: 300, icon: "🕶️" },
                    'owl_sunglasses': { name: "Kacamata Hitam", price: 250, icon: "🕶️" },
                    'owl_scarf_red': { name: "Syal Merah", price: 150, icon: "🧣" },
                    'owl_crown': { name: "Mahkota Raja", price: 1000, icon: "👑" },
                    'owl_3d_glasses': { name: "Kacamata 3D", price: 250, icon: "🕶️" },
                    'owl_bowtie': { name: "Dasi Kupu-Kupu", price: 180, icon: "🎀" },
                    'owl_party_hat': { name: "Topi Pesta", price: 100, icon: "🥳" },
                    'owl_headphone': { name: "Headphone", price: 400, icon: "🎧" }
                }
            },
            tokoBonus: {
                title: "Toko Bonus",
                icon: "⭐",
                bgColor: "bg-yellow-100",
                items: {
                    'bonus_double': { name: "Poin Ganda (1 Jam)", price: 500, type: "powerup", icon: "2x" },
                    'bonus_hint': { name: "5 Bantuan Ekstra", price: 200, type: "powerup", icon: "💡" },
                    'bonus_streak_protection': { name: "Pelindung Beruntun", price: 750, type: "powerup", icon: "🛡️" },
                    'bonus_skip': { name: "Lewati 3 Kuis", price: 300, type: "powerup", icon: "⏭️" },
                    'bonus_time': { name: "Waktu Ekstra", price: 250, type: "powerup", icon: "⏱️" },
                    'bonus_xp_boost': { name: "XP Boost", price: 400, type: "powerup", icon: "🚀" },
                    'bonus_lootbox': { name: "Kotak Misteri", price: 600, type: "powerup", icon: "❓" },
                    'bonus_revive': { name: "Hidup Kembali", price: 1000, type: "powerup", icon: "❤️" },
                    'bonus_shield': { name: "Perisai Jawaban Salah", price: 800, type: "powerup", icon: "🛡️" },
                    'bonus_keys': { name: "3 Kunci Emas", price: 900, type: "powerup", icon: "🔑" }
                }
            }
            ,
            // new stores: background music store and sfx store (10 items each)
            bgmStore: {
                title: "Toko Musik Latar",
                icon: "🎧",
                bgColor: "bg-indigo-100",
                items: {
                    'bgm_calm_1': { name: 'Latar Tenang 1', price: 300, preview: 'calm1', type: 'bgm' },
                    'bgm_calm_2': { name: 'Latar Tenang 2', price: 300, preview: 'calm2', type: 'bgm' },
                    'bgm_focus_1': { name: 'Fokus Piano', price: 400, preview: 'focus1', type: 'bgm' },
                    'bgm_focus_2': { name: 'Fokus Loop 2', price: 400, preview: 'focus2', type: 'bgm' },
                    'bgm_uplift_1': { name: 'Semangat 1', price: 450, preview: 'uplift1', type: 'bgm' },
                    'bgm_uplift_2': { name: 'Semangat 2', price: 450, preview: 'uplift2', type: 'bgm' },
                    'bgm_ambient_1': { name: 'Ambient 1', price: 350, preview: 'amb1', type: 'bgm' },
                    'bgm_ambient_2': { name: 'Ambient 2', price: 350, preview: 'amb2', type: 'bgm' },
                    'bgm_chill_1': { name: 'Chill Loop', price: 300, preview: 'chill1', type: 'bgm' },
                    'bgm_cinematic_1': { name: 'Cinematic', price: 500, preview: 'cin1', type: 'bgm' }
                }
            },
            sfxStore: {
                title: "Toko Efek Suara",
                icon: "🔊",
                bgColor: "bg-emerald-100",
                items: {
                    'sfx_click_soft': { name: 'Klik Lembut', price: 50, preview: 'sfx_click_soft', type: 'sfx' },
                        'sfx_click_tick': { name: 'Klik Tick', price: 75, preview: 'sfx_click_tick', type: 'sfx' },
                        'sfx_nav_swipe': { name: 'Swipe', price: 80, preview: 'sfx_nav_swipe', type: 'sfx' },
                        'sfx_nav_boop': { name: 'Boop', price: 60, preview: 'sfx_nav_boop', type: 'sfx' },
                        'sfx_win_chime': { name: 'Chime Menang', price: 120, preview: 'sfx_win_chime', type: 'sfx' },
                        'sfx_pop_light': { name: 'Pop Ringan', price: 70, preview: 'sfx_pop_light', type: 'sfx' },
                        'sfx_slide': { name: 'Slide', price: 80, preview: 'sfx_slide', type: 'sfx' },
                        'sfx_confirm': { name: 'Konfirmasi', price: 90, preview: 'sfx_confirm', type: 'sfx' },
                        'sfx_error': { name: 'Error Buzz', price: 100, preview: 'sfx_error', type: 'sfx' },
                        'sfx_reward_snap': { name: 'Snap Reward', price: 150, preview: 'sfx_reward_snap', type: 'sfx' }
                }
            }
        };
        const mascotSVG = `<svg id="owl-base" viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg"><g><path d="M50,15 C25,15 10,35 10,55 C10,80 25,95 50,95 C75,95 90,80 90,55 C90,35 75,15 50,15 Z" fill="#A0522D"/><path d="M35,45 C40,40 50,40 55,45 C60,50 60,60 55,65 L45,65 C40,60 40,50 35,45 Z" fill="#8B4513" transform="translate(-15, 0)"/><path d="M65,45 C60,40 50,40 45,45 C40,50 40,60 45,65 L55,65 C60,60 60,50 65,45 Z" fill="#8B4513" transform="translate(15, 0)"/><circle cx="32" cy="52" r="18" fill="white"/><circle cx="68" cy="52" r="18" fill="white"/><circle cx="33" cy="53" r="8" fill="black"/><circle cx="67" cy="53" r="8" fill="black"/><path d="M50,65 C55,75 45,75 50,65 L52,70 L48,70 Z" fill="#FFC107"/><path d="M20,15 Q30,5 40,15" stroke="#8B4513" stroke-width="4" fill="none" stroke-linecap="round"/><path d="M80,15 Q70,5 60,15" stroke="#8B4513" stroke-width="4" fill="none" stroke-linecap="round"/></g></svg>`;

        // --- DATABASE LENGKAP MATERI ---
       const edukasiData = {
            sd: {
                dunia: {
                    matematika_dasar: { 
                        namaDunia: "Kerajaan Angka", warna: "blue", icon: "🔢", deskripsi: "Jelajahi dunia angka, penjumlahan, dan perkalian yang seru!", 
                        subMateri: { 
                            penjumlahan: { judul: "Berhitung Cepat", konten: "<p>Penjumlahan adalah cara menggabungkan dua angka atau lebih. Contoh: 2 apel ditambah 3 apel menjadi 5 apel.</p>", funFact: "Simbol tambah (+) sudah digunakan selama lebih dari 500 tahun!", kuis: [{ type: "pilihan-ganda", pertanyaan: "7 + 8 = ?", pilihan: ["14", "15", "16", "13"], jawaban: "15", hint:"Hitung maju 8 langkah dari 7." }] },
                            pengurangan: { judul: "Ambil dan Sisakan", konten: "<p>Pengurangan adalah mengambil sejumlah angka dari angka lain. Contoh: Punya 5 kue, dimakan 2, sisa 3 kue.</p>", funFact: "Kata 'selisih' adalah nama lain untuk hasil dari pengurangan.", kuis: [{ type: "pilihan-ganda", pertanyaan: "12 - 5 = ?", pilihan: ["6", "7", "8", "9"], jawaban: "7", hint:"Hitung mundur 5 langkah dari 12." }] },
                            perkalian: { judul: "Lompatan Ajaib", konten: "<p>Perkalian adalah penjumlahan berulang. 3 x 4 sama dengan menjumlahkan 4 sebanyak 3 kali.</p>", funFact: "Tabel perkalian modern pertama kali dibuat oleh matematikawan Skotlandia, John Napier.", kuis: [{ type: "pilihan-ganda", pertanyaan: "6 x 3 = ?", pilihan: ["18", "15", "24", "12"], jawaban: "18", hint:"Jumlahkan 6 sebanyak 3 kali." }] },
                            pembagian: { judul: "Bagi Rata", konten: "<p>Pembagian adalah membagi sama rata. 10 permen dibagi untuk 2 anak, masing-masing dapat 5.</p>", funFact: "Simbol bagi (÷) disebut obelus, yang dalam bahasa Yunani berarti 'tusuk sate'.", kuis: [{ type: "pilihan-ganda", pertanyaan: "15 / 3 = ?", pilihan: ["4", "5", "6", "3"], jawaban: "5", hint:"Berapa kali 3 muat dalam 15?" }] },
                            pecahan: { judul: "Potongan Pizza", konten: "<p>Pecahan adalah bagian dari keseluruhan. 1/2 berarti satu dari dua bagian yang sama besar.</p>", funFact: "Orang Mesir kuno menulis semua pecahan sebagai penjumlahan dari pecahan satuan (pembilang 1).", kuis: [{ type: "pilihan-ganda", pertanyaan: "Setengah dari 8 adalah...", pilihan: ["2", "4", "6", "8"], jawaban: "4", hint:"Sama dengan 8 dibagi 2." }] },
                            ganjil_genap: { judul: "Pasukan Ganjil & Genap", konten: "<p>Bilangan genap bisa berpasangan (2, 4, 6), bilangan ganjil selalu ada yang sendirian (1, 3, 5).</p>", funFact: "Menjumlahkan dua bilangan ganjil selalu menghasilkan bilangan genap.", kuis: [{ type: "pilihan-ganda", pertanyaan: "Manakah yang bilangan ganjil?", pilihan: ["10", "17", "22", "8"], jawaban: "17", hint:"Angka yang tidak bisa dibagi 2." }] },
                            pengukuran: { judul: "Mengukur Dunia", konten: "<p>Kita mengukur panjang dengan sentimeter (cm) dan berat dengan kilogram (kg).</p>", funFact: "Satu kilogram awalnya didefinisikan berdasarkan berat satu liter air.", kuis: [{ type: "pilihan-ganda", pertanyaan: "Alat untuk mengukur panjang buku adalah...", pilihan: ["Timbangan", "Penggaris", "Jam", "Gelas Ukur"], jawaban: "Penggaris", hint:"Ada di kotak pensilmu." }] },
                            bangun_datar_ruang: { judul: "Berburu Bentuk", konten: "<p>Ada bentuk datar (persegi, lingkaran) dan bentuk ruang (kubus, bola).</p>", funFact: "Sarang lebah menggunakan bentuk segienam karena itu cara paling efisien untuk mengisi ruang.", kuis: [{ type: "pilihan-ganda", pertanyaan: "Benda yang bentuknya seperti dadu adalah...", pilihan: ["Bola", "Kubus", "Piramida", "Kerucut"], jawaban: "Kubus", hint:"Memiliki 6 sisi yang sama." }] },
                            waktu: { judul: "Waktu Berpetualang", konten: "<p>Jarum pendek jam menunjuk jam, jarum panjang menunjuk menit.</p>", funFact: "Pembagian jam menjadi 60 menit berasal dari sistem angka bangsa Babilonia kuno.", kuis: [{ type: "pilihan-ganda", pertanyaan: "Jika jarum pendek di angka 3 dan panjang di 12, pukul berapa itu?", pilihan: ["12:03", "03:12", "03:00", "03:30"], jawaban: "03:00", hint:"Angka 12 pada jarum panjang berarti menit ke-0." }] },
                            pola_bilangan: { judul: "Pola Rahasia", konten: "<p>Pola adalah urutan yang berulang dengan aturan. Contoh: 2, 4, 6, 8, ... (ditambah 2).</p>", funFact: "Pola bilangan sering ditemukan di alam, seperti pada kelopak bunga dan cangkang siput.", kuis: [{ type: "pilihan-ganda", pertanyaan: "Lanjutkan pola ini: 5, 10, 15, ...?", pilihan: ["16", "20", "25", "30"], jawaban: "20", hint:"Ini adalah pola ditambah 5." }] }
                        } 
                    },
                    bahasa_indonesia_sd: { 
                        namaDunia: "Pulau Kata", warna: "green", icon: "✍️", deskripsi: "Belajar membaca, menulis, dan menyusun kalimat dengan benar.", 
                        subMateri: {
                            alfabet: { judul: "Pasukan Alfabet", konten: "<p>Alfabet adalah kumpulan huruf dari A sampai Z. Setiap huruf memiliki bunyinya sendiri.</p>", funFact: "Bahasa Indonesia menggunakan 26 huruf alfabet Latin, sama seperti Bahasa Inggris.", kuis: [{ type: "pilihan-ganda", pertanyaan: "Huruf apa yang datang setelah huruf 'G'?", pilihan: ["F", "H", "I", "J"], jawaban: "H", hint:"E, F, G, ..." }] },
                            merangkai_kata: { judul: "Merangkai Kata Ajaib", konten: "<p>Menggabungkan huruf vokal (a, i, u, e, o) dan konsonan akan membentuk kata yang punya arti.</p>", funFact: "Kata terpanjang dalam kamus bahasa Indonesia adalah 'mempertanggungjawabkannya'.", kuis: [{ type: "pilihan-ganda", pertanyaan: "Susun huruf 'k-u-b-u' menjadi nama benda.", pilihan: ["kuub", "buku", "kibu", "ubuk"], jawaban: "buku", hint:"Digunakan untuk membaca." }] },
                            tanda_baca: { judul: "Tuan Tanda Baca", konten: "<p>Tanda baca membantu kita mengerti tulisan. Titik (.) untuk berhenti, koma (,) untuk jeda, dan tanda tanya (?) untuk bertanya.</p>", funFact: "Tanda seru (!) dulunya ditulis sebagai kata Latin 'io' yang berarti 'seruan kegembiraan'.", kuis: [{ type: "pilihan-ganda", pertanyaan: "Tanda baca di akhir kalimat 'Siapa namamu' adalah...", pilihan: [".", ",", "?", "!"], jawaban: "?", hint:"Ini adalah kalimat tanya." }] },
                            kalimat: { judul: "Siapa, Apa, di Mana?", konten: "<p>Kalimat yang baik biasanya menjawab pertanyaan siapa (Subjek), melakukan apa (Predikat), dan apa/siapa yang dikenai (Objek).</p>", funFact: "Tanda titik (.) digunakan untuk mengakhiri sebuah kalimat berita.", kuis: [{ type: "pilihan-ganda", pertanyaan: "Manakah kalimat yang benar?", pilihan: ["Makan nasi saya", "Saya makan nasi", "Nasi saya makan", "Saya nasi makan"], jawaban: "Saya makan nasi", hint:"Urutan S-P-O." }] },
                            kata_benda: { judul: "Kata Benda di Sekitarku", konten: "<p>Kata benda adalah nama orang, tempat, atau benda. Contoh: meja, buku, Rina.</p>", funFact: "Dalam beberapa bahasa, semua kata benda memiliki 'gender' (maskulin atau feminin).", kuis: [{ type: "pilihan-ganda", pertanyaan: "Manakah yang merupakan kata benda?", pilihan: ["Berlari", "Merah", "Kursi", "Cepat"], jawaban: "Kursi", hint:"Ini adalah nama sebuah benda." }] },
                            kata_kerja: { judul: "Aksi Kata Kerja", konten: "<p>Kata kerja adalah kata yang menyatakan suatu tindakan atau perbuatan. Contoh: makan, tidur, belajar.</p>", funFact: "Kata 'kerja' itu sendiri adalah sebuah kata benda!", kuis: [{ type: "pilihan-ganda", pertanyaan: "Manakah yang merupakan kata kerja?", pilihan: ["Membaca", "Cantik", "Sekolah", "Buku"], jawaban: "Membaca", hint:"Ini adalah sebuah kegiatan." }] },
                            kata_sifat: { judul: "Cantiknya Kata Sifat", konten: "<p>Kata sifat adalah kata yang menjelaskan kata benda. Contoh: besar, kecil, pintar, rajin.</p>", funFact: "Menambahkan kata 'sangat' atau 'sekali' dapat memperkuat arti kata sifat.", kuis: [{ type: "pilihan-ganda", pertanyaan: "Dalam 'rumah besar', kata yang merupakan kata sifat adalah...", pilihan: ["Rumah", "Besar", "Yang", "Di"], jawaban: "Besar", hint:"Kata ini menjelaskan bagaimana rumah itu." }] },
                            antonim_sinonim: { judul: "Lawan dan Kawan Kata", konten: "<p>Antonim adalah lawan kata (panas-dingin), sinonim adalah persamaan kata (pintar-pandai).</p>", funFact: "Menggunakan sinonim membuat tulisan menjadi lebih menarik dan tidak membosankan.", kuis: [{ type: "pilihan-ganda", pertanyaan: "Lawan kata dari 'terang' adalah...", pilihan: ["Cerah", "Gelap", "Siang", "Putih"], jawaban: "Gelap", hint:"Keadaan saat tidak ada cahaya." }] },
                            puisi: { judul: "Puisi Indah", konten: "<p>Puisi adalah tulisan yang menggunakan bahasa indah dan seringkali memiliki irama atau sajak (akhiran bunyi yang sama).</p>", funFact: "Puisi adalah salah satu bentuk sastra tertua di dunia.", kuis: [{ type: "pilihan-ganda", pertanyaan: "Akhiran bunyi yang sama pada baris puisi disebut...", pilihan: ["Bait", "Baris", "Sajak", "Judul"], jawaban: "Sajak", hint:"Contoh: kelapa dan menyapa." }] },
                            dongeng: { judul: "Dongeng Kancil", konten: "<p>Dongeng adalah cerita khayalan yang tidak benar-benar terjadi, biasanya mengandung pesan moral. Fabel adalah dongeng dengan tokoh hewan.</p>", funFact: "Dongeng 'Cinderella' memiliki lebih dari 500 versi di seluruh dunia.", kuis: [{ type: "pilihan-ganda", pertanyaan: "Cerita tentang 'Si Kancil' termasuk jenis...", pilihan: ["Berita", "Fabel", "Pengumuman", "Biografi"], jawaban: "Fabel", hint:"Tokohnya adalah hewan yang bisa bicara." }] }
                        }
                    },
                    ipa_sd: { 
                        namaDunia: "Taman Sains", warna: "yellow", icon: "🌿", deskripsi: "Pelajari tentang hewan, tumbuhan, dan alam sekitar kita.",
                        subMateri: {
                            hewan: { judul: "Sahabat Satwa", konten: "<p>Ada banyak jenis hewan di dunia. Ada karnivora (pemakan daging), herbivora (pemakan tumbuhan), dan omnivora (pemakan segala).</p>", funFact: "Gajah adalah satu-satunya mamalia yang tidak bisa melompat!", kuis: [{ type: "pilihan-ganda", pertanyaan: "Sapi adalah contoh hewan pemakan...", pilihan: ["Daging", "Tumbuhan", "Segalanya", "Ikan"], jawaban: "Tumbuhan", hint:"Sapi makan rumput." }] },
                            tumbuhan: { judul: "Akar, Batang, dan Daun", konten: "<p>Tumbuhan memiliki akar untuk menyerap air, batang untuk berdiri tegak, dan daun untuk membuat makanan (fotosintesis).</p>", funFact: "Pohon tertinggi di dunia bisa mencapai ketinggian lebih dari 100 meter!", kuis: [{ type: "pilihan-ganda", pertanyaan: "Bagian tumbuhan yang berfungsi membuat makanan adalah...", pilihan: ["Akar", "Batang", "Daun", "Bunga"], jawaban: "Daun", hint:"Warnanya biasanya hijau." }] },
                            pancaindra: { judul: "Lima Indra Ajaib", konten: "<p>Manusia punya lima indra: mata untuk melihat, telinga untuk mendengar, hidung untuk mencium, lidah untuk mengecap, dan kulit untuk meraba.</p>", funFact: "Hidung manusia bisa membedakan lebih dari 1 triliun bau yang berbeda.", kuis: [{ type: "pilihan-ganda", pertanyaan: "Indra yang digunakan untuk merasakan manisnya gula adalah...", pilihan: ["Mata", "Kulit", "Lidah", "Telinga"], jawaban: "Lidah", hint:"Letaknya di dalam mulut." }] },
                            siklus_air: { judul: "Petualangan Air", konten: "<p>Air di bumi selalu berputar. Air laut menguap menjadi awan, lalu turun lagi sebagai hujan. Ini disebut siklus air.</p>", funFact: "Jumlah air di Bumi saat ini sama dengan jumlah air pada zaman dinosaurus.", kuis: [{ type: "pilihan-ganda", pertanyaan: "Uap air yang naik ke langit akan membentuk...", pilihan: ["Pelangi", "Awan", "Angin", "Petir"], jawaban: "Awan", hint:"Warnanya putih atau kelabu." }] },
                            wujud_benda: { judul: "Padat, Cair, Gas!", konten: "<p>Benda memiliki tiga wujud: padat (batu), cair (air), dan gas (udara). Wujud benda bisa berubah, misalnya es mencair menjadi air.</p>", funFact: "Ada wujud benda keempat yang disebut plasma, seperti yang ada pada bintang dan petir.", kuis: [{ type: "pilihan-ganda", pertanyaan: "Perubahan dari cair menjadi padat disebut...", pilihan: ["Mencair", "Menguap", "Membeku", "Menyublim"], jawaban: "Membeku", hint:"Seperti saat membuat es batu." }] },
                            tata_surya_sd: { judul: "Siang dan Malam", konten: "<p>Bumi berputar pada porosnya (rotasi) yang menyebabkan siang dan malam. Bumi juga mengelilingi Matahari (revolusi).</p>", funFact: "Jejak kaki para astronot di Bulan akan tetap ada di sana selama jutaan tahun karena tidak ada angin.", kuis: [{ type: "pilihan-ganda", pertanyaan: "Peristiwa terjadinya siang dan malam disebabkan oleh...", pilihan: ["Rotasi Bumi", "Revolusi Bumi", "Gravitasi Bulan", "Rotasi Bulan"], jawaban: "Rotasi Bumi", hint:"Perputaran Bumi pada porosnya." }] },
                            cahaya: { judul: "Pelangi di Langit", konten: "<p>Cahaya merambat lurus dan bisa dibiaskan. Pelangi terbentuk karena cahaya matahari dibiaskan oleh titik-titik air hujan.</p>", funFact: "Kamu tidak akan pernah bisa mencapai ujung pelangi, karena ia bergerak seiring dengan sudut pandangmu.", kuis: [{ type: "pilihan-ganda", pertanyaan: "Benda yang digunakan untuk melihat pantulan diri kita adalah...", pilihan: ["Kaca", "Cermin", "Lensa", "Air"], jawaban: "Cermin", hint:"Memiliki permukaan yang mengkilap." }] },
                            magnet: { judul: "Kekuatan Magnet", konten: "<p>Magnet bisa menarik benda-benda yang terbuat dari besi. Magnet memiliki dua kutub, utara dan selatan.</p>", funFact: "Bumi kita adalah sebuah magnet raksasa, itulah sebabnya kompas selalu menunjuk ke utara.", kuis: [{ type: "pilihan-ganda", pertanyaan: "Benda yang TIDAK bisa ditarik magnet adalah...", pilihan: ["Paku", "Peniti", "Kertas", "Klip"], jawaban: "Kertas", hint:"Terbuat dari kayu." }] },
                            kesehatan: { judul: "Sehat dan Kuat", konten: "<p>Untuk menjaga tubuh tetap sehat, kita perlu makan makanan bergizi, berolahraga teratur, dan cukup istirahat.</p>", funFact: "Tertawa baik untuk jantung dan dapat meningkatkan aliran darah sebesar 20 persen.", kuis: [{ type: "pilihan-ganda", pertanyaan: "Berikut ini yang termasuk makanan sehat adalah...", pilihan: ["Permen", "Sayuran", "Keripik", "Cokelat"], jawaban: "Sayuran", hint:"Banyak mengandung vitamin." }] },
                            lingkungan: { judul: "Jaga Bumi Kita", konten: "<p>Kita harus menjaga lingkungan dengan cara tidak membuang sampah sembarangan, menanam pohon, dan menghemat air.</p>", funFact: "Satu botol plastik membutuhkan waktu lebih dari 450 tahun untuk terurai di alam.", kuis: [{ type: "pilihan-ganda", pertanyaan: "Kegiatan yang baik untuk lingkungan adalah...", pilihan: ["Membuang sampah di sungai", "Menebang pohon", "Menanam pohon", "Menggunakan plastik sekali pakai"], jawaban: "Menanam pohon", hint:"Membuat udara lebih sejuk." }] }
                        }
                    },
                    ips_sd: {
                        namaDunia: "Nusantara Kita", warna: "orange", icon: "🗺️", deskripsi: "Kenali keragaman suku, budaya, dan geografi Indonesia.",
                        subMateri: {
                            peta: { judul: "Membaca Peta", konten: "<p>Peta adalah gambar permukaan bumi. Ada simbol-simbol di peta untuk gunung, sungai, dan kota.</p>", funFact: "Peta tertua yang diketahui berasal dari Babilonia sekitar 2.500 tahun yang lalu.", kuis: [{ type: "pilihan-ganda", pertanyaan: "Warna biru pada peta biasanya melambangkan...", pilihan: ["Gunung", "Hutan", "Perairan", "Gurun"], jawaban: "Perairan", hint:"Seperti warna laut dan danau." }] },
                            kenampakan_alam: { judul: "Gunung dan Pantai", konten: "<p>Indonesia punya banyak kenampakan alam seperti gunung berapi, sungai yang panjang, dan pantai yang indah.</p>", funFact: "Indonesia adalah negara dengan jumlah gunung berapi aktif terbanyak di dunia.", kuis: [{ type: "pilihan-ganda", pertanyaan: "Daerah daratan yang menjorok ke laut disebut...", pilihan: ["Teluk", "Tanjung", "Selat", "Delta"], jawaban: "Tanjung", hint:"Kebalikan dari teluk." }] },
                            suku_bangsa: { judul: "Rumah Adat dan Suku", konten: "<p>Indonesia kaya akan suku bangsa. Setiap suku punya rumah adat, pakaian adat, dan bahasa yang unik.</p>", funFact: "Ada lebih dari 700 bahasa daerah yang digunakan di seluruh Indonesia.", kuis: [{ type: "pilihan-ganda", pertanyaan: "Rumah Gadang adalah rumah adat dari suku...", pilihan: ["Jawa", "Minangkabau", "Dayak", "Asmat"], jawaban: "Minangkabau", hint:"Terkenal dengan atapnya yang seperti tanduk kerbau." }] },
                            kegiatan_ekonomi: { judul: "Pekerjaan di Sekitarku", konten: "<p>Orang bekerja sesuai dengan kondisi alamnya. Di pantai banyak nelayan, di pegunungan banyak petani sayur.</p>", funFact: "Pasar terapung di Kalimantan adalah contoh kegiatan ekonomi yang unik dan menyesuaikan dengan alam sungai.", kuis: [{ type: "pilihan-ganda", pertanyaan: "Pekerjaan utama penduduk di daerah pantai adalah...", pilihan: ["Petani", "Nelayan", "Pekerja kantor", "Guru"], jawaban: "Nelayan", hint:"Mereka mencari ikan di laut." }] },
                            kerajaan_hindu_buddha: { judul: "Raja-Raja Zaman Dulu", konten: "<p>Dulu di Indonesia ada kerajaan besar seperti Sriwijaya yang jaya di laut dan Majapahit yang menyatukan nusantara.</p>", funFact: "Candi Borobudur adalah candi Buddha terbesar di dunia dan merupakan peninggalan kerajaan Mataram Kuno.", kuis: [{ type: "pilihan-ganda", pertanyaan: "Kerajaan maritim (laut) terbesar di Indonesia adalah...", pilihan: ["Majapahit", "Sriwijaya", "Kutai", "Tarumanegara"], jawaban: "Sriwijaya", hint:"Pusatnya ada di Sumatera." }] },
                            pahlawan_nasional: { judul: "Para Pemberani", konten: "<p>Pahlawan nasional adalah orang-orang yang berjuang untuk kemerdekaan Indonesia, seperti Pangeran Diponegoro dan Cut Nyak Dien.</p>", funFact: "Nama pahlawan sering diabadikan sebagai nama jalan, bandara, dan universitas untuk menghormati jasa mereka.", kuis: [{ type: "pilihan-ganda", pertanyaan: "Siapakah pahlawan wanita yang berasal dari Aceh?", pilihan: ["R.A. Kartini", "Cut Nyak Dien", "Dewi Sartika", "Martha Christina Tiahahu"], jawaban: "Cut Nyak Dien", hint:"Berjuang melawan Belanda." }] },
                            proklamasi: { judul: "Hari Merdeka", konten: "<p>Indonesia merdeka pada tanggal 17 Agustus 1945. Proklamasi dibacakan oleh Soekarno dan Hatta.</p>", funFact: "Naskah proklamasi yang asli ditulis tangan oleh Soekarno di rumah seorang laksamana Jepang.", kuis: [{ type: "pilihan-ganda", pertanyaan: "Proklamasi Kemerdekaan Indonesia dilaksanakan pada tahun...", pilihan: ["1942", "1945", "1950", "1928"], jawaban: "1945", hint:"Tahun yang selalu kita rayakan." }] },
                            pancasila: { judul: "Lima Dasar Negara", konten: "<p>Pancasila adalah dasar negara kita. Sila pertama adalah Ketuhanan Yang Maha Esa, dilambangkan dengan bintang.</p>", funFact: "Burung Garuda Pancasila memiliki jumlah bulu yang melambangkan tanggal proklamasi: 17 helai di sayap, 8 di ekor, dan 45 di leher.", kuis: [{ type: "pilihan-ganda", pertanyaan: "Sila kedua Pancasila dilambangkan dengan gambar...", pilihan: ["Pohon Beringin", "Rantai", "Padi dan Kapas", "Kepala Banteng"], jawaban: "Rantai", hint:"Melambangkan hubungan antarmanusia." }] },
                            musyawarah: { judul: "Keputusan Bersama", konten: "<p>Musyawarah adalah berdiskusi untuk mencapai keputusan bersama. Ini adalah cerminan sila keempat Pancasila.</p>", funFact: "Konsep musyawarah sudah ada sejak lama dalam budaya desa-desa di Indonesia.", kuis: [{ type: "pilihan-ganda", pertanyaan: "Memilih ketua kelas sebaiknya dilakukan dengan cara...", pilihan: ["Paksaan", "Musyawarah", "Ditunjuk guru saja", "Adu panco"], jawaban: "Musyawarah", hint:"Agar adil untuk semua." }] },
                            gotong_royong: { judul: "Kerja Bakti", konten: "<p>Gotong royong adalah bekerja bersama-sama untuk kepentingan umum, seperti membersihkan lingkungan sekolah atau desa.</p>", funFact: "Gotong royong adalah salah satu kepribadian bangsa Indonesia yang paling dikenal.", kuis: [{ type: "pilihan-ganda", pertanyaan: "Manfaat dari gotong royong adalah...", pilihan: ["Pekerjaan cepat selesai", "Menimbulkan perpecahan", "Membuang waktu", "Menambah pekerjaan"], jawaban: "Pekerjaan cepat selesai", hint:"Berat sama dipikul, ringan sama dijinjing." }] }
                        }
                    },
                    seni_budaya_sd: { 
                        namaDunia: "Galeri Kreasi", warna: "pink", icon: "🎨", deskripsi: "Ekspresikan dirimu melalui gambar, lagu, dan tarian!", 
                        subMateri: {
                            gambar_bentuk: { judul: "Menggambar Bentuk", konten: "<p>Menggambar bentuk adalah cara meniru objek tiga dimensi seperti kubus, bola, atau vas bunga ke dalam gambar dua dimensi.</p>", funFact: "Teknik 'arsir' digunakan untuk memberikan kesan gelap-terang pada gambar bentuk sehingga terlihat nyata.", kuis: [{ type: "pilihan-ganda", pertanyaan: "Warna primer yang tidak bisa dibuat dari campuran warna lain adalah...", pilihan: ["Hijau, Oranye, Ungu", "Merah, Kuning, Biru", "Hitam, Putih, Abu-abu", "Merah Muda, Cokelat, Biru Dongker"], jawaban: "Merah, Kuning, Biru", hint:"Tiga warna dasar." }] },
                            campur_warna: { judul: "Campuran Warna Ajaib", konten: "<p>Warna primer (merah, kuning, biru) dapat dicampur untuk menghasilkan warna sekunder. Merah + Kuning = Oranye.</p>", funFact: "Mata manusia dapat membedakan sekitar 10 juta warna yang berbeda!", kuis: [{ type: "pilihan-ganda", pertanyaan: "Apa hasil dari campuran warna biru dan kuning?", pilihan: ["Ungu", "Cokelat", "Hijau", "Abu-abu"], jawaban: "Hijau", hint:"Seperti warna daun." }] },
                            lagu_daerah: { judul: "Lagu Daerah Nusantara", konten: "<p>Setiap daerah di Indonesia memiliki lagu daerahnya sendiri, seperti 'Ampar-Ampar Pisang' dari Kalimantan Selatan.</p>", funFact: "Lagu 'Rasa Sayange' dari Maluku pernah digunakan dalam iklan pariwisata internasional.", kuis: [{ type: "pilihan-ganda", pertanyaan: "Lagu 'Gundul-Gundul Pacul' berasal dari daerah...", pilihan: ["Jawa Barat", "Jawa Tengah", "Sumatera Barat", "Bali"], jawaban: "Jawa Tengah", hint:"Menggunakan bahasa Jawa." }] },
                            tari_tradisional: { judul: "Tari Tradisional", konten: "<p>Tari tradisional adalah tarian yang tumbuh di kalangan rakyat. Contohnya Tari Saman dari Aceh yang sangat kompak.</p>", funFact: "Tari Kecak dari Bali tidak menggunakan iringan alat musik, melainkan paduan suara 'cak-cak' dari para penarinya.", kuis: [{ type: "pilihan-ganda", pertanyaan: "Gerakan penari yang mengikuti irama musik disebut...", pilihan: ["Wiraga", "Wirama", "Wirasa", "Wirupa"], jawaban: "Wiraga", hint:"Berkaitan dengan raga atau tubuh." }] },
                            membuat_kolase: { judul: "Membuat Kolase", konten: "<p>Kolase adalah karya seni yang dibuat dengan menempelkan berbagai bahan seperti kertas, kain, atau biji-bijian pada sebuah permukaan.</p>", funFact: "Kata 'kolase' berasal dari bahasa Prancis 'coller' yang artinya 'merekatkan'.", kuis: [{ type: "pilihan-ganda", pertanyaan: "Bahan alam yang bisa digunakan untuk membuat kolase adalah...", pilihan: ["Kancing", "Sedotan", "Daun kering", "Manik-manik"], jawaban: "Daun kering", hint:"Bahan yang berasal dari alam." }] },
                            mengenal_batik: { judul: "Mengenal Batik", konten: "<p>Batik adalah kain bergambar yang pembuatannya secara khusus dengan menuliskan atau menerakan malam (lilin) pada kain itu.</p>", funFact: "UNESCO telah menetapkan batik sebagai Warisan Kemanusiaan untuk Budaya Lisan dan Nonbendawi dari Indonesia.", kuis: [{ type: "pilihan-ganda", pertanyaan: "Alat utama untuk membuat batik tulis adalah...", pilihan: ["Kuas", "Pensil", "Canting", "Spidol"], jawaban: "Canting", hint:"Alat kecil berisi lilin panas." }] },
                            alat_musik_ritmis: { judul: "Alat Musik Ritmis", konten: "<p>Alat musik ritmis berfungsi untuk memberikan irama dan tidak memiliki nada. Contohnya adalah drum, marakas, dan tamborin.</p>", funFact: "Kendang adalah salah satu alat musik ritmis utama dalam musik gamelan Jawa dan Bali.", kuis: [{ type: "pilihan-ganda", pertanyaan: "Contoh alat musik ritmis yang dimainkan dengan cara digoyangkan adalah...", pilihan: ["Gendang", "Marakas", "Gong", "Piano"], jawaban: "Marakas", hint:"Biasanya berisi biji-bijian kecil." }] },
                            pola_irama: { judul: "Pola Irama Sederhana", konten: "<p>Pola irama adalah susunan panjang pendeknya bunyi dalam sebuah lagu. Birama 4/4 berarti ada 4 ketukan dalam satu bar.", funFact: "Detak jantung kita adalah contoh pola irama alami yang paling dasar.", kuis: [{ type: "pilihan-ganda", pertanyaan: "Tanda istirahat dalam notasi musik berfungsi untuk...", pilihan: ["Mempercepat tempo", "Berhenti sejenak", "Mengeraskan suara", "Membuat nada tinggi"], jawaban: "Berhenti sejenak", hint:"Memberikan jeda dalam musik." }] },
                            pentas_drama: { judul: "Pentas Drama Cilik", konten: "<p>Drama adalah cerita yang dipentaskan. Unsur utamanya adalah tokoh, latar (tempat), dan alur (jalan cerita).</p>", funFact: "Pantomim adalah pertunjukan drama yang hanya menggunakan gerak tubuh tanpa dialog.", kuis: [{ type: "pilihan-ganda", pertanyaan: "Percakapan antar tokoh dalam drama disebut...", pilihan: ["Monolog", "Prolog", "Epilog", "Dialog"], jawaban: "Dialog", hint:"Terjadi antara dua orang atau lebih." }] },
                            apresiasi_seni: { judul: "Menikmati Karya Seni", konten: "<p>Apresiasi seni adalah sikap menghargai dan menilai sebuah karya seni. Kita bisa mengomentari bentuk, warna, dan pesan dari karya tersebut.</p>", funFact: "Setiap orang bisa memiliki pendapat yang berbeda tentang sebuah karya seni, dan semuanya sah!", kuis: [{ type: "pilihan-ganda", pertanyaan: "Kegiatan menilai dan menghargai karya seni disebut...", pilihan: ["Kritik", "Apresiasi", "Koleksi", "Pameran"], jawaban: "Apresiasi", hint:"Berasal dari kata 'appreciate'." }] }
                        } 
                    },
                    pjok_sd: { 
                        namaDunia: "Arena Olahraga", warna: "red", icon: "⚽", deskripsi: "Belajar tentang olahraga dan cara menjaga tubuh tetap bugar.", 
                        subMateri: {
                            gerak_lokomotor: { judul: "Gerak Lokomotor", konten: "<p>Gerak lokomotor adalah gerakan yang membuat tubuh berpindah tempat, seperti berjalan, berlari, melompat, dan berguling.</p>", funFact: "Berlari adalah salah satu bentuk gerak lokomotor tercepat pada manusia.", kuis: [{ type: "pilihan-ganda", pertanyaan: "Manakah yang BUKAN gerak lokomotor?", pilihan: ["Berjalan", "Berlari", "Melompat", "Memutar lengan"], jawaban: "Memutar lengan", hint:"Gerakan yang tidak berpindah tempat." }] },
                            senam_lantai: { judul: "Senam Lantai Dasar", konten: "<p>Senam lantai adalah gerakan senam yang dilakukan di atas matras. Contohnya adalah rol depan (guling depan) dan rol belakang.</p>", funFact: "Keseimbangan adalah kunci utama dalam melakukan gerakan senam lantai dengan baik.", kuis: [{ type: "pilihan-ganda", pertanyaan: "Gerakan berguling ke depan di atas matras disebut...", pilihan: ["Kayang", "Sikap lilin", "Rol depan", "Meroda"], jawaban: "Rol depan", hint:"Dimulai dari posisi jongkok." }] },
                            permainan_kasti: { judul: "Permainan Bola Kasti", konten: "<p>Kasti adalah permainan bola kecil beregu. Ada regu pemukul dan regu penjaga. Dibutuhkan kekompakan untuk menang.</p>", funFact: "Permainan kasti melatih kecepatan lari, ketepatan melempar, dan kelihaian memukul bola.", kuis: [{ type: "pilihan-ganda", pertanyaan: "Tugas regu penjaga dalam permainan kasti adalah...", pilihan: ["Memukul bola", "Menangkap bola dan melempar ke lawan", "Berlari ke tiang hinggap", "Menjadi wasit"], jawaban: "Menangkap bola dan melempar ke lawan", hint:"Berusaha mematikan lawan." }] },
                            renang_dasar: { judul: "Dasar-Dasar Renang", konten: "<p>Sebelum berenang, penting untuk melakukan pemanasan dan pengenalan air agar tubuh tidak kaget dan terhindar dari kram.</p>", funFact: "Manusia sebenarnya bisa mengapung di air secara alami karena sebagian besar tubuh kita terdiri dari air.", kuis: [{ type: "pilihan-ganda", pertanyaan: "Gerakan kaki pada renang gaya bebas adalah...", pilihan: ["Seperti katak", "Naik turun bergantian", "Seperti lumba-lumba", "Diam saja"], jawaban: "Naik turun bergantian", hint:"Seperti sedang berjalan di air." }] },
                            kebugaran_jasmani: { judul: "Latihan Kebugaran", konten: "<p>Kebugaran jasmani penting agar tubuh tidak mudah lelah. Latihannya bisa berupa push-up untuk kekuatan lengan dan sit-up untuk kekuatan perut.", funFact: "Melompat-lompat di tempat selama satu menit dapat meningkatkan detak jantung dan baik untuk kesehatan.", kuis: [{ type: "pilihan-ganda", pertanyaan: "Latihan untuk melatih kekuatan otot perut adalah...", pilihan: ["Push-up", "Sit-up", "Lari", "Squat"], jawaban: "Sit-up", hint:"Gerakan dari tidur ke duduk." }] },
                            sepak_bola_mini: { judul: "Sepak Bola Mini", konten: "<p>Sepak bola mini dimainkan dengan jumlah pemain yang lebih sedikit dan di lapangan yang lebih kecil. Aturan dasarnya sama: mencetak gol ke gawang lawan.", funFact: "Teknik dasar dalam sepak bola adalah menendang, menggiring, dan menghentikan bola.", kuis: [{ type: "pilihan-ganda", pertanyaan: "Dalam sepak bola, pemain yang boleh menggunakan tangan adalah...", pilihan: ["Penyerang", "Gelandang", "Bek", "Penjaga gawang"], jawaban: "Penjaga gawang", hint:"Bertugas menjaga gawang." }] },
                            bulu_tangkis_dasar: { judul: "Dasar Bulu Tangkis", konten: "<p>Bulu tangkis adalah permainan menggunakan raket dan kok. Pukulan servis adalah pukulan untuk memulai permainan.", funFact: "Indonesia adalah salah satu negara terkuat di dunia dalam cabang olahraga bulu tangkis.", kuis: [{ type: "pilihan-ganda", pertanyaan: "Pukulan keras dan menukik tajam ke area lawan disebut...", pilihan: ["Servis", "Lob", "Smash", "Dropshot"], jawaban: "Smash", hint:"Pukulan yang mematikan." }] },
                            p3k: { judul: "P3K Cedera Ringan", konten: "<p>P3K adalah Pertolongan Pertama Pada Kecelakaan. Jika temanmu lecet, bersihkan luka dengan air bersih lalu tutup dengan plester.", funFact: "Kompres es dapat membantu mengurangi bengkak pada cedera ringan seperti terkilir.", kuis: [{ type: "pilihan-ganda", pertanyaan: "Jika hidung temanmu berdarah (mimisan), apa yang sebaiknya dilakukan?", pilihan: ["Menengadahkan kepala", "Menundukkan kepala dan menekan cuping hidung", "Menyumbat hidung dengan daun", "Berlari-lari"], jawaban: "Menundukkan kepala dan menekan cuping hidung", hint:"Agar darah tidak tertelan." }] },
                            sikap_tubuh_sehat: { judul: "Sikap Tubuh Sehat", konten: "<p>Menjaga sikap tubuh yang baik, seperti duduk dengan punggung tegak, penting untuk kesehatan tulang belakang kita.</p>", funFact: "Membungkuk saat melihat ponsel dalam waktu lama bisa menyebabkan nyeri leher.", kuis: [{ type: "pilihan-ganda", pertanyaan: "Bagaimana posisi tidur yang baik untuk punggung?", pilihan: ["Meringkuk seperti bola", "Tengkurap", "Terlentang atau miring dengan bantal", "Duduk"], jawaban: "Terlentang atau miring dengan bantal", hint:"Posisi yang paling rileks." }] },
                            permainan_tradisional: { judul: "Permainan Tradisional", konten: "<p>Permainan tradisional seperti petak umpet, engklek, dan gobak sodor sangat menyenangkan dan melatih kita bergerak serta bekerja sama.</p>", funFact: "Bermain di luar rumah membantu tubuh mendapatkan vitamin D dari sinar matahari.", kuis: [{ type: "pilihan-ganda", pertanyaan: "Permainan yang menggunakan batu lempar dan kotak-kotak di tanah adalah...", pilihan: ["Petak umpet", "Engklek", "Egrang", "Bentengan"], jawaban: "Engklek", hint:"Bermain dengan satu kaki." }] }
                        } 
                    },
                    pkn_sd: { 
                        namaDunia: "Istana Kewarganegaraan", warna: "purple", icon: "🏛️", deskripsi: "Pahami hak dan kewajiban sebagai warga negara cilik.", 
                        subMateri: {
                            aturan_rumah_sekolah: { judul: "Aturan di Rumah & Sekolah", konten: "<p>Aturan dibuat agar semua hal berjalan dengan tertib. Contoh aturan di rumah adalah merapikan mainan setelah bermain. Aturan di sekolah adalah datang tepat waktu.</p>", funFact: "Menaati aturan melatih kita menjadi pribadi yang disiplin dan bertanggung jawab.", kuis: [{ type: "pilihan-ganda", pertanyaan: "Contoh menaati aturan di sekolah adalah...", pilihan: ["Mencoret-coret meja", "Mengerjakan piket kelas", "Datang terlambat", "Mengobrol saat upacara"], jawaban: "Mengerjakan piket kelas", hint:"Melaksanakan tugas yang diberikan." }] },
                            sila_pancasila: { judul: "Sila-Sila Pancasila", konten: "<p>Pancasila memiliki lima sila. Sila pertama 'Ketuhanan Yang Maha Esa' mengajarkan kita untuk percaya kepada Tuhan dan menghormati agama lain.</p>", funFact: "Urutan sila-sila dalam Pancasila tidak boleh diubah-ubah karena merupakan satu kesatuan.", kuis: [{ type: "pilihan-ganda", pertanyaan: "Sikap yang sesuai dengan sila pertama Pancasila adalah...", pilihan: ["Rajin menabung", "Berdoa sebelum makan", "Gotong royong", "Belajar giat"], jawaban: "Berdoa sebelum makan", hint:"Berhubungan dengan Tuhan." }] },
                            bhinneka_tunggal_ika: { judul: "Arti Bhinneka Tunggal Ika", konten: "<p>Bhinneka Tunggal Ika artinya 'berbeda-beda tetapi tetap satu jua'. Ini adalah semboyan bangsa Indonesia yang menggambarkan persatuan dalam keragaman.</p>", funFact: "Semboyan ini diambil dari kitab Sutasoma karangan Mpu Tantular.", kuis: [{ type: "pilihan-ganda", pertanyaan: "Sikap yang mencerminkan Bhinneka Tunggal Ika adalah...", pilihan: ["Hanya berteman dengan yang satu suku", "Menghargai teman yang berbeda agama", "Mengejek budaya daerah lain", "Menganggap suku sendiri paling hebat"], jawaban: "Menghargai teman yang berbeda agama", hint:"Menjaga persatuan." }] },
                            hak_kewajiban_anak: { judul: "Hak dan Kewajiban Anak", konten: "<p>Hak anak adalah sesuatu yang harus ia dapatkan, seperti hak untuk bermain dan belajar. Kewajiban adalah sesuatu yang harus dilakukan, seperti membantu orang tua.</p>", funFact: "Hak dan kewajiban harus dilaksanakan secara seimbang.", kuis: [{ type: "pilihan-ganda", pertanyaan: "Mendapatkan kasih sayang dari orang tua adalah contoh...", pilihan: ["Kewajiban anak", "Hak anak", "Peraturan sekolah", "Hukuman"], jawaban: "Hak anak", hint:"Sesuatu yang seharusnya kamu terima." }] },
                            musyawarah_kelas: { judul: "Musyawarah di Kelas", konten: "<p>Musyawarah adalah cara mengambil keputusan bersama. Contohnya saat memilih ketua kelas. Semua siswa berhak memberikan pendapat.", funFact: "Dalam musyawarah, kita harus menghargai pendapat orang lain meskipun berbeda dengan pendapat kita.", kuis: [{ type: "pilihan-ganda", pertanyaan: "Jika pendapat kita tidak diterima dalam musyawarah, sikap kita seharusnya...", pilihan: ["Marah dan pulang", "Menerima keputusan dengan lapang dada", "Memaksa teman lain", "Menangis"], jawaban: "Menerima keputusan dengan lapang dada", hint:"Ini adalah ciri demokrasi." }] },
                            lambang_negara: { judul: "Lambang Negara Garuda", konten: "<p>Lambang negara kita adalah Garuda Pancasila. Di dadanya terdapat perisai Pancasila, dan kakinya mencengkeram pita 'Bhinneka Tunggal Ika'.</p>", funFact: "Jumlah bulu pada Garuda Pancasila melambangkan tanggal proklamasi kemerdekaan: 17 Agustus 1945.", kuis: [{ type: "pilihan-ganda", pertanyaan: "Apa warna dasar pada perisai di dada Garuda Pancasila?", pilihan: ["Merah dan Putih", "Kuning Emas", "Hijau", "Biru"], jawaban: "Merah dan Putih", hint:"Seperti warna bendera kita." }] },
                            menghargai_perbedaan: { judul: "Menghargai Perbedaan", konten: "<p>Setiap orang unik. Ada yang rambutnya lurus, ada yang keriting. Ada yang suka menggambar, ada yang suka olahraga. Kita harus menghargai semua perbedaan itu.</p>", funFact: "Menghargai perbedaan membuat pertemanan menjadi lebih berwarna dan menyenangkan.", kuis: [{ type: "pilihan-ganda", pertanyaan: "Ketika temanmu sedang beribadah sesuai agamanya, apa yang kamu lakukan?", pilihan: ["Mengganggunya", "Mengajaknya bermain", "Menunggunya dengan tenang", "Menyalakan musik keras-keras"], jawaban: "Menunggunya dengan tenang", hint:"Sikap toleransi." }] },
                            tata_tertib: { judul: "Tata Tertib", konten: "<p>Tata tertib adalah peraturan yang harus ditaati. Tujuannya adalah untuk menciptakan ketertiban dan kelancaran, baik di tempat umum maupun di sekolah.</p>", funFact: "Mengantre adalah salah satu contoh menaati tata tertib di tempat umum.", kuis: [{ type: "pilihan-ganda", pertanyaan: "Memakai seragam lengkap dan rapi adalah contoh menaati tata tertib di...", pilihan: ["Rumah", "Taman bermain", "Sekolah", "Pasar"], jawaban: "Sekolah", hint:"Peraturan khusus di lingkungan pendidikan." }] },
                            pemerintahan_desa: { judul: "Pemerintahan Desa", konten: "<p>Desa dipimpin oleh seorang Kepala Desa yang dipilih oleh warganya. Kepala Desa dibantu oleh perangkat desa lainnya dalam menjalankan tugasnya.", funFact: "Lurah adalah sebutan untuk pemimpin di wilayah kelurahan, yang biasanya berada di perkotaan.", kuis: [{ type: "pilihan-ganda", pertanyaan: "Pemimpin pemerintahan di tingkat desa disebut...", pilihan: ["Camat", "Bupati", "Kepala Desa", "Gubernur"], jawaban: "Kepala Desa", hint:"Dipilih langsung oleh masyarakat desa." }] },
                            sumpah_pemuda: { judul: "Semangat Sumpah Pemuda", konten: "<p>Sumpah Pemuda adalah ikrar para pemuda Indonesia pada tanggal 28 Oktober 1928 yang berjanji untuk bertumpah darah, berbangsa, dan berbahasa satu, yaitu Indonesia.</p>", funFact: "Lagu 'Indonesia Raya' pertama kali diperdengarkan pada saat Kongres Pemuda II yang menghasilkan Sumpah Pemuda.", kuis: [{ type: "pilihan-ganda", pertanyaan: "Kapan Sumpah Pemuda diikrarkan?", pilihan: ["17 Agustus 1945", "2 Mei 1908", "28 Oktober 1928", "10 November 1945"], jawaban: "28 Oktober 1928", hint:"Diperingati sebagai Hari Sumpah Pemuda." }] }
                        } 
                    },
                    tik_sd: { 
                        namaDunia: "Planet Digital", warna: "teal", icon: "💻", deskripsi: "Kenali komputer, internet, dan cara aman berselancar di dunia maya.", 
                        subMateri: {
                            perangkat_keras: { judul: "Mengenal Komputer", konten: "<p>Komputer memiliki perangkat keras (hardware) utama: monitor (layar), CPU (otak komputer), keyboard (untuk mengetik), dan mouse (untuk menggerakkan kursor).</p>", funFact: "Mouse komputer pertama terbuat dari kayu!", kuis: [{ type: "pilihan-ganda", pertanyaan: "Perangkat untuk menampilkan gambar dan tulisan dari komputer adalah...", pilihan: ["CPU", "Keyboard", "Mouse", "Monitor"], jawaban: "Monitor", hint:"Bentuknya seperti televisi." }] },
                            perangkat_lunak: { judul: "Program Komputer", konten: "<p>Perangkat lunak (software) adalah program yang menjalankan komputer. Contohnya adalah sistem operasi (seperti Windows) dan program untuk menggambar (seperti Paint).</p>", funFact: "Program komputer pertama ditulis pada tahun 1843 oleh seorang wanita bernama Ada Lovelace.", kuis: [{ type: "pilihan-ganda", pertanyaan: "Program yang digunakan untuk menggambar di komputer adalah...", pilihan: ["Paint", "Calculator", "Word", "Excel"], jawaban: "Paint", hint:"Namanya berarti 'melukis'." }] },
                            mengetik: { judul: "Latihan Mengetik", konten: "<p>Keyboard digunakan untuk mengetik huruf dan angka. Tombol spasi untuk memberi jarak, dan tombol Enter untuk membuat baris baru.", funFact: "Susunan huruf QWERTY pada keyboard dibuat agar kita mengetik lebih lambat, karena mesin tik zaman dulu sering macet jika mengetik terlalu cepat.", kuis: [{ type: "pilihan-ganda", pertanyaan: "Tombol untuk menghapus tulisan yang salah adalah...", pilihan: ["Enter", "Spasi", "Backspace", "Shift"], jawaban: "Backspace", hint:"Menghapus ke arah kiri." }] },
                            menggambar_paint: { judul: "Asyiknya Menggambar", konten: "<p>Di program Paint, kita bisa menggunakan berbagai alat seperti pensil, kuas, dan kaleng cat untuk membuat gambar digital yang berwarna-warni.</p>", funFact: "Kamu bisa membuat warna sendiri dengan mengklik 'Edit Colors' di Paint.", kuis: [{ type: "pilihan-ganda", pertanyaan: "Ikon yang bentuknya seperti kaleng cat di Paint berfungsi untuk...", pilihan: ["Membuat garis", "Menulis teks", "Mewarnai bidang", "Menghapus"], jawaban: "Mewarnai bidang", hint:"Mengisi area dengan warna." }] },
                            internet_dasar: { judul: "Apa itu Internet?", konten: "<p>Internet adalah jaringan komputer raksasa yang menghubungkan seluruh dunia. Dengan internet, kita bisa mencari informasi dan berkomunikasi dengan orang lain.</p>", funFact: "Email pertama dikirim pada tahun 1971, bahkan sebelum internet dikenal luas.", kuis: [{ type: "pilihan-ganda", pertanyaan: "Untuk terhubung ke internet, kita memerlukan...", pilihan: ["Printer", "Speaker", "Koneksi internet (misal: WiFi)", "Scanner"], jawaban: "Koneksi internet (misal: WiFi)", hint:"Sinyal yang menghubungkan perangkatmu." }] },
                            mesin_pencari: { judul: "Mencari Informasi", konten: "<p>Mesin pencari seperti Google membantu kita menemukan informasi di internet. Cukup ketik kata kunci yang ingin dicari, lalu tekan Enter.</p>", funFact: "Setiap hari, ada miliaran pencarian yang dilakukan di Google.", kuis: [{ type: "pilihan-ganda", pertanyaan: "Kata atau frasa yang kita ketik di mesin pencari disebut...", pilihan: ["Judul", "Kata kunci", "Alamat", "Sandi"], jawaban: "Kata kunci", hint:"Kata yang menjadi kunci pencarian." }] },
                            aman_di_internet: { judul: "Aman di Dunia Maya", konten: "<p>Selalu ingat untuk tidak memberikan informasi pribadi seperti alamat rumah atau nomor telepon kepada orang asing di internet. Beritahu orang tuamu jika ada sesuatu yang membuatmu tidak nyaman.", funFact: "Kata sandi yang kuat biasanya terdiri dari campuran huruf besar, huruf kecil, angka, dan simbol.", kuis: [{ type: "pilihan-ganda", pertanyaan: "Jika ada orang tidak dikenal menghubungimu di internet, sebaiknya kamu...", pilihan: ["Memberikan nomormu", "Mengabaikannya dan memberitahu orang tua", "Mengajaknya bertemu", "Memarahinya"], jawaban: "Mengabaikannya dan memberitahu orang tua", hint:"Keselamatan adalah yang utama." }] },
                            email: { judul: "Mengirim Surat Elektronik", konten: "<p>Email atau surel (surat elektronik) adalah cara mengirim pesan melalui internet. Setiap orang memiliki alamat email yang unik.", funFact: "Simbol '@' dalam alamat email dibaca 'at' yang dalam bahasa Inggris berarti 'di'.", kuis: [{ type: "pilihan-ganda", pertanyaan: "Bagian dari email untuk menuliskan isi pesan utama adalah...", pilihan: ["Kepada (To)", "Subjek (Subject)", "Badan Email (Body)", "Lampiran (Attachment)"], jawaban: "Badan Email (Body)", hint:"Tempat untuk menulis suratnya." }] },
                            menyimpan_file: { judul: "Menyimpan Pekerjaanmu", konten: "<p>Setelah selesai menggambar atau mengetik, jangan lupa menyimpan file agar tidak hilang. Biasanya dengan mengklik File lalu Save.", funFact: "Nama file sebaiknya menggambarkan isinya, agar mudah dicari lagi nanti.", kuis: [{ type: "pilihan-ganda", pertanyaan: "Ekstensi file untuk gambar yang dibuat di Paint biasanya adalah...", pilihan: [".docx", ".mp3", ".png atau .jpg", ".txt"], jawaban: ".png atau .jpg", hint:"Ekstensi untuk file gambar." }] },
                            merawat_komputer: { judul: "Merawat Komputer", konten: "<p>Jaga kebersihan komputer dengan membersihkan layar dan keyboard. Jangan makan dan minum di dekat komputer agar tidak tumpah.", funFact: "Mematikan komputer dengan prosedur yang benar (Shutdown) dapat membuatnya lebih awet.", kuis: [{ type: "pilihan-ganda", pertanyaan: "Cara mematikan komputer yang benar adalah...", pilihan: ["Mencabut kabel listrik langsung", "Menekan tombol power lama-lama", "Melalui menu Start lalu Shutdown", "Menyiramnya dengan air"], jawaban: "Melalui menu Start lalu Shutdown", hint:"Prosedur yang aman." }] }
                        } 
                    },
                    musik_sd: { 
                        namaDunia: "Melodi Ceria", warna: "fuchsia", icon: "🎵", deskripsi: "Mengenal not, irama, dan alat musik yang menyenangkan.", 
                        subMateri: {
                            nada_tinggi_rendah: { judul: "Nada Tinggi dan Rendah", konten: "<p>Dalam musik, ada nada yang terdengar tinggi dan ada yang rendah. Pada not balok, semakin tinggi posisi not, semakin tinggi nadanya.", funFact: "Suara peluit bernada tinggi, sedangkan suara drum bernada rendah.", kuis: [{ type: "pilihan-ganda", pertanyaan: "Tangga nada dasar dalam musik adalah...", pilihan: ["A-B-C-D-E-F-G", "Do-Re-Mi-Fa-So-La-Si-Do", "1-2-3-4-5-6-7-8", "Alif-Ba-Ta"], jawaban: "Do-Re-Mi-Fa-So-La-Si-Do", hint:"Terdiri dari 8 nada." }] },
                            tempo: { judul: "Tempo Cepat dan Lambat", konten: "<p>Tempo adalah cepat lambatnya sebuah lagu dinyanyikan. Lagu gembira biasanya bertempo cepat, lagu sedih bertempo lambat.", funFact: "Kata 'tempo' berasal dari bahasa Italia yang artinya 'waktu'.", kuis: [{ type: "pilihan-ganda", pertanyaan: "Lagu 'Bintang Kecil' sebaiknya dinyanyikan dengan tempo...", pilihan: ["Sangat cepat (Allegro)", "Lambat (Largo)", "Cepat (Vivace)", "Sedang (Moderato)"], jawaban: "Lambat (Largo)", hint:"Lagu pengantar tidur." }] },
                            dinamik: { judul: "Dinamik Keras dan Lembut", konten: "<p>Dinamik adalah keras lembutnya suara saat bernyanyi atau bermain musik. Tanda 'f' (forte) berarti keras, tanda 'p' (piano) berarti lembut.", funFact: "Nama alat musik 'piano' sebenarnya adalah 'pianoforte', yang berarti bisa memainkan nada lembut dan keras.", kuis: [{ type: "pilihan-ganda", pertanyaan: "Untuk menunjukkan bagian lagu yang dinyanyikan dengan sangat keras, digunakan tanda...", pilihan: ["p (piano)", "mp (mezzo piano)", "f (forte)", "ff (fortissimo)"], jawaban: "ff (fortissimo)", hint:"Sangat forte." }] },
                            alat_musik_melodis: { judul: "Alat Musik Melodis", konten: "<p>Alat musik melodis adalah alat musik yang dapat menghasilkan nada, seperti piano, pianika, dan rekorder.</p>", funFact: "Pianika dimainkan dengan cara ditiup sambil menekan tuts-tutsnya.", kuis: [{ type: "pilihan-ganda", pertanyaan: "Berikut ini yang merupakan alat musik melodis adalah...", pilihan: ["Drum", "Gendang", "Pianika", "Triangle"], jawaban: "Pianika", hint:"Bisa memainkan melodi lagu." }] },
                            not_angka: { judul: "Membaca Not Angka", konten: "<p>Not angka menggunakan angka 1 (do) hingga 7 (si) untuk mewakili nada. Tanda titik di atas atau di bawah angka menunjukkan nada yang lebih tinggi atau rendah.", funFact: "Sistem notasi angka ini sangat populer di Indonesia untuk belajar musik.", kuis: [{ type: "pilihan-ganda", pertanyaan: "Dalam notasi angka, angka 5 melambangkan nada...", pilihan: ["Do", "Mi", "Sol", "Si"], jawaban: "Sol", hint:"Do, Re, Mi, Fa, ..." }] },
                            bernyanyi_unisono: { judul: "Bernyanyi Unisono", konten: "<p>Bernyanyi secara unisono berarti menyanyikan melodi yang sama secara bersama-sama dalam satu suara. Contohnya saat kita menyanyikan lagu Indonesia Raya saat upacara.", funFact: "Paduan suara yang baik membutuhkan kekompakan dalam memulai dan mengakhiri lagu bersama-sama.", kuis: [{ type: "pilihan-ganda", pertanyaan: "Bernyanyi bersama-sama dengan satu suara disebut...", pilihan: ["Solo", "Duet", "Unisono", "Kuartet"], jawaban: "Unisono", hint:"'Uni' berarti satu." }] },
                            alat_musik_harmonis: { judul: "Alat Musik Harmonis", konten: "<p>Alat musik harmonis dapat memainkan beberapa nada sekaligus untuk menciptakan harmoni atau akor, contohnya gitar dan keyboard.", funFact: "Satu akor biasanya terdiri dari tiga nada atau lebih yang dimainkan bersamaan.", kuis: [{ type: "pilihan-ganda", pertanyaan: "Contoh alat musik harmonis adalah...", pilihan: ["Seruling", "Gitar", "Tamborin", "Marakas"], jawaban: "Gitar", hint:"Bisa memainkan melodi dan iringan sekaligus." }] },
                            birama: { judul: "Ketukan Birama", konten: "<p>Birama adalah bagian dari baris melodi yang menunjukkan jumlah ketukan. Birama 2/4 artinya ada dua ketukan dalam setiap ruas birama.", funFact: "Dirigen atau konduktor orkestra menggunakan gerakan tangan untuk memberikan aba-aba birama kepada para pemain musik.", kuis: [{ type: "pilihan-ganda", pertanyaan: "Lagu 'Topi Saya Bundar' memiliki birama...", pilihan: ["2/4", "3/4", "4/4", "6/8"], jawaban: "4/4", hint:"Hitung ketukannya: To-pi-sa-ya | Bun-dar..." }] },
                            lagu_wajib_nasional: { judul: "Lagu Wajib Nasional", konten: "<p>Lagu wajib nasional adalah lagu yang diciptakan untuk menanamkan rasa cinta tanah air, seperti 'Indonesia Raya' dan 'Garuda Pancasila'.</p>", funFact: "Lagu 'Indonesia Raya' diciptakan oleh Wage Rudolf Supratman.", kuis: [{ type: "pilihan-ganda", pertanyaan: "Siapakah pencipta lagu 'Garuda Pancasila'?", pilihan: ["Ibu Sud", "C. Simanjuntak", "Sudharnoto", "W.R. Supratman"], jawaban: "Sudharnoto", hint:"Bukan pencipta Indonesia Raya." }] },
                            bunyi_alam_buatan: { judul: "Bunyi Alam dan Buatan", konten: "<p>Bunyi bisa berasal dari alam (suara hujan, kicau burung) atau buatan manusia (suara tepuk tangan, bunyi klakson mobil).</p>", funFact: "Gema terjadi ketika suara memantul kembali dari permukaan yang keras.", kuis: [{ type: "pilihan-ganda", pertanyaan: "Suara petir adalah contoh dari bunyi...", pilihan: ["Buatan", "Musik", "Alam", "Ritmis"], jawaban: "Alam", hint:"Berasal dari gejala alam." }] }
                        } 
                    },
                    inggris_sd: { 
                        namaDunia: "Kampung Inggris", warna: "indigo", icon: "🇬🇧", deskripsi: "Pelajari kata-kata dan percakapan dasar dalam Bahasa Inggris.", 
                        subMateri: {
                            greetings: { judul: "Greetings (Sapaan)", konten: "<p>Untuk menyapa dalam bahasa Inggris, kita bisa menggunakan 'Hello', 'Hi', 'Good morning' (selamat pagi), 'Good afternoon' (selamat siang), dan 'Good evening' (selamat malam).</p>", funFact: "'Goodbye' adalah kependekan dari frasa 'God be with ye' (Tuhan bersamamu).", kuis: [{ type: "pilihan-ganda", pertanyaan: "Apa yang kamu ucapkan saat bertemu guru di pagi hari?", pilihan: ["Good night", "Good morning", "Goodbye", "Hello"], jawaban: "Good morning", hint:"Pagi hari." }] },
                            numbers: { judul: "Numbers (Angka)", konten: "<p>Mari berhitung dalam bahasa Inggris! 1 (one), 2 (two), 3 (three), 4 (four), 5 (five), 6 (six), 7 (seven), 8 (eight), 9 (nine), 10 (ten).</p>", funFact: "Angka 'four' (4) adalah satu-satunya angka yang jumlah hurufnya sama dengan nilainya.", kuis: [{ type: "pilihan-ganda", pertanyaan: "What comes after six?", pilihan: ["Five", "Eight", "Seven", "Nine"], jawaban: "Seven", hint:"Angka setelah enam." }] },
                            colors: { judul: "Colors (Warna)", konten: "<p>Warna dalam bahasa Inggris: red (merah), yellow (kuning), blue (biru), green (hijau), black (hitam), white (putih).</p>", funFact: "Beberapa penelitian menunjukkan bahwa warna biru adalah warna yang paling disukai di seluruh dunia.", kuis: [{ type: "pilihan-ganda", pertanyaan: "The color of the sky is...", pilihan: ["Red", "Green", "Yellow", "Blue"], jawaban: "Blue", hint:"Warna langit." }] },
                            animals: { judul: "Animals (Hewan)", konten: "<p>Nama-nama hewan: cat (kucing), dog (anjing), bird (burung), fish (ikan), elephant (gajah), lion (singa).</p>", funFact: "Suara kucing 'meow' dalam bahasa Inggris hampir sama bunyinya di banyak bahasa lain.", kuis: [{ type: "pilihan-ganda", pertanyaan: "An animal that can fly is a...", pilihan: ["Fish", "Dog", "Bird", "Cat"], jawaban: "Bird", hint:"Hewan yang bisa terbang." }] },
                            fruits: { judul: "Fruits (Buah-buahan)", konten: "<p>Nama buah-buahan: apple (apel), banana (pisang), orange (jeruk), grape (anggur), watermelon (semangka).</p>", funFact: "Tomat sebenarnya adalah buah, bukan sayuran!", kuis: [{ type: "pilihan-ganda", pertanyaan: "A monkey likes to eat...", pilihan: ["Apple", "Grape", "Watermelon", "Banana"], jawaban: "Banana", hint:"Buah kesukaan monyet." }] },
                            family: { judul: "My Family (Keluargaku)", konten: "<p>Anggota keluarga: father (ayah), mother (ibu), brother (saudara laki-laki), sister (saudara perempuan), grandfather (kakek), grandmother (nenek).</p>", funFact: "Kata 'dad' dan 'mom' adalah panggilan informal yang umum digunakan di banyak negara berbahasa Inggris.", kuis: [{ type: "pilihan-ganda", pertanyaan: "Your mother's mother is your...", pilihan: ["Sister", "Aunt", "Grandmother", "Cousin"], jawaban: "Grandmother", hint:"Ibunya ibumu." }] },
                            body_parts: { judul: "Body Parts (Bagian Tubuh)", konten: "<p>Bagian tubuh kita: head (kepala), eyes (mata), nose (hidung), mouth (mulut), ears (telinga), hand (tangan), foot (kaki).</p>", funFact: "Sidik jari setiap orang benar-benar unik, tidak ada yang sama persis.", kuis: [{ type: "pilihan-ganda", pertanyaan: "We use our ... to see.", pilihan: ["Ears", "Nose", "Eyes", "Mouth"], jawaban: "Eyes", hint:"Digunakan untuk melihat." }] },
                            things_in_classroom: { judul: "In the Classroom", konten: "<p>Benda-benda di kelas: table (meja), chair (kursi), book (buku), pen (pulpen), pencil (pensil), bag (tas).</p>", funFact: "Kata 'pencil' berasal dari kata Latin 'pencillus' yang berarti 'ekor kecil'.", kuis: [{ type: "pilihan-ganda", pertanyaan: "We sit on a ... in the classroom.", pilihan: ["Table", "Book", "Chair", "Bag"], jawaban: "Chair", hint:"Digunakan untuk duduk." }] },
                            asking_name: { judul: "What's Your Name?", konten: "<p>Untuk menanyakan nama, kita bilang 'What is your name?'. Untuk menjawabnya, kita bilang 'My name is...'.</p>", funFact: "Menanyakan nama adalah salah satu hal pertama yang kita pelajari saat berkenalan.", kuis: [{ type: "pilihan-ganda", pertanyaan: "Bagaimana cara menjawab pertanyaan 'What is your name?'", pilihan: ["I am fine", "My name is Budi", "I am seven years old", "Hello"], jawaban: "My name is Budi", hint:"Menyebutkan namamu." }] },
                            feelings: { judul: "Feelings (Perasaan)", konten: "<p>Mengungkapkan perasaan: I am happy (saya senang), I am sad (saya sedih), I am angry (saya marah), I am sleepy (saya mengantuk).</p>", funFact: "Tersenyum, bahkan saat kita tidak merasa senang, dapat benar-benar membuat suasana hati kita menjadi lebih baik.", kuis: [{ type: "pilihan-ganda", pertanyaan: "When you get a present, you feel...", pilihan: ["Sad", "Angry", "Sleepy", "Happy"], jawaban: "Happy", hint:"Perasaan saat mendapat hadiah." }] }
                        } 
                    }
                }
            },
            smp: {
                dunia: {
                    aljabar_smp: {
                        namaDunia: "Laboratorium Aljabar", warna: "blue", icon: "➗", deskripsi: "Memecahkan misteri dengan variabel dan rumus matematika.",
                        subMateri: {
                            misteri_x: { judul: "Misteri Huruf X", konten: "<p>Aljabar menggunakan huruf (variabel) untuk mewakili angka yang tidak diketahui. Contoh: x + 5 = 8, berarti x adalah 3.</p>", funFact: "Kata 'aljabar' berasal dari kata Arab 'al-jabr' yang berarti 'penggabungan bagian yang rusak'.", kuis: [{ type: "pilihan-ganda", pertanyaan: "Jika 2a = 10, berapakah nilai a?", pilihan: ["4", "5", "6"], jawaban: "5", hint: "Angka berapa yang jika dikalikan 2 hasilnya 10?" }] },
                            himpunan: { judul: "Klub Himpunan", konten: "<p>Himpunan adalah kumpulan objek yang terdefinisi dengan jelas. Contoh: Himpunan hewan berkaki empat.</p>", funFact: "Konsep himpunan modern dikembangkan oleh Georg Cantor pada akhir abad ke-19.", kuis: [{ type: "pilihan-ganda", pertanyaan: "Mana yang merupakan himpunan?", pilihan: ["Kumpulan lukisan indah", "Kumpulan siswa kelas 7A", "Kumpulan orang pintar"], jawaban: "Kumpulan siswa kelas 7A", hint: "Anggotanya jelas dan pasti." }] },
                            garis_sudut: { judul: "Perpotongan Garis", konten: "<p>Dua garis sejajar yang dipotong garis lain akan membentuk sudut-sudut yang memiliki hubungan, seperti sehadap dan berseberangan.</p>", funFact: "Ilmu tentang garis dan sudut, geometri, adalah salah satu cabang matematika tertua.", kuis: [{ type: "pilihan-ganda", pertanyaan: "Sudut yang besarnya tepat 90 derajat disebut sudut...", pilihan: ["Lancip", "Tumpul", "Siku-siku"], jawaban: "Siku-siku", hint: "Seperti sudut pada buku." }] },
                            pythagoras: { judul: "Segitiga Siku-Siku Pythagoras", konten: "<p>Pada segitiga siku-siku, kuadrat sisi miring (hipotenusa) sama dengan jumlah kuadrat dua sisi lainnya (a² + b² = c²).</p>", funFact: "Meskipun dinamai Pythagoras, teorema ini sudah dikenal oleh bangsa Babilonia 1000 tahun sebelumnya.", kuis: [{ type: "pilihan-ganda", pertanyaan: "Jika sisi tegak segitiga adalah 3 dan 4, berapa sisi miringnya?", pilihan: ["5", "6", "7"], jawaban: "5", hint: "Hitung akar dari (3x3 + 4x4)." }] },
                            bangun_ruang: { judul: "Dimensi Ketiga", konten: "<p>Bangun ruang seperti kubus, balok, dan tabung memiliki volume (isi) dan luas permukaan.</p>", funFact: "Bola adalah bangun ruang dengan luas permukaan terkecil untuk volume tertentu.", kuis: [{ type: "pilihan-ganda", pertanyaan: "Rumus volume kubus dengan sisi 's' adalah...", pilihan: ["s x s", "6 x s x s", "s x s x s"], jawaban: "s x s x s", hint: "Panjang kali lebar kali tinggi." }] },
                            persamaan_linear: { judul: "Menyeimbangkan Persamaan", konten: "<p>Persamaan Linear Satu Variabel (PLSV) adalah kalimat terbuka dengan satu variabel yang memiliki hubungan sama dengan.</p>", funFact: "Prinsip menyeimbangkan persamaan mirip seperti neraca timbangan agar tetap seimbang.", kuis: [{ type: "pilihan-ganda", pertanyaan: "Penyelesaian dari x - 3 = 7 adalah...", pilihan: ["x = 4", "x = 10", "x = 9"], jawaban: "x = 10", hint: "Pindahkan -3 ke sisi kanan menjadi +3." }] },
                            gradien: { judul: "Si Garis Miring", konten: "<p>Gradien (m) adalah ukuran kemiringan suatu garis lurus. Dihitung dari perubahan vertikal dibagi perubahan horizontal.</p>", funFact: "Konsep gradien sangat penting dalam pembangunan jalan di pegunungan agar tidak terlalu curam.", kuis: [{ type: "pilihan-ganda", pertanyaan: "Garis yang datar sempurna memiliki gradien...", pilihan: ["1", "0", "Tak terhingga"], jawaban: "0", hint: "Tidak ada perubahan vertikal." }] },
                            peluang: { judul: "Peluang Dadu", konten: "<p>Peluang adalah kemungkinan terjadinya suatu peristiwa. Dihitung dari jumlah kejadian yang diinginkan dibagi total kemungkinan.</p>", funFact: "Ilmu peluang awalnya dikembangkan untuk menganalisis permainan judi.", kuis: [{ type: "pilihan-ganda", pertanyaan: "Berapa peluang munculnya angka 5 saat melempar satu dadu?", pilihan: ["1/6", "5/6", "1/2"], jawaban: "1/6", hint: "Ada satu angka 5 dari total enam sisi." }] },
                            statistika: { judul: "Membaca Data", konten: "<p>Statistika adalah ilmu mengolah data. Mean (rata-rata), median (nilai tengah), dan modus (paling sering muncul) adalah ukuran pemusatan data.</p>", funFact: "Statistika digunakan di hampir semua bidang, dari prakiraan cuaca hingga pemilu.", kuis: [{ type: "pilihan-ganda", pertanyaan: "Modus dari data: 2, 3, 3, 4, 5 adalah...", pilihan: ["2", "3", "4"], jawaban: "3", hint: "Angka yang muncul paling banyak." }] },
                            aritmetika_sosial: { judul: "Matematika Jual Beli", konten: "<p>Aritmetika sosial membahas tentang untung, rugi, diskon, dan bunga dalam kehidupan sehari-hari.</p>", funFact: "Kata 'diskon' berasal dari bahasa Latin 'computare' yang berarti menghitung.", kuis: [{ type: "pilihan-ganda", pertanyaan: "Baju seharga 100.000 diskon 20%. Berapa harga yang harus dibayar?", pilihan: ["80.000", "20.000", "120.000"], jawaban: "80.000", hint: "Diskonnya 20% dari 100.000, lalu kurangkan." }] }
                        }
                    },
                    biologi_smp: {
                        namaDunia: "Ekspedisi Biologi", warna: "green", icon: "🧬", deskripsi: "Menyelami dunia makhluk hidup, dari sel terkecil hingga ekosistem.",
                        subMateri: {
                            sel: { judul: "Kota Sel", konten: "<p>Sel adalah unit terkecil kehidupan. Sel hewan dan tumbuhan memiliki bagian-bagian (organel) seperti inti sel dan mitokondria.</p>", funFact: "Tubuh manusia dewasa terdiri dari sekitar 37 triliun sel!", kuis: [{ type: "pilihan-ganda", pertanyaan: "Bagian sel yang berfungsi sebagai 'otak' atau pusat kendali adalah?", pilihan: ["Dinding Sel", "Mitokondria", "Inti Sel"], jawaban: "Inti Sel", hint: "Mengandung materi genetik (DNA)." }] },
                            ekosistem: { judul: "Jaring-Jaring Kehidupan", konten: "<p>Ekosistem adalah interaksi antara makhluk hidup (biotik) dan lingkungannya (abiotik). Ada rantai makanan dan jaring-jaring makanan.</p>", funFact: "Satu sendok teh tanah yang sehat bisa mengandung miliaran mikroorganisme.", kuis: [{ type: "pilihan-ganda", pertanyaan: "Dalam rantai makanan, tumbuhan berperan sebagai...", pilihan: ["Konsumen", "Produsen", "Pengurai"], jawaban: "Produsen", hint: "Mereka membuat makanan sendiri." }] },
                            klasifikasi: { judul: "Pohon Kehidupan", konten: "<p>Makhluk hidup diklasifikasikan ke dalam beberapa kerajaan (Kingdom), seperti Monera, Protista, Fungi, Plantae, dan Animalia.</p>", funFact: "Sistem klasifikasi modern (taksonomi) diciptakan oleh Carl Linnaeus.", kuis: [{ type: "pilihan-ganda", pertanyaan: "Jamur termasuk dalam kerajaan...", pilihan: ["Plantae", "Fungi", "Animalia"], jawaban: "Fungi", hint: "Tidak bisa berfotosintesis." }] },
                            fotosintesis: { judul: "Dapur Tumbuhan", konten: "<p>Fotosintesis adalah proses tumbuhan membuat makanan sendiri menggunakan cahaya matahari, air, dan karbon dioksida, menghasilkan oksigen.</p>", funFact: "Lebih dari setengah oksigen di bumi dihasilkan oleh fitoplankton di lautan, bukan pohon.", kuis: [{ type: "pilihan-ganda", pertanyaan: "Gas yang dibutuhkan tumbuhan untuk fotosintesis adalah...", pilihan: ["Oksigen", "Karbon dioksida", "Nitrogen"], jawaban: "Karbon dioksida", hint: "Gas yang kita hembuskan saat bernapas." }] },
                            sistem_gerak: { judul: "Rangka dan Otot", konten: "<p>Manusia bergerak menggunakan sistem gerak yang terdiri dari rangka (tulang) sebagai alat gerak pasif dan otot sebagai alat gerak aktif.</p>", funFact: "Tulang paha adalah tulang terpanjang dan terkuat di tubuh manusia.", kuis: [{ type: "pilihan-ganda", pertanyaan: "Alat gerak aktif pada manusia adalah...", pilihan: ["Tulang", "Sendi", "Otot"], jawaban: "Otot", hint: "Bisa berkontraksi dan relaksasi." }] },
                            sistem_peredaran_darah: { judul: "Aliran Darah", konten: "<p>Jantung memompa darah ke seluruh tubuh melalui pembuluh darah (arteri dan vena) untuk mengedarkan oksigen dan nutrisi.</p>", funFact: "Jika semua pembuluh darah dalam satu orang disambung, panjangnya bisa mengelilingi bumi lebih dari dua kali.", kuis: [{ type: "pilihan-ganda", pertanyaan: "Organ yang berfungsi memompa darah adalah...", pilihan: ["Paru-paru", "Jantung", "Hati"], jawaban: "Jantung", hint: "Terletak di rongga dada sebelah kiri." }] },
                            sistem_saraf: { judul: "Pusat Kendali Tubuh", konten: "<p>Sistem saraf, yang terdiri dari otak, sumsum tulang belakang, dan saraf, berfungsi sebagai pusat kendali dan komunikasi tubuh.</p>", funFact: "Sinyal saraf dapat bergerak dengan kecepatan lebih dari 400 km/jam!", kuis: [{ type: "pilihan-ganda", pertanyaan: "Pusat sistem saraf manusia adalah...", pilihan: ["Jantung", "Otak", "Pankreas"], jawaban: "Otak", hint: "Terletak di dalam kepala." }] },
                            pewarisan_sifat: { judul: "Gen dan DNA", konten: "<p>Sifat-sifat kita, seperti warna rambut dan mata, diwariskan dari orang tua melalui materi genetik yang disebut gen dalam DNA.</p>", funFact: "Manusia berbagi sekitar 99.9% DNA yang sama satu sama lain.", kuis: [{ type: "pilihan-ganda", pertanyaan: "Bapak Genetika Modern adalah...", pilihan: ["Charles Darwin", "Gregor Mendel", "Albert Einstein"], jawaban: "Gregor Mendel", hint: "Dia meneliti kacang ercis." }] },
                            adaptasi: { judul: "Bertahan di Alam", konten: "<p>Adaptasi adalah cara makhluk hidup menyesuaikan diri dengan lingkungannya. Ada adaptasi morfologi (bentuk tubuh), fisiologi (fungsi tubuh), dan tingkah laku.</p>", funFact: "Bunglon mengubah warna kulitnya bukan hanya untuk kamuflase, tapi juga untuk komunikasi dan mengatur suhu tubuh.", kuis: [{ type: "pilihan-ganda", pertanyaan: "Bentuk paruh burung yang berbeda-beda sesuai jenis makanannya adalah contoh adaptasi...", pilihan: ["Fisiologi", "Morfologi", "Tingkah laku"], jawaban: "Morfologi", hint: "Berkaitan dengan bentuk fisik." }] },
                            pencemaran: { judul: "Ancaman Lingkungan", konten: "<p>Pencemaran lingkungan (air, udara, tanah) disebabkan oleh limbah industri dan rumah tangga yang dapat merusak ekosistem.</p>", funFact: "Efek rumah kaca disebabkan oleh penumpukan gas seperti karbon dioksida di atmosfer, menyebabkan pemanasan global.", kuis: [{ type: "pilihan-ganda", pertanyaan: "Gas utama penyebab efek rumah kaca adalah...", pilihan: ["Oksigen", "Nitrogen", "Karbon Dioksida"], jawaban: "Karbon Dioksida", hint: "Dihasilkan dari pembakaran." }] }
                        }
                    },
                    fisika_smp: {
                        namaDunia: "Bengkel Fisika", warna: "purple", icon: "⚛️", deskripsi: "Mengungkap hukum alam yang mengatur energi, gaya, dan gerak.",
                        subMateri: {
                            hukum_newton: { judul: "Gaya dan Gerak Newton", konten: "<p>Hukum Newton menjelaskan hubungan antara gaya dan gerak. Benda diam akan tetap diam jika tidak ada gaya (Inersia).</p>", funFact: "Kisah apel jatuh yang menginspirasi Newton tentang gravitasi mungkin tidak benar-benar terjadi, tetapi menjadi legenda yang populer.", kuis: [{ type: "pilihan-ganda", pertanyaan: "Mengapa kita terdorong ke depan saat bus mengerem mendadak? Ini contoh hukum...", pilihan: ["Hukum I Newton", "Hukum II Newton", "Hukum III Newton"], jawaban: "Hukum I Newton", hint: "Tentang kelembaman atau inersia." }] },
                            energi: { judul: "Energi Kinetik & Potensial", konten: "<p>Energi tidak dapat diciptakan atau dimusnahkan, hanya berubah bentuk. Energi potensial adalah energi karena posisi, energi kinetik adalah energi karena gerak.</p>", funFact: "Roller coaster adalah contoh sempurna perubahan energi dari potensial (di puncak) menjadi kinetik (saat meluncur).", kuis: [{ type: "pilihan-ganda", pertanyaan: "Apel yang tergantung di pohon memiliki energi...", pilihan: ["Kinetik", "Potensial", "Bunyi"], jawaban: "Potensial", hint: "Energi yang tersimpan karena ketinggiannya." }] },
                            pesawat_sederhana: { judul: "Pengungkit dan Katrol", konten: "<p>Pesawat sederhana adalah alat yang memudahkan pekerjaan, seperti tuas/pengungkit, katrol, dan bidang miring.</p>", funFact: "Piramida di Mesir kemungkinan besar dibangun menggunakan bidang miring raksasa untuk mengangkat balok-balok batu.", kuis: [{ type: "pilihan-ganda", pertanyaan: "Gunting adalah contoh dari pesawat sederhana jenis...", pilihan: ["Katrol", "Bidang Miring", "Tuas"], jawaban: "Tuas", hint: "Memiliki titik tumpu, kuasa, dan beban." }] },
                            tekanan: { judul: "Tekanan Zat", konten: "<p>Tekanan adalah gaya yang bekerja pada suatu luas permukaan. Pisau tajam karena luas permukaannya sangat kecil, sehingga tekanannya besar.</p>", funFact: "Kapal selam dapat menyelam dan mengapung dengan mengatur jumlah air di dalam tangki pemberatnya, sesuai prinsip Archimedes.", kuis: [{ type: "pilihan-ganda", pertanyaan: "Mengapa paku yang ujungnya runcing lebih mudah menancap?", pilihan: ["Karena gayanya lebih besar", "Karena tekanannya lebih besar", "Karena bahannya lebih kuat"], jawaban: "Karena tekanannya lebih besar", hint: "Luas permukaan kecil, tekanan besar." }] },
                            getaran_gelombang: { judul: "Getaran dan Gelombang", konten: "<p>Getaran adalah gerak bolak-balik. Gelombang adalah getaran yang merambat dan membawa energi, seperti gelombang suara dan cahaya.</p>", funFact: "Suara tidak dapat merambat di ruang hampa, karena tidak ada medium untuk bergetar.", kuis: [{ type: "pilihan-ganda", pertanyaan: "Contoh gelombang transversal adalah...", pilihan: ["Gelombang suara", "Gelombang cahaya", "Gelombang pada pegas"], jawaban: "Gelombang cahaya", hint: "Arah getarnya tegak lurus dengan arah rambatnya." }] },
                            optik: { judul: "Cermin dan Lensa", konten: "<p>Optik mempelajari cahaya. Cermin memantulkan cahaya, sedangkan lensa membiaskan cahaya. Digunakan pada kacamata dan teleskop.</p>", funFact: "Pelangi adalah contoh dari peristiwa dispersi, yaitu penguraian cahaya putih menjadi berbagai warna.", kuis: [{ type: "pilihan-ganda", pertanyaan: "Untuk membantu penderita rabun jauh (miopi), digunakan kacamata berlensa...", pilihan: ["Cekung", "Cembung", "Datar"], jawaban: "Cekung", hint: "Lensa negatif." }] },
                            listrik: { judul: "Arus Listrik", konten: "<p>Listrik dinamis adalah aliran elektron dalam suatu rangkaian tertutup. Ada rangkaian seri dan paralel.</p>", funFact: "Belut listrik dapat menghasilkan sengatan hingga 600 volt untuk melumpuhkan mangsanya.", kuis: [{ type: "pilihan-ganda", pertanyaan: "Pada rangkaian seri, jika satu lampu mati, maka lampu lain akan...", pilihan: ["Tetap menyala", "Makin terang", "Ikut mati"], jawaban: "Ikut mati", hint: "Karena alirannya terputus." }] },
                            suhu_kalor: { judul: "Panas dan Dingin", konten: "<p>Suhu adalah ukuran derajat panas. Kalor adalah energi panas yang berpindah dari benda bersuhu tinggi ke rendah. Perpindahan bisa secara konduksi, konveksi, atau radiasi.</p>", funFact: "Warna putih memantulkan panas lebih baik daripada warna hitam, itulah sebabnya kita merasa lebih sejuk memakai baju putih di hari yang panas.", kuis: [{ type: "pilihan-ganda", pertanyaan: "Asap api unggun yang bergerak ke atas adalah contoh perpindahan panas secara...", pilihan: ["Konduksi", "Konveksi", "Radiasi"], jawaban: "Konveksi", hint: "Perpindahan panas melalui aliran zat." }] },
                            kemagnetan: { judul: "Medan Magnet", konten: "<p>Magnet menghasilkan medan magnet di sekitarnya. Bumi sendiri adalah magnet raksasa yang melindungi kita dari radiasi matahari.</p>", funFact: "Beberapa hewan, seperti burung merpati dan penyu, menggunakan medan magnet bumi untuk navigasi saat bermigrasi.", kuis: [{ type: "pilihan-ganda", pertanyaan: "Jika dua kutub magnet yang sama didekatkan, akan terjadi...", pilihan: ["Tarik-menarik", "Tolak-menolak", "Tidak ada interaksi"], jawaban: "Tolak-menolak", hint: "Utara dengan utara, atau selatan dengan selatan." }] },
                            tata_surya_smp: { judul: "Jelajah Antariksa", konten: "<p>Tata surya kita terdiri dari Matahari sebagai pusat, dan planet-planet yang mengorbitnya karena gaya gravitasi.</p>", funFact: "Satu hari di Venus lebih lama daripada satu tahun di Venus. Rotasinya sangat lambat!", kuis: [{ type: "pilihan-ganda", pertanyaan: "Planet yang terkenal dengan cincinnya adalah...", pilihan: ["Jupiter", "Mars", "Saturnus"], jawaban: "Saturnus", hint: "Planet terbesar kedua di tata surya." }] }
                        }
                    },
                    kimia_smp: { 
                        namaDunia: "Dapur Kimia", warna: "orange", icon: "🧪", deskripsi: "Mengenal unsur, senyawa, dan reaksi yang membentuk dunia kita.", 
                        subMateri: {
                            materi: { judul: "Wujud Materi", konten: "<p>Materi adalah segala sesuatu yang memiliki massa dan menempati ruang. Materi dapat berwujud padat, cair, dan gas, dan dapat berubah wujud melalui proses seperti mencair dan menguap.</p>", funFact: "Plasma, sering disebut wujud keempat materi, adalah wujud materi paling umum di alam semesta, ditemukan di bintang-bintang.", kuis: [{ type: "pilihan-ganda", pertanyaan: "Perubahan wujud dari gas langsung menjadi padat disebut...", pilihan: ["Menyublim", "Mengkristal", "Mengembun"], jawaban: "Mengkristal", hint: "Kebalikan dari menyublim, contohnya pembentukan salju."}] },
                            unsur_senyawa_campuran: { judul: "Unsur, Senyawa, Campuran", konten: "<p>Unsur adalah zat tunggal (Oksigen). Senyawa adalah gabungan unsur secara kimia (Air, H₂O). Campuran adalah gabungan zat tanpa reaksi kimia (Air Gula).</p>", funFact: "Udara yang kita hirup adalah contoh campuran, sebagian besar terdiri dari unsur Nitrogen dan Oksigen.", kuis: [{ type: "pilihan-ganda", pertanyaan: "Manakah yang merupakan contoh campuran homogen?", pilihan: ["Pasir dan air", "Minyak dan air", "Sirup"], jawaban: "Sirup", hint: "Komponennya tidak dapat dibedakan lagi."}] },
                            atom_molekul: { judul: "Partikel Terkecil", konten: "<p>Atom adalah bagian terkecil dari suatu unsur. Molekul adalah gabungan dari dua atom atau lebih, baik dari unsur yang sama (O₂) maupun berbeda (H₂O).</p>", funFact: "Jika sebuah apel diperbesar hingga seukuran Bumi, maka atom-atom di dalamnya baru akan seukuran apel asli.", kuis: [{ type: "pilihan-ganda", pertanyaan: "Partikel yang menyusun molekul air (H₂O) adalah...", pilihan: ["2 atom Hidrogen & 1 atom Oksigen", "1 atom Hidrogen & 2 atom Oksigen", "Hanya atom air"], jawaban: "2 atom Hidrogen & 1 atom Oksigen", hint: "Lihat rumus kimianya: H₂O."}] },
                            larutan_asam_basa: { judul: "Larutan Asam Basa", konten: "<p>Larutan asam memiliki rasa masam dan pH < 7 (contoh: cuka). Larutan basa terasa licin dan pH > 7 (contoh: sabun). pH 7 adalah netral (air murni).</p>", funFact: "Indikator alami seperti ekstrak kunyit atau kol ungu dapat berubah warna untuk menunjukkan suatu larutan bersifat asam atau basa.", kuis: [{ type: "pilihan-ganda", pertanyaan: "Kertas lakmus merah akan berubah menjadi biru jika dicelupkan ke dalam larutan...", pilihan: ["Asam", "Basa", "Netral"], jawaban: "Basa", hint: "Basa membirukan lakmus merah."}] },
                            reaksi_kimia: { judul: "Perubahan Kimia", konten: "<p>Reaksi kimia adalah proses yang menghasilkan zat baru. Ciri-cirinya antara lain perubahan warna, timbulnya gas, terbentuknya endapan, atau perubahan suhu.</p>", funFact: "Karat pada besi adalah contoh reaksi kimia yang lambat antara besi, oksigen, dan air.", kuis: [{ type: "pilihan-ganda", pertanyaan: "Pembakaran kertas adalah contoh perubahan...", pilihan: ["Fisika", "Kimia", "Wujud"], jawaban: "Kimia", hint: "Kertas berubah menjadi abu, zat yang baru."}] },
                            tabel_periodik: { judul: "Peta Unsur", konten: "<p>Tabel periodik adalah tabel yang menampilkan semua unsur kimia yang diketahui, diatur berdasarkan nomor atom dan sifat kimianya yang berulang (periodik).</p>", funFact: "Dmitri Mendeleev, penemu tabel periodik, dengan berani meninggalkan ruang kosong untuk unsur-unsur yang ia prediksi akan ditemukan, dan prediksinya terbukti benar.", kuis: [{ type: "pilihan-ganda", pertanyaan: "Unsur dengan simbol 'Fe' adalah...", pilihan: ["Emas", "Perak", "Besi"], jawaban: "Besi", hint: "Berasal dari nama Latinnya, Ferrum."}] },
                            pemisahan_campuran: { judul: "Memisahkan Campuran", konten: "<p>Ada berbagai cara memisahkan campuran, seperti filtrasi (penyaringan), distilasi (penyulingan berdasarkan titik didih), dan kromatografi (berdasarkan perbedaan kecepatan rambat).</p>", funFact: "Proses pembuatan garam dari air laut menggunakan metode penguapan (evaporasi), salah satu teknik pemisahan campuran sederhana.", kuis: [{ type: "pilihan-ganda", pertanyaan: "Metode yang paling tepat untuk memisahkan air teh dari ampasnya adalah...", pilihan: ["Distilasi", "Filtrasi", "Kromatografi"], jawaban: "Filtrasi", hint: "Menggunakan saringan."}] },
                            stoikiometri_dasar: { judul: "Konsep Mol", konten: "<p>Mol adalah satuan jumlah zat dalam kimia. Satu mol zat mengandung partikel sebanyak bilangan Avogadro (sekitar 6,022 x 10²³ partikel).</p>", funFact: "Satu mol butiran popcorn akan menutupi seluruh daratan Amerika Serikat dengan kedalaman lebih dari 14 km!", kuis: [{ type: "pilihan-ganda", pertanyaan: "Satuan standar internasional (SI) untuk jumlah zat adalah...", pilihan: ["Gram", "Liter", "Mol"], jawaban: "Mol", hint: "Ini adalah konsep sentral dalam perhitungan kimia."}] },
                            ikatan_kimia: { judul: "Ikatan Kimia", konten: "<p>Atom-atom bergabung membentuk molekul melalui ikatan kimia. Ikatan ionik terjadi karena serah terima elektron (logam & nonlogam), sedangkan ikatan kovalen terjadi karena pemakaian bersama elektron (nonlogam & nonlogam).</p>", funFact: "Ikatan hidrogen, meskipun lebih lemah dari ikatan kovalen, sangat penting dan bertanggung jawab atas sifat-sifat unik air.", kuis: [{ type: "pilihan-ganda", pertanyaan: "Ikatan yang terbentuk dalam senyawa garam dapur (NaCl) adalah...", pilihan: ["Kovalen", "Ionik", "Logam"], jawaban: "Ionik", hint: "Terbentuk dari unsur logam (Na) dan nonlogam (Cl)."}] },
                            zat_aditif_adiktif: { judul: "Zat Aditif & Adiktif", konten: "<p>Zat aditif adalah bahan yang ditambahkan ke makanan (pewarna, pengawet). Zat adiktif adalah zat yang dapat menyebabkan kecanduan (nikotin, kafein).</p>", funFact: "Monosodium Glutamat (MSG) adalah zat aditif yang memberikan rasa 'umami' atau gurih pada makanan.", kuis: [{ type: "pilihan-ganda", pertanyaan: "Pemanis, pengawet, dan pewarna pada makanan termasuk golongan...", pilihan: ["Zat adiktif", "Zat aditif", "Narkotika"], jawaban: "Zat aditif", hint: "Ditambahkan untuk tujuan tertentu."}] }
                        }
                    },
                    pkn_smp: { 
                        namaDunia: "Parlemen Muda", warna: "indigo", icon: "⚖️", deskripsi: "Mempelajari dasar-dasar negara, hukum, dan demokrasi.", 
                        subMateri: {
                            norma: { judul: "Aturan Masyarakat", konten: "<p>Norma adalah aturan atau kaidah yang berlaku dalam masyarakat. Ada norma agama, kesusilaan, kesopanan, dan hukum. Tujuannya adalah menciptakan ketertiban.</p>", funFact: "Norma kesopanan bisa berbeda-beda di setiap daerah, contohnya cara makan atau menyapa orang yang lebih tua.", kuis: [{ type: "pilihan-ganda", pertanyaan: "Sanksi yang paling tegas dan memaksa berasal dari norma...", pilihan: ["Agama", "Kesopanan", "Hukum"], jawaban: "Hukum", hint: "Diberlakukan oleh aparat negara."}] },
                            uud_1945: { judul: "Konstitusi Negara", konten: "<p>Undang-Undang Dasar Negara Republik Indonesia Tahun 1945 adalah hukum dasar tertulis dan sumber hukum tertinggi di Indonesia.</p>", funFact: "UUD 1945 telah mengalami empat kali perubahan (amandemen) antara tahun 1999 hingga 2002 untuk menyesuaikan dengan tuntutan reformasi.", kuis: [{ type: "pilihan-ganda", pertanyaan: "Lembaga yang berwenang mengubah dan menetapkan UUD adalah...", pilihan: ["Presiden", "DPR", "MPR"], jawaban: "MPR", hint: "Majelis Permusyawaratan Rakyat."}] },
                            kedaulatan_rakyat: { judul: "Kedaulatan Rakyat", konten: "<p>Kedaulatan berada di tangan rakyat dan dilaksanakan menurut UUD. Artinya, rakyatlah pemegang kekuasaan tertinggi di negara, yang diwujudkan melalui pemilihan umum (pemilu).</p>", funFact: "Prinsip 'dari rakyat, oleh rakyat, dan untuk rakyat' adalah esensi dari demokrasi yang berdaulat di tangan rakyat.", kuis: [{ type: "pilihan-ganda", pertanyaan: "Sarana perwujudan kedaulatan rakyat di Indonesia adalah...", pilihan: ["Demonstrasi", "Musyawarah desa", "Pemilu"], jawaban: "Pemilu", hint: "Untuk memilih wakil rakyat dan pemimpin."}] },
                            persatuan_kesatuan: { judul: "Makna Persatuan", konten: "<p>Persatuan dan kesatuan bangsa Indonesia sangat penting untuk menjaga keutuhan Negara Kesatuan Republik Indonesia (NKRI) di tengah keragaman suku, agama, ras, dan budaya.</p>", funFact: "Sumpah Pemuda pada tahun 1928 adalah salah satu tonggak sejarah terpenting dalam mewujudkan persatuan bangsa Indonesia.", kuis: [{ type: "pilihan-ganda", pertanyaan: "Semboyan yang melandasi persatuan dalam keragaman di Indonesia adalah...", pilihan: ["Tut Wuri Handayani", "Bhinneka Tunggal Ika", "Rawe-rawe rantas malang-malang putung"], jawaban: "Bhinneka Tunggal Ika", hint: "Artinya berbeda-beda tetapi tetap satu."}] },
                            demokrasi_pancasila: { judul: "Demokrasi Pancasila", konten: "<p>Demokrasi Pancasila adalah demokrasi yang berdasarkan pada nilai-nilai Pancasila, mengutamakan musyawarah untuk mufakat, dan berketuhanan Yang Maha Esa.</p>", funFact: "Ciri khas Demokrasi Pancasila adalah adanya keseimbangan antara hak dan kewajiban, serta kebebasan yang bertanggung jawab.", kuis: [{ type: "pilihan-ganda", pertanyaan: "Pengambilan keputusan dalam Demokrasi Pancasila mengutamakan...", pilihan: ["Suara terbanyak (voting)", "Keputusan pemimpin", "Musyawarah untuk mufakat"], jawaban: "Musyawarah untuk mufakat", hint: "Ini adalah cerminan sila keempat."}] },
                            ham: { judul: "Hak Asasi Manusia", konten: "<p>Hak Asasi Manusia (HAM) adalah hak dasar yang melekat pada diri manusia sejak lahir sebagai anugerah Tuhan, seperti hak untuk hidup, hak berpendapat, dan hak beragama.</p>", funFact: "Deklarasi Universal HAM diadopsi oleh PBB pada 10 Desember 1948, yang kini diperingati sebagai Hari HAM Sedunia.", kuis: [{ type: "pilihan-ganda", pertanyaan: "Berikut ini yang merupakan contoh kewajiban asasi manusia adalah...", pilihan: ["Mendapat pendidikan", "Menghormati hak orang lain", "Mengeluarkan pendapat"], jawaban: "Menghormati hak orang lain", hint: "Kewajiban yang menyertai hak."}] },
                            otonomi_daerah: { judul: "Otonomi Daerah", konten: "<p>Otonomi daerah adalah penyerahan wewenang dari pemerintah pusat kepada pemerintah daerah untuk mengatur dan mengurus sendiri urusan pemerintahannya.", funFact: "Tujuan otonomi daerah adalah untuk meningkatkan pelayanan publik dan mendekatkan pembangunan kepada masyarakat.", kuis: [{ type: "pilihan-ganda", pertanyaan: "Kepala daerah untuk tingkat provinsi adalah...", pilihan: ["Bupati", "Walikota", "Gubernur"], jawaban: "Gubernur", hint: "Dipilih melalui Pilkada."}] },
                            lembaga_negara: { judul: "Lembaga-Lembaga Negara", konten: "<p>Indonesia memiliki lembaga-lembaga negara seperti MPR, DPR, DPD (legislatif), Presiden (eksekutif), serta MA, MK, KY (yudikatif).</p>", funFact: "Mahkamah Konstitusi (MK) adalah lembaga baru yang dibentuk setelah amandemen UUD 1945, bertugas menguji UU terhadap UUD.", kuis: [{ type: "pilihan-ganda", pertanyaan: "Lembaga negara yang memegang kekuasaan kehakiman adalah...", pilihan: ["DPR dan MPR", "Presiden dan Wakil Presiden", "MA dan MK"], jawaban: "MA dan MK", hint: "Kekuasaan yudikatif."}] },
                            bela_negara: { judul: "Bela Negara", konten: "<p>Bela negara adalah sikap dan perilaku warga negara yang dijiwai oleh kecintaannya kepada NKRI. Wujudnya bisa berupa belajar dengan giat, menjaga ketertiban, atau menjadi anggota TNI/Polri.</p>", funFact: "Setiap warga negara berhak dan wajib ikut serta dalam usaha pembelaan negara.", kuis: [{ type: "pilihan-ganda", pertanyaan: "Bagi seorang pelajar, bentuk bela negara yang paling utama adalah...", pilihan: ["Ikut perang", "Belajar dengan tekun", "Menjadi polisi", "Membayar pajak"], jawaban: "Belajar dengan tekun", hint: "Mempersiapkan diri untuk membangun bangsa."}] },
                            hukum_di_indonesia: { judul: "Sistem Hukum Nasional", konten: "<p>Sistem hukum di Indonesia berlandaskan Pancasila dan UUD 1945. Ada berbagai jenis hukum seperti hukum pidana, perdata, dan tata negara yang ditegakkan melalui lembaga peradilan.</p>", funFact: "Asas 'semua orang sama di hadapan hukum' (equality before the law) adalah prinsip penting yang dijamin oleh konstitusi.", kuis: [{ type: "pilihan-ganda", pertanyaan: "Pengadilan tingkat pertama untuk perkara pidana dan perdata umum adalah...", pilihan: ["Pengadilan Tinggi", "Pengadilan Negeri", "Mahkamah Agung"], jawaban: "Pengadilan Negeri", hint: "Ada di setiap kabupaten/kota."}] }
                        }
                    },
                    sejarah_smp: { 
                        namaDunia: "Kronik Sejarah Nusantara", warna: "stone", icon: "📜", deskripsi: "Menelusuri jejak masa penjajahan hingga kemerdekaan Indonesia.", 
                        subMateri: {
                            kedatangan_bangsa_eropa: { judul: "Kedatangan Bangsa Eropa", konten: "<p>Bangsa Eropa (Portugis, Spanyol, Belanda) datang ke Nusantara pada abad ke-16 untuk mencari rempah-rempah yang sangat berharga, didorong oleh semangat Gold, Glory, dan Gospel.</p>", funFact: "Jatuhnya Konstantinopel ke tangan Turki Usmani pada 1453 membuat jalur perdagangan rempah-rempah terputus, mendorong Eropa mencari jalur laut sendiri.", kuis: [{ type: "pilihan-ganda", pertanyaan: "Tiga tujuan utama penjelajahan samudra oleh bangsa Eropa dikenal dengan sebutan...", pilihan: ["3G (Gold, Glory, Gospel)", "3K (Kebersihan, Keindahan, Keamanan)", "3S (Senyum, Sapa, Salam)"], jawaban: "3G (Gold, Glory, Gospel)", hint: "Kekayaan, Kejayaan, dan Penyebaran Agama."}] },
                            voc: { judul: "Masa VOC", konten: "<p>VOC (Vereenigde Oostindische Compagnie) adalah kongsi dagang Belanda yang diberi hak istimewa (oktroi) untuk memonopoli perdagangan rempah-rempah di Nusantara.</p>", funFact: "Pada puncaknya, VOC adalah perusahaan terkaya dalam sejarah dunia, bahkan memiliki tentara dan mata uang sendiri.", kuis: [{ type: "pilihan-ganda", pertanyaan: "Hak istimewa yang dimiliki VOC disebut...", pilihan: ["Konsesi", "Oktroi", "Monopoli"], jawaban: "Oktroi", hint: "Diberikan oleh pemerintah Belanda."}] },
                            perlawanan_daerah: { judul: "Perlawanan Daerah", konten: "<p>Banyak pahlawan daerah yang memimpin perlawanan terhadap penjajah, seperti Pangeran Diponegoro di Jawa, Sultan Hasanuddin di Makassar, dan Pattimura di Maluku.</p>", funFact: "Perang Diponegoro (1825-1830) adalah salah satu perang terbesar yang pernah dihadapi Belanda dan menguras kas negara mereka.", kuis: [{ type: "pilihan-ganda", pertanyaan: "Pahlawan dari Maluku yang terkenal dengan perlawanannya merebut Benteng Duurstede adalah...", pilihan: ["Tuanku Imam Bonjol", "Pattimura", "Sultan Agung"], jawaban: "Pattimura", hint: "Diabadikan dalam uang kertas Rp1.000."}] },
                            pergerakan_nasional: { judul: "Kebangkitan Nasional", konten: "<p>Awal abad ke-20 menandai dimulainya Pergerakan Nasional, di mana perjuangan tidak lagi bersifat kedaerahan tetapi bersifat nasional, menggunakan organisasi modern. Diawali berdirinya Budi Utomo tahun 1908.</p>", funFact: "Politik Etis atau 'politik balas budi' yang diterapkan Belanda secara tidak langsung melahirkan kaum terpelajar yang kemudian memotori pergerakan nasional.", kuis: [{ type: "pilihan-ganda", pertanyaan: "Hari lahirnya organisasi Budi Utomo diperingati sebagai...", pilihan: ["Hari Pendidikan Nasional", "Hari Kebangkitan Nasional", "Hari Pahlawan"], jawaban: "Hari Kebangkitan Nasional", hint: "Tanggal 20 Mei."}] },
                            sumpah_pemuda_1928: { judul: "Sumpah Pemuda 1928", konten: "<p>Pada Kongres Pemuda II tanggal 28 Oktober 1928, para pemuda dari berbagai daerah mengikrarkan Sumpah Pemuda, yang menegaskan cita-cita 'satu nusa, satu bangsa, dan satu bahasa'.</p>", funFact: "Lagu Indonesia Raya ciptaan W.R. Supratman pertama kali diperdengarkan secara instrumental pada saat Kongres Pemuda II.", kuis: [{ type: "pilihan-ganda", pertanyaan: "Sumpah Pemuda merupakan hasil dari...", pilihan: ["Kongres Pemuda I", "Kongres Pemuda II", "Rapat Budi Utomo"], jawaban: "Kongres Pemuda II", hint: "Diadakan di Jakarta (Batavia)."}] },
                            pendudukan_jepang: { judul: "Masa Pendudukan Jepang", konten: "<p>Jepang menduduki Indonesia dari tahun 1942-1945. Meskipun singkat, masa ini sangat berat bagi rakyat Indonesia (romusha), tetapi juga membangkitkan nasionalisme dan memberikan pengalaman militer (PETA).</p>", funFact: "Jepang datang dengan propaganda 'Gerakan 3A' (Nippon Pemimpin Asia, Pelindung Asia, Cahaya Asia) untuk menarik simpati rakyat.", kuis: [{ type: "pilihan-ganda", pertanyaan: "Kerja paksa pada masa pendudukan Jepang disebut...", pilihan: ["Rodi", "Tanam Paksa", "Romusha"], jawaban: "Romusha", hint: "Banyak dikirim untuk membangun infrastruktur perang."}] },
                            sekitar_proklamasi: { judul: "Sekitar Proklamasi", konten: "<p>Menyerahnya Jepang kepada Sekutu menciptakan kekosongan kekuasaan (vacuum of power) di Indonesia. Golongan muda mendesak golongan tua untuk segera memproklamasikan kemerdekaan.</p>", funFact: "Peristiwa Rengasdengklok adalah 'penculikan' Soekarno-Hatta oleh golongan muda untuk menjauhkan mereka dari pengaruh Jepang dan mendesak proklamasi.", kuis: [{ type: "pilihan-ganda", pertanyaan: "Naskah Proklamasi Kemerdekaan Indonesia diketik oleh...", pilihan: ["Soekarno", "Mohammad Hatta", "Sayuti Melik"], jawaban: "Sayuti Melik", hint: "Naskah aslinya ditulis tangan oleh Soekarno."}] },
                            perjuangan_mempertahankan: { judul: "Perjuangan Mempertahankan", konten: "<p>Setelah proklamasi, perjuangan belum berakhir. Bangsa Indonesia harus menghadapi kedatangan kembali Belanda (NICA) melalui pertempuran fisik (Pertempuran Surabaya, Bandung Lautan Api) dan diplomasi (Perjanjian Linggarjati, Renville).</p>", funFact: "Pidato 'Merdeka atau Mati!' oleh Bung Tomo melalui siaran radio berhasil membakar semangat arek-arek Suroboyo dalam Pertempuran 10 November 1945.", kuis: [{ type: "pilihan-ganda", pertanyaan: "Peristiwa pembumihangusan kota Bandung oleh para pejuang agar tidak diduduki Sekutu dikenal sebagai...", pilihan: ["Palagan Ambarawa", "Bandung Lautan Api", "Serangan Umum 1 Maret"], jawaban: "Bandung Lautan Api", hint: "Terjadi pada Maret 1946."}] },
                            orde_lama: { judul: "Era Orde Lama", konten: "<p>Orde Lama (1945-1966) dipimpin oleh Presiden Soekarno. Periode ini diwarnai oleh berbagai gejolak politik, penerapan Demokrasi Parlementer kemudian Demokrasi Terpimpin, serta politik luar negeri yang dinamis (Konferensi Asia-Afrika).</p>", funFact: "Konferensi Asia-Afrika di Bandung tahun 1955 adalah cikal bakal lahirnya Gerakan Non-Blok, sebuah kekuatan penyeimbang antara Blok Barat dan Blok Timur.", kuis: [{ type: "pilihan-ganda", pertanyaan: "Sistem pemerintahan antara 1950-1959 di mana kepala pemerintahan dipegang oleh Perdana Menteri adalah...", pilihan: ["Demokrasi Terpimpin", "Demokrasi Parlementer", "Demokrasi Pancasila"], jawaban: "Demokrasi Parlementer", hint: "Presiden hanya sebagai kepala negara."}] },
                            orde_baru_reformasi: { judul: "Orde Baru & Reformasi", konten: "<p>Orde Baru (1966-1998) dipimpin oleh Presiden Soeharto dengan fokus pada pembangunan ekonomi. Era ini berakhir dengan gerakan Reformasi 1998 yang menuntut demokrasi, supremasi hukum, dan pemberantasan KKN.</p>", funFact: "Gerakan Reformasi 1998 dipicu oleh krisis moneter Asia dan puncaknya adalah pendudukan Gedung DPR/MPR oleh mahasiswa.", kuis: [{ type: "pilihan-ganda", pertanyaan: "Era pemerintahan setelah Orde Baru yang dimulai sejak tahun 1998 disebut era...", pilihan: ["Demokrasi", "Pembangunan", "Reformasi"], jawaban: "Reformasi", hint: "Menandai perubahan besar dalam sistem politik Indonesia."}] }
                        }
                    },
                    geografi_smp: { 
                        namaDunia: "Atlas Dunia", warna: "emerald", icon: "🌍", deskripsi: "Menjelajahi benua, iklim, dan interaksi manusia dengan lingkungan.", 
                        subMateri: {
                            posisi_geografis_indonesia: { judul: "Posisi Geografis Indonesia", konten: "<p>Indonesia terletak di antara dua benua (Asia dan Australia) dan dua samudra (Hindia dan Pasifik). Posisi silang ini sangat strategis bagi perdagangan dan budaya.</p>", funFact: "Indonesia adalah negara kepulauan terbesar di dunia, terdiri dari lebih dari 17.000 pulau.", kuis: [{ type: "pilihan-ganda", pertanyaan: "Letak Indonesia di antara dua benua dan dua samudra disebut letak...", pilihan: ["Astronomis", "Geologis", "Geografis"], jawaban: "Geografis", hint: "Berdasarkan posisi nyata di permukaan bumi."}] },
                            iklim_indonesia: { judul: "Iklim Tropis", konten: "<p>Karena dilalui garis khatulistiwa, Indonesia beriklim tropis dengan suhu udara dan curah hujan yang tinggi. Hanya ada dua musim: kemarau dan penghujan.</p>", funFact: "Angin muson (monsun) adalah angin periodik yang menyebabkan perubahan musim di Indonesia. Muson Barat membawa hujan, Muson Timur membawa kemarau.", kuis: [{ type: "pilihan-ganda", pertanyaan: "Musim kemarau di Indonesia umumnya disebabkan oleh angin muson...", pilihan: ["Barat", "Timur", "Utara"], jawaban: "Timur", hint: "Berasal dari benua Australia yang kering."}] },
                            keragaman_flora_fauna: { judul: "Flora dan Fauna", konten: "<p>Indonesia memiliki keragaman hayati yang sangat tinggi, dibagi menjadi tiga wilayah: Asiatis (barat), Peralihan (tengah), dan Australis (timur), dipisahkan oleh Garis Wallace dan Weber.</p>", funFact: "Komodo, kadal terbesar di dunia, adalah fauna endemik Indonesia yang hanya ditemukan di wilayah Peralihan.", kuis: [{ type: "pilihan-ganda", pertanyaan: "Harimau, gajah, dan orangutan adalah contoh fauna tipe...", pilihan: ["Asiatis", "Peralihan", "Australis"], jawaban: "Asiatis", hint: "Mirip dengan fauna di benua Asia."}] },
                            interaksi_sosial: { judul: "Interaksi Sosial", konten: "<p>Interaksi sosial adalah hubungan timbal balik antar individu atau kelompok. Bisa bersifat asosiatif (mengarah ke persatuan, seperti kerja sama) atau disosiatif (mengarah ke perpecahan, seperti persaingan).</p>", funFact: "Kontak sosial tidak harus bertemu langsung. Mengirim pesan atau video call juga termasuk kontak sosial.", kuis: [{ type: "pilihan-ganda", pertanyaan: "Gotong royong membersihkan desa adalah contoh interaksi sosial yang bersifat...", pilihan: ["Asosiatif", "Disosiatif", "Akomodatif"], jawaban: "Asosiatif", hint: "Mengarah pada kebaikan bersama."}] },
                            kependudukan: { judul: "Dinamika Penduduk", konten: "<p>Dinamika penduduk adalah perubahan jumlah penduduk yang dipengaruhi oleh kelahiran (natalitas), kematian (mortalitas), dan perpindahan (migrasi).</p>", funFact: "Piramida penduduk dapat digunakan untuk melihat komposisi usia dan jenis kelamin suatu negara, serta memprediksi masalah kependudukan di masa depan.", kuis: [{ type: "pilihan-ganda", pertanyaan: "Perpindahan penduduk dari desa ke kota disebut...", pilihan: ["Transmigrasi", "Imigrasi", "Urbanisasi"], jawaban: "Urbanisasi", hint: "Terjadi karena daya tarik kota."}] },
                            peta_dan_komponennya: { judul: "Komponen Peta", konten: "<p>Peta yang baik memiliki komponen seperti judul, skala, orientasi (arah mata angin), legenda (keterangan simbol), dan sumber peta.</p>", funFact: "Skala peta 1:100.000 berarti 1 cm di peta sama dengan 100.000 cm (atau 1 km) di jarak sebenarnya.", kuis: [{ type: "pilihan-ganda", pertanyaan: "Bagian peta yang berfungsi untuk menjelaskan arti dari simbol-simbol yang ada adalah...", pilihan: ["Judul", "Skala", "Legenda"], jawaban: "Legenda", hint: "Kunci untuk membaca peta."}] },
                            benua_samudra: { judul: "Benua dan Samudra", konten: "<p>Permukaan bumi terdiri dari daratan luas yang disebut benua (Asia, Afrika, Amerika, Eropa, Australia, Antarktika) dan perairan luas yang disebut samudra (Pasifik, Atlantik, Hindia, Arktik, Antarktika/Selatan).</p>", funFact: "Samudra Pasifik adalah samudra terbesar dan terdalam, mencakup sekitar sepertiga permukaan Bumi.", kuis: [{ type: "pilihan-ganda", pertanyaan: "Benua terluas di dunia adalah...", pilihan: ["Afrika", "Amerika", "Asia"], jawaban: "Asia", hint: "Indonesia terletak di benua ini."}] },
                            perubahan_sosial_budaya: { judul: "Perubahan Sosial Budaya", konten: "<p>Perubahan sosial budaya adalah perubahan pada lembaga kemasyarakatan yang memengaruhi sistem sosialnya. Bisa disebabkan oleh penemuan baru (discovery/invention) atau pengaruh budaya luar (akulturasi/asimilasi).</p>", funFact: "Globalisasi, terutama melalui internet dan media, adalah pendorong utama perubahan sosial budaya yang sangat cepat di era modern.", kuis: [{ type: "pilihan-ganda", pertanyaan: "Masuknya budaya Hindu-Buddha ke Indonesia yang berpadu dengan budaya lokal tanpa menghilangkan unsur asli disebut...", pilihan: ["Asimilasi", "Akulturasi", "Westernisasi"], jawaban: "Akulturasi", hint: "Terjadi percampuran budaya."}] },
                            kegiatan_ekonomi_smp: { judul: "Kegiatan Ekonomi", konten: "<p>Kegiatan ekonomi terdiri dari tiga hal: produksi (menghasilkan barang/jasa), distribusi (menyalurkan barang/jasa), dan konsumsi (menggunakan barang/jasa).</p>", funFact: "Jalur distribusi yang panjang dari produsen ke konsumen seringkali menjadi penyebab harga barang menjadi lebih mahal.", kuis: [{ type: "pilihan-ganda", pertanyaan: "Seorang penjahit yang membuat baju melakukan kegiatan...", pilihan: ["Produksi", "Distribusi", "Konsumsi"], jawaban: "Produksi", hint: "Menghasilkan suatu barang."}] },
                            asia_tenggara: { judul: "Negara-Negara ASEAN", konten: "<p>ASEAN (Association of Southeast Asian Nations) adalah organisasi negara-negara di kawasan Asia Tenggara yang bertujuan untuk kerja sama ekonomi, politik, dan sosial budaya.</p>", funFact: "Satu-satunya negara di Asia Tenggara yang tidak pernah dijajah oleh bangsa Eropa adalah Thailand.", kuis: [{ type: "pilihan-ganda", pertanyaan: "Sekretariat ASEAN berkedudukan di kota...", pilihan: ["Kuala Lumpur", "Bangkok", "Jakarta"], jawaban: "Jakarta", hint: "Ibu kota negara kita."}] }
                        }
                    },
                    sastra_smp: { 
                        namaDunia: "Panggung Sastra", warna: "rose", icon: "🎭", deskripsi: "Menganalisis puisi, cerpen, dan novel karya sastrawan Indonesia.", 
                        subMateri: {
                            unsur_intrinsik_cerpen: { judul: "Unsur Intrinsik Cerpen", konten: "<p>Unsur intrinsik adalah unsur yang membangun cerita dari dalam, meliputi tema, tokoh & penokohan, alur (plot), latar (setting), sudut pandang, dan amanat.</p>", funFact: "Alur maju (progresif) adalah alur yang paling umum digunakan, di mana cerita berjalan dari awal hingga akhir secara berurutan.", kuis: [{ type: "pilihan-ganda", pertanyaan: "Pesan moral yang ingin disampaikan pengarang kepada pembaca disebut...", pilihan: ["Tema", "Alur", "Amanat"], jawaban: "Amanat", hint: "Pelajaran yang bisa dipetik."}] },
                            majas: { judul: "Gaya Bahasa (Majas)", konten: "<p>Majas adalah gaya bahasa kiasan untuk membuat karya sastra lebih hidup. Contoh: majas personifikasi (daun menari-nari), metafora (raja siang), dan hiperbola (teriakannya menggelegar).</p>", funFact: "Penggunaan majas yang tepat dapat membangkitkan imajinasi pembaca dan memperkuat makna.", kuis: [{ type: "pilihan-ganda", pertanyaan: "Kalimat 'Pena lebih tajam daripada pedang' menggunakan majas...", pilihan: ["Hiperbola", "Metafora", "Personifikasi"], jawaban: "Metafora", hint: "Membandingkan dua hal secara langsung."}] },
                            puisi_rakyat: { judul: "Puisi Rakyat", konten: "<p>Puisi rakyat adalah sastra lisan yang terikat aturan, seperti pantun, gurindam, dan syair. Pantun bersajak a-b-a-b, baris 1-2 sampiran, baris 3-4 isi.</p>", funFact: "Gurindam Dua Belas karya Raja Ali Haji adalah salah satu karya sastra Melayu klasik yang paling terkenal, berisi nasihat dan ajaran moral.", kuis: [{ type: "pilihan-ganda", pertanyaan: "Puisi rakyat yang terdiri dari dua baris, di mana baris pertama adalah syarat dan baris kedua adalah jawaban/akibat, adalah...", pilihan: ["Pantun", "Syair", "Gurindam"], jawaban: "Gurindam", hint: "Contoh: Barang siapa tiada memegang agama, sekali-kali tiada boleh dibilangkan nama."}] },
                            buku_fiksi_nonfiksi: { judul: "Fiksi dan Nonfiksi", konten: "<p>Buku fiksi adalah buku yang berisi cerita rekaan atau khayalan (novel, cerpen). Buku nonfiksi adalah buku yang berisi fakta dan data berdasarkan kenyataan (biografi, buku pelajaran).</p>", funFact: "Batas antara fiksi dan nonfiksi terkadang bisa kabur, seperti dalam novel sejarah yang didasarkan pada peristiwa nyata tetapi dengan dialog yang dikhayalkan.", kuis: [{ type: "pilihan-ganda", pertanyaan: "Buku yang menceritakan riwayat hidup seseorang yang ditulis oleh orang lain disebut...", pilihan: ["Autobiografi", "Biografi", "Novel"], jawaban: "Biografi", hint: "Jika ditulis sendiri disebut autobiografi."}] },
                            surat_pribadi_dinas: { judul: "Surat Pribadi & Dinas", konten: "<p>Surat pribadi bersifat personal dan bahasanya tidak baku, ditujukan untuk teman atau keluarga. Surat dinas bersifat resmi, menggunakan bahasa baku dan format tertentu, ditujukan untuk instansi.</p>", funFact: "Kop surat, nomor surat, dan stempel adalah ciri-ciri yang umum ditemukan pada surat dinas, tetapi tidak ada pada surat pribadi.", kuis: [{ type: "pilihan-ganda", pertanyaan: "Bahasa yang digunakan dalam surat dinas haruslah...", pilihan: ["Santai dan gaul", "Baku dan resmi", "Puitis"], jawaban: "Baku dan resmi", hint: "Sesuai kaidah bahasa Indonesia yang baik dan benar."}] },
                            iklan_slogan_poster: { judul: "Iklan, Slogan, Poster", konten: "<p>Iklan, slogan, dan poster adalah teks persuasif yang bertujuan untuk membujuk khalayak. Kalimatnya harus singkat, jelas, dan menarik.</p>", funFact: "Efek visual seperti warna dan gambar yang mencolok sangat penting dalam poster untuk menarik perhatian orang yang lewat.", kuis: [{ type: "pilihan-ganda", pertanyaan: "Kalimat singkat dan padat yang berfungsi sebagai semboyan atau motto disebut...", pilihan: ["Iklan", "Slogan", "Poster"], jawaban: "Slogan", hint: "Contoh: 'Hemat energi, selamatkan bumi'."}] },
                            berita: { judul: "Teks Berita", konten: "<p>Teks berita harus mengandung unsur 5W+1H (What, Who, Where, When, Why, How), bersifat faktual (berdasarkan fakta), dan objektif (tidak memihak).</p>", funFact: "Struktur piramida terbalik sering digunakan dalam penulisan berita, di mana informasi paling penting diletakkan di awal paragraf.", kuis: [{ type: "pilihan-ganda", pertanyaan: "Unsur berita yang menjawab pertanyaan 'di mana' disebut...", pilihan: ["What", "Where", "When"], jawaban: "Where", hint: "Menunjukkan lokasi kejadian."}] },
                            teks_ulasan: { judul: "Teks Ulasan (Resensi)", konten: "<p>Teks ulasan adalah teks yang berisi penilaian atau review terhadap suatu karya (film, buku, lagu). Strukturnya meliputi orientasi, tafsiran, evaluasi, dan rangkuman.</p>", funFact: "Seorang penulis resensi yang baik harus mampu memberikan penilaian yang seimbang, menunjukkan kelebihan dan kekurangan karya secara objektif.", kuis: [{ type: "pilihan-ganda", pertanyaan: "Bagian dari teks ulasan yang berisi penilaian penulis terhadap kelebihan dan kekurangan karya adalah...", pilihan: ["Orientasi", "Tafsiran", "Evaluasi"], jawaban: "Evaluasi", hint: "Bagian inti dari sebuah review."}] },
                            drama_smp: { judul: "Teks Drama", konten: "<p>Teks drama berisi dialog antar tokoh dan petunjuk laku (kramagung) untuk dipentaskan. Unsur-unsurnya meliputi babak, adegan, dialog, dan prolog/epilog.</p>", funFact: "Kramagung adalah bagian naskah drama yang ditulis dalam tanda kurung, berisi petunjuk aksi atau ekspresi yang harus dilakukan aktor.", kuis: [{ type: "pilihan-ganda", pertanyaan: "Percakapan antara dua tokoh atau lebih dalam naskah drama disebut...", pilihan: ["Monolog", "Prolog", "Dialog"], jawaban: "Dialog", hint: "Merupakan unsur utama dalam drama."}] },
                            menulis_kreatif: { judul: "Menulis Kreatif", konten: "<p>Menulis kreatif adalah proses menciptakan tulisan orisinal yang ekspresif dan imajinatif. Kuncinya adalah banyak membaca sebagai referensi dan berani memulai untuk menuliskan ide.", funFact: "Teknik 'brainstorming' atau curah gagasan, seperti membuat peta pikiran (mind mapping), sangat membantu untuk menemukan ide sebelum mulai menulis.", kuis: [{ type: "pilihan-ganda", pertanyaan: "Langkah pertama yang paling penting dalam menulis kreatif adalah...", pilihan: ["Menemukan ide", "Mengedit tulisan", "Mempublikasikan"], jawaban: "Menemukan ide", hint: "Tanpa ide, tidak ada yang bisa ditulis."}] }
                        }
                    },
                    inggris_smp: { 
                        namaDunia: "English Harbour", warna: "teal", icon: "⚓", deskripsi: "Menguasai grammar, tenses, dan percakapan Bahasa Inggris.", 
                        subMateri: {
                            simple_present: { judul: "Simple Present Tense", konten: "<p>Simple Present Tense digunakan untuk menyatakan kebiasaan, fakta umum, atau kebenaran. Contoh: 'The sun rises in the east.' atau 'I go to school every day.'</p>", funFact: "Untuk subjek he, she, it, kata kerjanya biasanya ditambahkan akhiran -s atau -es.", kuis: [{ type: "pilihan-ganda", pertanyaan: "She ... English very well.", pilihan: ["speak", "speaks", "speaking"], jawaban: "speaks", hint: "Subjeknya adalah 'She'."}] },
                            simple_past: { judul: "Simple Past Tense", konten: "<p>Simple Past Tense digunakan untuk menceritakan kejadian yang telah terjadi di masa lampau. Biasanya menggunakan kata kerja bentuk kedua (Verb 2). Contoh: 'We visited Bali last year.'</p>", funFact: "Banyak kata kerja tak beraturan (irregular verbs) dalam bahasa Inggris yang bentuk keduanya tidak mengikuti pola -ed, seperti go -> went, eat -> ate.", kuis: [{ type: "pilihan-ganda", pertanyaan: "I ... a movie yesterday.", pilihan: ["watch", "watched", "watching"], jawaban: "watched", hint: "Gunakan Verb 2 karena ada kata 'yesterday'."}] },
                            descriptive_text: { judul: "Descriptive Text", konten: "<p>Descriptive text adalah teks yang bertujuan untuk menggambarkan seseorang, tempat, atau benda secara detail agar pembaca seolah-olah bisa melihat atau merasakannya.", funFact: "Penggunaan kata sifat (adjectives) yang kaya sangat penting dalam descriptive text untuk membuatnya hidup.", kuis: [{ type: "pilihan-ganda", pertanyaan: "Tujuan utama dari descriptive text adalah...", pilihan: ["Menceritakan urutan kejadian", "Memberi petunjuk", "Menggambarkan sesuatu"], jawaban: "Menggambarkan sesuatu", hint: "Berasal dari kata 'describe'."}] },
                            recount_text: { judul: "Recount Text", konten: "<p>Recount text adalah teks yang menceritakan kembali pengalaman atau kejadian di masa lampau secara berurutan. Strukturnya adalah orientation, events, dan re-orientation.</p>", funFact: "Recount text selalu menggunakan Past Tense karena menceritakan sesuatu yang sudah berlalu.", kuis: [{ type: "pilihan-ganda", pertanyaan: "Buku harian atau diary adalah contoh dari...", pilihan: ["Procedure text", "Recount text", "Descriptive text"], jawaban: "Recount text", hint: "Menceritakan kembali apa yang terjadi."}] },
                            procedure_text: { judul: "Procedure Text", konten: "<p>Procedure text adalah teks yang memberikan instruksi atau langkah-langkah untuk melakukan sesuatu. Contohnya adalah resep masakan atau buku manual.", funFact: "Procedure text sering menggunakan kalimat perintah (imperative sentences) seperti 'Cut the onion' atau 'Press the button'.", kuis: [{ type: "pilihan-ganda", pertanyaan: "Teks yang berisi cara membuat mi instan termasuk jenis...", pilihan: ["Recount text", "Narrative text", "Procedure text"], jawaban: "Procedure text", hint: "Memberikan langkah-langkah."}] },
                            asking_giving_opinion: { judul: "Asking & Giving Opinion", konten: "<p>Untuk menanyakan pendapat, gunakan frasa seperti 'What do you think about...?'. Untuk memberi pendapat, gunakan 'I think...' atau 'In my opinion...'.</p>", funFact: "Menghargai pendapat orang lain meskipun berbeda adalah kunci komunikasi yang baik dalam bahasa apapun.", kuis: [{ type: "pilihan-ganda", pertanyaan: "Frasa yang tepat untuk menanyakan pendapat adalah...", pilihan: ["I think it's great", "What do you think?", "I agree with you"], jawaban: "What do you think?", hint: "Ini adalah sebuah pertanyaan."}] },
                            degrees_of_comparison: { judul: "Degrees of Comparison", konten: "<p>Comparison degree digunakan untuk membandingkan kata sifat. Ada tiga tingkatan: positive (big), comparative (bigger), dan superlative (biggest).</p>", funFact: "Untuk kata sifat yang panjang (lebih dari dua suku kata), kita menggunakan 'more' untuk comparative dan 'most' untuk superlative, contoh: beautiful, more beautiful, most beautiful.", kuis: [{ type: "pilihan-ganda", pertanyaan: "Mount Everest is the ... mountain in the world.", pilihan: ["high", "higher", "highest"], jawaban: "highest", hint: "Membandingkan dengan semua gunung lain (superlative)."}] },
                            prepositions: { judul: "Prepositions (Kata Depan)", konten: "<p>Preposisi (in, on, at, under, beside) adalah kata yang menunjukkan hubungan lokasi, waktu, atau arah antara objek dalam sebuah kalimat.</p>", funFact: "Ada aturan umum penggunaan preposisi waktu: 'at' untuk jam (at 5 PM), 'on' untuk hari (on Monday), dan 'in' untuk bulan/tahun (in July, in 2023).", kuis: [{ type: "pilihan-ganda", pertanyaan: "The book is ... the table.", pilihan: ["in", "on", "at"], jawaban: "on", hint: "Menempel di atas permukaan."}] },
                            present_continuous: { judul: "Present Continuous Tense", konten: "<p>Present Continuous Tense (to be + verb-ing) digunakan untuk menyatakan kegiatan yang sedang berlangsung saat ini. Contoh: 'You are reading this sentence now.'</p>", funFact: "Tense ini juga bisa digunakan untuk menyatakan rencana pasti di masa depan, contoh: 'I am meeting my friend tomorrow'.", kuis: [{ type: "pilihan-ganda", pertanyaan: "Listen! The baby ...", pilihan: ["cries", "is crying", "cried"], jawaban: "is crying", hint: "Kegiatan yang sedang berlangsung saat ini ('Listen!')."}] },
                            modal_auxiliaries: { judul: "Modal Auxiliaries", konten: "<p>Modal (can, will, must, should) adalah kata kerja bantu yang digunakan untuk menyatakan kemampuan, kemungkinan, kewajiban, atau nasihat.</p>", funFact: "Setelah modal, kata kerja yang mengikutinya selalu dalam bentuk dasar (Verb 1) tanpa 'to'. Contoh: 'You should go', bukan 'You should to go'.", kuis: [{ type: "pilihan-ganda", pertanyaan: "You ... finish your homework before playing. (Kewajiban)", pilihan: ["can", "may", "must"], jawaban: "must", hint: "Menyatakan keharusan atau kewajiban."}] }
                        }
                    },
                    ekonomi_smp: { 
                        namaDunia: "Bursa Ekonomi", warna: "lime", icon: "📈", deskripsi: "Memahami konsep permintaan, penawaran, dan kegiatan ekonomi.", 
                        subMateri: {
                            kebutuhan_manusia: { judul: "Kebutuhan Manusia", konten: "<p>Kebutuhan manusia tidak terbatas, sedangkan alat pemuas kebutuhan (sumber daya) terbatas. Inilah yang menjadi inti masalah ekonomi.</p>", funFact: "Kebutuhan primer (sandang, pangan, papan) adalah kebutuhan yang harus dipenuhi untuk bertahan hidup.", kuis: [{ type: "pilihan-ganda", pertanyaan: "Masalah pokok dalam ilmu ekonomi adalah...", pilihan: ["Kelangkaan (scarcity)", "Kemiskinan", "Inflasi"], jawaban: "Kelangkaan (scarcity)", hint: "Kesenjangan antara kebutuhan dan sumber daya."}] },
                            tindakan_ekonomi: { judul: "Tindakan Ekonomi", konten: "<p>Tindakan ekonomi adalah setiap usaha manusia untuk memenuhi kebutuhan. Prinsip ekonomi adalah berusaha dengan pengorbanan sekecil-kecilnya untuk memperoleh hasil tertentu, atau dengan pengorbanan tertentu untuk memperoleh hasil sebesar-besarnya.</p>", funFact: "Membandingkan harga di beberapa toko sebelum membeli adalah contoh penerapan prinsip ekonomi dalam kehidupan sehari-hari.", kuis: [{ type: "pilihan-ganda", pertanyaan: "Slogan 'Dengan pengorbanan minimal untuk hasil maksimal' adalah inti dari...", pilihan: ["Motif ekonomi", "Prinsip ekonomi", "Hukum ekonomi"], jawaban: "Prinsip ekonomi", hint: "Berusaha seefisien mungkin."}] },
                            permintaan_penawaran: { judul: "Permintaan & Penawaran", konten: "<p>Permintaan adalah jumlah barang yang ingin dibeli pada tingkat harga tertentu. Penawaran adalah jumlah barang yang ingin dijual. Hukum permintaan: harga naik, permintaan turun. Hukum penawaran: harga naik, penawaran naik.</p>", funFact: "Harga keseimbangan (ekuilibrium) terjadi saat jumlah barang yang diminta sama dengan jumlah yang ditawarkan.", kuis: [{ type: "pilihan-ganda", pertanyaan: "Jika harga cabai meningkat tajam, maka permintaan terhadap cabai cenderung...", pilihan: ["Naik", "Turun", "Tetap"], jawaban: "Turun", hint: "Sesuai hukum permintaan."}] },
                            pasar: { judul: "Pasar", konten: "<p>Pasar adalah tempat bertemunya penjual dan pembeli untuk melakukan transaksi. Pasar tidak harus berupa tempat fisik; toko online juga termasuk pasar.</p>", funFact: "Pasar persaingan sempurna adalah bentuk pasar teoretis di mana tidak ada satu pun penjual atau pembeli yang bisa mempengaruhi harga.", kuis: [{ type: "pilihan-ganda", pertanyaan: "Tempat terjadinya interaksi antara permintaan dan penawaran disebut...", pilihan: ["Pabrik", "Pasar", "Distributor"], jawaban: "Pasar", hint: "Bisa konkret atau abstrak."}] },
                            uang: { judul: "Uang", konten: "<p>Uang adalah alat tukar yang sah. Fungsi asli uang adalah sebagai alat tukar dan satuan hitung. Fungsi turunannya sebagai alat pembayaran, penyimpan kekayaan, dan pemindah kekayaan.</p>", funFact: "Sebelum ada uang, manusia melakukan barter, yaitu menukar barang dengan barang, yang seringkali tidak efisien.", kuis: [{ type: "pilihan-ganda", pertanyaan: "Fungsi asli uang adalah sebagai...", pilihan: ["Alat penimbun kekayaan", "Alat tukar", "Alat pembayaran utang"], jawaban: "Alat tukar", hint: "Fungsi paling mendasar."}] },
                            pajak: { judul: "Pajak", konten: "<p>Pajak adalah iuran wajib rakyat kepada negara yang bersifat memaksa berdasarkan undang-undang, tanpa mendapat imbalan secara langsung. Pajak digunakan untuk membiayai pengeluaran negara.</p>", funFact: "Jalan raya, sekolah negeri, dan rumah sakit umum adalah beberapa contoh fasilitas yang dibangun dari uang pajak.", kuis: [{ type: "pilihan-ganda", pertanyaan: "Pajak yang dikenakan atas penghasilan seseorang atau badan usaha disebut...", pilihan: ["Pajak Pertambahan Nilai (PPN)", "Pajak Penghasilan (PPh)", "Pajak Bumi dan Bangunan (PBB)"], jawaban: "Pajak Penghasilan (PPh)", hint: "Dikenakan pada gaji atau keuntungan."}] },
                            perdagangan_internasional: { judul: "Perdagangan Internasional", konten: "<p>Perdagangan internasional terjadi karena setiap negara memiliki keunggulan komparatif yang berbeda. Ekspor adalah menjual barang ke luar negeri, impor adalah membeli barang dari luar negeri.</p>", funFact: "Sebuah ponsel pintar modern adalah contoh produk global, di mana komponennya dibuat di berbagai negara yang berbeda sebelum dirakit menjadi satu.", kuis: [{ type: "pilihan-ganda", pertanyaan: "Kegiatan menjual produk dari dalam negeri ke luar negeri disebut...", pilihan: ["Impor", "Ekspor", "Barter"], jawaban: "Ekspor", hint: "Meningkatkan devisa negara."}] },
                            koperasi: { judul: "Koperasi", konten: "<p>Koperasi adalah badan usaha yang beranggotakan orang-seorang atau badan hukum koperasi dengan melandaskan kegiatannya berdasarkan prinsip koperasi sekaligus sebagai gerakan ekonomi rakyat yang berdasar atas asas kekeluargaan.</p>", funFact: "Bapak Koperasi Indonesia adalah Mohammad Hatta, wakil presiden pertama Indonesia.", kuis: [{ type: "pilihan-ganda", pertanyaan: "Tujuan utama koperasi adalah...", pilihan: ["Mencari keuntungan sebesar-besarnya", "Meningkatkan kesejahteraan anggota", "Menguasai pasar"], jawaban: "Meningkatkan kesejahteraan anggota", hint: "Dari anggota, oleh anggota, untuk anggota."}] },
                            badan_usaha: { judul: "Badan Usaha", konten: "<p>Ada berbagai bentuk badan usaha, seperti Perusahaan Perseorangan, Firma, CV, dan Perseroan Terbatas (PT). BUMN (Badan Usaha Milik Negara) adalah badan usaha yang modalnya dimiliki oleh negara.</p>", funFact: "Kelebihan utama Perseroan Terbatas (PT) adalah adanya pemisahan harta pribadi pemilik dengan harta perusahaan.", kuis: [{ type: "pilihan-ganda", pertanyaan: "Badan usaha yang modalnya berasal dari negara disebut...", pilihan: ["BUMS", "BUMN", "Koperasi"], jawaban: "BUMN", hint: "Singkatan dari Badan Usaha Milik Negara."}] },
                            kreativitas_kewirausahaan: { judul: "Kreativitas & Kewirausahaan", konten: "<p>Kewirausahaan adalah semangat, sikap, dan kemampuan seseorang untuk menciptakan sesuatu yang baru dan bernilai. Kreativitas dan inovasi adalah kunci seorang wirausahawan.</p>", funFact: "Banyak perusahaan teknologi terbesar di dunia saat ini dimulai dari garasi rumah oleh para wirausahawan muda yang kreatif.", kuis: [{ type: "pilihan-ganda", pertanyaan: "Seseorang yang memulai dan mengelola usahanya sendiri dengan mengambil risiko disebut...", pilihan: ["Manajer", "Investor", "Wirausahawan (entrepreneur)"], jawaban: "Wirausahawan (entrepreneur)", hint: "Menciptakan peluang usaha baru."}] }
                        } 
                    }
                }
            },
            sma: {
                dunia: {
                    kalkulus_sma: {
                        namaDunia: "Kalkulus Kosmos", warna: "purple", icon: "∬", deskripsi: "Menggunakan matematika tingkat lanjut untuk memahami perubahan dan tak hingga.",
                        subMateri: {
                            limit: { judul: "Gerbang Menuju Tak Hingga", konten: "<p>Limit adalah nilai yang 'didekati' oleh suatu fungsi saat inputnya mendekati suatu nilai tertentu. Konsep ini menjadi fondasi dari turunan dan integral.</p>", funFact: "Konsep limit sudah ada sejak zaman Yunani kuno, tetapi baru diformalkan pada abad ke-19.", kuis: [{ type: "pilihan-ganda", pertanyaan: "Limit dari f(x) = x + 2 saat x mendekati 3 adalah?", pilihan: ["3", "Tak hingga", "5"], jawaban: "5", hint: "Substitusikan saja nilai x = 3 ke dalam fungsi." }] },
                            turunan: { judul: "Laju Perubahan Sesaat", konten: "<p>Turunan (diferensial) mengukur laju perubahan sesaat dari suatu fungsi. Dalam fisika, turunan dari posisi adalah kecepatan.</p>", funFact: "Isaac Newton dan Gottfried Leibniz secara independen mengembangkan kalkulus pada abad ke-17.", kuis: [{ type: "pilihan-ganda", pertanyaan: "Turunan pertama dari f(x) = 3x² adalah...", pilihan: ["6x", "3x", "x²"], jawaban: "6x", hint: "Gunakan aturan pangkat: n*x^(n-1)." }] },
                            integral: { judul: "Menghitung Luas di Bawah Kurva", konten: "<p>Integral adalah kebalikan dari turunan (anti-turunan). Integral tentu digunakan untuk menghitung luas area di bawah kurva.</p>", funFact: "Integral sangat penting dalam bidang teknik untuk menghitung volume benda putar dan pusat massa.", kuis: [{ type: "pilihan-ganda", pertanyaan: "Integral dari f(x) = 2x adalah...", pilihan: ["x² + C", "2 + C", "x + C"], jawaban: "x² + C", hint: "Kebalikan dari turunan. Jangan lupa konstanta C." }] },
                            trigonometri_lanjut: { judul: "Identitas Trigonometri", konten: "<p>Trigonometri lanjut membahas identitas seperti sin²x + cos²x = 1, serta persamaan dan fungsi trigonometri yang kompleks.</p>", funFact: "Trigonometri awalnya dikembangkan untuk keperluan astronomi dan navigasi.", kuis: [{ type: "pilihan-ganda", pertanyaan: "Jika sin²x + cos²x = 1, maka 1 - sin²x sama dengan...", pilihan: ["cos²x", "sin x", "1"], jawaban: "cos²x", hint: "Pindahkan sin²x ke ruas kanan." }] },
                            matriks: { judul: "Matriks dan Transformasi", konten: "<p>Matriks adalah susunan bilangan dalam baris dan kolom. Matriks dapat digunakan untuk menyelesaikan sistem persamaan linear dan melakukan transformasi geometri.</p>", funFact: "Matriks digunakan dalam grafika komputer untuk memutar, memperbesar, dan memindahkan objek 3D.", kuis: [{ type: "pilihan-ganda", pertanyaan: "Matriks yang hasil perkaliannya dengan matriks lain tidak mengubah matriks tersebut adalah matriks...", pilihan: ["Nol", "Identitas", "Transpose"], jawaban: "Identitas", hint: "Seperti angka 1 dalam perkalian biasa." }] },
                            vektor: { judul: "Besaran dan Arah", konten: "<p>Vektor adalah besaran yang memiliki nilai dan arah, seperti kecepatan dan gaya. Berbeda dengan skalar yang hanya memiliki nilai.</p>", funFact: "GPS menggunakan prinsip vektor untuk menghitung posisi dan rute perjalanan Anda.", kuis: [{ type: "pilihan-ganda", pertanyaan: "Manakah dari berikut ini yang merupakan besaran vektor?", pilihan: ["Suhu", "Jarak", "Perpindahan"], jawaban: "Perpindahan", hint: "Memperhatikan arah gerak." }] },
                            dimensi_tiga: { judul: "Jarak dalam Ruang", konten: "<p>Geometri dimensi tiga mempelajari hubungan titik, garis, dan bidang dalam ruang, seperti menghitung jarak dan sudut pada kubus atau limas.</p>", funFact: "Seniman Renaissance seperti Leonardo da Vinci adalah pionir dalam menggunakan prinsip geometri 3D untuk menciptakan ilusi kedalaman pada lukisan.", kuis: [{ type: "pilihan-ganda", pertanyaan: "Garis lurus terpanjang di dalam sebuah kubus adalah...", pilihan: ["Rusuk", "Diagonal sisi", "Diagonal ruang"], jawaban: "Diagonal ruang", hint: "Menghubungkan dua titik sudut yang berlawanan." }] },
                            program_linear: { judul: "Optimasi Sumber Daya", konten: "<p>Program linear adalah metode matematika untuk menemukan nilai optimum (maksimum atau minimum) dari suatu masalah dengan batasan-batasan tertentu.</p>", funFact: "Program linear banyak digunakan dalam bisnis untuk memaksimalkan keuntungan atau meminimalkan biaya produksi.", kuis: [{ type: "pilihan-ganda", pertanyaan: "Tujuan utama program linear adalah menemukan nilai...", pilihan: ["Rata-rata", "Tengah", "Optimum"], jawaban: "Optimum", hint: "Bisa maksimum atau minimum." }] },
                            transformasi_geometri: { judul: "Geser, Putar, Cermin", konten: "<p>Transformasi geometri adalah perubahan posisi atau ukuran suatu objek. Meliputi translasi (pergeseran), rotasi (perputaran), refleksi (pencerminan), dan dilatasi (perbesaran).</p>", funFact: "Pola pada kain batik seringkali menggunakan prinsip transformasi geometri, terutama refleksi dan translasi.", kuis: [{ type: "pilihan-ganda", pertanyaan: "Transformasi yang mengubah ukuran objek adalah...", pilihan: ["Translasi", "Rotasi", "Dilatasi"], jawaban: "Dilatasi", hint: "Membuat lebih besar atau lebih kecil." }] },
                            peluang_lanjut: { judul: "Kaidah Pencacahan", konten: "<p>Peluang lanjut membahas kaidah pencacahan, permutasi (urutan penting), dan kombinasi (urutan tidak penting) untuk menghitung kemungkinan.", funFact: "Jumlah kemungkinan susunan setumpuk 52 kartu remi lebih banyak daripada jumlah atom di Bumi.", kuis: [{ type: "pilihan-ganda", pertanyaan: "Memilih 3 juara dari 10 finalis adalah contoh dari...", pilihan: ["Permutasi", "Kombinasi", "Faktorial"], jawaban: "Permutasi", hint: "Karena urutan juara 1, 2, dan 3 itu penting." }] }
                        }
                    },
                    fisika_sma: {
                        namaDunia: "Reaktor Fisika Kuantum", warna: "red", icon: "💥", deskripsi: "Menjelajahi dunia partikel sub-atomik dan hukum fisika modern.",
                        subMateri: {
                            relativitas: { judul: "Ruang-Waktu Einstein", konten: "<p>Teori relativitas khusus Einstein menyatakan bahwa ruang dan waktu bersifat relatif, dan kecepatan cahaya adalah konstan bagi semua pengamat.</p>", funFact: "Karena efek relativitas, waktu berjalan sedikit lebih lambat bagi astronot di luar angkasa dibandingkan di Bumi.", kuis: [{ type: "pilihan-ganda", pertanyaan: "Menurut Einstein, apa yang terjadi pada massa benda saat bergerak mendekati kecepatan cahaya?", pilihan: ["Berkurang", "Tetap", "Bertambah"], jawaban: "Bertambah", hint: "Energi dan massa setara (E=mc²)." }] },
                            radiasi_benda_hitam: { judul: "Radiasi Benda Hitam", konten: "<p>Benda hitam ideal menyerap semua radiasi. Spektrum radiasinya hanya bergantung pada suhu. Fenomena ini melahirkan fisika kuantum.</p>", funFact: "Matahari dan bintang-bintang lain dapat dianggap sebagai benda hitam yang hampir sempurna.", kuis: [{ type: "pilihan-ganda", pertanyaan: "Hukum yang menjelaskan puncak spektrum radiasi benda hitam bergeser ke panjang gelombang lebih pendek saat suhu meningkat adalah...", pilihan: ["Hukum Stefan-Boltzmann", "Hukum Pergeseran Wien", "Hukum Planck"], jawaban: "Hukum Pergeseran Wien", hint: "Wien's Displacement Law." }] },
                            efek_fotolistrik: { judul: "Cahaya sebagai Partikel", konten: "<p>Efek fotolistrik adalah keluarnya elektron dari logam saat disinari cahaya. Ini membuktikan bahwa cahaya memiliki sifat partikel (foton).</p>", funFact: "Albert Einstein memenangkan Hadiah Nobel bukan untuk teori relativitas, melainkan untuk penjelasannya tentang efek fotolistrik.", kuis: [{ type: "pilihan-ganda", pertanyaan: "Energi satu foton (partikel cahaya) sebanding dengan...", pilihan: ["Amplitudo", "Frekuensi", "Panjang gelombang"], jawaban: "Frekuensi", hint: "E = hf, di mana h adalah konstanta Planck." }] },
                            model_atom: { judul: "Model Atom Modern", konten: "<p>Model atom berkembang dari Dalton, Thomson, Rutherford, Bohr, hingga model mekanika kuantum yang menyatakan elektron berada dalam orbital (awan probabilitas).</p>", funFact: "Jika inti atom sebesar kelereng, maka elektron terdekat akan berada sejauh setengah kilometer!", kuis: [{ type: "pilihan-ganda", pertanyaan: "Model atom yang menggambarkan elektron mengorbit inti seperti planet mengelilingi matahari adalah model...", pilihan: ["Thomson", "Rutherford", "Bohr"], jawaban: "Rutherford", hint: "Model roti kismis digagas oleh Thomson." }] },
                            dualisme_gelombang_partikel: { judul: "Sifat Ganda Materi", konten: "<p>Louis de Broglie mengemukakan bahwa semua materi, termasuk elektron, memiliki sifat ganda, yaitu bisa bersifat sebagai partikel dan juga sebagai gelombang.</p>", funFact: "Sifat gelombang dari elektron dimanfaatkan dalam mikroskop elektron untuk melihat objek yang sangat kecil.", kuis: [{ type: "pilihan-ganda", pertanyaan: "Hipotesis de Broglie menyatakan bahwa panjang gelombang suatu partikel...", pilihan: ["Berbanding lurus dengan momentumnya", "Berbanding terbalik dengan momentumnya", "Tidak bergantung pada momentumnya"], jawaban: "Berbanding terbalik dengan momentumnya", hint: "λ = h/p." }] },
                            fisika_inti: { judul: "Energi dari Inti Atom", konten: "<p>Fisika inti mempelajari tentang inti atom. Reaksi fisi (pembelahan inti) dan fusi (penggabungan inti) melepaskan energi yang sangat besar.</p>", funFact: "Reaksi fusi adalah sumber energi Matahari dan bintang-bintang.", kuis: [{ type: "pilihan-ganda", pertanyaan: "Reaksi yang terjadi pada Pembangkit Listrik Tenaga Nuklir (PLTN) adalah...", pilihan: ["Fisi", "Fusi", "Peluruhan beta"], jawaban: "Fisi", hint: "Pembelahan inti Uranium." }] },
                            termodinamika: { judul: "Hukum Panas dan Energi", konten: "<p>Termodinamika mempelajari hubungan antara panas, kerja, dan energi. Hukum kedua menyatakan bahwa entropi (ketidakteraturan) semesta selalu bertambah.</p>", funFact: "Tidak mungkin membuat mesin yang 100% efisien mengubah panas menjadi kerja, ini adalah salah satu konsekuensi dari Hukum Kedua Termodinamika.", kuis: [{ type: "pilihan-ganda", pertanyaan: "Hukum pertama termodinamika pada dasarnya adalah pernyataan dari hukum kekekalan...", pilihan: ["Momentum", "Massa", "Energi"], jawaban: "Energi", hint: "Energi tidak dapat diciptakan atau dimusnahkan." }] },
                            gelombang_elektromagnetik: { judul: "Spektrum Tak Terlihat", konten: "<p>Spektrum gelombang elektromagnetik meliputi gelombang radio, mikro, inframerah, cahaya tampak, ultraviolet, sinar-X, dan sinar gamma.</p>", funFact: "Wi-Fi, Bluetooth, dan sinyal ponsel Anda semuanya adalah bentuk gelombang radio.", kuis: [{ type: "pilihan-ganda", pertanyaan: "Gelombang elektromagnetik dengan energi paling tinggi adalah...", pilihan: ["Gelombang Radio", "Cahaya Tampak", "Sinar Gamma"], jawaban: "Sinar Gamma", hint: "Memiliki frekuensi tertinggi." }] },
                            arus_bolak_balik: { judul: "Listrik di Rumah Kita", konten: "<p>Arus bolak-balik (AC) adalah jenis listrik yang digunakan di rumah. Rangkaian RLC (Resistor, Induktor, Kapasitor) adalah komponen utamanya.</p>", funFact: "Perang arus ('War of Currents') antara Thomas Edison (pendukung DC) dan Nikola Tesla (pendukung AC) dimenangkan oleh AC karena lebih efisien untuk transmisi jarak jauh.", kuis: [{ type: "pilihan-ganda", pertanyaan: "Alat yang digunakan untuk menaikkan atau menurunkan tegangan AC adalah...", pilihan: ["Kapasitor", "Transformator", "Resistor"], jawaban: "Transformator", hint: "Sering disebut trafo." }] },
                            induksi_elektromagnetik: { judul: "Magnet Menghasilkan Listrik", konten: "<p>Hukum Faraday tentang induksi elektromagnetik menyatakan bahwa perubahan medan magnet dapat menghasilkan arus listrik. Ini adalah prinsip dasar generator.", funFact: "Hampir semua listrik yang kita gunakan saat ini dibangkitkan menggunakan prinsip induksi elektromagnetik.", kuis: [{ type: "pilihan-ganda", pertanyaan: "Prinsip kerja dinamo sepeda didasarkan pada...", pilihan: ["Efek fotolistrik", "Induksi elektromagnetik", "Hukum Ohm"], jawaban: "Induksi elektromagnetik", hint: "Perputaran magnet di dekat kumparan." }] }
                        }
                    },
                    kimia_sma: {
                        namaDunia: "Sintesis Kimia Organik", warna: "lime", icon: "⚗️", deskripsi: "Mempelajari senyawa berbasis karbon yang menjadi dasar kehidupan.",
                        subMateri: {
                            atom_karbon: { judul: "Keunikan Atom Karbon", konten: "<p>Atom karbon dapat membentuk empat ikatan kovalen yang stabil, memungkinkannya membentuk rantai dan cincin kompleks, dasar dari semua molekul organik.</p>", funFact: "Bentuk alotropi karbon termasuk grafit (pada pensil), intan (permata terkeras), dan graphene (bahan satu atom tertipis).", kuis: [{ type: "pilihan-ganda", pertanyaan: "Berapa jumlah ikatan yang dapat dibentuk oleh satu atom karbon?", pilihan: ["2", "4", "6"], jawaban: "4", hint: "Elektron valensinya ada 4." }] },
                            hidrokarbon: { judul: "Alkana, Alkena, Alkuna", konten: "<p>Hidrokarbon adalah senyawa paling sederhana yang hanya terdiri dari hidrogen dan karbon. Alkana (ikatan tunggal), Alkena (ikatan rangkap dua), Alkuna (ikatan rangkap tiga).</p>", funFact: "Gas alam dan minyak bumi sebagian besar adalah campuran dari berbagai senyawa hidrokarbon.", kuis: [{ type: "pilihan-ganda", pertanyaan: "Senyawa C₂H₄ termasuk dalam deret homolog...", pilihan: ["Alkana", "Alkena", "Alkuna"], jawaban: "Alkena", hint: "Mengikuti rumus CnH2n." }] },
                            gugus_fungsi_alkohol: { judul: "Alkohol dan Eter", konten: "<p>Gugus fungsi adalah atom atau kelompok atom yang memberikan sifat khas pada senyawa. Gugus -OH adalah alkohol, sedangkan -O- adalah eter.</p>", funFact: "Etanol adalah jenis alkohol yang ditemukan dalam minuman, sementara metanol sangat beracun.", kuis: [{ type: "pilihan-ganda", pertanyaan: "Senyawa dengan gugus fungsi -OH disebut...", pilihan: ["Eter", "Alkohol", "Aldehid"], jawaban: "Alkohol", hint: "Contohnya metanol, etanol." }] },
                            aldehid_keton: { judul: "Aldehid dan Keton", konten: "<p>Keduanya memiliki gugus karbonil (C=O). Pada aldehid, gugus karbonil ada di ujung rantai, sedangkan pada keton ada di tengah.</p>", funFact: "Formalin, yang digunakan untuk mengawetkan spesimen biologi, adalah nama dagang dari larutan formaldehid (suatu aldehid).", kuis: [{ type: "pilihan-ganda", pertanyaan: "Aseton, yang digunakan sebagai penghapus cat kuku, adalah contoh senyawa...", pilihan: ["Aldehid", "Keton", "Asam karboksilat"], jawaban: "Keton", hint: "Nama IUPAC-nya adalah propanon." }] },
                            asam_karboksilat_ester: { judul: "Asam dan Aroma", konten: "<p>Asam karboksilat (-COOH) bersifat asam. Ester (-COO-) terbentuk dari reaksi asam karboksilat dan alkohol, dan seringkali memiliki aroma buah.", funFact: "Aroma pisang, nanas, dan apel pada perasa buatan berasal dari senyawa ester yang berbeda.", kuis: [{ type: "pilihan-ganda", pertanyaan: "Asam cuka atau asam asetat termasuk dalam golongan...", pilihan: ["Ester", "Alkohol", "Asam karboksilat"], jawaban: "Asam karboksilat", hint: "Rumusnya CH₃COOH." }] },
                            benzena: { judul: "Cincin Aromatik Benzena", konten: "<p>Benzena (C₆H₆) adalah senyawa siklik dengan ikatan rangkap terkonjugasi yang sangat stabil. Banyak senyawa turunan benzena penting dalam industri.</p>", funFact: "Struktur cincin benzena pertama kali diusulkan oleh August Kekulé setelah bermimpi tentang seekor ular yang menggigit ekornya sendiri.", kuis: [{ type: "pilihan-ganda", pertanyaan: "Senyawa turunan benzena yang digunakan sebagai bahan peledak adalah...", pilihan: ["Fenol", "Anilina", "TNT (Trinitrotoluena)"], jawaban: "TNT (Trinitrotoluena)", hint: "Singkatan dari Trinitrotoluena." }] },
                            polimer: { judul: "Rantai Raksasa Polimer", konten: "<p>Polimer adalah molekul raksasa (makromolekul) yang terbentuk dari pengulangan unit-unit kecil (monomer). Contohnya plastik, nilon, dan karet.</p>", funFact: "DNA dan protein dalam tubuh kita juga merupakan contoh polimer alami.", kuis: [{ type: "pilihan-ganda", pertanyaan: "Plastik PET yang digunakan untuk botol minuman adalah contoh...", pilihan: ["Monomer", "Polimer", "Isomer"], jawaban: "Polimer", hint: "Terbentuk dari banyak unit monomer." }] },
                            karbohidrat: { judul: "Sumber Energi: Karbohidrat", konten: "<p>Karbohidrat adalah biomolekul yang terdiri dari atom C, H, dan O. Berfungsi sebagai sumber energi utama. Contoh: glukosa, sukrosa, amilum.</p>", funFact: "Selulosa, karbohidrat yang menyusun dinding sel tumbuhan, adalah senyawa organik paling melimpah di Bumi.", kuis: [{ type: "pilihan-ganda", pertanyaan: "Gula pasir yang kita gunakan sehari-hari adalah...", pilihan: ["Glukosa", "Fruktosa", "Sukrosa"], jawaban: "Sukrosa", hint: "Sebuah disakarida." }] },
                            protein_lemak: { judul: "Pembangun Tubuh: Protein & Lemak", konten: "<p>Protein adalah polimer dari asam amino, berfungsi sebagai pembangun sel dan enzim. Lemak (lipid) berfungsi sebagai cadangan energi dan pelarut vitamin.</p>", funFact: "Bentuk tiga dimensi dari protein sangat menentukan fungsinya. Perubahan bentuk sedikit saja bisa membuatnya tidak aktif.", kuis: [{ type: "pilihan-ganda", pertanyaan: "Monomer atau unit penyusun protein adalah...", pilihan: ["Glukosa", "Asam amino", "Asam lemak"], jawaban: "Asam amino", hint: "Ada 20 jenis asam amino esensial." }] },
                            redoks_elektrokimia: { judul: "Sel Volta dan Elektrolisis", konten: "<p>Elektrokimia mempelajari hubungan antara reaksi kimia dan energi listrik. Sel Volta mengubah energi kimia menjadi listrik (baterai), sedangkan elektrolisis sebaliknya.</p>", funFact: "Proses penyepuhan logam, seperti melapisi sendok dengan perak, menggunakan prinsip elektrolisis.", kuis: [{ type: "pilihan-ganda", pertanyaan: "Pada sel Volta (baterai), energi kimia diubah menjadi energi...", pilihan: ["Panas", "Cahaya", "Listrik"], jawaban: "Listrik", hint: "Menghasilkan arus listrik spontan." }] }
                        }
                    },
                     // Dunia-dunia tambahan untuk SMA
                    biologi_sma: {
                        namaDunia: "Molekul Kehidupan",
                        warna: "emerald",
                        icon: "🦠",
                        deskripsi: "Mendalami genetika, evolusi, dan bioteknologi modern.",
                        subMateri: {
                            sel_dan_organela: { judul: "Sel & Organela", konten: "<p>Struktur sel, fungsi organela, perbedaan sel prokariotik dan eukariotik.</p>", funFact: "Tubuh manusia terdiri dari triliunan sel yang saling bekerja sama.", kuis: [{ type: "pilihan-ganda", pertanyaan: "Organel yang bertanggung jawab untuk menghasilkan energi sel adalah?", pilihan: ["Ribosom","Mitochondria","Kloroplas"], jawaban: "Mitochondria", hint: "Dikenal sebagai 'pembangkit tenaga' sel." }] },
                            genetika_dasar: { judul: "Genetika Dasar", konten: "<p>Gen, kromosom, pewarisan sifat Mendelian, dan dasar DNA.</p>", funFact: "Manusia memiliki sekitar 20.000-25.000 gen dalam genomnya.", kuis: [{ type: "pilihan-ganda", pertanyaan: "Bahan genetik utama pada manusia adalah...", pilihan: ["RNA","Protein","DNA"], jawaban: "DNA", hint: "Menyimpan instruksi biologis." }] },
                            evolusi_seleksi: { judul: "Evolusi & Seleksi Alam", konten: "<p>Proses perubahan spesies dari waktu ke waktu melalui seleksi alam dan mutasi.</p>", funFact: "Burung finch di Kepulauan Galapagos membantu Darwin merumuskan teori evolusi.", kuis: [{ type: "pilihan-ganda", pertanyaan: "Proses yang menjelaskan adaptasi spesies adalah...", pilihan: ["Evolusi","Homeostasis","Mitosis"], jawaban: "Evolusi", hint: "Perubahan genetik pada populasi selama generasi." }] },
                            bioteknologi: { judul: "Bioteknologi", konten: "<p>Teknik rekayasa genetika, kloning sederhana, dan aplikasi farmasi.</p>", funFact: "Insulin sintetis pertama kali diproduksi oleh bakteri yang dimodifikasi secara genetik.", kuis: [{ type: "pilihan-ganda", pertanyaan: "Salah satu aplikasi bioteknologi adalah memproduksi...", pilihan: ["Mobil","Insulin recombinant","Kain"], jawaban: "Insulin recombinant", hint: "Digunakan untuk pengobatan diabetes." }] },
                            ekologi: { judul: "Ekologi & Ekosistem", konten: "<p>Rantai makanan, siklus materi, dan hubungan antarspesies dalam ekosistem.</p>", funFact: "Lebah adalah polinator yang penting bagi banyak tanaman pangan.", kuis: [{ type: "pilihan-ganda", pertanyaan: "Interaksi antara predator dan mangsa mempengaruhi...", pilihan: ["Iklim","Populasi","Gravitasi"], jawaban: "Populasi", hint: "Jumlah individu dalam suatu spesies." }] },
                            fisiologi_manusia: { judul: "Fisiologi Manusia", konten: "<p>Sistem pernapasan, peredaran darah, pencernaan, dan sistem saraf dasar.</p>", funFact: "Jantung manusia berdetak sekitar 100.000 kali per hari.", kuis: [{ type: "pilihan-ganda", pertanyaan: "Organ yang memompa darah ke seluruh tubuh adalah...", pilihan: ["Paru-paru","Hati","Jantung"], jawaban: "Jantung", hint: "Ini adalah otot berongga utama tubuh." }] },
                            mikrobiologi: { judul: "Mikrobiologi", konten: "<p>Bakteri, virus, jamur, dan peran mereka dalam kesehatan serta penyakit.</p>", funFact: "Tubuh manusia memiliki lebih banyak sel mikroba daripada sel manusia sendiri jika dihitung berdasarkan jumlah gen.", kuis: [{ type: "pilihan-ganda", pertanyaan: "Organisme kecil yang sering menyebabkan infeksi menular adalah...", pilihan: ["Gunung","Virus","Piring"], jawaban: "Virus", hint: "Agen kecil yang membutuhkan inang untuk bereplikasi." }] },
                            bioteknologi_etika: { judul: "Etika Bioteknologi", konten: "<p>Pertimbangan etis dalam penggunaan teknologi genetika seperti editing gen dan kloning.</p>", funFact: "Isu etika sering muncul ketika teknologi baru melampaui peraturan yang ada.", kuis: [{ type: "pilihan-ganda", pertanyaan: "Salah satu isu etika bioteknologi adalah...", pilihan: ["Privasi genetik","Daur ulang","Transportasi"], jawaban: "Privasi genetik", hint: "Informasi genetik bisa mempengaruhi asuransi dan pekerjaan." }] },
                            biologi_molekuler: { judul: "Biologi Molekuler", konten: "<p>Transkripsi, translasi, dan bagaimana gen diterjemahkan menjadi protein.</p>", funFact: "Proses translasi terjadi di ribosom yang ada di sitoplasma sel.", kuis: [{ type: "pilihan-ganda", pertanyaan: "Tempat terjadinya translasi dalam sel adalah...", pilihan: ["Nukleus","Ribosom","Membran sel"], jawaban: "Ribosom", hint: "Pabrik protein sel." }] },
                            genetika_populasi: { judul: "Genetika Populasi", konten: "<p>Frekuensi gen dalam populasi, hukum Hardy-Weinberg, dan faktor yang mengubahnya.</p>", funFact: "Mutasi acak dapat memperkenalkan variasi baru yang menjadi bahan seleksi alam.", kuis: [{ type: "pilihan-ganda", pertanyaan: "Suatu faktor yang dapat mengubah frekuensi alel adalah...", pilihan: ["Mutasi","Geometri","Photosynthesis"], jawaban: "Mutasi", hint: "Salah satu sumber variasi genetik." }] },
                            teknik_lapangan: { judul: "Teknik Lapangan", konten: "<p>Metode pengamatan biologis: pengambilan sampel, mikroskopi sederhana, dan pencatatan data lapangan.</p>", funFact: "Ilmuwan menggunakan perangkap kamera untuk mempelajari hewan yang sulit dipantau secara langsung.", kuis: [{ type: "pilihan-ganda", pertanyaan: "Salah satu alat utama untuk melihat sel adalah...", pilihan: ["Mikroskop","Kamera","Teleskop"], jawaban: "Mikroskop", hint: "Digunakan untuk melihat benda sangat kecil." }] }
                        }
                    },
                    sosiologi_sma: {
                        namaDunia: "Agora Sosiologi",
                        warna: "cyan",
                        icon: "👨‍👩‍👧‍👦",
                        deskripsi: "Menganalisis struktur, konflik, dan perubahan dalam masyarakat.",
                        subMateri: {
                            konsep_sosial: { judul: "Konsep Dasar Sosiologi", konten: "<p>Struktur sosial, norma, nilai, dan peran sosial dalam masyarakat.</p>", funFact: "Norma sosial bisa berbeda antarbudaya meskipun tujuan mereka serupa.", kuis: [{ type: "pilihan-ganda", pertanyaan: "Aturan tidak tertulis yang mengatur perilaku disebut...", pilihan: ["Hukum","Norma","Statistik"], jawaban: "Norma", hint: "Bukan aturan formal tetapi diharapkan diikuti." }] },
                            stratifikasi: { judul: "Stratifikasi Sosial", konten: "<p>Kelas sosial, mobilitas sosial, dan dampaknya terhadap kesempatan individu.</p>", funFact: "Beberapa masyarakat memiliki mobilitas sosial yang sangat terbatas, sehingga posisi sosial cenderung diwariskan.", kuis: [{ type: "pilihan-ganda", pertanyaan: "Stratifikasi sosial berkaitan dengan...", pilihan: ["Tingkat kepemilikan dan status","Jenis cuaca","Bentuk seni"], jawaban: "Tingkat kepemilikan dan status", hint: "Hierarki dalam masyarakat." }] },
                            interaksi_harian: { judul: "Interaksi Sehari-hari", konten: "<p>Simbol, bahasa tubuh, dan komunikasi non-verbal yang membentuk hubungan antarindividu.</p>", funFact: "Ekspresi wajah dasar seperti tersenyum dikenali lintas budaya.", kuis: [{ type: "pilihan-ganda", pertanyaan: "Bahasa tubuh yang menunjukkan keterbukaan seringkali adalah...", pilihan: ["Menutup lengan","Kontak mata","Menyilangkan kaki"], jawaban: "Kontak mata", hint: "Tergantung budaya, tapi sering dianggap positif." }] },
                            kelompok_dan_lembaga: { judul: "Kelompok & Lembaga", konten: "<p>Keluarga, sekolah, agama, dan pemerintahan sebagai institusi sosial yang membentuk perilaku.</p>", funFact: "Sekolah adalah salah satu agen sosialisasi utama dalam masyarakat modern.", kuis: [{ type: "pilihan-ganda", pertanyaan: "Salah satu contoh institusi sosial adalah...", pilihan: ["Gunung","Sekolah","Pelukan"], jawaban: "Sekolah", hint: "Organisasi yang mentransmisikan nilai dan keterampilan." }] },
                            konflik_sosial: { judul: "Konflik & Perubahan", konten: "<p>Penyebab konflik sosial, gerakan sosial, dan bagaimana perubahan sosial berlangsung.</p>", funFact: "Gerakan sosial sering muncul ketika sekelompok orang menuntut perubahan kebijakan atau keadilan sosial.", kuis: [{ type: "pilihan-ganda", pertanyaan: "Gerakan sosial biasanya bertujuan untuk...", pilihan: ["Mempertahankan status quo","Mendorong perubahan","Mengurangi populasi"], jawaban: "Mendorong perubahan", hint: "Bentuk tindakan kolektif." }] },
                            budaya_populer: { judul: "Budaya Populer & Media", konten: "<p>Peran media massa dan budaya populer dalam membentuk opini, mode, dan gaya hidup.</p>", funFact: "Media sosial mempercepat penyebaran budaya populer di seluruh dunia.", kuis: [{ type: "pilihan-ganda", pertanyaan: "Platform yang menyebarkan budaya populer masa kini adalah...", pilihan: ["Surat kabar kuno","Media sosial","Lukisan gua"], jawaban: "Media sosial", hint: "Cepat dan viral." }] },
                            penelitian_sosial: { judul: "Metode Penelitian", konten: "<p>Survei, wawancara, observasi, dan analisis data kualitatif serta kuantitatif.</p>", funFact: "Sosiolog menggunakan metode ilmiah untuk menguji hipotesis tentang masyarakat.", kuis: [{ type: "pilihan-ganda", pertanyaan: "Metode yang menghasilkan data numerik adalah...", pilihan: ["Wawancara mendalam","Survei kuantitatif","Etnografi"], jawaban: "Survei kuantitatif", hint: "Suka menggunakan angka dan statistik." }] },
                            sosiologi_pendidikan: { judul: "Sosiologi Pendidikan", konten: "<p>Bagaimana sekolah mereproduksi nilai-nilai sosial dan peranannya dalam mobilitas sosial.</p>", funFact: "Beberapa teori sosiologi menyatakan bahwa sekolah cenderung mereproduksi ketidaksetaraan yang ada di masyarakat.", kuis: [{ type: "pilihan-ganda", pertanyaan: "Salah satu fungsi sosial sekolah adalah...", pilihan: ["Menghambat pengetahuan","Mengajarkan keterampilan","Menghilangkan budaya"], jawaban: "Mengajarkan keterampilan", hint: "Peran utama pendidikan dalam masyarakat." }] },
                            urbanisasi: { judul: "Urbanisasi & Perkotaan", konten: "<p>Fenomena perpindahan penduduk dari desa ke kota dan tantangan perkotaan modern.</p>", funFact: "Kota-kota besar sering mengalami masalah seperti kemacetan, polusi, dan perumahan tidak memadai." , kuis: [{ type: "pilihan-ganda", pertanyaan: "Urbanisasi berarti...", pilihan: ["Pindah dari kota ke pedesaan","Pindah dari pedesaan ke kota","Bertani"], jawaban: "Pindah dari pedesaan ke kota", hint: "Perubahan demografis besar." }] },
                            globalisasi: { judul: "Globalisasi", konten: "<p>Interkoneksi ekonomi, budaya, dan politik lintas negara serta dampaknya pada identitas lokal.</p>", funFact: "Globalisasi membuat produk dan ide bergerak lebih cepat antarnegara, tetapi juga menimbulkan tantangan lokal.", kuis: [{ type: "pilihan-ganda", pertanyaan: "Salah satu efek globalisasi adalah...", pilihan: ["Isolasi budaya","Pertukaran budaya","Penutupan perbatasan"], jawaban: "Pertukaran budaya", hint: "Lebih banyak interaksi antarbangsa." }] }
                        }
                    },
                    ekonomi_sma: {
                        namaDunia: "Pasar Modal Global",
                        warna: "amber",
                        icon: "💰",
                        deskripsi: "Mengupas tuntas makroekonomi, kebijakan fiskal, dan perdagangan internasional.",
                        subMateri: {
                            makroekonomi: { judul: "Makroekonomi", konten: "<p>Konsep PDB, inflasi, pengangguran, dan kebijakan fiskal/moneter.</p>", funFact: "Bank sentral menggunakan suku bunga untuk mengendalikan inflasi.", kuis: [{ type: "pilihan-ganda", pertanyaan: "Indikator total produksi barang dan jasa suatu negara disebut...", pilihan: ["PDB","IPM","Inflasi"], jawaban: "PDB", hint: "Produk Domestik Bruto." }] },
                            mikroekonomi: { judul: "Mikroekonomi", konten: "<p>Teori produsen dan konsumen, kelangkaan, biaya peluang, dan pasar persaingan.</p>", funFact: "Biaya peluang adalah nilai dari alternatif terbaik yang dikorbankan saat memilih sesuatu.", kuis: [{ type: "pilihan-ganda", pertanyaan: "Biaya peluang adalah...", pilihan: ["Biaya nyata yang dibayar","Nilai alternatif yang dikorbankan","Keuntungan bersih"], jawaban: "Nilai alternatif yang dikorbankan", hint: "Konsep penting dalam pengambilan keputusan." }] },
                            sistem_keuangan: { judul: "Sistem Keuangan", konten: "<p>Peran bank, pasar modal, saham, obligasi, dan lembaga keuangan lainnya.</p>", funFact: "Pasar modal memungkinkan perusahaan mengumpulkan dana dari publik melalui emisi saham.", kuis: [{ type: "pilihan-ganda", pertanyaan: "Instrumen yang menunjukkan kepemilikan perusahaan disebut...", pilihan: ["Obligasi","Saham","Deposito"], jawaban: "Saham", hint: "Memberi hak atas bagian dari perusahaan." }] },
                            perdagangan_internasional: { judul: "Perdagangan Internasional", konten: "<p>Teori keunggulan komparatif, tarif, dan neraca perdagangan.</p>", funFact: "Spesialisasi produksi berdasarkan keunggulan komparatif meningkatkan efisiensi global.", kuis: [{ type: "pilihan-ganda", pertanyaan: "Perdagangan antarnegara disebut...", pilihan: ["Perdagangan domestik","Perdagangan internasional","Barter"], jawaban: "Perdagangan internasional", hint: "Melibatkan ekspor dan impor." }] },
                            kebijakan_publik: { judul: "Kebijakan Publik", konten: "<p>Bagaimana pemerintah merancang kebijakan untuk pertumbuhan, stabilitas, dan kesejahteraan.</p>", funFact: "Subsidi dan pajak adalah alat umum untuk mempengaruhi perilaku ekonomi.", kuis: [{ type: "pilihan-ganda", pertanyaan: "Instrumen kebijakan fiskal utamanya adalah...", pilihan: ["Suku bunga","Belanja pemerintah & pajak","Kebijakan moneter"], jawaban: "Belanja pemerintah & pajak", hint: "Dijalankan oleh pemerintah pusat." }] },
                            investasi: { judul: "Investasi Dasar", konten: "<p>Konsep risiko & imbal hasil, diversifikasi, dan instrumen investasi sederhana.</p>", funFact: "Diversifikasi tidak menghilangkan risiko pasar, tetapi dapat mengurangi risiko spesifik aset.", kuis: [{ type: "pilihan-ganda", pertanyaan: "Diversifikasi bertujuan untuk...", pilihan: ["Meningkatkan risiko","Mengurangi risiko spesifik","Menjamin keuntungan"], jawaban: "Mengurangi risiko spesifik", hint: "Spreade risiko antar aset." }] },
                            pasar_modal: { judul: "Pasar Modal & Saham", konten: "<p>Bagaimana bursa saham bekerja, IPO, dan peran pialang.</p>", funFact: "Perusahaan bisa menjadi publik melalui IPO untuk mengumpulkan modal besar." , kuis: [{ type: "pilihan-ganda", pertanyaan: "Perusahaan yang menjual sahamnya ke publik melakukan...", pilihan: ["MBO","IPO","Merger"], jawaban: "IPO", hint: "Initial Public Offering." }] },
                            makro_krisis: { judul: "Krisis & Resesi", konten: "<p>Penyebab krisis finansial, resesi, dan kebijakan mitigasi.</p>", funFact: "Krisis 2008 dipicu oleh gelembung pasar perumahan dan produk derivatif berisiko.", kuis: [{ type: "pilihan-ganda", pertanyaan: "Resesi ditandai dengan...", pilihan: ["Pertumbuhan ekonomi tinggi","Penurunan aktivitas ekonomi","Inflasi tinggi terus-menerus"], jawaban: "Penurunan aktivitas ekonomi", hint: "Kontraksi ekonomi selama dua kuartal atau lebih." }] },
                            ekonomi_perilaku: { judul: "Ekonomi Perilaku", konten: "<p>Bagaimana bias dan psikologi mempengaruhi keputusan ekonomi individu.</p>", funFact: "Bias seperti aversi kerugian membuat orang lebih takut rugi daripada senang mendapat keuntungan sebanding.", kuis: [{ type: "pilihan-ganda", pertanyaan: "Salah satu contoh bias kognitif dalam ekonomi adalah...", pilihan: ["Aversi kerugian","Homeostasis","Photosynthesis"], jawaban: "Aversi kerugian", hint: "Preferensi terhadap menghindari kerugian." }] },
                            kewirausahaan: { judul: "Kewirausahaan", konten: "<p>Model bisnis sederhana, pitching ide, dan dasar manajemen usaha kecil.</p>", funFact: "Startup sukses seringkali butuh iterasi produk yang cepat dan feedback pengguna." , kuis: [{ type: "pilihan-ganda", pertanyaan: "Salah satu elemen penting model bisnis adalah...", pilihan: ["Suhu","Sumber pendapatan","Warna logo"], jawaban: "Sumber pendapatan", hint: "Bagaimana bisnis menghasilkan uang." }] }
                        }
                    },
                    geografi_sma: {
                        namaDunia: "Geopolitik Dunia",
                        warna: "teal",
                        icon: "🌐",
                        deskripsi: "Memahami isu-isu global, interaksi negara, dan sistem informasi geografis.",
                        subMateri: {
                            peta_dan_koordinat: { judul: "Peta & Koordinat", konten: "<p>Latitude, longitude, dan membaca peta topografi.</p>", funFact: "Garis khatulistiwa membagi Bumi menjadi belahan utara dan selatan.", kuis: [{ type: "pilihan-ganda", pertanyaan: "Garis yang mengukur posisi utara-selatan disebut...", pilihan: ["Longitude","Latitude","Paralel"], jawaban: "Latitude", hint: "Berjalan sejajar khatulistiwa." }] },
                            iklim_dunia: { judul: "Iklim & Zonasi", konten: "<p>Faktor yang mempengaruhi iklim, tipe-tipe iklim, dan perubahan iklim.</p>", funFact: "Ada pergeseran zona iklim akibat pemanasan global." , kuis: [{ type: "pilihan-ganda", pertanyaan: "Gas rumah kaca yang utama adalah...", pilihan: ["Oksigen","Karbon Dioksida","Nitrogen"], jawaban: "Karbon Dioksida", hint: "Berhubungan dengan efek rumah kaca." }] },
                            geomorfologi: { judul: "Bentuk Muka Bumi", konten: "<p>Proses pembentukan gunung, lembah, dataran, dan pantai melalui aktivitas geologi.</p>", funFact: "Gempa dan gunung berapi sering terjadi di batas lempeng tektonik." , kuis: [{ type: "pilihan-ganda", pertanyaan: "Proses yang membentuk pegunungan utama adalah...", pilihan: ["Erosi","Tektonik Lempeng","Fotosintesis"], jawaban: "Tektonik Lempeng", hint: "Gerakan kerak bumi." }] },
                            sumberdaya_alam: { judul: "Sumber Daya Alam", konten: "<p>Mineral, air, dan energi serta pengelolaannya secara berkelanjutan.</p>", funFact: "Cadangan air tanah sangat penting untuk pertanian di musim kemarau." , kuis: [{ type: "pilihan-ganda", pertanyaan: "Sumber daya yang bisa habis disebut...", pilihan: ["Terbarukan","Tidak terbarukan","Abadi"], jawaban: "Tidak terbarukan", hint: "Contoh: minyak bumi." }] },
                            geopolitik: { judul: "Geopolitik", konten: "<p>Relasi antarnegara, konflik wilayah, dan pengaruh geografis terhadap kebijakan luar negeri.</p>", funFact: "Akses ke jalur pelayaran strategis seringkali menjadi alasan penting dalam hubungan internasional.", kuis: [{ type: "pilihan-ganda", pertanyaan: "Salah satu contoh kepentingan geopolitik adalah...", pilihan: ["Parade militer","Akses pelabuhan strategis","Festival musik"], jawaban: "Akses pelabuhan strategis", hint: "Sumber daya dan jalur perdagangan." }] },
                            urbanisasi_dan_perencanaan: { judul: "Perencanaan Kota", konten: "<p>Isu perencanaan kota, transportasi, dan ruang hijau.</p>", funFact: "Kota yang padat tanpa ruang terbuka dapat menurunkan kualitas hidup.", kuis: [{ type: "pilihan-ganda", pertanyaan: "Perencanaan kota yang baik memperhatikan...", pilihan: ["Transportasi","Jumlah pohon saja","Hanya estetika"], jawaban: "Transportasi", hint: "Aksesibilitas itu penting." }] },
                            bencana_alam: { judul: "Risiko Bencana", konten: "<p>Tipe-tipe bencana alam dan strategi mitigasi seperti early warning systems.</p>", funFact: "Sistem peringatan dini dapat menyelamatkan ribuan nyawa saat tsunami." , kuis: [{ type: "pilihan-ganda", pertanyaan: "Mitigasi bencana salah satunya adalah...", pilihan: ["Membangun di zona rawan","Early warning system","Mengabaikan peringatan"], jawaban: "Early warning system", hint: "Memberi waktu evakuasi." }] },
                            demografi: { judul: "Populasi & Demografi", konten: "<p>Struktur umur, tingkat kelahiran, dan implikasinya pada ekonomi dan layanan publik." , funFact: "Beberapa negara menghadapi penuaan populasi yang mempengaruhi sistem pensiun.", kuis: [{ type: "pilihan-ganda", pertanyaan: "Angka yang menggambarkan jumlah orang per unit area disebut...", pilihan: ["Densitas penduduk","Angka kematian","Angka kelahiran"], jawaban: "Densitas penduduk", hint: "Hubungan jumlah orang dan luas wilayah." }] },
                            teknologi_gis: { judul: "GIS & Penginderaan Jauh", konten: "<p>Penggunaan peta digital dan citra satelit untuk analisis spasial dan perencanaan.</p>", funFact: "Teknologi penginderaan jauh digunakan untuk memetakan perubahan hutan dan tutupan lahan.", kuis: [{ type: "pilihan-ganda", pertanyaan: "Alat untuk menganalisis data ruang disebut...", pilihan: ["Spreadsheet","GIS","Kamera"], jawaban: "GIS", hint: "Sistem Informasi Geografis." }] }
                        }
                    },
                    sejarah_sma: {
                        namaDunia: "Peradaban Dunia",
                        warna: "stone",
                        icon: "🏛️",
                        deskripsi: "Menelusuri sejarah peradaban dunia dari zaman kuno hingga era modern.",
                        subMateri: {
                            peradaban_awal: { judul: "Peradaban Kuno", konten: "<p>Mesopotamia, Mesir kuno, Peradaban Indus, dan Tiongkok kuno.</p>", funFact: "Salah satu kota tertua di dunia adalah Uruk di Mesopotamia.", kuis: [{ type: "pilihan-ganda", pertanyaan: "Sungai utama peradaban Mesopotamia adalah...", pilihan: ["Nil","Euphrates & Tigris","Yangtze"], jawaban: "Euphrates & Tigris", hint: "Dua sungai besar di wilayah itu." }] },
                            abad_tengah: { judul: "Abad Pertengahan", konten: "<p>Feodalisme, kebangkitan kota, dan transformasi sosial di Eropa dan dunia Islam.</p>", funFact: "Universitas-universitas tertua di dunia banyak berdiri pada masa Abad Pertengahan." , kuis: [{ type: "pilihan-ganda", pertanyaan: "Sistem sosial yang dominan pada Abad Pertengahan adalah...", pilihan: ["Demokrasi","Feodalisme","Komunisme"], jawaban: "Feodalisme", hint: "Hubungan lord-vassal." }] },
                            penjelajahan: { judul: "Era Penjelajahan", konten: "<p>Penemuan jalur laut baru, kolonialisme, dan dampaknya terhadap dunia.</p>", funFact: "Perjalanan laut membawa komoditas baru dan juga memicu pertukaran budaya yang besar.", kuis: [{ type: "pilihan-ganda", pertanyaan: "Tokoh yang terkenal melakukan penjelajahan ke Dunia Baru adalah...", pilihan: ["Magellan","Columbus","Newton"], jawaban: "Columbus", hint: "Nama sering dikaitkan dengan 'penemuan' Amerika oleh Eropa." }] },
                            revolusi_industri: { judul: "Revolusi Industri", konten: "<p>Perubahan produksi dari tangan manusia ke mesin dan dampaknya pada urbanisasi dan tenaga kerja.</p>", funFact: "Mesin uap adalah salah satu pendorong utama Revolusi Industri di Inggris." , kuis: [{ type: "pilihan-ganda", pertanyaan: "Salah satu efek revolusi industri adalah...", pilihan: ["Pertanian meningkat drastis","Urbanisasi","Hilangnya teknologi"], jawaban: "Urbanisasi", hint: "Banyak orang pindah ke kota kerja pabrik." }] },
                            perang_dunia: { judul: "Perang Dunia & Dampaknya", konten: "<p>Penyebab dan konsekuensi Perang Dunia I & II serta perubahan geopolitik pascaperang.</p>", funFact: "Pembentukan PBB adalah upaya untuk mencegah perang besar di masa depan.", kuis: [{ type: "pilihan-ganda", pertanyaan: "Organisasi internasional yang didirikan setelah Perang Dunia II adalah...", pilihan: ["Liga Bangsa-Bangsa","PBB","NATO"], jawaban: "PBB", hint: "Bertujuan menjaga perdamaian dunia." }] },
                            kolonialisme: { judul: "Kolonialisme & Dekolonisasi", konten: "<p>Sejarah penjajahan, eksploitasi sumber daya, dan perjuangan kemerdekaan bangsa-bangsa." , funFact: "Gelombang dekolonisasi pasca-Perang Dunia II mengubah peta politik global." , kuis: [{ type: "pilihan-ganda", pertanyaan: "Proses kemerdekaan negara-negara koloni disebut...", pilihan: ["Aneksasi","Dekolonisasi","Imperialisme"], jawaban: "Dekolonisasi", hint: "Pembentukan negara merdeka." }] },
                            sejarah_nasional: { judul: "Sejarah Nasional Indonesia", konten: "<p>Pergerakan nasional, proklamasi kemerdekaan, dan pembentukan negara.</p>", funFact: "Proklamasi Kemerdekaan Indonesia dibacakan pada 17 Agustus 1945.", kuis: [{ type: "pilihan-ganda", pertanyaan: "Tanggal Proklamasi Kemerdekaan Indonesia adalah...", pilihan: ["17 Agustus 1945","1 Januari 1900","10 November 1945"], jawaban: "17 Agustus 1945", hint: "Hari kemerdekaan Indonesia." }] },
                            sejarah_kebudayaan: { judul: "Sejarah Kebudayaan", konten: "<p>Perkembangan seni, agama, dan praktik budaya di berbagai peradaban." , funFact: "Wayang adalah salah satu bentuk seni tradisional yang kaya makna simbolik." , kuis: [{ type: "pilihan-ganda", pertanyaan: "Salah satu bentuk tradisi lisan adalah...", pilihan: ["Novels","Legenda lisan","Internet"], jawaban: "Legenda lisan", hint: "Diteruskan turun-temurun." }] },
                            historiografi: { judul: "Metode Sejarawan", konten: "<p>Metode penelaahan sumber, kritik sumber, dan cara menulis sejarah secara ilmiah.</p>", funFact: "Sejarawan menggunakan arsip, prasasti, dan bukti material lainnya untuk merekonstruksi masa lalu.", kuis: [{ type: "pilihan-ganda", pertanyaan: "Istilah untuk evaluasi sumber sejarah disebut...", pilihan: ["Kritik sumber","Analisis statistik","Eksperimen"], jawaban: "Kritik sumber", hint: "Memastikan kebenaran bukti sejarah." }] }
                        }
                    },
                    sastra_sma: {
                        namaDunia: "Literary Circle",
                        warna: "rose",
                        icon: "📖",
                        deskripsi: "Mengkaji karya sastra dunia dan teori-teori kritik sastra.",
                        subMateri: {
                            pengantar_sastra: { judul: "Pengantar Sastra", konten: "<p>Genre sastra, elemen cerita, dan cara membaca kritis.</p>", funFact: "Sastra dapat mencerminkan kondisi sosial dan waktu ketika karya itu dibuat.", kuis: [{ type: "pilihan-ganda", pertanyaan: "Elemen utama cerita adalah...", pilihan: ["Karakter, Alur, Tema","Warna, Ukuran, Bentuk","Nada, Volume, Kecepatan"], jawaban: "Karakter, Alur, Tema", hint: "Dasar-dasar analisis sastra." }] },
                            puisi: { judul: "Analisis Puisi", konten: "<p>Metafora, irama, rima, dan citraan dalam puisi.</p>", funFact: "Beberapa puisi terkenal hanya terdiri dari beberapa baris tetapi sangat mendalam maknanya.", kuis: [{ type: "pilihan-ganda", pertanyaan: "Salah satu alat gaya dalam puisi adalah...", pilihan: ["Metafora","Tabel","Diagram"], jawaban: "Metafora", hint: "Perbandingan tanpa kata 'seperti'." }] },
                            prosa_modern: { judul: "Prosa & Cerita Pendek", konten: "<p>Struktur cerita pendek, pengembangan karakter, dan plot twist.</p>", funFact: "Cerita pendek seringkali fokus pada satu momen atau konflik tertentu.", kuis: [{ type: "pilihan-ganda", pertanyaan: "Jenis karya yang biasanya lebih singkat dan fokus adalah...", pilihan: ["Novel","Cerita Pendek","Ensiklopedia"], jawaban: "Cerita Pendek", hint: "Satu konflik pusat biasanya cukup." }] },
                            drama: { judul: "Teater & Drama", konten: "<p>Unsur panggung, dialog, dan perbedaan antara naskah drama dan prosa.</p>", funFact: "Drama klasik sering dipentaskan di teater terbuka tanpa pencahayaan modern.", kuis: [{ type: "pilihan-ganda", pertanyaan: "Salah satu unsur utama drama adalah...", pilihan: ["Dialog","Lagu","Animasi"], jawaban: "Dialog", hint: "Penting untuk menyampaikan cerita." }] },
                            novel: { judul: "Mengenal Novel", konten: "<p>Novel adalah karya prosa panjang yang mengembangkan tema, tokoh, dan alur secara lebih mendalam.</p>", funFact: "Novel modern pertama sering dianggap 'Don Quixote' karya Miguel de Cervantes.", kuis: [{ type: "pilihan-ganda", pertanyaan: "Ciri utama novel dibanding cerita pendek adalah...", pilihan: ["Lebih singkat","Alur lebih kompleks","Hanya satu tokoh"], jawaban: "Alur lebih kompleks", hint: "Ruang untuk pengembangan karakter." }] },
                            kritik_sastra: { judul: "Kritik & Teori", konten: "<p>Pendekatan membaca teks: formalisme, strukturalisme, feminisme, dan teori pascakolonial.</p>", funFact: "Teori sastra membantu kita melihat makna yang tersembunyi dalam teks.", kuis: [{ type: "pilihan-ganda", pertanyaan: "Salah satu pendekatan kritik sastra adalah...", pilihan: ["Formalisme","Biologi","Geometri"], jawaban: "Formalisme", hint: "Fokus pada struktur teks." }] },
                            penulis_indonesia: { judul: "Pengarang Indonesia", konten: "<p>Perkenalan pada sastrawan penting Indonesia seperti Pramoedya Ananta Toer, Chairil Anwar, dan Nh. Dini.</p>", funFact: "Chairil Anwar adalah tokoh penting dalam puisi modern Indonesia yang terkenal dengan gaya bebasnya.", kuis: [{ type: "pilihan-ganda", pertanyaan: "Siapa penulis 'Bumi Manusia' dari Indonesia?", pilihan: ["Chairil Anwar","Pramoedya Ananta Toer","Taufik Ismail"], jawaban: "Pramoedya Ananta Toer", hint: "Penulis trilogi Buru." }] },
                            sastra_dunia: { judul: "Sastra Dunia", konten: "<p>Mengenal karya-karya klasik dan modern dari berbagai tradisi sastra dunia.</p>", funFact: "Sastra dari berbagai negara memberikan perspektif unik tentang kehidupan dan sejarah setempat.", kuis: [{ type: "pilihan-ganda", pertanyaan: "Salah satu novel klasik dunia adalah...", pilihan: ["Don Quixote","Twitter","Minecraft"], jawaban: "Don Quixote", hint: "Karya Cervantes." }] },
                            analisis_tema: { judul: "Tema & Simbol", konten: "<p>Bagaimana mengidentifikasi tema utama, simbol, dan motif dalam sebuah karya sastra.</p>", funFact: "Sebuah simbol bisa muncul berkali-kali dan memberi makna tambahan pada cerita.", kuis: [{ type: "pilihan-ganda", pertanyaan: "Tema cerita biasanya berhubungan dengan...", pilihan: ["Warna cover buku","Pesan atau ide utama","Harga buku"], jawaban: "Pesan atau ide utama", hint: "Inti yang ingin disampaikan penulis." }] },
                            adaptasi_media: { judul: "Adaptasi ke Film & Teater", konten: "<p>Proses mengubah karya sastra menjadi naskah panggung atau skenario film, serta tantangannya.</p>", funFact: "Banyak novel sukses yang menjadi film box-office, tetapi tidak semua penggemar menyukai perubahan cerita.", kuis: [{ type: "pilihan-ganda", pertanyaan: "Ketika novel diadaptasi ke film, salah satu tantangannya adalah...", pilihan: ["Menambah detail sebanyak-banyaknya","Menerjemahkan monolog panjang menjadi visual","Menghapus semua tokoh"], jawaban: "Menerjemahkan monolog panjang menjadi visual", hint: "Medium berbeda memerlukan pendekatan berbeda." }] }
                        }
                    },
                    tik_sma: {
                        namaDunia: "Studio Informatika",
                        warna: "slate",
                        icon: "👨‍💻",
                        deskripsi: "Mempelajari algoritma, logika pemrograman, dan dampak sosial teknologi.",
                        subMateri: {
                            algoritma: { judul: "Algoritma Dasar", konten: "<p>Langkah-langkah sistematis untuk menyelesaikan masalah komputer.</p>", funFact: "Algoritma adalah inti dari pemrograman; tanpa algoritma, komputer hanyalah kotak kosong.", kuis: [{ type: "pilihan-ganda", pertanyaan: "Algoritma berguna untuk...", pilihan: ["Menentukan urutan langkah","Memilih warna","Mencetak gambar"], jawaban: "Menentukan urutan langkah", hint: "Pola penyelesaian masalah." }] },
                            struktur_data: { judul: "Struktur Data", konten: "<p>Array, list, stack, queue, dan bagaimana memilih struktur yang tepat untuk data.</p>", funFact: "Pemilihan struktur data yang tepat dapat membuat program jauh lebih cepat.", kuis: [{ type: "pilihan-ganda", pertanyaan: "Struktur data yang mengikuti aturan LIFO adalah...", pilihan: ["Queue","Stack","Array"], jawaban: "Stack", hint: "Terakhir masuk, pertama keluar." }] },
                            pemrograman: { judul: "Dasar Pemrograman", konten: "<p>Variabel, percabangan, pengulangan, dan fungsi di dalam bahasa pemrograman.</p>", funFact: "Bahasa pemrograman pertama yang banyak dikenal adalah Fortran dan COBOL.", kuis: [{ type: "pilihan-ganda", pertanyaan: "Perintah untuk membuat pengulangan biasanya menggunakan...", pilihan: ["if","for/while","switch"], jawaban: "for/while", hint: "Digunakan untuk loop." }] },
                            basis_data: { judul: "Basis Data", konten: "<p>Konsep tabel, relasi, query sederhana, dan penyimpanan data terstruktur.</p>", funFact: "Sistem basis data modern memungkinkan jutaan pengguna mengakses informasi secara bersamaan.", kuis: [{ type: "pilihan-ganda", pertanyaan: "Bahasa yang umum digunakan untuk query basis data adalah...", pilihan: ["HTML","SQL","CSS"], jawaban: "SQL", hint: "Structured Query Language." }] },
                            jaringan: { judul: "Jaringan Komputer", konten: "<p>Dasar TCP/IP, model OSI, alamat IP, dan cara data berpindah antar komputer.</p>", funFact: "Internet awalnya dikembangkan oleh ARPANET sebagai proyek penelitian militer dan akademik.", kuis: [{ type: "pilihan-ganda", pertanyaan: "Alamat unik pada setiap perangkat di jaringan disebut...", pilihan: ["Port","IP address","Hostname"], jawaban: "IP address", hint: "Seperti alamat rumah di internet." }] },
                            keamanan_siber: { judul: "Keamanan Siber", konten: "<p>Prinsip dasar keamanan: enkripsi, autentikasi, dan praktik aman saat berselancar.</p>", funFact: "Serangan siber bisa menargetkan individu maupun infrastruktur penting negara.", kuis: [{ type: "pilihan-ganda", pertanyaan: "Salah satu cara melindungi akun online adalah...", pilihan: ["Menggunakan password sederhana","Berbagi password","Menggunakan 2FA"], jawaban: "Menggunakan 2FA", hint: "Autentikasi dua faktor." }] },
                            pengembangan_web: { judul: "Web Development", konten: "<p>HTML, CSS, dan JavaScript sebagai pondasi pembuatan situs web.</p>", funFact: "Website statis dulu lebih umum; sekarang banyak aplikasi web yang berjalan sepenuhnya di browser.", kuis: [{ type: "pilihan-ganda", pertanyaan: "Bahasa yang digunakan untuk menata tampilan web adalah...", pilihan: ["HTML","CSS","SQL"], jawaban: "CSS", hint: "Untuk styling." }] },
                            mobile: { judul: "Aplikasi Mobile", konten: "<p>Perbedaan native vs hybrid, dan konsep UI/UX pada perangkat mobile.</p>", funFact: "Aplikasi mobile membuka peluang baru untuk layanan instan di genggaman kita.", kuis: [{ type: "pilihan-ganda", pertanyaan: "Platform mobile populer termasuk...", pilihan: ["Windows Phone","Android","Symbian"], jawaban: "Android", hint: "Sistem operasi mobile paling banyak digunakan." }] },
                            kecerdasan_buatan: { judul: "Pengantar AI", konten: "<p>Konsep dasar pembelajaran mesin, klasifikasi, dan penerapan sederhana.</p>", funFact: "AI digunakan mulai dari rekomendasi film hingga mobil tanpa pengemudi (self-driving).", kuis: [{ type: "pilihan-ganda", pertanyaan: "Pembelajaran mesin termasuk cabang dari...", pilihan: ["Biologi","Kecerdasan Buatan","Geografi"], jawaban: "Kecerdasan Buatan", hint: "Membuat mesin belajar dari data." }] },
                            etika_digital: { judul: "Etika Digital", konten: "<p>Isu privasi, hak cipta, dan tanggung jawab pengguna di dunia digital.</p>", funFact: "Perilaku online juga memiliki konsekuensi hukum dan sosial di dunia nyata.", kuis: [{ type: "pilihan-ganda", pertanyaan: "Salah satu prinsip etika digital adalah...", pilihan: ["Membagikan password orang lain","Menghormati privasi","Mengunduh tanpa izin"], jawaban: "Menghormati privasi", hint: "Perlakukan data orang lain seperti kamu ingin diperlakukan." }] }
                        }
                    }
                }
            },
            kuliah: {
                dunia: {
                    filsafat_kuliah: {
                        namaDunia: "Fakultas Filsafat", warna: "stone", icon: "🤔", deskripsi: "Menggali pertanyaan mendasar tentang eksistensi, pengetahuan, dan etika.",
                        subMateri: {
                            rasionalisme_empirisme: { judul: "Akal vs Pengalaman", konten: "<p>Rasionalisme (Plato, Descartes) berpendapat bahwa pengetahuan sejati berasal dari akal budi (reason). Empirisme (Aristoteles, Locke) berpendapat pengetahuan berasal dari pengalaman indrawi (experience).</p>", funFact: "Perdebatan antara rasionalisme dan empirisme membentuk dasar dari sebagian besar filsafat Barat modern.", kuis: [{ type: "pilihan-ganda", pertanyaan: "Filusuf yang terkenal dengan ucapan 'Aku berpikir, maka aku ada' ('Cogito, ergo sum') adalah penganut aliran?", pilihan: ["Empirisme", "Rasionalisme", "Eksistensialisme"], jawaban: "Rasionalisme", hint: "Mendahulukan akal di atas segalanya." }] },
                            metafisika: { judul: "Hakikat Realitas", konten: "<p>Metafisika adalah cabang filsafat yang mempertanyakan hakikat dasar dari realitas. Apa itu 'ada'? Apa itu ruang dan waktu?</p>", funFact: "Nama 'metafisika' berasal dari karya Aristoteles yang secara harfiah ditempatkan 'setelah fisika' (meta ta physika) dalam koleksi tulisannya.", kuis: [{ type: "pilihan-ganda", pertanyaan: "Studi filosofis tentang 'keberadaan' atau 'being' disebut...", pilihan: ["Epistemologi", "Etika", "Ontologi"], jawaban: "Ontologi", hint: "Ini adalah cabang utama dari metafisika." }] },
                            etika: { judul: "Baik dan Buruk", konten: "<p>Etika mempelajari prinsip-prinsip moral. Deontologi (Kant) fokus pada kewajiban, sementara Utilitarianisme (Bentham, Mill) fokus pada hasil atau konsekuensi yang paling menguntungkan banyak orang.</p>", funFact: "Dilema troli (Trolley Problem) adalah eksperimen pikiran yang sering digunakan untuk menguji intuisi etis antara deontologi dan utilitarianisme.", kuis: [{ type: "pilihan-ganda", pertanyaan: "Aliran etika yang menilai tindakan berdasarkan hasilnya adalah...", pilihan: ["Deontologi", "Etika Kebajikan", "Utilitarianisme"], jawaban: "Utilitarianisme", hint: "The greatest good for the greatest number." }] },
                            epistemologi: { judul: "Batas Pengetahuan", konten: "<p>Epistemologi adalah cabang filsafat yang berfokus pada pengetahuan itu sendiri. Apa itu pengetahuan? Bagaimana kita mendapatkannya? Apa yang bisa kita ketahui?</p>", funFact: "Masalah Gettier adalah tantangan terkenal dalam epistemologi yang mempertanyakan definisi klasik pengetahuan sebagai 'kepercayaan sejati yang dapat dibenarkan'.", kuis: [{ type: "pilihan-ganda", pertanyaan: "Cabang filsafat yang mempelajari tentang pengetahuan disebut...", pilihan: ["Metafisika", "Epistemologi", "Estetika"], jawaban: "Epistemologi", hint: "Berasal dari kata Yunani 'episteme' (pengetahuan)." }] },
                            filsafat_politik: { judul: "Kontrak Sosial", konten: "<p>Teori kontrak sosial (Hobbes, Locke, Rousseau) berpendapat bahwa negara dan otoritas pemerintah dibenarkan karena adanya persetujuan (kontrak) dari individu untuk keluar dari 'keadaan alamiah'.</p>", funFact: "Thomas Hobbes menggambarkan keadaan alamiah sebagai 'perang semua melawan semua', di mana hidup itu 'soliter, miskin, keji, brutal, dan singkat'.", kuis: [{ type: "pilihan-ganda", pertanyaan: "Filusuf yang berpendapat manusia lahir sebagai 'tabula rasa' atau kertas kosong adalah...", pilihan: ["Hobbes", "Locke", "Rousseau"], jawaban: "Locke", hint: "Gagasannya sangat mempengaruhi deklarasi kemerdekaan AS." }] },
                            eksistensialisme: { judul: "Eksistensi Mendahului Esensi", konten: "<p>Eksistensialisme (Sartre, Camus) adalah aliran filsafat yang menekankan kebebasan individu, tanggung jawab, dan subjektivitas. Manusia pertama-tama ada, baru kemudian mendefinisikan dirinya sendiri.</p>", funFact: "Jean-Paul Sartre pernah menolak Hadiah Nobel Sastra karena ia tidak ingin 'diubah' oleh institusi.", kuis: [{ type: "pilihan-ganda", pertanyaan: "Konsep utama dalam eksistensialisme yang menyatakan bahwa hidup tidak memiliki makna inheren adalah...", pilihan: ["Absurdisme", "Nihilisme", "Determinisme"], jawaban: "Absurdisme", hint: "Terutama dikaitkan dengan Albert Camus." }] },
                            post_strukturalisme: { judul: "Dekonstruksi Makna", konten: "<p>Post-strukturalisme (Derrida, Foucault) mengkritik gagasan bahwa ada struktur universal yang stabil dalam makna, bahasa, dan masyarakat. Mereka menekankan ketidakstabilan makna.</p>", funFact: "Jacques Derrida memperkenalkan konsep 'dekonstruksi', yaitu membongkar teks untuk melihat asumsi-asumsi yang tersembunyi.", kuis: [{ type: "pilihan-ganda", pertanyaan: "Michel Foucault terkenal dengan analisisnya tentang hubungan antara pengetahuan dan...", pilihan: ["Ekonomi", "Kekuasaan", "Seni"], jawaban: "Kekuasaan", hint: "Knowledge is power." }] },
                            logika: { judul: "Seni Berpikir Lurus", konten: "<p>Logika adalah studi tentang penalaran yang valid. Silogisme Aristoteles adalah contoh klasik: Jika semua manusia fana (premis 1) dan Socrates adalah manusia (premis 2), maka Socrates fana (kesimpulan).</p>", funFact: "Kesalahan logika (logical fallacy) seperti 'ad hominem' (menyerang orangnya, bukan argumennya) sering terjadi dalam debat sehari-hari.", kuis: [{ type: "pilihan-ganda", pertanyaan: "Kesimpulan yang ditarik dari dua premis atau lebih disebut...", pilihan: ["Proposisi", "Argumen", "Deduksi"], jawaban: "Deduksi", hint: "Dari umum ke khusus." }] },
                            filsafat_timur: { judul: "Jalan Tao dan Zen", konten: "<p>Filsafat Timur, seperti Taoisme dan Zen Buddhisme, seringkali lebih fokus pada harmoni, keseimbangan, dan pengalaman langsung daripada analisis logis Barat.</p>", funFact: "Konsep Yin dan Yang dalam Taoisme melambangkan dualitas yang saling melengkapi dan membentuk keseluruhan yang seimbang.", kuis: [{ type: "pilihan-ganda", pertanyaan: "Konsep 'Wu Wei' dalam Taoisme berarti...", pilihan: ["Bekerja keras", "Tindakan tanpa usaha (effortless action)", "Meditasi mendalam"], jawaban: "Tindakan tanpa usaha (effortless action)", hint: "Mengalir bersama alam." }] },
                            estetika: { judul: "Apa itu Keindahan?", konten: "<p>Estetika adalah cabang filsafat yang membahas sifat seni, keindahan, dan selera. Apakah keindahan itu objektif atau subjektif?</p>", funFact: "Immanuel Kant berpendapat bahwa penilaian keindahan bersifat subjektif namun universal, artinya kita berharap orang lain setuju dengan kita.", kuis: [{ type: "pilihan-ganda", pertanyaan: "Konsep 'katarsis' atau pemurnian emosi melalui seni pertama kali diperkenalkan oleh...", pilihan: ["Plato", "Aristoteles", "Nietzsche"], jawaban: "Aristoteles", hint: "Dalam konteks drama tragedi Yunani." }] }
                        }
                    },
                    psikologi_kuliah: {
                        namaDunia: "Kajian Psikologi", warna: "fuchsia", icon: "🧠", deskripsi: "Memahami pikiran, perasaan, dan perilaku manusia melalui berbagai teori.",
                        subMateri: {
                            psikoanalisis: { judul: "Peta Pikiran Freud", konten: "<p>Sigmund Freud memperkenalkan konsep ketidaksadaran (unconscious mind) serta struktur kepribadian id, ego, dan superego yang mempengaruhi perilaku manusia.</p>", funFact: "Freud percaya bahwa mimpi adalah 'jalan utama menuju alam bawah sadar'.", kuis: [{ type: "pilihan-ganda", pertanyaan: "Menurut Freud, bagian kepribadian yang bekerja berdasarkan prinsip kesenangan (pleasure principle) adalah?", pilihan: ["Ego", "Superego", "Id"], jawaban: "Id", hint: "Dorongan paling dasar dan primitif." }] },
                            behaviorisme: { judul: "Belajar dari Lingkungan", konten: "<p>Behaviorisme (Pavlov, Skinner) berfokus pada perilaku yang dapat diamati dan bagaimana perilaku itu dibentuk oleh lingkungan melalui pengkondisian (conditioning).</p>", funFact: "Eksperimen 'Anjing Pavlov' menunjukkan bahwa respons fisiologis seperti mengeluarkan air liur dapat dikondisikan terhadap rangsangan netral seperti bunyi bel.", kuis: [{ type: "pilihan-ganda", pertanyaan: "Dalam 'Skinner Box', seekor tikus belajar menekan tuas untuk mendapatkan makanan. Ini adalah contoh dari...", pilihan: ["Pengkondisian Klasik", "Pengkondisian Operan", "Belajar Laten"], jawaban: "Pengkondisian Operan", hint: "Perilaku dikendalikan oleh konsekuensi (ganjaran/hukuman)." }] },
                            humanisme: { judul: "Potensi Diri Manusia", konten: "<p>Psikologi Humanistik (Maslow, Rogers) menentang pandangan pesimistis psikoanalisis dan behaviorisme, dengan fokus pada kehendak bebas, pertumbuhan pribadi, dan aktualisasi diri.</p>", funFact: "Puncak dari Hierarki Kebutuhan Maslow adalah 'aktualisasi diri', yaitu pencapaian potensi penuh seseorang.", kuis: [{ type: "pilihan-ganda", pertanyaan: "Hierarki Kebutuhan yang terkenal digagas oleh...", pilihan: ["Carl Rogers", "Abraham Maslow", "B.F. Skinner"], jawaban: "Abraham Maslow", hint: "Bentuknya seperti piramida." }] },
                            kognitif: { judul: "Revolusi Kognitif", konten: "<p>Psikologi kognitif mempelajari proses mental internal seperti berpikir, memori, persepsi, dan pemecahan masalah. Manusia dipandang sebagai pemroses informasi aktif.</p>", funFact: "Analogi pikiran sebagai komputer adalah metafora sentral dalam psikologi kognitif awal.", kuis: [{ type: "pilihan-ganda", pertanyaan: "Studi tentang bagaimana kita memperoleh, menyimpan, dan mengambil informasi disebut studi tentang...", pilihan: ["Persepsi", "Memori", "Atensi"], jawaban: "Memori", hint: "Penyimpanan informasi di otak." }] },
                            perkembangan: { judul: "Tahapan Hidup Piaget", konten: "<p>Psikologi perkembangan mempelajari perubahan psikologis sepanjang rentang hidup. Jean Piaget terkenal dengan teori empat tahap perkembangan kognitif anak.</p>", funFact: "Menurut Piaget, anak-anak kecil belum mengembangkan 'konservasi', yaitu pemahaman bahwa kuantitas tetap sama meskipun bentuknya berubah.", kuis: [{ type: "pilihan-ganda", pertanyaan: "Tahap perkembangan kognitif di mana anak mulai berpikir logis tentang peristiwa konkret adalah...", pilihan: ["Sensorimotor", "Praoperasional", "Operasional Konkret"], jawaban: "Operasional Konkret", hint: "Terjadi pada usia sekitar 7-11 tahun." }] },
                            sosial: { judul: "Individu dalam Kelompok", konten: "<p>Psikologi sosial mempelajari bagaimana pikiran, perasaan, dan perilaku individu dipengaruhi oleh kehadiran orang lain. Contoh: konformitas, kepatuhan, prasangka.</p>", funFact: "Eksperimen Penjara Stanford menunjukkan betapa kuatnya peran sosial dapat mempengaruhi perilaku seseorang, bahkan hingga ke tingkat ekstrem.", kuis: [{ type: "pilihan-ganda", pertanyaan: "Kecenderungan untuk setuju dengan kelompok meskipun kita tahu itu salah disebut...", pilihan: ["Kepatuhan", "Konformitas", "Disosiasi"], jawaban: "Konformitas", hint: "Eksperimen garis Asch adalah contoh klasiknya." }] },
                            abnormal: { judul: "Kesehatan Mental", konten: "<p>Psikologi abnormal mempelajari pola perilaku, emosi, dan pikiran yang tidak biasa, yang dapat dianggap sebagai gangguan mental. DSM-5 adalah manual diagnostiknya.</p>", funFact: "Homoseksualitas pernah tercantum dalam DSM sebagai gangguan mental hingga tahun 1973.", kuis: [{ type: "pilihan-ganda", pertanyaan: "Manual diagnostik yang digunakan secara luas untuk gangguan mental adalah...", pilihan: ["ICD-10", "DSM-5", "PPDGJ"], jawaban: "DSM-5", hint: "Diterbitkan oleh American Psychiatric Association." }] },
                            persepsi: { judul: "Melihat Dunia", konten: "<p>Sensasi adalah proses indra menerima rangsangan. Persepsi adalah proses otak mengorganisir dan menginterpretasikan sensasi tersebut menjadi sesuatu yang bermakna.</p>", funFact: "Otak kita terus-menerus membuat 'tebakan terbaik' tentang dunia luar berdasarkan informasi sensorik yang tidak lengkap, yang kadang-kadang menyebabkan ilusi optik.", kuis: [{ type: "pilihan-ganda", pertanyaan: "Prinsip Gestalt dalam persepsi menekankan bahwa...", pilihan: ["Keseluruhan lebih dari jumlah bagian-bagiannya", "Bagian-bagian lebih penting dari keseluruhan", "Persepsi selalu akurat"], jawaban: "Keseluruhan lebih dari jumlah bagian-bagiannya", hint: "Otak kita cenderung mengorganisir menjadi pola yang utuh." }] },
                            memori: { judul: "Arsip Pikiran", konten: "<p>Memori bukanlah satu hal tunggal, melainkan sistem yang kompleks, termasuk memori sensorik, jangka pendek (working memory), dan jangka panjang (eksplisit dan implisit).</p>", funFact: "Efek 'ujung lidah' (tip-of-the-tongue) terjadi ketika kita merasa tahu suatu informasi tetapi sulit untuk mengambilnya dari memori jangka panjang.", kuis: [{ type: "pilihan-ganda", pertanyaan: "Memori untuk keterampilan dan kebiasaan, seperti bersepeda, disebut memori...", pilihan: ["Episodik", "Semantik", "Prosedural"], jawaban: "Prosedural", hint: "Ini adalah bagian dari memori implisit (tidak sadar)." }] },
                            inteligensi: { judul: "Mengukur Kecerdasan", konten: "<p>Inteligensi adalah kemampuan untuk belajar dari pengalaman, memecahkan masalah, dan beradaptasi. Teori modern, seperti teori Howard Gardner, menyatakan ada berbagai jenis kecerdasan (multiple intelligences).</p>", funFact: "Efek Flynn adalah pengamatan bahwa skor IQ rata-rata di banyak bagian dunia meningkat secara substansial sepanjang abad ke-20.", kuis: [{ type: "pilihan-ganda", pertanyaan: "Kecerdasan musikal dan spasial adalah bagian dari teori...", pilihan: ["Inteligensi Umum (g factor)", "Inteligensi Ganda (Multiple Intelligences)", "Inteligensi Triarkis"], jawaban: "Inteligensi Ganda (Multiple Intelligences)", hint: "Digagas oleh Howard Gardner." }] }
                        }
                    },
                    hukum_kuliah: {
                        namaDunia: "Dasar-Dasar Hukum", warna: "indigo", icon: "⚖️", deskripsi: "Mengenal sistem, prinsip, dan cabang-cabang utama dalam ilmu hukum.",
                        subMateri: {
                            sistem_hukum: { judul: "Civil Law vs Common Law", konten: "<p>Sistem Civil Law (Eropa Kontinental, Indonesia) berbasis pada kodifikasi hukum tertulis. Sistem Common Law (Inggris, AS) berbasis pada preseden atau putusan hakim sebelumnya (yurisprudensi).</p>", funFact: "Negara bagian Louisiana di AS secara unik menggunakan sistem campuran antara civil law dan common law.", kuis: [{ type: "pilihan-ganda", pertanyaan: "Sistem hukum yang dianut oleh negara Indonesia adalah...", pilihan: ["Common Law", "Civil Law", "Hukum Adat"], jawaban: "Civil Law", hint: "Warisan dari sistem hukum Belanda." }] },
                            asas_legalitas: { judul: "Asas Legalitas Pidana", konten: "<p>Asas legalitas (nullum delictum nulla poena sine praevia lege poenali) berarti tidak ada perbuatan yang dapat dihukum kecuali atas kekuatan aturan pidana dalam undang-undang yang telah ada sebelumnya.</p>", funFact: "Asas ini adalah benteng utama melawan kesewenang-wenangan penguasa dalam hukum pidana.", kuis: [{ type: "pilihan-ganda", pertanyaan: "Inti dari asas legalitas adalah...", pilihan: ["Hukuman harus setimpal", "Tidak ada hukuman tanpa undang-undang sebelumnya", "Setiap orang sama di depan hukum"], jawaban: "Tidak ada hukuman tanpa undang-undang sebelumnya", hint: "Prinsip non-retroaktif." }] },
                            subjek_objek_hukum: { judul: "Subjek dan Objek Hukum", konten: "<p>Subjek hukum adalah pendukung hak dan kewajiban (manusia dan badan hukum). Objek hukum adalah segala sesuatu yang bermanfaat bagi subjek hukum dan dapat menjadi objek hubungan hukum (benda).</p>", funFact: "Di beberapa negara, ada perdebatan hukum untuk memberikan status 'subjek hukum non-manusia' kepada hewan atau bahkan alam.", kuis: [{ type: "pilihan-ganda", pertanyaan: "Perusahaan (PT) dalam hukum dianggap sebagai...", pilihan: ["Objek Hukum", "Subjek Hukum Badan Hukum", "Subjek Hukum Manusia"], jawaban: "Subjek Hukum Badan Hukum", hint: "Dapat memiliki aset dan digugat atas namanya sendiri." }] },
                            hukum_perdata: { judul: "Hukum Perikatan", konten: "<p>Hukum perdata mengatur hubungan antar individu. Hukum Perikatan (Buku III KUHPerdata) adalah inti dari hukum perdata, mengatur tentang perjanjian (kontrak) dan perbuatan melawan hukum.</p>", funFact: "Syarat sahnya perjanjian ada empat: sepakat, cakap, suatu hal tertentu, dan sebab yang halal.", kuis: [{ type: "pilihan-ganda", pertanyaan: "Hubungan hukum antara dua pihak atau lebih dalam bidang harta kekayaan disebut...", pilihan: ["Perkawinan", "Perikatan", "Waris"], jawaban: "Perikatan", hint: "Bisa lahir dari perjanjian atau undang-undang." }] },
                            htn: { judul: "Hukum Tata Negara", konten: "<p>Hukum Tata Negara (HTN) mempelajari negara dalam keadaan diam, yaitu tentang organisasi, struktur, dan wewenang lembaga-lembaga negara.</p>", funFact: "Konsep 'Trias Politica' (pemisahan kekuasaan legislatif, eksekutif, yudikatif) yang digagas Montesquieu adalah konsep sentral dalam HTN modern.", kuis: [{ type: "pilihan-ganda", pertanyaan: "Lembaga negara yang memegang kekuasaan legislatif (membuat UU) di Indonesia adalah...", pilihan: ["Presiden", "Mahkamah Agung", "DPR"], jawaban: "DPR", hint: "Dewan Perwakilan Rakyat." }] },
                            han: { judul: "Hukum Administrasi Negara", konten: "<p>Hukum Administrasi Negara (HAN) mempelajari negara dalam keadaan bergerak, yaitu tentang bagaimana pemerintah menjalankan tugasnya dan hubungan hukumnya dengan warga negara.</p>", funFact: "Surat Izin Mengemudi (SIM) atau Izin Mendirikan Bangunan (IMB) adalah contoh produk dari Hukum Administrasi Negara.", kuis: [{ type: "pilihan-ganda", pertanyaan: "Sengketa antara warga negara dengan pejabat pemerintah terkait suatu keputusan (beschikking) diselesaikan di pengadilan...", pilihan: ["Negeri", "Agama", "Tata Usaha Negara (PTUN)"], jawaban: "Tata Usaha Negara (PTUN)", hint: "Mengadili sengketa administrasi." }] },
                            hukum_internasional: { judul: "Hukum Antar Negara", konten: "<p>Hukum Internasional adalah keseluruhan kaidah dan asas hukum yang mengatur hubungan atau persoalan yang melintasi batas negara.</p>", funFact: "Sumber utama hukum internasional adalah perjanjian internasional (traktat) dan kebiasaan internasional.", kuis: [{ type: "pilihan-ganda", pertanyaan: "Mahkamah yang mengadili kejahatan perang dan genosida adalah...", pilihan: ["Mahkamah Internasional (ICJ)", "Pengadilan Kriminal Internasional (ICC)", "Mahkamah Konstitusi"], jawaban: "Pengadilan Kriminal Internasional (ICC)", hint: "ICJ mengadili sengketa antar negara." }] },
                            hierarki_perundangan: { judul: "Tata Urutan Perundangan", konten: "<p>Ada hierarki (tata urutan) peraturan perundang-undangan, di mana peraturan yang lebih rendah tidak boleh bertentangan dengan yang lebih tinggi. UUD 1945 adalah yang tertinggi.</p>", funFact: "Jika sebuah Undang-Undang dianggap bertentangan dengan UUD 1945, ia dapat diuji materi (judicial review) di Mahkamah Konstitusi.", kuis: [{ type: "pilihan-ganda", pertanyaan: "Dalam hierarki perundangan Indonesia, yang kedudukannya paling tinggi adalah...", pilihan: ["Undang-Undang", "Peraturan Pemerintah", "UUD 1945"], jawaban: "UUD 1945", hint: "Konstitusi negara." }] },
                            hukum_acara: { judul: "Hukum Acara Pidana", konten: "<p>Hukum acara (hukum formil) adalah serangkaian aturan untuk menegakkan hukum materiil. Contoh: bagaimana cara polisi menyidik, jaksa menuntut, dan hakim mengadili dalam kasus pidana.</p>", funFact: "Asas 'praduga tak bersalah' (presumption of innocence) adalah pilar utama dalam hukum acara pidana modern.", kuis: [{ type: "pilihan-ganda", pertanyaan: "Pihak yang bertugas membuktikan dakwaan terhadap terdakwa di pengadilan adalah...", pilihan: ["Hakim", "Pengacara", "Jaksa Penuntut Umum"], jawaban: "Jaksa Penuntut Umum", hint: "Mewakili negara/korban." }] },
                            teori_hukum: { judul: "Tujuan Hukum", konten: "<p>Ada berbagai teori tentang tujuan hukum. Teori Etis (Aristoteles) menyatakan tujuan hukum adalah keadilan. Teori Utilitarian (Bentham) adalah kemanfaatan. Teori Yuridis (Austin) adalah kepastian hukum.</p>", funFact: "Gustav Radbruch mencoba menyeimbangkan ketiganya, menyatakan bahwa hukum harus mengandung nilai keadilan, kemanfaatan, dan kepastian.", kuis: [{ type: "pilihan-ganda", pertanyaan: "Teori yang menyatakan tujuan hukum adalah untuk mencapai 'the greatest happiness for the greatest number' adalah teori...", pilihan: ["Etis", "Utilitarian", "Normatif"], jawaban: "Utilitarian", hint: "Fokus pada manfaat atau kegunaan." }] }
                        }
                    },
                     // Dunia-dunia tambahan untuk Kuliah
                    komunikasi_kuliah: {
                        namaDunia: "Teori Komunikasi",
                        warna: "cyan",
                        icon: "📡",
                        deskripsi: "Menganalisis model, media, dan dampak komunikasi dalam masyarakat.",
                        subMateri: {
                            model_komunikasi: { judul: "Model Komunikasi", konten: "<p>Shannon-Weaver, model transaksional, dan elemen dasar komunikasi.</p>", funFact: "Model Shannon awalnya dibuat untuk meningkatkan telekomunikasi.", kuis: [{ type: "pilihan-ganda", pertanyaan: "Komponen yang mengganggu sinyal disebut...", pilihan: ["Sumber","Noise","Encoder"], jawaban: "Noise", hint: "Gangguan transmisi." }] },
                            media_dan_efek: { judul: "Media & Efek", konten: "<p>Bagaimana media membentuk opini dan agenda-setting.</p>", funFact: "Agenda-setting menjelaskan bagaimana media memprioritaskan isu.", kuis: [{ type: "pilihan-ganda", pertanyaan: "Proses media mempengaruhi topik yang dianggap penting disebut...", pilihan: ["Framing","Agenda-setting","Priming"], jawaban: "Agenda-setting", hint: "Memilih apa yang dibicarakan publik." }] },
                            komunikasi_antarbudaya: { judul: "Komunikasi Antarbudaya", konten: "<p>Perbedaan cara berkomunikasi antarbudaya dan kompetensi yang dibutuhkan.</p>", funFact: "Senyum memiliki arti berbeda di beberapa budaya.", kuis: [{ type: "pilihan-ganda", pertanyaan: "Kompetensi antarbudaya penting untuk...", pilihan: ["Menghindari konflik","Meningkatkan stereotip","Menutup dialog"], jawaban: "Menghindari konflik", hint: "Memahami perbedaan budaya." }] },
                            riset_komunikasi: { judul: "Metode Riset", konten: "<p>Survei, wawancara, analisis isi dan etnografi media.</p>", funFact: "Analisis isi dapat menghitung frekuensi tema dalam media.", kuis: [{ type: "pilihan-ganda", pertanyaan: "Metode yang menghasilkan data numerik disebut...", pilihan: ["Kualitatif","Kuantitatif","Naratif"], jawaban: "Kuantitatif", hint: "Angka dan statistik." }] },
                            komunikasi_organisasi: { judul: "Komunikasi Organisasi", konten: "<p>Alur komunikasi formal dan informal serta manajemen krisis.</p>", funFact: "Krisis komunikasi bisa merusak reputasi perusahaan jika tidak ditangani.", kuis: [{ type: "pilihan-ganda", pertanyaan: "Bagian yang menangani hubungan publik disebut...", pilihan: ["HR","Public Relations","IT"], jawaban: "Public Relations", hint: "Hubungan organisasi dengan publik." }] },
                            etika_media: { judul: "Etika & Regulasi", konten: "<p>Isu privasi, sensor, dan tanggung jawab media.</p>", funFact: "Beberapa negara memiliki dewan pers untuk etika jurnalistik.", kuis: [{ type: "pilihan-ganda", pertanyaan: "Prinsip jurnalistik yang penting adalah...", pilihan: ["Kecepatan saja","Verifikasi Fakta","Sensasi"], jawaban: "Verifikasi Fakta", hint: "Pastikan kebenaran berita." }] },
                            komunikasi_digital: { judul: "Komunikasi Digital", konten: "<p>Media sosial, platform digital, dan pola penyebaran daring.</p>", funFact: "Hoaks sering tersebar cepat melalui jaringan sosial.", kuis: [{ type: "pilihan-ganda", pertanyaan: "Salah satu tantangan media sosial adalah...", pilihan: ["Kecepatan verifikasi","Biaya produksi tinggi","Tidak ada jangkauan"], jawaban: "Kecepatan verifikasi", hint: "Informasi menyebar cepat." }] },
                            persuasi_dan_iklan: { judul: "Persuasi & Iklan", konten: "<p>Teknik persuasi dalam iklan dan propaganda.</p>", funFact: "Iklan sering menggunakan psikologi untuk membentuk preferensi konsumen.", kuis: [{ type: "pilihan-ganda", pertanyaan: "Elemen persuasi yang kuat salah satunya adalah...", pilihan: ["Ketidakkonsistenan","Emosi","Acuh"], jawaban: "Emosi", hint: "Memengaruhi keputusan pembeli." }] },
                            komunikasi_politik: { judul: "Komunikasi Politik", konten: "<p>Kampanye, framing isu, dan efek opini publik.</p>", funFact: "Kampanye modern memanfaatkan data untuk menargetkan pemilih.", kuis: [{ type: "pilihan-ganda", pertanyaan: "Strategi komunikasi yang menekankan tema disebut...", pilihan: ["Framing","Encoding","Decoding"], jawaban: "Framing", hint: "Menentukan sudut pandang." }] },
                            analisis_media: { judul: "Analisis Isi", konten: "<p>Menganalisis konten media untuk menemukan pola dan bias.</p>", funFact: "Analisis media dapat menunjukkan kecenderungan ideologi.", kuis: [{ type: "pilihan-ganda", pertanyaan: "Analisis isi biasanya mengkaji...", pilihan: ["Konten teks saja","Polanya dalam teks/media","Hanya gambar"], jawaban: "Polanya dalam teks/media", hint: "Mencari pola topik." }] },
                            studi_kasus: { judul: "Studi Kasus Media", konten: "<p>Mengkaji kasus nyata kampanye atau peliputan penting.</p>", funFact: "Studi kasus sering dipakai untuk mengajarkan strategi komunikasi.", kuis: [{ type: "pilihan-ganda", pertanyaan: "Metode yang cocok untuk memahami konteks mendalam adalah...", pilihan: ["Eksperimen","Studi Kasus","Sensus"], jawaban: "Studi Kasus", hint: "Analisis kontekstual." }] }
                        }
                    },

                    manajemen_kuliah: {
                        namaDunia: "Manajemen Strategis",
                        warna: "amber",
                        icon: "📊",
                        deskripsi: "Mempelajari perencanaan, analisis SWOT, dan pengambilan keputusan dalam bisnis.",
                        subMateri: {
                            dasar_manajemen: { judul: "Dasar Manajemen", konten: "<p>Fungsi manajemen: perencanaan, pengorganisasian, pengarahan, dan pengendalian.</p>", funFact: "Istilah manajemen modern berkembang pesat sejak revolusi industri.", kuis: [{ type: "pilihan-ganda", pertanyaan: "Fungsi manajemen yang menetapkan tujuan adalah...", pilihan: ["Perencanaan","Pengorganisasian","Pengendalian"], jawaban: "Perencanaan", hint: "Menentukan tujuan dan langkah." }] },
                            analisis_swot: { judul: "SWOT", konten: "<p>Analisis Strengths, Weaknesses, Opportunities, Threats untuk strategi bisnis.</p>", funFact: "SWOT sering dipakai untuk merumuskan strategi perusahaan.", kuis: [{ type: "pilihan-ganda", pertanyaan: "Elemen SWOT yang merupakan faktor internal positif adalah...", pilihan: ["Threats","Strengths","Opportunities"], jawaban: "Strengths", hint: "Kekuatan internal." }] },
                            strategi_corporate: { judul: "Strategi Korporasi", konten: "<p>Diferensiasi, kepemimpinan biaya, dan fokus sebagai strategi bisnis umum.</p>", funFact: "Perusahaan sukses biasanya konsisten pada strategi jangka panjang.", kuis: [{ type: "pilihan-ganda", pertanyaan: "Strategi yang menekankan penawaran unik disebut...", pilihan: ["Diferensiasi","Kepemimpinan Biaya","Diversifikasi"], jawaban: "Diferensiasi", hint: "Fokus pada nilai unik." }] },
                            manajemen_proyek: { judul: "Manajemen Proyek", konten: "<p>Kerangka PMBOK, jadwal, dan pengelolaan sumber daya.</p>", funFact: "Proyek yang buruk dirancang sering berakhir melewati anggaran.", kuis: [{ type: "pilihan-ganda", pertanyaan: "Salah satu alat manajemen proyek adalah...", pilihan: ["Gantt Chart","T-scheme","Heatmap"], jawaban: "Gantt Chart", hint: "Menunjukkan jadwal proyek." }] },
                            kepemimpinan: { judul: "Kepemimpinan", konten: "<p>Gaya kepemimpinan, motivasi tim, dan pengembangan SDM.</p>", funFact: "Kepemimpinan transformasional sering dikaitkan dengan inovasi.", kuis: [{ type: "pilihan-ganda", pertanyaan: "Gaya kepemimpinan yang memberi arah dan inspirasi disebut...", pilihan: ["Transaksional","Transformasional","Laissez-faire"], jawaban: "Transformasional", hint: "Mendorong perubahan dan visi." }] },
                            pemasaran_dasar: { judul: "Pemasaran", konten: "<p>4P pemasaran: Product, Price, Place, Promotion dan segmentasi pasar.</p>", funFact: "Segmentasi pasar membantu menargetkan produk ke konsumen tertentu.", kuis: [{ type: "pilihan-ganda", pertanyaan: "Salah satu elemen 4P adalah...", pilihan: ["People","Place","Profit"], jawaban: "Place", hint: "Distribusi produk." }] },
                            analisis_keuangan: { judul: "Analisis Keuangan", konten: "<p>Dasar laporan keuangan: neraca, laba-rugi, dan arus kas.</p>", funFact: "Arus kas adalah indikator kesehatan perusahaan.", kuis: [{ type: "pilihan-ganda", pertanyaan: "Laporan yang menunjukkan keuntungan perusahaan disebut...", pilihan: ["Neraca","Laba-Rugi","Arus Kas"], jawaban: "Laba-Rugi", hint: "Pendapatan dikurangi biaya." }] },
                            etika_bisnis: { judul: "Etika Bisnis", konten: "<p>Corporate governance, tanggung jawab sosial perusahaan, dan kepatuhan hukum.</p>", funFact: "Perusahaan yang mengabaikan etika berisiko kehilangan kepercayaan publik.", kuis: [{ type: "pilihan-ganda", pertanyaan: "Tanggung jawab sosial perusahaan sering disingkat...", pilihan: ["CSR","KPI","ROI"], jawaban: "CSR", hint: "Corporate Social Responsibility." }] },
                            inovasi: { judul: "Inovasi & Change", konten: "<p>Proses inovasi produk dan manajemen perubahan organisasi.</p>", funFact: "Inovasi sering muncul dari percobaan kecil dan iterasi cepat.", kuis: [{ type: "pilihan-ganda", pertanyaan: "Siklus pengembangan yang cepat sering disebut...", pilihan: ["Waterfall","Agile","Batch"], jawaban: "Agile", hint: "Iterasi dan umpan balik." }] },
                            studi_kasus_manajemen: { judul: "Studi Kasus Bisnis", konten: "<p>Analisis kasus nyata untuk menerapkan konsep manajemen strategis.</p>", funFact: "Studi kasus populer sering muncul dari perusahaan teknologi besar.", kuis: [{ type: "pilihan-ganda", pertanyaan: "Metode yang cocok untuk memahami konteks manajerial adalah...", pilihan: ["Eksperimen","Studi Kasus","Survey Cepat"], jawaban: "Studi Kasus", hint: "Pendekatan kontekstual." }] }
                        }
                    },

                    teknik_kuliah: { namaDunia: "Jantung Teknik Mesin", warna: "slate", icon: "⚙️", deskripsi: "Memahami dasar-dasar termodinamika, statika, dan dinamika.", subMateri: {
                        statika: { judul: "Statika", konten: "<p>Analisis gaya pada benda diam, kesetimbangan gaya dan momen.</p>", funFact: "Konsep momen gaya adalah kunci untuk desain struktur sederhana.", kuis: [{ type: 'pilihan-ganda', pertanyaan: 'Jika resultan gaya nol dan momen nol, benda berada dalam...', pilihan: ['Gerak','Kesetimbangan','Getaran'], jawaban: 'Kesetimbangan', hint: 'Tidak ada percepatan.' }] },
                        dinamika: { judul: "Dinamika", konten: "<p>Hukum Newton, gerak, dan gaya pada benda yang bergerak.</p>", funFact: "Hukum kedua Newton (F=ma) menghubungkan gaya dan percepatan.", kuis: [{ type: 'pilihan-ganda', pertanyaan: 'Rumus dasar hukum kedua Newton adalah...', pilihan: ['F=ma','E=mc2','pV=nRT'], jawaban: 'F=ma', hint: 'Force = mass x acceleration.' }] },
                        termodinamika: { judul: "Termodinamika", konten: "<p>Hukum termodinamika, energi internal, dan efisiensi mesin.</p>", funFact: "Hukum kedua termodinamika memperkenalkan konsep entropi.", kuis: [{ type: 'pilihan-ganda', pertanyaan: 'Hukum termodinamika yang menyatakan entropi meningkat adalah hukum nomor...', pilihan: ['1','2','3'], jawaban: '2', hint: 'Kecenderungan ketidakteraturan meningkat.' }] },
                        mekanika_fluid: { judul: "Mekanika Fluida", konten: "<p>Aliran fluida, tekanan, dan prinsip Bernoulli.</p>", funFact: "Prinsip Bernoulli menjelaskan mengapa pesawat bisa terangkat.", kuis: [{ type: 'pilihan-ganda', pertanyaan: 'Prinsip yang berhubungan dengan tekanan dan kecepatan fluida adalah...', pilihan: ['Bernoulli','Ohm','Hooke'], jawaban: 'Bernoulli', hint: 'Kecepatan tinggi → tekanan rendah.' }] },
                        material: { judul: "Sifat Material", konten: "<p>Sifat mekanik material: tegangan, regangan, modulus elastisitas.</p>", funFact: "Pemilihan material yang tepat kritis untuk keselamatan struktur.", kuis: [{ type: 'pilihan-ganda', pertanyaan: 'Modulus elastisitas mengukur...', pilihan: ['Kekuatan tarik','Kekakuan','Kerapuhan'], jawaban: 'Kekakuan', hint: 'Rasio tegangan terhadap regangan.' }] },
                        mekanika_material: { judul: "Kekuatan Material", konten: "<p>Analisis tegangan, batas leleh, dan faktor keselamatan dalam desain.</p>", funFact: "Faktor keselamatan biasanya dipilih berdasarkan risiko dan ketidakpastian material.", kuis: [{ type: 'pilihan-ganda', pertanyaan: 'Sebuah faktor keselamatan >1 berarti desain...', pilihan: ['Lebih Aman','Berbahaya','Lebih Murah'], jawaban: 'Lebih Aman', hint: 'Memberi margin keamanan.' }] },
                        kontrol: { judul: "Sistem Kontrol", konten: "<p>Dasar sistem kontrol umpan balik, PID controller, dan stabilitas sistem.</p>", funFact: "PID controller banyak dipakai pada sistem otomasi industri.", kuis: [{ type: 'pilihan-ganda', pertanyaan: 'Singkatan PID pada kontroler berarti...', pilihan: ['Proporsional-Integral-Derivatif','Proactive-Immediate-Delayed','Passive-Integral-Derivative'], jawaban: 'Proporsional-Integral-Derivatif', hint: 'Tiga komponen korektif.' }] },
                        produksi: { judul: "Manufaktur", konten: "<p>Proses manufaktur, toleransi, dan perencanaan produksi dasar.</p>", funFact: "Lean manufacturing menekankan pengurangan pemborosan dalam produksi.", kuis: [{ type: 'pilihan-ganda', pertanyaan: 'Metode yang menekankan pengurangan pemborosan disebut...', pilihan: ['Lean','Six Sigma','Waterfall'], jawaban: 'Lean', hint: 'Fokus pada efisiensi.' }] },
                        energi_terbarukan: { judul: "Energi Terbarukan", konten: "<p>Dasar pembangkit energi angin, surya, dan efisiensi energi.</p>", funFact: "Energi terbarukan membantu mengurangi ketergantungan pada bahan bakar fosil.", kuis: [{ type: 'pilihan-ganda', pertanyaan: 'Contoh energi terbarukan adalah...', pilihan: ['Minyak Bumi','Batu Bara','Energi Surya'], jawaban: 'Energi Surya', hint: 'Sumber energi dapat diperbarui.' }] },
                        studi_kasus_teknik: { judul: "Studi Kasus Teknik", konten: "<p>Analisis contoh nyata perancangan mesin sederhana atau sistem termal.</p>", funFact: "Banyak solusi teknik lahir dari kebutuhan praktis dalam proyek dunia nyata.", kuis: [{ type: 'pilihan-ganda', pertanyaan: 'Analisis kasus teknik berguna untuk...', pilihan: ['Teori murni','Aplikasi praktis','Hanya histori'], jawaban: 'Aplikasi praktis', hint: 'Menerapkan teori ke masalah nyata.' }] }
                    } },

                    informatika_kuliah: { namaDunia: "Arsitektur Perangkat Lunak", warna: "blue", icon: "💾", deskripsi: "Mempelajari siklus hidup pengembangan software dan design patterns.", subMateri: {
                        rekayasa_perangkat_lunak: { judul: "SDLC", konten: "<p>Siklus hidup pengembangan perangkat lunak: requirement, design, implementasi, testing, deployment.</p>", funFact: "Model Agile populer karena iterasi cepat dan feedback pengguna.", kuis: [{ type: 'pilihan-ganda', pertanyaan: 'Fase yang biasanya melakukan pengujian adalah...', pilihan: ['Requirement','Testing','Deployment'], jawaban: 'Testing', hint: 'Pastikan kualitas sebelum rilis.' }] },
                        desain_arsitektur: { judul: "Desain Arsitektur", konten: "<p>Monolitik vs microservices, layering, dan trade-offs arsitektural.</p>", funFact: "Microservices membantu skala layanan independen tapi menambah kompleksitas operasional.", kuis: [{ type: 'pilihan-ganda', pertanyaan: 'Arsitektur yang memisahkan layanan menjadi modul independen disebut...', pilihan: ['Monolitik','Microservices','Layered'], jawaban: 'Microservices', hint: 'Layanan kecil terpisah.' }] },
                        pola_desain: { judul: "Design Patterns", konten: "<p>Factory, Singleton, Observer, dan bagaimana pola membantu desain yang dapat dipelihara.</p>", funFact: "Design patterns pertama kali dikodifikasi oleh Gang of Four (GoF).", kuis: [{ type: 'pilihan-ganda', pertanyaan: 'Pattern yang memastikan hanya ada satu instance suatu kelas disebut...', pilihan: ['Factory','Adapter','Singleton'], jawaban: 'Singleton', hint: 'Satu-satunya instance.' }] },
                        pengujian: { judul: "Pengujian Perangkat Lunak", konten: "<p>Unit test, integration test, dan automated testing pipelines.</p>", funFact: "TDD (Test-Driven Development) menulis tes sebelum kode fungsionalnya.", kuis: [{ type: 'pilihan-ganda', pertanyaan: 'Tes yang memeriksa fungsi terkecil disebut...', pilihan: ['Integration','Unit','System'], jawaban: 'Unit', hint: 'Bagian paling kecil kode.' }] },
                        devops: { judul: "DevOps & CI/CD", konten: "<p>Integrasi berkelanjutan, pengiriman berkelanjutan, dan infrastruktur sebagai kode.</p>", funFact: "CI/CD mempercepat rilis fitur dan mengurangi risiko integrasi.", kuis: [{ type: 'pilihan-ganda', pertanyaan: 'CI singkatan dari...', pilihan: ['Continuous Integration','Continuous Improvement','Code Integration'], jawaban: 'Continuous Integration', hint: 'Gabungan kode otomatis.' }] },
                        keamanan_perangkat_lunak: { judul: "Keamanan", konten: "<p>Prinsip secure coding, OWASP Top 10, dan enkripsi dasar.</p>", funFact: "OWASP Top 10 membantu developer memahami risiko keamanan web umum.", kuis: [{ type: 'pilihan-ganda', pertanyaan: 'Salah satu risiko keamanan web adalah...', pilihan: ['XSS','UI Bug','Typography'], jawaban: 'XSS', hint: 'Cross-site scripting.' }] },
                        basis_data_lanjut: { judul: "Database", konten: "<p>Normalisasi, index, transaksi, dan NoSQL vs SQL trade-offs.</p>", funFact: "Index yang tepat dapat membuat query 100x lebih cepat.", kuis: [{ type: 'pilihan-ganda', pertanyaan: 'Transaksi memastikan sifat apa (ACID)?', pilihan: ['Atomicity','Availability','Integrity'], jawaban: 'Atomicity', hint: 'Seluruh operasi berhasil atau gagal semuanya.' }] },
                        arsitektur_kinerja: { judul: "Kinerja & Skalabilitas", konten: "<p>Caching, load balancing, dan strategi skala horizontal vs vertikal.</p>", funFact: "Caching sering menjadi solusi pertama untuk meningkatkan kinerja aplikasi web.", kuis: [{ type: 'pilihan-ganda', pertanyaan: 'Caching biasanya menyimpan data di...', pilihan: ['Disk saja','Memory','Printer'], jawaban: 'Memory', hint: 'Akses lebih cepat.' }] },
                        etika_digital_kuliah: { judul: "Etika Digital", konten: "<p>Privasi, bias algoritma, dan tanggung jawab rekayasa perangkat lunak.</p>", funFact: "Algoritma yang bias dapat memperkuat ketidakadilan sosial jika tidak diawasi.", kuis: [{ type: 'pilihan-ganda', pertanyaan: 'Salah satu contoh isu etika pada AI adalah...', pilihan: ['Efisiensi','Bias Data','Bandwidth'], jawaban: 'Bias Data', hint: 'Keputusan tidak adil akibat data.' }] },
                        studi_proyek_akhir: { judul: "Proyek Akhir", konten: "<p>Menggabungkan semua aspek dalam proyek perangkat lunak mini sebagai praktik.</p>", funFact: "Proyek akhir membantu mahasiswa menerjemahkan teori menjadi produk nyata.", kuis: [{ type: 'pilihan-ganda', pertanyaan: 'Bagian penting dari proyek akhir adalah...', pilihan: ['Dokumentasi','Tidak ada dokumentasi','Rahasia'], jawaban: 'Dokumentasi', hint: 'Mempermudah pemeliharaan.' }] }
                    } },

                    politik_kuliah: { namaDunia: "Ilmu Politik Modern", warna: "red", icon: "🗳️", deskripsi: "Mengkaji ideologi politik, teori negara, dan sistem pemilu.", subMateri: {
                        teori_politik: { judul: "Teori Politik", konten: "<p>Liberalism, conservatism, socialism, dan teori kontemporer.</p>", funFact: "Banyak ideologi modern muncul sebagai reaksi terhadap industrialisasi.", kuis: [{ type: 'pilihan-ganda', pertanyaan: 'Ideologi yang menekankan kepemilikan kolektif adalah...', pilihan: ['Liberal','Conservative','Socialist'], jawaban: 'Socialist', hint: 'Aspek kolektivisme.' }] },
                        sistem_pemerintahan: { judul: "Sistem Pemerintahan", konten: "<p>Presidentialisme, parlementer, dan sistem hybrid.</p>", funFact: "Beberapa negara memiliki sistem semi-presidensial yang menggabungkan fitur keduanya.", kuis: [{ type: 'pilihan-ganda', pertanyaan: 'Sistem yang memisahkan kepala negara dan kepala pemerintahan biasanya disebut...', pilihan: ['Parliamentary','Presidential','Monarchy'], jawaban: 'Parliamentary', hint: 'Peran terpisah.' }] },
                        pemilu_dan_partai: { judul: "Pemilu & Partai", konten: "<p>Jenis sistem pemilu, peran partai politik, dan strategi kampanye.</p>", funFact: "Sistem pemilu memengaruhi jumlah partai yang bisa bertumbuh di sebuah negara.", kuis: [{ type: 'pilihan-ganda', pertanyaan: 'Sistem perwakilan proporsional cenderung menghasilkan...', pilihan: ['Banyak partai','Dua partai saja','Tidak ada partai'], jawaban: 'Banyak partai', hint: 'Distribusi kursi proporsional.' }] },
                        kebijakan_public: { judul: "Kebijakan Publik", konten: "<p>Proses pembuatan kebijakan publik dan evaluasi dampak.</p>", funFact: "Analisis biaya-manfaat sering dipakai sebelum menerapkan kebijakan besar.", kuis: [{ type: 'pilihan-ganda', pertanyaan: 'Analisis yang menimbang biaya dan manfaat disebut...', pilihan: ['Analisis Risiko','Analisis Biaya-Manfaat','Analisis Teknis'], jawaban: 'Analisis Biaya-Manfaat', hint: 'Menimbang pro-kontra ekonomi.' }] },
                        hubungan_internasional: { judul: "Hubungan Internasional", konten: "<p>Teori realisme, liberalisme, dan konstruktivisme dalam hubungan antarnegara.</p>", funFact: "Teori realisme menekankan kepentingan negara dan keamanan.", kuis: [{ type: 'pilihan-ganda', pertanyaan: 'Teori yang menekankan kekuatan militer dan kepentingan negara disebut...', pilihan: ['Realisme','Liberalism','Konstruktivisme'], jawaban: 'Realisme', hint: 'Fokus pada kekuatan negara.' }] },
                        politik_komparatif: { judul: "Komparatif Politik", konten: "<p>Membandingkan sistem politik dan institusi berbagai negara.</p>", funFact: "Pendekatan komparatif membantu memahami variasi institusional global.", kuis: [{ type: 'pilihan-ganda', pertanyaan: 'Pendekatan komparatif berguna untuk...', pilihan: ['Mempelajari satu negara saja','Membandingkan negara','Hanya teori'], jawaban: 'Membandingkan negara', hint: 'Perbandingan lintas negara.' }] },
                        ideologi_dan_identitas: { judul: "Ideologi & Identitas", konten: "<p>Peran identitas etnis, agama, dan kelas dalam politik.", funFact: "Identitas bisa menjadi sumber solidaritas maupun konflik politik.", kuis: [{ type: 'pilihan-ganda', pertanyaan: 'Identitas politik sering mencakup...', pilihan: ['Hanya agama','Etnis, agama, kelas','Hanya ekonomi'], jawaban: 'Etnis, agama, kelas', hint: 'Banyak dimensi identitas.' }] },
                        kebijakan_ekonomi_politik: { judul: "Ekonomi Politik", konten: "<p>Interaksi antara kebijakan ekonomi dan struktur politik.</p>", funFact: "Kebijakan ekonomi dapat memengaruhi stabilitas politik jangka panjang.", kuis: [{ type: 'pilihan-ganda', pertanyaan: 'Kebijakan fiskal biasanya terkait dengan...', pilihan: ['Suku bunga','Belanja pemerintah & pajak','Regulasi pasar saham'], jawaban: 'Belanja pemerintah & pajak', hint: 'Di tangan pemerintah fiskal.' }] },
                        gerakan_sosial: { judul: "Gerakan Sosial", konten: "<p>Peran gerakan sosial dalam perubahan politik dan contoh sejarahnya.</p>", funFact: "Gerakan sosial modern sering memanfaatkan media sosial untuk koordinasi.", kuis: [{ type: 'pilihan-ganda', pertanyaan: 'Gerakan sosial biasanya bertujuan untuk...', pilihan: ['Mempertahankan status quo','Mendorong perubahan','Membatasi hak'], jawaban: 'Mendorong perubahan', hint: 'Aksi kolektif.' }] },
                        studi_kasus_politik: { judul: "Studi Kasus Politik", konten: "<p>Analisis kasus kebijakan atau pemilu sebagai pembelajaran praktis.</p>", funFact: "Studi kasus pemilu sering digunakan untuk memahami dinamika kampanye.", kuis: [{ type: 'pilihan-ganda', pertanyaan: 'Studi kasus politik berguna untuk...', pilihan: ['Teori semata','Aplikasi praktis','Menghapus sejarah'], jawaban: 'Aplikasi praktis', hint: 'Memahami konteks nyata.' }] }
                    } },
                }
            }
        };


        function generateBadges() {
            for (const jenjang in edukasiData) {
                const jenjangData = edukasiData[jenjang];
                if (!jenjangData.badges) jenjangData.badges = {};
                for (const duniaId in jenjangData.dunia) {
                    const dunia = jenjangData.dunia[duniaId];
                    jenjangData.badges[duniaId] = {
                        id: duniaId,
                        title: `Pakar ${dunia.namaDunia}`,
                        description: `Menyelesaikan semua materi di ${dunia.namaDunia}.`,
                        icon: dunia.icon
                    };
                }
                const jenjangTitle = { sd: "SD", smp: "SMP", sma: "SMA", kuliah: "Kuliah" }[jenjang];
                jenjangData.badges['cendekia'] = {
                    id: 'cendekia',
                    title: `Cendekia ${jenjangTitle}`,
                    description: `Menyelesaikan 100% materi di jenjang ${jenjangTitle}!`,
                    icon: '🎓'
                };
            }
        }
        generateBadges();
        // Ensure every jenjang has 10 dunia and each dunia has 10 subMateri
        function ensureEduStructure() {
            const jenjangKeys = Object.keys(edukasiData);
            const fallbackColors = ['green','blue','purple','red','stone','yellow','orange','pink','teal','fuchsia'];
            jenjangKeys.forEach(jenjang => {
                const root = edukasiData[jenjang];
                if (!root.dunia) root.dunia = {};
                // make sure there are at least 10 dunia
                const existingDunia = Object.keys(root.dunia);
                for (let i = existingDunia.length; i < 10; i++) {
                    const id = `auto_dunia_${i+1}`;
                    root.dunia[id] = {
                        namaDunia: `Dunia Tambahan ${i+1}`,
                        warna: fallbackColors[i % fallbackColors.length] || 'blue',
                        icon: '✨',
                        deskripsi: `Konten tambahan otomatis untuk jenjang ${jenjang}.`,
                        subMateri: {}
                    };
                }
                // ensure each dunia has 10 subMateri
                for (const duniaId in root.dunia) {
                    const dunia = root.dunia[duniaId];
                    if (!dunia.subMateri) dunia.subMateri = {};
                    const existingSub = Object.keys(dunia.subMateri);
                    for (let j = existingSub.length; j < 10; j++) {
                        const sid = `auto_sub_${j+1}`;
                        dunia.subMateri[sid] = {
                            judul: `Submateri ${j+1}`,
                            konten: `<p>Konten otomatis untuk ${dunia.namaDunia} - sub ${j+1}.</p>`,
                            funFact: `Fakta menarik otomatis untuk ${dunia.namaDunia}.`,
                            kuis: [{ type: 'pilihan-ganda', pertanyaan: `Berapakah 1 + ${j}?`, pilihan: [`${j}`, `${j+1}`, `${j+2}`, `${j+3}`], jawaban: `${j+1}`, hint: 'Coba hitung sederhana.' }]
                        };
                    }
                }
            });
        }
        ensureEduStructure();

        // Validate and auto-fix Kuliah data specifically (ensure 10 subMateri each, fields present)
        function validateAndFixKuliah() {
            if (!edukasiData.kuliah || !edukasiData.kuliah.dunia) return;
            const duniaKeys = Object.keys(edukasiData.kuliah.dunia);
            duniaKeys.forEach(dk => {
                const dunia = edukasiData.kuliah.dunia[dk];
                if (!dunia.subMateri) dunia.subMateri = {};
                const existing = Object.keys(dunia.subMateri);
                // ensure at least 10 submateri
                for (let i = existing.length; i < 10; i++) {
                    const sid = `auto_kul_${i+1}`;
                    dunia.subMateri[sid] = {
                        judul: `Topik Tambahan ${i+1}`,
                        konten: `<p>Konten sementara untuk ${dunia.namaDunia} — submateri ${i+1}.</p>`,
                        funFact: `Fakta singkat otomatis untuk ${dunia.namaDunia}.`,
                        kuis: [{ type: 'pilihan-ganda', pertanyaan: `Contoh soal untuk ${dunia.namaDunia} - ${i+1}`, pilihan: ['A','B','C','D'], jawaban: 'A', hint: 'Ini hanyalah contoh.' }]
                    };
                }
                // ensure existing ones have fields
                Object.keys(dunia.subMateri).forEach(sid => {
                    const sm = dunia.subMateri[sid];
                    if (!sm.judul) sm.judul = 'Judul Tidak Diketahui';
                    if (!sm.konten) sm.konten = '<p>Konten belum tersedia.</p>';
                    if (!sm.funFact) sm.funFact = '';
                    if (!Array.isArray(sm.kuis) || sm.kuis.length === 0) sm.kuis = [{ type: 'pilihan-ganda', pertanyaan: 'Soal contoh', pilihan: ['A','B','C'], jawaban: 'A', hint: '' }];
                });
            });
        }
        validateAndFixKuliah();


         // --- Variabel & State Aplikasi ---
        const domElements = { 
            screens: document.querySelectorAll('.screen'), 
            modals: document.querySelectorAll('.modal-overlay'),
            loadingScreen: document.getElementById('loading-screen'),
            userListContainer: document.getElementById('user-list-container'), 
            addNewUserBtn: document.getElementById('add-new-user-btn'), 
            playerNameInput: document.getElementById('player-name-input'), 
            avatarSelectionContainer: document.getElementById('avatar-selection-container'),
            nextToLevelBtn: document.getElementById('next-to-level-btn'), 
            cancelNewUserBtn: document.getElementById('cancel-new-user-btn'), 
            jenjangPromptName: document.getElementById('jenjang-prompt-name'), 
            welcomeMessage: document.getElementById('welcome-message'), 
            pointsDisplay: document.getElementById('points-display'), 
            userAvatarHeader: document.getElementById('user-avatar-header'), 
            duniaContainer: document.getElementById('dunia-container'), 
            submateriContainer: document.getElementById('submateri-container'), 
            submateriTitle: document.getElementById('submateri-title'), 
            materiContent: document.getElementById('materi-content'), 
            backToWorldsBtn: document.getElementById('back-to-worlds-btn'), 
            backToSubmateriBtn: document.getElementById('back-to-submateri-btn'), 
            settingsBtn: document.getElementById('settings-btn'), 
            achievementsBtn: document.getElementById('achievements-btn'), 
            closeSettingsBtn: document.getElementById('close-settings-btn'), 
            editNameInput: document.getElementById('edit-name-input'), 
            saveNameBtn: document.getElementById('save-name-btn'), 
            changeJenjangSelect: document.getElementById('change-jenjang-select'),
            soundToggleBtn: document.getElementById('sound-toggle'),
            musicToggleBtn: document.getElementById('music-toggle'),
            zenModeToggle: document.getElementById('zen-mode-toggle'),
            themeSelector: document.getElementById('theme-selector'),
            resetProgressBtn: document.getElementById('reset-progress-btn'), 
            resetUsernameConfirm: document.getElementById('reset-username-confirm'), 
            cancelResetBtn: document.getElementById('cancel-reset-btn'), 
            confirmResetBtn: document.getElementById('confirm-reset-btn'), 
            funFactText: document.getElementById('fun-fact-text'), 
            closeFunFactBtn: document.getElementById('close-fun-fact-btn'), 
            achievementsList: document.getElementById('achievements-list'), 
            closeAchievementsBtn: document.getElementById('close-achievements-btn'), 
            leaderboardBtn: document.getElementById('leaderboard-btn'),
            leaderboardList: document.getElementById('leaderboard-list'),
            closeLeaderboardBtn: document.getElementById('close-leaderboard-btn'),
            dailyMissionBtn: document.getElementById('daily-mission-btn'),
            dailyMissionText: document.getElementById('daily-mission-text'),
            missionProgressBar: document.getElementById('mission-progress-bar'),
            claimMissionRewardBtn: document.getElementById('claim-mission-reward-btn'),
            closeDailyMissionBtn: document.getElementById('close-daily-mission-btn'),
            closeDailyBonusBtn: document.getElementById('close-daily-bonus-btn'),
            avatarShopContainer: document.getElementById('avatar-shop-container'),
            closeAvatarShopBtn: document.getElementById('close-avatar-shop-btn'),
            shopPointsDisplay: document.getElementById('shop-points-display'),
            animationContainer: document.getElementById('animation-container'),
            streakDisplay: document.getElementById('streak-display'),
            dailyBonusAmount: document.getElementById('daily-bonus-amount'),
            dailyStreakBonusText: document.getElementById('daily-streak-bonus-text'),
            mascotTipContainer: document.getElementById('mascot-tip-container'),
            backgroundMusic: document.getElementById('background-music'),
            searchBar: document.getElementById('search-bar'),
            wordOfTheDay: document.getElementById('word-of-the-day'),
            reviewModeBtn: document.getElementById('review-mode-btn'),
            timedChallengeBtn: document.getElementById('timed-challenge-btn'),
            timedChallengeModal: document.getElementById('timed-challenge-modal'),
            challengeTimer: document.getElementById('challenge-timer'),
            challengeScore: document.getElementById('challenge-score'),
            challengeQuestionArea: document.getElementById('challenge-question-area'),
            challengeFeedback: document.getElementById('challenge-feedback'),
            closeTimedChallengeBtn: document.getElementById('close-timed-challenge-btn'),
            userTitleDisplay: document.getElementById('user-title-display'),
            genericShopTitle: document.getElementById('generic-shop-title'),
            genericShopContainer: document.getElementById('generic-shop-container'),
            genericShopPoints: document.getElementById('generic-shop-points'),
            inventoryBtn: document.getElementById('inventory-btn'),
            inventoryModal: document.getElementById('inventory-modal'),
            inventoryList: document.getElementById('inventory-list'),
            autosaveIndicator: document.getElementById('autosave-indicator'),
            purchaseHistoryList: document.getElementById('purchase-history-list'),
            confirmToggle: document.getElementById('confirm-toggle'),
            eventBannerContainer: document.getElementById('event-banner-container'),
            progressTreeToggle: document.getElementById('progress-tree-toggle'),
            favoritesList: document.getElementById('favorites-list'),
            closeFavoritesBtn: document.getElementById('close-favorites-btn'),
            statsModal: document.getElementById('stats-modal'),
            statsUsername: document.getElementById('stats-username'),
            statsContent: document.getElementById('stats-content'),
            closeStatsBtn: document.getElementById('close-stats-btn'),
        };

        // Ensure a background music audio element exists (fallback to HTMLAudioElement)
        (function initBackgroundMusic(){
            try {
                if (!domElements.backgroundMusic) {
                    const a = document.createElement('audio');
                    a.id = 'background-music';
                    a.loop = true;
                    // small bundled placeholder data URI or leave src null for now; app will set src when user purchases
                    a.src = '';
                    a.volume = 0.45;
                    document.body.appendChild(a);
                    domElements.backgroundMusic = a;
                }
            } catch(e){}
        })();

        // Wire settings toggles (safe guards if elements absent)
        (function wireSettingsToggles(){
            try {
                if (domElements.soundToggleBtn && !domElements.soundToggleBtn.dataset.listenerAttached) {
                    domElements.soundToggleBtn.addEventListener('click', ()=>{
                        // toggle master sound; keep sfxOn in step when turning off
                        activeUser.settings.soundOn = !activeUser.settings.soundOn;
                        if (!activeUser.settings.soundOn) activeUser.settings.sfxOn = false;
                        saveData();
                        domElements.soundToggleBtn.textContent = activeUser.settings.soundOn ? '🔊' : '🔈';
                    });
                    domElements.soundToggleBtn.dataset.listenerAttached = '1';
                }

                if (domElements.musicToggleBtn && !domElements.musicToggleBtn.dataset.listenerAttached) {
                    domElements.musicToggleBtn.addEventListener('click', ()=>{
                        const newState = !activeUser.settings.musicOn;
                        toggleMusic(newState);
                    });
                    domElements.musicToggleBtn.dataset.listenerAttached = '1';
                }

                if (domElements.zenModeToggle && !domElements.zenModeToggle.dataset.listenerAttached) {
                    domElements.zenModeToggle.checked = !!activeUser.settings.zenMode;
                    domElements.zenModeToggle.addEventListener('change', (e)=>{ activeUser.settings.zenMode = !!e.target.checked; saveData(); document.body.classList.toggle('zen-mode', activeUser.settings.zenMode); });
                    domElements.zenModeToggle.dataset.listenerAttached = '1';
                }
            } catch(e){}
        })();

        let userProfiles = [];
        let currentUserIndex = -1;
        let activeUser = null;
        let currentDuniaId = null;
        let currentSubmateriId = null;
        let selectedAvatarId = null;
        let timedChallengeInterval = null;
        let viewedUser = null;
        
        const sounds = { 
            click: new Tone.Synth({ oscillator: { type: "sine" }, envelope: { attack: 0.01, decay: 0.2, sustain: 0, release: 0.1 } }).toDestination(), 
            correct: new Tone.Synth({ oscillator: { type: "triangle" }, envelope: { attack: 0.01, decay: 0.3, sustain: 0.1, release: 0.2 } }).toDestination(), 
            wrong: new Tone.Synth({ oscillator: { type: "square" }, envelope: { attack: 0.01, decay: 0.5, sustain: 0, release: 0.2 } }).toDestination(), 
            badge: new Tone.Synth({ oscillator: { type: "sawtooth" }, envelope: { attack: 0.1, decay: 0.5, sustain: 0.2, release: 0.5 } }).toDestination(),
            open: new Tone.Synth({ oscillator: { type: "sine" }, envelope: { attack: 0.01, decay: 0.1, sustain: 0, release: 0.1 } }).toDestination(),
            purchase: new Tone.Synth({ oscillator: { type: "triangle8" }, envelope: { attack: 0.01, decay: 0.4, sustain: 0.1, release: 0.2 } }).toDestination(),
            equip: new Tone.Synth({ oscillator: { type: "sine" }, envelope: { attack: 0.05, decay: 0.2, sustain: 0.2, release: 0.1 } }).toDestination(),
            // additional SFX players (for store previews / alternate click sounds)
            // placeholders - actual players are created by loadDefaultAudioAssets when URLs are known
            sfx_click_soft: null,
            sfx_click_tick: null,
            sfx_nav_swipe: null,
            sfx_nav_boop: null,
            sfx_win_chime: new Tone.Synth({ oscillator: { type: 'triangle' }, envelope: { attack: 0.01, decay: 0.6, sustain: 0.2, release: 0.4 } }).toDestination(),
            sfx_error: new Tone.Synth({ oscillator: { type: 'sawtooth' }, envelope: { attack:0.01, decay:0.3, sustain:0, release:0.2 } }).toDestination(),
            sfx_pop_light: null,
            sfx_slide: null,
            sfx_confirm: null,
            sfx_reward_snap: null,
        };

        const colorMapping = { 
            green: { bg: 'bg-green-100', text: 'text-green-800', border: 'border-green-400', progress: 'bg-green-500' }, 
            blue: { bg: 'bg-blue-100', text: 'text-blue-800', border: 'border-blue-400', progress: 'bg-blue-500' },
            purple: { bg: 'bg-purple-100', text: 'text-purple-800', border: 'border-purple-400', progress: 'bg-purple-500' },
            red: { bg: 'bg-red-100', text: 'text-red-800', border: 'border-red-400', progress: 'bg-red-500' },
            stone: { bg: 'bg-stone-100', text: 'text-stone-800', border: 'border-stone-400', progress: 'bg-stone-500' },
            yellow: { bg: 'bg-yellow-100', text: 'text-yellow-800', border: 'border-yellow-400', progress: 'bg-yellow-500' },
            orange: { bg: 'bg-orange-100', text: 'text-orange-800', border: 'border-orange-400', progress: 'bg-orange-500' },
            pink: { bg: 'bg-pink-100', text: 'text-pink-800', border: 'border-pink-400', progress: 'bg-pink-500' },
            teal: { bg: 'bg-teal-100', text: 'text-teal-800', border: 'border-teal-400', progress: 'bg-teal-500' },
            fuchsia: { bg: 'bg-fuchsia-100', text: 'text-fuchsia-800', border: 'border-fuchsia-400', progress: 'bg-fuchsia-500' },
        };

        // Per-jenjang color palettes (used for achievement icons and card accents)
        const jenjangPalettes = {
            sd: ['#60a5fa','#3b82f6','#2563eb'],        // playful blues for SD
            smp: ['#34d399','#10b981','#059669'],       // greens for SMP
            sma: ['#a78bfa','#7c3aed','#6d28d9'],       // purples for SMA
            kuliah: ['#f59e0b','#f97316','#ea580c'],    // warm gold/orange for Kuliah
        };

        const defaultPalette = ['#60a5fa','#34d399','#f59e0b','#f97316','#a78bfa','#f472b6'];

        // --- Fungsi-fungsi Aplikasi ---

        // --- Achievement definitions (moved to global for renderer) ---
        const achievementsDefinitions = {
            sd: [
                { id: 'sd_complete_any_dunia_1', title: 'Penjelajah Mini', desc: 'Selesaikan 1 dunia penuh', condition: (u, j) => {
                    for (const d in edukasiData[j].dunia) { const total=Object.keys(edukasiData[j].dunia[d].subMateri).length; const done=Object.values((u.progress && u.progress[j] && u.progress[j][d])||{}).filter(p=>p.done).length; if(done===total) return true; } return false;
                }},
                { id: 'sd_5_submateri', title: 'Pecinta Belajar', desc: 'Selesaikan 5 submateri', condition: (u,j)=>{ let c=0; for(const d in (u.progress && u.progress[j])||{}) c+=Object.values(u.progress[j][d]).filter(p=>p.done).length; return c>=5; } },
                { id: 'sd_50_points', title: 'Pengumpul Poin', desc: 'Kumpulkan 50 poin', condition: (u)=> (u.points||0) >= 50 },
                { id: 'sd_master_dunia_3', title: 'Raja Dunia', desc: 'Selesaikan 3 dunia', condition: (u,j)=>{ let count=0; for(const d in edukasiData[j].dunia){ const total=Object.keys(edukasiData[j].dunia[d].subMateri).length; const done=Object.values((u.progress&&u.progress[j]&&u.progress[j][d])||{}).filter(p=>p.done).length; if(done===total) count++; } return count>=3; } },
                { id: 'sd_favorite_5', title: 'Pemilih Cermat', desc: 'Tambahkan 5 favorit', condition: (u)=> (u.favorites && u.favorites.length>=5) }
            ],
            smp: [
                { id: 'smp_1_dunia', title: 'Pemburu Dunia', desc: 'Selesaikan 1 dunia SMP', condition: (u,j)=>{ for (const d in edukasiData[j].dunia){ const total=Object.keys(edukasiData[j].dunia[d].subMateri).length; const done=Object.values((u.progress&&u.progress[j]&&u.progress[j][d])||{}).filter(p=>p.done).length; if(done===total) return true;} return false; } },
                { id: 'smp_10_sub', title: 'Gigih SMP', desc: 'Selesaikan 10 submateri', condition: (u,j)=>{ let c=0; for(const d in (u.progress&&u.progress[j])||{}) c+=Object.values(u.progress[j][d]).filter(p=>p.done).length; return c>=10; } },
                { id: 'smp_100_points', title: 'Poin SMP', desc: 'Kumpulkan 100 poin', condition: (u)=> (u.points||0)>=100 }
            ],
            sma: [
                { id: 'sma_1_dunia', title: 'Eksplorer SMA', desc: 'Selesaikan 1 dunia SMA', condition: (u,j)=>{ for (const d in edukasiData[j].dunia){ const total=Object.keys(edukasiData[j].dunia[d].subMateri).length; const done=Object.values((u.progress&&u.progress[j]&&u.progress[j][d])||{}).filter(p=>p.done).length; if(done===total) return true;} return false; } },
                { id: 'sma_20_sub', title: 'Konsisten SMA', desc: 'Selesaikan 20 submateri', condition: (u,j)=>{ let c=0; for(const d in (u.progress&&u.progress[j])||{}) c+=Object.values(u.progress[j][d]).filter(p=>p.done).length; return c>=20; } },
                { id: 'sma_500_points', title: 'Pengoleksi SMA', desc: 'Kumpulkan 500 poin', condition: (u)=> (u.points||0)>=500 }
            ],
            kuliah: [
                { id: 'kul_1_dunia', title: 'Sarjana Muda', desc: 'Selesaikan 1 dunia kuliah', condition: (u,j)=>{ for (const d in edukasiData[j].dunia){ const total=Object.keys(edukasiData[j].dunia[d].subMateri).length; const done=Object.values((u.progress&&u.progress[j]&&u.progress[j][d])||{}).filter(p=>p.done).length; if(done===total) return true;} return false; } },
                { id: 'kul_30_sub', title: 'Rajin Kuliah', desc: 'Selesaikan 30 submateri', condition: (u,j)=>{ let c=0; for(const d in (u.progress&&u.progress[j])||{}) c+=Object.values(u.progress[j][d]).filter(p=>p.done).length; return c>=30; } },
                { id: 'kul_1000_points', title: 'Dekanat', desc: 'Kumpulkan 1000 poin', condition: (u)=> (u.points||0)>=1000 }
            ]
        };

        // Ensure pre-defined achievements have icons (non-destructive)
        (function assignIconsToPredefined(){
            ['sd','smp','sma','kuliah'].forEach(j => {
                const defs = achievementsDefinitions[j] || [];
                for (let i=0;i<defs.length && i<15;i++) {
                    if (!defs[i].iconSVG) defs[i].iconSVG = defaultAchievementIconSVG(i, j);
                }
            });
        })();
        function createNewUser(name, avatarId) {
            const starterAvatars = Object.keys(avatarData).filter(id => avatarData[id].isStarter);
            const defaultTheme = Object.keys(shopData.customization.items).find(id => shopData.customization.items[id].isDefault);
            const u = {
                id: Date.now(),
                name: name, avatarId: avatarId, jenjang: null, points: 0,
                progress: {}, badges: {}, dailyMission: {}, lastLogin: null, loginStreak: 0,
                unlockedAvatars: starterAvatars,
                inventory: defaultTheme ? [defaultTheme] : [],
                favorites: [],
                stats: { correctAnswers: 0, wrongAnswers: 0, quizzesCompleted: 0 },
                settings: { soundOn: true, sfxOn: true, theme: 'light', musicOn: true, zenMode: false },
            };
            userProfiles.push(u);
            currentUserIndex = userProfiles.length - 1;
            activeUser = u;
            // ensure the user has default equipped audio so the app sounds good out-of-the-box
            try { ensureDefaultAudioEquipped(activeUser); } catch(e){}
            saveData();
            // prepare audio assets and apply user settings
            try { loadDefaultAudioAssets(); applySettings(); } catch(e){}
            domElements.jenjangPromptName.textContent = `Hai ${activeUser.name}, ayo pilih jenjangmu!`;
            switchScreen('jenjang-screen');
        }

        // Ensure built-in default audio is equipped for first-time users.
        function ensureDefaultAudioEquipped(user) {
            if (!user) return;
            if (!user.equipped) user.equipped = {};
            // If the user already has some equipped items, don't override them
            const eq = user.equipped;
            // sensible defaults using built-in generators (present after loadDefaultAudioAssets)
            if (!eq.bgm) eq.bgm = 'calm1';
            if (!eq.sfx_click) eq.sfx_click = 'sfx_click_soft';
            if (!eq.sfx_correct) eq.sfx_correct = 'sfx_win_chime';
            if (!eq.sfx_wrong) eq.sfx_wrong = 'sfx_error';
            if (!eq.sfx_open) eq.sfx_open = 'open';
            if (!eq.sfx_badge) eq.sfx_badge = 'badge';
            if (!eq.sfx_purchase) eq.sfx_purchase = 'purchase';
            // persist
            try { saveData(); } catch(e){}
        }
        
        function initializeProgressForJenjang(jenjang) {
            if (!edukasiData[jenjang] || !activeUser) return;
            if (!activeUser.progress) activeUser.progress = {};
            if (!activeUser.badges) activeUser.badges = {};
            if (activeUser.progress[jenjang]) return;
            activeUser.progress[jenjang] = {};
            activeUser.badges[jenjang] = [];
            for (const duniaId in edukasiData[jenjang].dunia) {
                activeUser.progress[jenjang][duniaId] = {};
                for (const submateriId in edukasiData[jenjang].dunia[duniaId].subMateri) {
                    activeUser.progress[jenjang][duniaId][submateriId] = { done: false };
                }
            }
            saveData();
        }

        function checkDailyLogin() {
            const today = new Date().toDateString();
            if (activeUser.lastLogin === today) return;
            const yesterday = new Date();
            yesterday.setDate(yesterday.getDate() - 1);
            if (activeUser.lastLogin === yesterday.toDateString()) activeUser.loginStreak++;
            else activeUser.loginStreak = 1;
            const baseBonus = 50;
            const streakBonus = activeUser.loginStreak * 10;
            const totalBonus = baseBonus + streakBonus;
            activeUser.lastLogin = today;
            addPoints(totalBonus, null, false);
            domElements.dailyBonusAmount.textContent = `${totalBonus} Poin`;
            domElements.dailyStreakBonusText.textContent = activeUser.loginStreak > 1 ? `Bonus beruntun ${activeUser.loginStreak} hari: +${streakBonus} poin!` : "Kembali besok untuk bonus lebih besar!";
            showModal('daily-bonus-modal');
            saveData();
            updateUI();
        }

        function updateUI() {
            if (!activeUser) return;
            document.body.classList.toggle('zen-mode', activeUser.settings.zenMode);
            domElements.welcomeMessage.textContent = `Halo, ${activeUser.name}!`;
            domElements.userAvatarHeader.innerHTML = avatarData[activeUser.avatarId].svg;
            domElements.streakDisplay.innerHTML = activeUser.loginStreak > 1 ? `🔥 ${activeUser.loginStreak}` : '';
            domElements.pointsDisplay.textContent = `💰 Poin: ${activeUser.points}`;
            // update word of the day if present
            if (!domElements.wordOfTheDay.dataset.manual) updateWordOfTheDay();
        }

        // --- Word of the day rotation ---
        const wordsOfTheDay = [
            'Belajar sedikit setiap hari akan membawa banyak perubahan.',
            'Kesalahan adalah guru terbaik, belajarlah darinya.',
            'Ketekunan mengalahkan kepintaran yang malas.',
            'Tanya lebih banyak, tahu lebih banyak.',
            'Cobalah lagi: kegagalan adalah langkah menuju sukses.',
            'Berbagi pengetahuan membuatnya lebih berharga.'
        ];
        function updateWordOfTheDay(forceIndex = null) {
            if (!domElements.wordOfTheDay) return;
            let idx = parseInt(domElements.wordOfTheDay.dataset.index || '-1');
            if (forceIndex !== null) idx = forceIndex;
            else idx = (idx + 1) % wordsOfTheDay.length;
            domElements.wordOfTheDay.textContent = wordsOfTheDay[idx];
            domElements.wordOfTheDay.dataset.index = idx;
        }
        // allow clicking to cycle the word (guard to avoid duplicate listener)
        if (domElements.wordOfTheDay && !domElements.wordOfTheDay.dataset.listenerAttached) {
            domElements.wordOfTheDay.addEventListener('click', () => { domElements.wordOfTheDay.dataset.manual = '1'; updateWordOfTheDay(); showMascotTip('Kata hari ini diperbarui'); });
            domElements.wordOfTheDay.dataset.listenerAttached = '1';
        }
        
        function showAnimation(text, type = 'point') {
            const animEl = document.createElement('div');
            animEl.className = 'point-animation';
            animEl.textContent = text;
            domElements.animationContainer.appendChild(animEl);
            setTimeout(() => animEl.remove(), 1500);
        }

        function addPoints(amount, duniaId = null, withAnimation = true) {
            if (!activeUser || activeUser.settings.zenMode) return;
            activeUser.points += amount;
            if(withAnimation && amount > 0) showAnimation(`+${amount}`, 'point');
            saveData();
            updateUI();
        }

        function handleQuizAnswer(element, answer, duniaId, submateriId, type, hintUsed) {
            const feedbackEl = domElements.materiContent.querySelector('#quiz-feedback');
            const isCompleted = activeUser.progress[activeUser.jenjang]?.[duniaId]?.[submateriId]?.done;
            const userAnswer = (type === 'isi-jawaban') ? element.value.trim() : element.textContent.trim();
            const isCorrect = userAnswer.toLowerCase() === answer.toLowerCase();

            if (isCorrect) {
                playSound('correct');
                feedbackEl.textContent = 'Jawaban Benar! Kamu Hebat!';
                feedbackEl.className = 'mt-4 text-lg font-bold text-green-600';
                if (element && element.classList) element.classList.add('quiz-correct'); setTimeout(()=> element.classList && element.classList.remove('quiz-correct'), 800);
                if (!isCompleted) {
                    showAnimation('⭐+10', 'point');
                    addPoints(10, duniaId, false);
                    activeUser.progress[activeUser.jenjang][duniaId][submateriId] = { done: true };
                    // update stats
                    activeUser.stats = activeUser.stats || { correctAnswers: 0, wrongAnswers: 0, quizzesCompleted: 0 };
                    activeUser.stats.correctAnswers = (activeUser.stats.correctAnswers || 0) + 1;
                    activeUser.stats.quizzesCompleted = (activeUser.stats.quizzesCompleted || 0) + 1;
                    // update daily mission progress via helper
                    try { updateMissionProgress(1); } catch(e) {}
                    // mark done and persist
                    saveData();
                    // check badges for jenjang
                    try { checkForBadges(activeUser.jenjang); } catch(e) {}
                }
                setTimeout(() => {
                    const materi = edukasiData[activeUser.jenjang].dunia[duniaId].subMateri[submateriId];
                    document.getElementById('mascot-container').innerHTML = mascotSVG;
                    domElements.funFactText.textContent = materi.funFact;
                    showModal('fun-fact-modal');
                }, 1000);
            } else {
                playSound('wrong');
                feedbackEl.textContent = 'Jawaban kurang tepat, coba lagi!';
                feedbackEl.setAttribute('role','status');
                feedbackEl.className = 'mt-4 text-lg font-bold text-red-600';
                try { const ann = ariaAnnouncer(); if (ann) ann.textContent = 'Jawaban salah.'; } catch(e){}
                if (element && element.classList) element.classList.add('quiz-wrong'); setTimeout(()=> element.classList && element.classList.remove('quiz-wrong'), 800);
                if (element.classList) {
                    element.classList.add('animate-shake');
                    setTimeout(() => element.classList.remove('animate-shake'), 500);
                }
                // increment wrong answer stat
                activeUser.stats = activeUser.stats || { correctAnswers: 0, wrongAnswers: 0, quizzesCompleted: 0 };
                activeUser.stats.wrongAnswers = (activeUser.stats.wrongAnswers || 0) + 1;
                saveData();
            }
            domElements.materiContent.querySelectorAll('button, input').forEach(btn => btn.disabled = true);
            // remove keyboard handler if present to avoid duplicate handlers
            if (window.lastMateriKeydownHandler) { document.removeEventListener('keydown', window.lastMateriKeydownHandler); window.lastMateriKeydownHandler = null; }
        }
        
        function renderDuniaMap() {
            const jenjang = activeUser.jenjang;
            const dataDunia = edukasiData[jenjang].dunia;
            domElements.duniaContainer.innerHTML = '';
            for (const duniaId in dataDunia) {
                const dunia = dataDunia[duniaId];
                const c = colorMapping[dunia.warna] || colorMapping.blue;
                const progress = activeUser.progress[jenjang]?.[duniaId] || {};
                const total = Object.keys(dunia.subMateri).length;
                const completed = Object.values(progress).filter(p => p.done).length;
                const percentage = total > 0 ? (completed / total) * 100 : 0;
                const card = document.createElement('div');
                card.className = `p-6 rounded-2xl shadow-lg cursor-pointer card-hover border-4 ${c.border} flex flex-col`;
                card.style.backgroundColor = `var(--card-bg-color)`;
                card.innerHTML = `<div class="text-5xl text-center mb-4">${dunia.icon}</div><h3 class="font-brand text-2xl text-center ${c.text}">${dunia.namaDunia}</h3><p class="text-sm mt-2 text-center flex-grow">${dunia.deskripsi}</p><div class="mt-4"><div class="text-xs font-semibold text-center mb-1">${completed} / ${total} Selesai</div><div class="w-full bg-gray-200 rounded-full h-2.5"><div class="${c.progress} h-2.5 rounded-full" style="width: ${percentage}%;"></div></div></div>`;
                card.addEventListener('click', () => {
                    playSound('click');
                    currentDuniaId = duniaId;
                    renderSubMateri(duniaId);
                    switchScreen('submateri-screen');
                    // daily mission: opened a new dunia
                    // daily mission: opened a new dunia (use updateMissionProgress helper)
                    if (activeUser.dailyMission && !activeUser.dailyMission.claimed && activeUser.dailyMission.id === 'm3') {
                        updateMissionProgress(1);
                    }
                });
                domElements.duniaContainer.appendChild(card);
            }
        }

        // enhanced: allow optional filter string to narrow displayed dunia
        function renderDuniaMapWithFilter(filter) {
            const jenjang = activeUser.jenjang;
            const dataDunia = edukasiData[jenjang].dunia;
            const q = (filter || '').toLowerCase().trim();
            domElements.duniaContainer.innerHTML = '';
            for (const duniaId in dataDunia) {
                const dunia = dataDunia[duniaId];
                const text = (dunia.namaDunia + ' ' + (dunia.deskripsi||'')).toLowerCase();
                if (q && !text.includes(q)) continue;
                const c = colorMapping[dunia.warna] || colorMapping.blue;
                const progress = activeUser.progress[jenjang]?.[duniaId] || {};
                const total = Object.keys(dunia.subMateri).length;
                const completed = Object.values(progress).filter(p => p.done).length;
                const percentage = total > 0 ? (completed / total) * 100 : 0;
                const card = document.createElement('div');
                card.className = `p-6 rounded-2xl shadow-lg cursor-pointer card-hover border-4 ${c.border} flex flex-col`;
                card.style.backgroundColor = `var(--card-bg-color)`;
                card.innerHTML = `<div class="text-5xl text-center mb-4">${dunia.icon}</div><h3 class="font-brand text-2xl text-center ${c.text}">${dunia.namaDunia}</h3><p class="text-sm mt-2 text-center flex-grow">${dunia.deskripsi}</p><div class="mt-4"><div class="text-xs font-semibold text-center mb-1">${completed} / ${total} Selesai</div><div class="w-full bg-gray-200 rounded-full h-2.5"><div class="${c.progress} h-2.5 rounded-full" style="width: ${percentage}%;"></div></div></div>`;
                card.addEventListener('click', () => {
                    playSound('click');
                    currentDuniaId = duniaId;
                    renderSubMateri(duniaId);
                    switchScreen('submateri-screen');
                });
                domElements.duniaContainer.appendChild(card);
            }
        }
        
        function renderSubMateri(duniaId) { 
            const dunia = edukasiData[activeUser.jenjang].dunia[duniaId];
            const useTreeView = domElements.progressTreeToggle.checked;
            const colors = colorMapping[dunia.warna] || colorMapping.blue;
            domElements.submateriTitle.textContent = dunia.namaDunia;
            domElements.submateriTitle.className = `font-brand text-4xl md:text-5xl text-center ${colors.text}`;
            domElements.submateriContainer.innerHTML = '';
            let prevSubmateriId = null; 
            for (const submateriId in dunia.subMateri) {
                const submateri = dunia.subMateri[submateriId];
                const isCompleted = activeUser.progress[activeUser.jenjang]?.[duniaId]?.[submateriId]?.done;
                let isLocked = false;
                if(useTreeView) {
                    const prevIsCompleted = prevSubmateriId ? activeUser.progress[activeUser.jenjang]?.[duniaId]?.[prevSubmateriId]?.done : true;
                    if(!prevIsCompleted) isLocked = true;
                }
                const card = document.createElement('div');
                card.className = `p-5 rounded-xl shadow-md flex items-center justify-between border-2 ${colors.border} ${isLocked ? 'opacity-50 cursor-not-allowed' : 'cursor-pointer card-hover'}`;
                card.innerHTML = `<span class="font-semibold ${colors.text}">${submateri.judul}</span> ${isCompleted ? `<span class="text-2xl text-yellow-500 star-animation">⭐</span>` : (isLocked ? `<span>🔒</span>` : `<span class="w-6 h-6 rounded-full border-2 ${colors.border}"></span>`)}`; 
                if(!isLocked) {
                    card.addEventListener('click', () => { 
                        playSound('click'); 
                        currentSubmateriId = submateriId; 
                        renderMateri(duniaId, submateriId); 
                        switchScreen('materi-screen'); 
                    });
                }
                domElements.submateriContainer.appendChild(card);
                prevSubmateriId = submateriId;
            }
        }

        function renderMateri(duniaId, submateriId) { 
            const materi = edukasiData[activeUser.jenjang].dunia[duniaId].subMateri[submateriId];
            const quiz = materi.kuis[0];
            const isFavorited = activeUser.favorites.some(fav => fav.duniaId === duniaId && fav.submateriId === submateriId);
            let optionsHTML = '';
            if (quiz.type === 'pilihan-ganda') { 
                [...quiz.pilihan].sort(() => .5 - Math.random()).forEach(o => { optionsHTML += `<button class="quiz-option w-full text-left p-4 my-2 border-2 rounded-lg font-semibold transition-colors hover:bg-gray-100">${o}</button>`; }); 
            } else {
                optionsHTML = `<div class="flex gap-2 items-center"><input type="text" id="quiz-input-text" class="w-full p-3 border-2 rounded-lg"><button id="quiz-submit-btn" class="bg-blue-500 text-white font-bold py-3 px-5 rounded-lg">Jawab</button></div>`; 
            }

            const favoriteIconSVG = `<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"></path></svg>`;
            
            domElements.materiContent.innerHTML = `
                <div class="flex justify-between items-start">
                    <h2 class="font-brand text-3xl mb-4">${materi.judul}</h2>
                    <button class="favorite-btn p-2 rounded-full transition-colors hover:bg-yellow-100 ${isFavorited ? 'favorited' : ''}" title="Tambahkan ke Favorit" data-dunia-id="${duniaId}" data-submateri-id="${submateriId}">${favoriteIconSVG}</button>
                </div>
                <div class="prose max-w-none">${materi.konten}</div>
                <hr class="my-6">
                <h3 class="font-bold text-xl mb-3">Tantangan Cepat!</h3>
                <p class="mb-4 text-lg">${quiz.pertanyaan}</p>
                <div>${optionsHTML}</div>
                <div class="flex items-center gap-3 mt-4">
                    <button id="quiz-hint-btn" class="px-3 py-2 bg-yellow-400 rounded-md font-semibold">Tunjukkan Petunjuk (-2 pt)</button>
                    <div id="quiz-feedback" class="text-lg font-bold"></div>
                </div>`;

            // attach answer handlers (guards to prevent duplicate registrations)
            if (quiz.type === 'isi-jawaban'){
                const submitBtn = document.getElementById('quiz-submit-btn');
                if (submitBtn && !submitBtn.dataset.listenerAttached) {
                    submitBtn.addEventListener('click', () => handleQuizAnswer(document.getElementById('quiz-input-text'), quiz.jawaban, duniaId, submateriId, quiz.type, false));
                    submitBtn.dataset.listenerAttached = '1';
                }
            } else {
                const optionEls = domElements.materiContent.querySelectorAll('.quiz-option');
                optionEls.forEach((b, idx) => {
                    if (!b.dataset.listenerAttached) {
                        b.addEventListener('click', (e) => handleQuizAnswer(e.target, quiz.jawaban, duniaId, submateriId, quiz.type, false));
                        b.dataset.listenerAttached = '1';
                    }
                });
            }
            const favBtn = domElements.materiContent.querySelector('.favorite-btn');
            if (favBtn && !favBtn.dataset.listenerAttached) { favBtn.addEventListener('click', toggleFavorite); favBtn.dataset.listenerAttached = '1'; }

            // hint button behavior (guarded)
            const hintBtn = document.getElementById('quiz-hint-btn');
            if (hintBtn && !hintBtn.dataset.listenerAttached) {
                hintBtn.addEventListener('click', () => showHint(quiz.hint, duniaId));
                hintBtn.dataset.listenerAttached = '1';
            }

            // keyboard navigation for quizzes: 1-9 to select options, Enter to submit text input
            if (window.lastMateriKeydownHandler) { document.removeEventListener('keydown', window.lastMateriKeydownHandler); window.lastMateriKeydownHandler = null; }
            window.lastMateriKeydownHandler = function(e) {
                if (e.key >= '1' && e.key <= '9') {
                    const idx = parseInt(e.key, 10) - 1;
                    const opts = domElements.materiContent ? domElements.materiContent.querySelectorAll('.quiz-option') : [];
                    if (opts && opts[idx]) { opts[idx].click(); }
                } else if (e.key === 'Enter') {
                    const input = document.getElementById('quiz-input-text');
                    const submit = document.getElementById('quiz-submit-btn');
                    if (input && submit) { submit.click(); }
                } else if (e.key === 'h' || e.key === 'H') {
                    // quick hint
                    const hint = quiz.hint || '';
                    if (hint) showHint(hint, duniaId);
                }
            };
            document.addEventListener('keydown', window.lastMateriKeydownHandler);
        }

        function showHint(hintText, duniaId) {
            if (!hintText) {
                showMascotTip('Tidak ada petunjuk tersedia untuk kuis ini.');
                return;
            }
            // small penalty for using a hint
            addPoints(-2, duniaId, true);
            // display a styled hint modal
            domElements.hintModalContent = domElements.hintModalContent || document.getElementById('hint-modal-content');
            if (!domElements.hintModalContent) {
                // create a lightweight hint modal if not present
                const modal = document.createElement('div');
                modal.id = 'hint-modal';
                modal.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50';
                modal.innerHTML = `<div class="bg-white p-6 rounded-lg max-w-lg w-full"><h3 class="font-bold text-xl mb-3">Petunjuk</h3><div id="hint-modal-content" class="prose"></div><div class="mt-4 text-right"><button id="hint-close-btn" class="px-4 py-2 bg-gray-200 rounded">Tutup</button></div></div>`;
                document.body.appendChild(modal);
                domElements.hintModalContent = document.getElementById('hint-modal-content');
                document.getElementById('hint-close-btn').addEventListener('click', () => modal.remove());
            }
            domElements.hintModalContent.innerHTML = hintText;
            const existing = document.getElementById('hint-modal');
            if (existing) existing.style.display = 'flex';
            else document.getElementById('hint-modal')?.classList.remove('hidden');
        }

        function toggleFavorite(event) {
            const btn = event.currentTarget;
            const { duniaId, submateriId } = btn.dataset;
            const favoriteIndex = activeUser.favorites.findIndex(fav => fav.duniaId === duniaId && fav.submateriId === submateriId);

            if (favoriteIndex > -1) {
                activeUser.favorites.splice(favoriteIndex, 1);
                btn.classList.remove('favorited');
                showMascotTip("Dihapus dari favorit.");
            } else {
                activeUser.favorites.push({ duniaId, submateriId });
                btn.classList.add('favorited');
                showMascotTip("Ditambahkan ke favorit!");
                // daily mission: added favorite (use helper when mission type m2 is active)
                try { if (activeUser.dailyMission && !activeUser.dailyMission.claimed && activeUser.dailyMission.id === 'm2') updateMissionProgress(1); } catch(e) {}
            }
            playSound('click');
            saveData();
        }

        function renderFavorites() {
            domElements.favoritesList.innerHTML = '';
            if (activeUser.favorites.length === 0) {
                domElements.favoritesList.innerHTML = `<p class="text-center text-gray-500">Kamu belum punya kuis favorit. Tandai kuis dengan ikon bintang untuk berlatih lagi di sini!</p>`;
                return;
            }
            activeUser.favorites.forEach(fav => {
                const dunia = edukasiData[activeUser.jenjang].dunia[fav.duniaId];
                const submateri = dunia.subMateri[fav.submateriId];
                const colors = colorMapping[dunia.warna];
                const itemEl = document.createElement('div');
                itemEl.className = `p-4 rounded-lg flex justify-between items-center cursor-pointer hover:bg-gray-100 border-2 ${colors.border}`;
                itemEl.innerHTML = `
                    <div>
                        <span class="font-bold ${colors.text}">${submateri.judul}</span>
                        <p class="text-sm text-gray-500">${dunia.namaDunia}</p>
                    </div>
                    <span class="text-2xl">${dunia.icon}</span>`;
                itemEl.addEventListener('click', () => {
                    hideModals();
                    renderMateri(fav.duniaId, fav.submateriId);
                    switchScreen('materi-screen');
                });
                domElements.favoritesList.appendChild(itemEl);
            });
        }
        
        function setupNewUserScreen() {
            domElements.avatarSelectionContainer.innerHTML = '';
            Object.keys(avatarData).filter(id => avatarData[id].isStarter).forEach(avatarId => {
                const avatarEl = document.createElement('div');
                avatarEl.className = 'avatar-selection w-20 h-20 p-1';
                avatarEl.dataset.avatarId = avatarId;
                avatarEl.innerHTML = avatarData[avatarId].svg;
                avatarEl.addEventListener('click', () => {
                    document.querySelectorAll('.avatar-selection').forEach(el => el.classList.remove('selected'));
                    avatarEl.classList.add('selected');
                    selectedAvatarId = avatarId;
                    domElements.nextToLevelBtn.disabled = !domElements.playerNameInput.value.trim();
                });
                domElements.avatarSelectionContainer.appendChild(avatarEl);
            });
        }
        
        function startSession() {
            checkDailyLogin();
            updateUI();
            switchScreen('map-screen');
            renderDuniaMap();
        }

        function renderLeaderboard() {
            domElements.leaderboardList.innerHTML = '';
            const sortedUsers = [...userProfiles].sort((a, b) => b.points - a.points);
            sortedUsers.forEach((user, index) => {
                const rank = index + 1;
                const medal = rank === 1 ? '🥇' : rank === 2 ? '🥈' : rank === 3 ? '🥉' : `#${rank}`;
                const isCurrentUser = user.id === activeUser.id;
                const row = document.createElement('div');
                row.className = `flex items-center justify-between p-3 rounded-lg cursor-pointer hover:bg-gray-100 ${isCurrentUser ? 'bg-blue-100 border-2 border-blue-400' : ''}`;
                row.style.backgroundColor = isCurrentUser ? '' : 'var(--bg-color)';
                row.innerHTML = `<div class="flex items-center gap-3"><span class="font-bold text-lg w-8 text-center">${medal}</span><span class="font-semibold">${user.name}</span></div><span class="font-bold text-amber-600">${user.points} Poin</span>`;
                row.addEventListener('click', () => {
                    viewedUser = user;
                    renderStatsPage(user);
                });
                domElements.leaderboardList.appendChild(row);
            });
        }
        
        function renderStatsPage(user) {
            hideModals();
            domElements.statsUsername.textContent = `Statistik ${user.name}`;
            const jenjang = user.jenjang;
            const badges = jenjang ? edukasiData[jenjang].badges : {};
            const userBadges = user.badges && user.badges[jenjang] ? user.badges[jenjang] : [];
            domElements.statsContent.innerHTML = `
                <div class="p-3 rounded-lg flex justify-between items-center" style="background-color: var(--bg-color);"><strong>Poin:</strong> <span class="font-bold text-amber-700">${user.points}</span></div>
                <div class="p-3 rounded-lg flex justify-between items-center" style="background-color: var(--bg-color);"><strong>Kuis Selesai:</strong> <span class="font-bold text-green-700">${user.stats.quizzesCompleted || 0}</span></div>
                <div class="p-3 rounded-lg flex justify-between items-center" style="background-color: var(--bg-color);"><strong>Lencana:</strong> <span class="font-bold text-sky-700">${userBadges.length} / ${Object.keys(badges).length}</span></div>
                <div class="p-3 rounded-lg flex justify-between items-center" style="background-color: var(--bg-color);"><strong>Login Beruntun:</strong> <span class="font-bold text-red-700">${user.loginStreak || 0} Hari</span></div>
            `;
            showModal('stats-modal');
        }
        
        function initializeApp() {
            setTimeout(() => {
                // ensure achievements definitions are populated
                try { ensureAchievementDefinitions(15); } catch(e) {}
                if (loadData() && userProfiles.length > 0) { 
                    // ensure old users have default equipped audio if missing
                    try { userProfiles.forEach(u => { if (!u.equipped) ensureDefaultAudioEquipped(u); }); } catch(e){}
                    renderUserSelectionScreen();
                } else { 
                    setupNewUserScreen();
                    switchScreen('name-entry-screen');
                }
            }, 500);
        }

        function renderUserSelectionScreen() {
            domElements.userListContainer.innerHTML = ''; 
            userProfiles.forEach((user, index) => {
                const card = document.createElement('div');
                card.className = 'user-card p-4 rounded-2xl shadow-lg text-center cursor-pointer card-hover';
                card.style.backgroundColor = 'var(--card-bg-color)';
                card.innerHTML = `${avatarData[user.avatarId]?.svg || ''}<h3 class="font-bold text-xl">${user.name}</h3>`;
                card.addEventListener('click', () => { 
                    playSound('click'); 
                    currentUserIndex = index; 
                    activeUser = userProfiles[index];
                    if (!activeUser.jenjang) {
                        domElements.jenjangPromptName.textContent = `Hai ${activeUser.name}, ayo pilih jenjangmu!`;
                        switchScreen('jenjang-screen');
                    } else {
                        try { loadDefaultAudioAssets(); } catch(e){}
                        // ensure the global currentBgmKey reflects the user's equipped bgm so applySettings/toggleMusic can start it
                        try { currentBgmKey = activeUser.equipped && activeUser.equipped.bgm ? activeUser.equipped.bgm : null; } catch(e) { currentBgmKey = null; }
                        applySettings();
                        // if music is enabled and we have a bgm key, start it
                        try { if (activeUser.settings && activeUser.settings.musicOn && currentBgmKey) equipBgm(currentBgmKey); } catch(e){}
                        startSession();
                    }
                });
                domElements.userListContainer.appendChild(card);
            });
            switchScreen('user-selection-screen');
        }

        // --- Inisialisasi & Helper Functions ---
        // Play a sound respecting soundOn/sfxOn settings. 'type' may be a store preview key.
    async function playSound(type, previewKey) {
            try {
                // fallback settings when no activeUser yet
                const settings = (activeUser && activeUser.settings) ? activeUser.settings : { soundOn: true, sfxOn: true, musicOn: true };
                if (!settings.soundOn) return; // master mute
                const sfxAllowed = !!settings.sfxOn;
                const musicAllowed = !!settings.musicOn;
                // ensure audio context starts (await permission) and mark unlocked
                try {
                    if (typeof Tone !== 'undefined' && !audioUnlocked) {
                        await Tone.start();
                        audioUnlocked = true;
                    }
                } catch(e){}

                // Music actions
                if (type === 'bgm_preview' || type === 'bgm') {
                    if (!musicAllowed) return;
                    // prefer Tone-based BGM if equipped, otherwise HTML audio
                    if (currentBgmKey) {
                        try { equipBgm(currentBgmKey); } catch(e){}
                    } else if (domElements.backgroundMusic && domElements.backgroundMusic.src) {
                        domElements.backgroundMusic.play().catch(()=>{});
                    }
                    return;
                }

                // SFX path — respect sfx toggle
                if (!sfxAllowed) return;

                // If user has equipped SFX for this type, prefer that mapping
                try {
                    if (activeUser && activeUser.equipped && typeof type === 'string') {
                        // map common types to equipped keys (e.g., 'click' -> equipped.sfx_click)
                        const equipMap = {
                            click: 'sfx_click',
                            correct: 'sfx_correct',
                            wrong: 'sfx_wrong',
                            purchase: 'sfx_purchase',
                            badge: 'sfx_badge',
                            open: 'sfx_open',
                        };
                        const eqKey = equipMap[type];
                        if (eqKey && activeUser.equipped[eqKey]) {
                            const userSfxId = activeUser.equipped[eqKey];
                            // If sounds contains that id, play it
                            if (sounds[userSfxId]) { type = userSfxId; }
                        }
                    }
                } catch(e){}

                // common built-in labels
                if (type === 'correct' && sounds.correct) { if (typeof sounds.correct.triggerAttackRelease === 'function') sounds.correct.triggerAttackRelease("C5", "8n", Tone.now()); else if (typeof sounds.correct === 'function') sounds.correct(); return; }
                if (type === 'wrong' && sounds.wrong) { if (typeof sounds.wrong.triggerAttackRelease === 'function') sounds.wrong.triggerAttackRelease("C3", "8n", Tone.now()); else if (typeof sounds.wrong === 'function') sounds.wrong(); return; }
                if (type === 'badge' && sounds.badge) { try { if (typeof sounds.badge.triggerAttackRelease === 'function') { sounds.badge.triggerAttackRelease("G4", "8n", Tone.now()); sounds.badge.triggerAttackRelease("C5", "8n", Tone.now() + 0.2); } else if (typeof sounds.badge === 'function') sounds.badge(); } catch(e){} return; }

                const s = sounds[type];
                if (!s) {
                    // fallback default click
                    if (sounds.click) {
                        if (typeof sounds.click.triggerAttackRelease === 'function') sounds.click.triggerAttackRelease("C4", "8n");
                        else if (typeof sounds.click === 'function') sounds.click();
                    }
                    return;
                }

                // If the entry is a function (factory or direct play), call it
                if (typeof s === 'function') { try { s(); } catch(e){} return; }

                // If it's a Tone.Player-like object with start/stop
                if (s && typeof s.start === 'function') {
                    try {
                        // start immediately
                        s.start?.(0);
                        // if a stop method exists, schedule a safe stop short after (prevent runaway playback)
                        if (typeof s.stop === 'function') {
                            setTimeout(() => { try { s.stop(); } catch(e){} }, 1400);
                        }
                    } catch(e) {
                        try { s.start?.(); } catch(e){}
                    }
                    return;
                }

                // If it's a synth with triggerAttackRelease
                if (typeof s.triggerAttackRelease === 'function') { try { s.triggerAttackRelease("C4", "8n", Tone.now()); } catch(e){} return; }


            } catch (e) { console.warn('playSound error', e); }
        }

        // Runtime-generated audio assets (no external files required)
        const bgmLoops = {};
        let currentBgmKey = null;

        function applyVolumeSettings() {
            try {
                const mv = (activeUser && activeUser.settings && typeof activeUser.settings.musicVolume === 'number') ? (activeUser.settings.musicVolume/100) : 0.45;
                const sv = (activeUser && activeUser.settings && typeof activeUser.settings.sfxVolume === 'number') ? (activeUser.settings.sfxVolume/100) : 1.0;
                // Apply to Tone destinations if possible
                try { Tone.Destination.volume.value = (mv > 0 ? (20 * Math.log10(mv)) : -Infinity); } catch(e){}
                // For fine-grained control, set individual synth/player volumes if they exist
                Object.values(bgmLoops || {}).forEach(b => { try { if (b.synth && b.synth.volume) b.synth.volume.value = -12 + (mv-0.45)*24; } catch(e){} });
                Object.keys(sounds || {}).forEach(k => {
                    try {
                        const s = sounds[k];
                        if (s && typeof s.volume === 'object' && typeof s.volume.value === 'number') {
                            // Tone.js objects
                            s.volume.value = (sv === 0) ? -Infinity : -6 + (sv-1.0)*12;
                        }
                    } catch(e){}
                });
                // HTMLAudio fallback
                if (domElements.backgroundMusic) domElements.backgroundMusic.volume = mv;
            } catch(e){}
        }

        function loadDefaultAudioAssets() {
            try {
                // Simple SFX implementations using short synth bursts
                const makeSfx = (name, freq, dur = '8n', type = 'sine') => {
                    sounds[name] = () => {
                        try {
                            const s = new Tone.Synth({ oscillator: { type } , envelope: { attack: 0.005, decay: 0.12, sustain: 0.0, release: 0.05 } }).toDestination();
                            s.triggerAttackRelease(freq, dur, Tone.now());
                            // dispose after short time
                            setTimeout(()=>{ try{ s.dispose(); }catch(e){} }, 800);
                        } catch(e){}
                    };
                };

                makeSfx('sfx_click_soft', 'C5', '8n', 'sine');
                makeSfx('sfx_click_tick', 'D5', '8n', 'triangle');
                makeSfx('sfx_nav_swipe', 'G4', '16n', 'sine');
                makeSfx('sfx_nav_boop', 'A4', '8n', 'sine');
                makeSfx('sfx_pop_light', 'E5', '8n', 'sine');
                makeSfx('sfx_slide', 'C4', '8n', 'sine');
                makeSfx('sfx_confirm', 'E4', '8n', 'triangle');
                makeSfx('sfx_reward_snap', 'G5', '8n', 'sawtooth');
                // some synth-based effects
                sounds['sfx_win_chime'] = () => {
                    try {
                        const p = new Tone.PolySynth(Tone.Synth, { oscillator: { type: 'triangle' } }).toDestination();
                        p.triggerAttackRelease(['C5','E5','G5'], '4n', Tone.now());
                        setTimeout(()=>{ try{ p.dispose(); }catch(e){} }, 800);
                    } catch(e){}
                };
                sounds['sfx_error'] = () => { try{ const s = new Tone.Synth({ oscillator: { type: 'sawtooth' } }).toDestination(); s.triggerAttackRelease('C3', '8n', Tone.now()); setTimeout(()=>s.dispose(),400);}catch(e){} };

                // Create simple BGM loops (short chord progressions)
                const makeBgm = (key, chords, interval = '2n', volume = -8) => {
                    try {
                        const synth = new Tone.PolySynth(Tone.Synth, { oscillator: { type: 'sine' }, envelope: { attack: 0.02, decay: 0.4, sustain: 0.3, release: 1 } }).toDestination();
                        synth.volume.value = volume;
                        const loop = new Tone.Loop((time) => {
                            const chord = chords[Math.floor(Math.random() * chords.length)];
                            synth.triggerAttackRelease(chord, '1n', time);
                        }, interval);
                        bgmLoops[key] = { synth, loop };
                        // do not start yet
                    } catch(e){}
                };

                makeBgm('calm1', [['C4','E4','G4'], ['A3','E4','C4']], '2n', -12);
                makeBgm('calm2', [['D4','F#4','A4'], ['B3','F#4','D4']], '2n', -12);
                makeBgm('focus1', [['E4','G#4','B4'], ['C#4','G#4','E4']], '2n', -8);
                makeBgm('uplift1', [['G4','B4','D5'], ['E4','B4','G4']], '2n', -6);
                makeBgm('amb1', [['C4','G3','E4'], ['F3','C4','A3']], '2n', -14);
                // additional bgm variations used by the shop
                makeBgm('focus2', [['B3','D4','F#4'], ['A3','E4','C4']], '2n', -8);
                makeBgm('uplift2', [['A4','C#5','E5'], ['F#4','C#5','A4']], '2n', -6);
                makeBgm('amb2', [['E4','B3','G3'], ['D4','A3','F3']], '2n', -14);
                makeBgm('chill1', [['G3','B3','D4'], ['E3','G3','C4']], '2n', -10);
                makeBgm('cin1', [['C3','G3','C4'], ['E3','B3','G3']], '2n', -8);

            } catch(e){}
            try { applyVolumeSettings(); } catch(e){}
        }

        // Preview management
        const previewTimeouts = {};
        let activePreview = null;
        function stopPreview(key) {
            try {
                if (!key && activePreview) key = activePreview;
                if (!key) return;
                // Stop Tone loop preview
                if (bgmLoops[key]) {
                    try { bgmLoops[key].loop.stop(); } catch(e){}
                    try { Tone.Transport.stop(); } catch(e){}
                }
                // stop any HTMLAudio fallback
                try { if (domElements.backgroundMusic && domElements.backgroundMusic.src && !activeUser.equipped?.bgm) domElements.backgroundMusic.pause(); } catch(e){}
                // clear timeout
                if (previewTimeouts[key]) { clearTimeout(previewTimeouts[key]); delete previewTimeouts[key]; }
                // remove previewing class from shop items
                document.querySelectorAll('.shop-item.previewing').forEach(el => el.classList.remove('previewing'));
                activePreview = null;
            } catch(e){}
        }

        function startBgmPreview(key, el) {
            try {
                stopPreview();
                if (!bgmLoops[key]) { // if not Tone loop created, try to fallback to backgroundMusic src mapping
                    // try to set html audio src if we have a mapping (not present by default)
                    if (domElements.backgroundMusic && domElements.backgroundMusic.src) domElements.backgroundMusic.play().catch(()=>{});
                    activePreview = key;
                    previewTimeouts[key] = setTimeout(()=> stopPreview(key), 12000);
                    if (el) el.classList.add('previewing');
                    return;
                }
                // start the Tone loop for preview
                try { bgmLoops[key].loop.start(0); Tone.Transport.start(); } catch(e){}
                activePreview = key;
                previewTimeouts[key] = setTimeout(()=> stopPreview(key), 12000);
                if (el) el.classList.add('previewing');
            } catch(e){}
        }

        function equipBgm(key) {
            try {
                // stop previous
                if (currentBgmKey && bgmLoops[currentBgmKey]) {
                    bgmLoops[currentBgmKey].loop.stop();
                }
                currentBgmKey = key;
                if (bgmLoops[key]) {
                    bgmLoops[key].loop.start(0);
                    if (activeUser && activeUser.settings && activeUser.settings.musicOn) {
                        Tone.Transport.start();
                    }
                }
            } catch(e){}
        }

        function stopBgm() {
            try {
                if (currentBgmKey && bgmLoops[currentBgmKey]) bgmLoops[currentBgmKey].loop.stop();
                currentBgmKey = null;
                try { Tone.Transport.stop(); } catch(e){}
            } catch(e){}
        }

        // Some browsers require a user gesture to start audio. Unlock on first gesture.
        let audioUnlocked = false;
        async function unlockAudioOnce() {
            if (audioUnlocked) return;
            audioUnlocked = true;
            try {
                if (typeof Tone !== 'undefined') {
                    try { await Tone.start(); } catch(e){}
                }
                // try to resume any equipped bgm if music is enabled
                if (activeUser && activeUser.settings && activeUser.settings.musicOn) {
                    try {
                        if (currentBgmKey && bgmLoops[currentBgmKey]) {
                            equipBgm(currentBgmKey);
                        } else if (domElements.backgroundMusic && domElements.backgroundMusic.src) {
                            domElements.backgroundMusic.play().catch(()=>{});
                        }
                    } catch(e){}
                }
            } catch(e){}
            // remove the event listener (if present)
            try { document.body.removeEventListener('pointerdown', unlockAudioOnce); } catch(e){}
        }
        document.body.addEventListener('pointerdown', unlockAudioOnce, { once: true });
    function saveData() { if (currentUserIndex > -1 && activeUser) { userProfiles[currentUserIndex] = activeUser; } localStorage.setItem('petualanganPengetahuanV4', JSON.stringify(userProfiles)); showAutosave(); }
        function loadData() { const d = localStorage.getItem('petualanganPengetahuanV4'); if (d) { userProfiles = JSON.parse(d); return true; } return false; }
        function switchScreen(id) { domElements.screens.forEach(s => s.classList.remove('active')); const screen = document.getElementById(id); if (screen) screen.classList.add('active'); }
    // Lightweight aliases that delegate to the enhanced modal management defined later.
    // These keep older callsites working until the robust implementations are parsed.
    function showModal(id) { try { if (typeof enhancedShowModal === 'function') { enhancedShowModal(id); } else { playSound('open'); try { window.showModal && window.showModal(id); } catch(e) { const modal = document.getElementById(id); if (modal) modal.classList.add('active'); } } } catch(e){} }
    function hideModals() { try { if (typeof enhancedHideModals === 'function') { enhancedHideModals(); } else { try { window.hideModals && window.hideModals(); } catch(e) { domElements.modals.forEach(m => m.classList.remove('active')); } } } catch(e){} }
        function applySettings() {
            // clear theme classes then apply
            document.body.classList.remove('dark', 'high-contrast', 'light');
            const theme = activeUser.settings.theme || 'light';
            if (theme === 'dark') document.body.classList.add('dark');
            else if (theme === 'high-contrast') document.body.classList.add('high-contrast');
            else document.body.classList.add('light');
            // reflect toggles in UI
            try {
                if (domElements.soundToggleBtn) domElements.soundToggleBtn.textContent = activeUser.settings.soundOn ? '🔊' : '🔈';
                if (domElements.musicToggleBtn) domElements.musicToggleBtn.textContent = activeUser.settings.musicOn ? '🎵' : '🎶';
                if (domElements.zenModeToggle) domElements.zenModeToggle.checked = !!activeUser.settings.zenMode;
                // SFX toggle and volume sliders
                try { if (domElements.sfxToggle) domElements.sfxToggle.checked = !!activeUser.settings.sfxOn; } catch(e){}
                try { if (domElements.musicVolumeSlider && typeof activeUser.settings.musicVolume === 'number') { domElements.musicVolumeSlider.value = activeUser.settings.musicVolume; domElements.musicVolumeLabel.textContent = `${activeUser.settings.musicVolume}%`; } }
                catch(e){}
                try { if (domElements.sfxVolumeSlider && typeof activeUser.settings.sfxVolume === 'number') { domElements.sfxVolumeSlider.value = activeUser.settings.sfxVolume; domElements.sfxVolumeLabel.textContent = `${activeUser.settings.sfxVolume}%`; } }
                catch(e){}
            } catch(e){}
            toggleMusic(activeUser.settings.musicOn);
            // apply volume settings to Tone and HTMLAudio
            try { applyVolumeSettings(); } catch(e){}
        }
        function toggleMusic(forceState) {
            try {
                if (!activeUser) return;
                const musicOn = typeof forceState === 'boolean' ? forceState : !activeUser.settings.musicOn;
                activeUser.settings.musicOn = !!musicOn;
                // prefer Tone-based bgm if equipped
                if (musicOn) {
                    if (currentBgmKey && bgmLoops[currentBgmKey]) {
                        try {
                            // stop other loops first
                            Object.keys(bgmLoops).forEach(k => { try { bgmLoops[k].loop.stop(); } catch(e){} });
                            bgmLoops[currentBgmKey].loop.start(0);
                            if (!Tone.Transport.state || Tone.Transport.state === 'stopped') try { Tone.Transport.start(); } catch(e){}
                        } catch(e){}
                    } else if (domElements.backgroundMusic && domElements.backgroundMusic.src) {
                        try { domElements.backgroundMusic.currentTime = 0; domElements.backgroundMusic.play().catch(()=>{}); } catch(e){}
                    }
                    if (domElements.musicToggleBtn) domElements.musicToggleBtn.textContent = '🎵';
                    document.body.classList.add('music-on');
                } else {
                    // stop both
                    try { if (Tone.Transport.state && Tone.Transport.state !== 'stopped') Tone.Transport.stop(); } catch(e){}
                    try { if (currentBgmKey && bgmLoops[currentBgmKey]) bgmLoops[currentBgmKey].loop.stop(); } catch(e){}
                    try { if (domElements.backgroundMusic) { domElements.backgroundMusic.pause(); domElements.backgroundMusic.currentTime = 0; } } catch(e){}
                    if (domElements.musicToggleBtn) domElements.musicToggleBtn.textContent = '🎶';
                    document.body.classList.remove('music-on');
                }
                saveData();
            } catch(e){ console.warn('toggleMusic error', e); }
        }

        function toggleSfx(forceState) {
            try {
                if (!activeUser) return;
                const sfxOn = typeof forceState === 'boolean' ? forceState : !activeUser.settings.sfxOn;
                activeUser.settings.sfxOn = !!sfxOn;
                if (domElements.soundToggleBtn) domElements.soundToggleBtn.textContent = (activeUser.settings.soundOn && activeUser.settings.sfxOn) ? '🔊' : '🔈';
                saveData();
            } catch(e) { console.warn('toggleSfx error', e); }
        }

        // --- New features: Search, Fullscreen, Export/Import, Shop rendering/purchase, Missions & Achievements automation, Undo ---

        // Search filtering for dunia
        domElements.searchBar.addEventListener('input', (e) => {
            const q = e.target.value.trim().toLowerCase();
            const jenjang = activeUser?.jenjang;
            if (!jenjang) return;
            const container = domElements.duniaContainer;
            Array.from(container.children).forEach(card => {
                const title = card.querySelector('h3')?.textContent?.toLowerCase() || '';
                const desc = card.querySelector('p')?.textContent?.toLowerCase() || '';
                card.style.display = (title.includes(q) || desc.includes(q) || q === '') ? '' : 'none';
            });
        });

        // Fullscreen (robust cross-browser toggle, update icon, play sound)
        (function wireFullscreen(){
            const btn = document.getElementById('fullscreen-btn');
            if (!btn) return;
            function isFullscreen() { return !!(document.fullscreenElement || document.webkitFullscreenElement || document.mozFullScreenElement || document.msFullscreenElement); }
            function requestFS(el) {
                if (el.requestFullscreen) return el.requestFullscreen();
                if (el.webkitRequestFullscreen) return el.webkitRequestFullscreen();
                if (el.mozRequestFullScreen) return el.mozRequestFullScreen();
                if (el.msRequestFullscreen) return el.msRequestFullscreen();
                return Promise.reject(new Error('No fullscreen API'));
            }
            function exitFS() {
                if (document.exitFullscreen) return document.exitFullscreen();
                if (document.webkitExitFullscreen) return document.webkitExitFullscreen();
                if (document.mozCancelFullScreen) return document.mozCancelFullScreen();
                if (document.msExitFullscreen) return document.msExitFullscreen();
                return Promise.reject(new Error('No exit fullscreen'));
            }
            // set initial icon
            try { btn.textContent = isFullscreen() ? '❐' : '⛶'; } catch(e){}
            btn.addEventListener('click', (ev)=>{
                ev.preventDefault(); try { playSound('click'); } catch(e){}
                if (!isFullscreen()) {
                    requestFS(document.documentElement).then(()=>{ try{ btn.textContent = '❐'; }catch(e){} }).catch(()=>{});
                } else {
                    exitFS().then(()=>{ try{ btn.textContent = '⛶'; }catch(e){} }).catch(()=>{});
                }
            });
            // keep icon in sync when user exits with ESC
            document.addEventListener('fullscreenchange', ()=>{ try{ btn.textContent = isFullscreen() ? '❐' : '⛶'; }catch(e){} });
        })();

        // Export / Import progress (JSON)
        function exportProgress() {
            const dataStr = JSON.stringify({ users: userProfiles, exportedAt: new Date().toISOString() }, null, 2);
            const blob = new Blob([dataStr], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a'); a.href = url; a.download = 'petualangan-export.json'; a.click(); URL.revokeObjectURL(url);
        }
        function importProgress(file) {
            const reader = new FileReader();
            reader.onload = (ev) => {
                try {
                    const data = JSON.parse(ev.target.result);
                    if (data.users) {
                        userProfiles = data.users;
                        saveData();
                        initializeApp();
                        showMascotTip('Impor berhasil. Profil terupdate.');
                    }
                } catch (e) { showMascotTip('File impor tidak valid.'); }
            };
            reader.readAsText(file);
        }

        // small file input for import
        const importInput = document.createElement('input'); importInput.type = 'file'; importInput.accept = '.json'; importInput.style.display='none';
        importInput.addEventListener('change', (e)=> { if(e.target.files[0]) importProgress(e.target.files[0]); });
        document.body.appendChild(importInput);

        // wire export/import into settings appearance tab
        const exportBtn = document.createElement('button'); exportBtn.className='w-full p-2 border-2 rounded-lg font-semibold mt-2'; exportBtn.textContent='📤 Export Data';
        exportBtn.addEventListener('click', exportProgress);
        const importBtn = document.createElement('button'); importBtn.className='w-full p-2 border-2 rounded-lg font-semibold mt-2'; importBtn.textContent='📥 Import Data';
        importBtn.addEventListener('click', ()=> importInput.click());
        domElements.themeSelector.appendChild(exportBtn);
        domElements.themeSelector.appendChild(importBtn);

        // Add volume controls to settings area (with SFX on/off)
        try {
            const volContainer = document.createElement('div'); volContainer.className='p-3 mt-4';
            volContainer.innerHTML = `<div class="font-semibold mb-2">Pengaturan Suara</div>
                <label class="block text-sm mb-1">Volume Musik: <span id="music-volume-label">45%</span></label>
                <input id="music-volume-slider" type="range" min="0" max="100" value="45" class="w-full"/>
                <label class="block text-sm mt-3 mb-1">Volume Efek: <span id="sfx-volume-label">100%</span></label>
                <input id="sfx-volume-slider" type="range" min="0" max="100" value="100" class="w-full"/>
                <div class="mt-3 flex items-center gap-2"><input id="sfx-toggle" type="checkbox" /> <label for="sfx-toggle" class="text-sm">Efek Suara (SFX)</label></div>`;
            domElements.themeSelector.appendChild(volContainer);
            // attach refs
            domElements.musicVolumeSlider = document.getElementById('music-volume-slider');
            domElements.sfxVolumeSlider = document.getElementById('sfx-volume-slider');
            domElements.musicVolumeLabel = document.getElementById('music-volume-label');
            domElements.sfxVolumeLabel = document.getElementById('sfx-volume-label');
            domElements.sfxToggle = document.getElementById('sfx-toggle');
            // initialize from settings (if available)
            try {
                const mv = (activeUser && activeUser.settings && typeof activeUser.settings.musicVolume === 'number') ? activeUser.settings.musicVolume : 45;
                const sv = (activeUser && activeUser.settings && typeof activeUser.settings.sfxVolume === 'number') ? activeUser.settings.sfxVolume : 100;
                domElements.musicVolumeSlider.value = mv;
                domElements.sfxVolumeSlider.value = sv;
                domElements.musicVolumeLabel.textContent = `${Math.round(mv)}%`;
                domElements.sfxVolumeLabel.textContent = `${Math.round(sv)}%`;
                // sfx on/off
                domElements.sfxToggle.checked = !!(activeUser && activeUser.settings && activeUser.settings.sfxOn);
            } catch(e){}
            // event wiring
            domElements.musicVolumeSlider.addEventListener('input', (e)=>{
                const v = Number(e.target.value)/100; domElements.musicVolumeLabel.textContent = `${Math.round(v*100)}%`;
                activeUser.settings.musicVolume = Math.round(v*100);
                saveData(); applyVolumeSettings();
            });
            domElements.sfxVolumeSlider.addEventListener('input', (e)=>{
                const v = Number(e.target.value)/100; domElements.sfxVolumeLabel.textContent = `${Math.round(v*100)}%`;
                activeUser.settings.sfxVolume = Math.round(v*100);
                saveData(); applyVolumeSettings();
            });
            domElements.sfxToggle.addEventListener('change', (e)=>{ toggleSfx(!!e.target.checked); });
        } catch(e){}

        // Attach guarded click SFX to header buttons (avoid duplicate bindings)
        try {
            const headerClickIds = ['settings-btn','achievements-btn','daily-mission-btn','shop-hub-btn','inventory-btn','leaderboard-btn','fullscreen-btn'];
            headerClickIds.forEach(id => {
                const el = document.getElementById(id);
                if (!el) return;
                if (el.dataset.listenerAttached) return;
                el.addEventListener('click', (ev)=>{
                    try { playSound('click'); } catch(e){ /* ignore */ }
                });
                el.dataset.listenerAttached = '1';
            });
        } catch(e){}

        // Render shops and purchase logic
        function renderShop(tokoKey) {
            let toko = shopData[tokoKey];
            if (!toko) return;
            domElements.genericShopTitle.textContent = toko.title;
            // short subtitle reminding users that built-in defaults are active
            try { domElements.genericShopSubtitle = domElements.genericShopSubtitle || document.getElementById('generic-shop-subtitle'); if (domElements.genericShopSubtitle) domElements.genericShopSubtitle.textContent = 'Suara standar sudah aktif — toko berisi variasi. Tekan "Pilih" untuk mengganti.'; } catch(e){}
            domElements.genericShopPoints.textContent = `${activeUser.points} Poin`;
            domElements.genericShopContainer.innerHTML = '';
                for (const itemId in toko.items) {
                const item = toko.items[itemId];
                const el = document.createElement('div');
                el.className = 'shop-item p-4 rounded-xl text-center relative';
                // sale badge and favorite
                const saleBadge = item.sale ? `<div class="bonus-world-badge">Sale ${item.sale}%</div>` : '';
                const favBtn = `<button title="Favorit" class="favorite-btn absolute top-2 left-2 text-lg">${(activeUser && activeUser.favorites && activeUser.favorites.includes(itemId)) ? '★' : '☆'}</button>`;
                // Determine owned / equipped state
                const owned = (activeUser && activeUser.inventory && activeUser.inventory.find(it => it.id === itemId && it.toko === tokoKey));
                const isEquipped = (activeUser && activeUser.equipped && ((item.type === 'bgm' && activeUser.equipped.bgm === (item.preview || itemId)) || (item.type === 'sfx' && Object.values(activeUser.equipped || {}).includes(itemId))));
                const statusBadge = owned ? `<div class="text-xs text-green-700 mt-1">${isEquipped ? 'Terpasang' : 'Dimiliki'}</div>` : '';
                el.innerHTML = `${saleBadge}${favBtn}<div class="text-4xl mb-2" data-title="${item.desc || item.name}">${item.icon || ''}</div><div class="font-semibold">${item.name}</div><div class="text-sm text-gray-500 mt-1">${item.price} Poin</div>${statusBadge}`;
                if (owned) el.classList.add('owned');
                if (isEquipped) el.classList.add('equipped');
                // tooltip wiring
                el.addEventListener('mouseenter', (ev)=> showTooltip(item.desc || item.name, ev.clientX, ev.clientY));
                el.addEventListener('mousemove', (ev)=> showTooltip(item.desc || item.name, ev.clientX, ev.clientY));
                el.addEventListener('mouseleave', hideTooltip);
                // favorite button wiring
                el.querySelectorAll('.favorite-btn').forEach(b => b.addEventListener('click', (ev)=>{ ev.stopPropagation(); toggleShopFavorite(itemId); b.textContent = activeUser.favorites.includes(itemId) ? '★' : '☆'; }));
                // Add preview and equip controls for bgm/sfx stores
                if (tokoKey === 'bgmStore' || tokoKey === 'sfxStore') {
                    const controls = document.createElement('div');
                    controls.className = 'shop-controls mt-3 flex gap-2 justify-center';
                    const previewBtn = document.createElement('button'); previewBtn.className='px-3 py-1 rounded-full bg-white border'; previewBtn.textContent='Pratinjau';
                    const equipBtn = document.createElement('button'); equipBtn.className='px-3 py-1 rounded-full bg-amber-500 text-white'; equipBtn.textContent='Pilih';
                    controls.appendChild(previewBtn); controls.appendChild(equipBtn);
                    el.appendChild(controls);

                    previewBtn.addEventListener('click', (ev)=>{ ev.stopPropagation(); try {
                            if (item.type === 'bgm') {
                                // toggle preview
                                if (el.classList.contains('previewing')) { stopPreview(item.preview); }
                                else { startBgmPreview(item.preview, el); showMascotTip('Memutar pratinjau...'); }
                            } else if (item.type === 'sfx') {
                                // sfx preview: play once and indicate previewing briefly
                                el.classList.add('previewing');
                                playSound(item.preview);
                                setTimeout(()=> el.classList.remove('previewing'), 1200);
                            }
                        } catch(e){} });

                    equipBtn.addEventListener('click', (ev)=>{ ev.stopPropagation(); try {
                        // persist equip into activeUser.equipped map
                        activeUser.equipped = activeUser.equipped || {};
                        if (item.type === 'bgm') {
                            activeUser.equipped.bgm = item.preview || itemId;
                            currentBgmKey = item.preview || itemId;
                            // start bgm if music is on
                            if (activeUser.settings && activeUser.settings.musicOn) try { equipBgm(currentBgmKey); } catch(e){}
                        } else if (item.type === 'sfx') {
                            // choose a reasonable mapping key: map preview id to click-type slot if name contains 'click' etc.
                            const slot = itemId.includes('click') ? 'sfx_click' : (itemId.includes('win') ? 'sfx_correct' : 'sfx_click');
                            activeUser.equipped[slot] = itemId;
                        }
                        saveData(); playSound('equip'); showMascotTip(`${item.name} dipilih!`);
                    } catch(e){ showMascotTip('Gagal memilih item.'); } });
                }

                el.addEventListener('click', () => {
                    // purchase with micro-interaction
                    if (activeUser.points >= item.price) {
                        activeUser.points -= item.price;
                        activeUser.inventory = activeUser.inventory || [];
                        activeUser.inventory.push({ toko: tokoKey, id: itemId, item });
                        // Do NOT auto-equip on purchase: keep built-in defaults active.
                        // The purchased item is added to inventory; use the 'Pilih' button to equip it explicitly.
                        try { activeUser.equipped = activeUser.equipped || {}; } catch(e){}
                        // play & visual
                        playSound('purchase');
                        if (confirmationsEnabled) spawnFloatingConfirm(el, `✓ ${item.name}`);
                        recordPurchase(`${item.name} (${tokoKey}) - ${item.price} Poin`);
                        el.classList.add('owned');
                        // mark equipped visually
                        if (item.type === 'bgm' && activeUser.equipped && activeUser.equipped.bgm === (item.preview || itemId)) el.classList.add('equipped');
                        if (item.type === 'sfx') { const slot = itemId.includes('click') ? 'sfx_click' : (itemId.includes('win') ? 'sfx_correct' : 'sfx_click'); if (activeUser.equipped[slot] === itemId) el.classList.add('equipped'); }
                        saveData();
                        domElements.genericShopPoints.textContent = `${activeUser.points} Poin`;
                        showMascotTip(`${item.name} berhasil dibeli! Item ditambahkan ke inventori. Tekan 'Pilih' untuk memasang.`);
                    } else {
                        el.classList.add('shake');
                        setTimeout(()=>el.classList.remove('shake'), 450);
                        playSound('wrong');
                        showMascotTip('Poin tidak cukup. Selesaikan kuis untuk mendapatkan poin.');
                    }
                });
                domElements.genericShopContainer.appendChild(el);
            }
            showModal('generic-shop-modal');
        }

        // connect shop hub buttons
        document.getElementById('open-avatar-shop').addEventListener('click', () => {
            // render avatar shop specifically
            domElements.avatarShopContainer.innerHTML = '';
            domElements.shopPointsDisplay.textContent = `${activeUser.points} Poin`;
            Object.keys(shopData.tokoAvatar.items).forEach(id => {
                const it = shopData.tokoAvatar.items[id];
                const div = document.createElement('div'); div.className='shop-item p-3 rounded-xl text-center';
                div.innerHTML = `<div class='mb-2'>${it.svg || it.icon || '👤'}</div><div class='font-semibold'>${it.name}</div><div class='text-sm text-gray-500'>${it.price} Poin</div>`;
                div.addEventListener('click', () => {
                    if (activeUser.points >= it.price) {
                        activeUser.points -= it.price; 
                        activeUser.unlockedAvatars = activeUser.unlockedAvatars || [];
                        if (!activeUser.unlockedAvatars.includes(id)) activeUser.unlockedAvatars.push(id);
                        saveData(); 
                        domElements.shopPointsDisplay.textContent = `${activeUser.points} Poin`; 
                        playSound('purchase'); 
                        if (confirmationsEnabled) spawnFloatingConfirm(div, `✓ ${it.name}`);
                        recordPurchase(`${it.name} (avatar) - ${it.price} Poin`);
                        div.classList.add('owned');
                        showMascotTip(`${it.name} dibuka!`);
                    } else { div.classList.add('shake'); setTimeout(()=>div.classList.remove('shake'),450); playSound('wrong'); showMascotTip('Poin tidak cukup.'); }
                });
                domElements.avatarShopContainer.appendChild(div);
            });
            showModal('avatar-shop-modal');
        });

    // connect generic toko buttons
    document.getElementById('open-customization-shop').addEventListener('click', () => { renderShop('customization'); });
    // open new BGM and SFX stores
    const bgmBtn = document.getElementById('open-bgm-shop'); if (bgmBtn) bgmBtn.addEventListener('click', ()=>{ hideModals(); renderShop('bgmStore'); });
    const sfxBtn = document.getElementById('open-sfx-shop'); if (sfxBtn) sfxBtn.addEventListener('click', ()=>{ hideModals(); renderShop('sfxStore'); });

        // Achievements awarding when submateri completed
        function checkForBadges(jenjang) {
            const jen = edukasiData[jenjang];
            if (!jen) return;
            // achievementsDefinitions is available globally above
            for (const duniaId in jen.dunia) {
                const dunia = jen.dunia[duniaId];
                const total = Object.keys(dunia.subMateri).length;
                const completed = Object.values(activeUser.progress[jenjang][duniaId] || {}).filter(p => p.done).length;
                if (completed === total && !(activeUser.badges && activeUser.badges[jenjang] && activeUser.badges[jenjang].includes(duniaId))) {
                    // award per-dunia badge
                    activeUser.badges = activeUser.badges || {};
                    activeUser.badges[jenjang] = activeUser.badges[jenjang] || [];
                    activeUser.badges[jenjang].push(duniaId);
                    playSound('badge');
                    spawnBadgeUnlock(duniaId, `Pakar ${dunia.namaDunia}`);
                    // world complete visual
                    const cards = domElements.duniaContainer.querySelectorAll('.card-hover');
                    Array.from(domElements.duniaContainer.children).forEach(c => { if (c.querySelector('h3') && c.querySelector('h3').textContent === dunia.namaDunia) { c.classList.add('world-complete'); setTimeout(()=>c.classList.remove('world-complete'), 1600); } });
                    // award small level-up reward
                    addPoints(30);
                    spawnConfetti(18);
                }
            }
            // full jenjang: semua dunia pada jenjang harus selesai
            let allCompleted = true;
            for (const duniaId2 in jen.dunia) {
                const d2 = jen.dunia[duniaId2];
                const total2 = Object.keys(d2.subMateri).length;
                const completed2 = Object.values(((activeUser.progress && activeUser.progress[jenjang]) || {})[duniaId2] || {}).filter(p => p.done).length;
                if (completed2 < total2) { allCompleted = false; break; }
            }
            if (allCompleted) {
                activeUser.badges = activeUser.badges || {};
                activeUser.badges[jenjang] = activeUser.badges[jenjang] || [];
                const badgeId = `${jenjang}_master`;
                if (!activeUser.badges[jenjang].includes(badgeId)) {
                    activeUser.badges[jenjang].push(badgeId);
                    playSound('badge');
                    spawnBadgeUnlock(badgeId, `Master ${jenjang.toUpperCase()}`);
                    // big celebration
                    spawnConfetti(40);
                    showLevelUp(`${jenjang.toUpperCase()} - Master Tercapai!`);
                }
            }

            // evaluate extra achievement definitions
            const defs = achievementsDefinitions[jenjang] || achievementsDefinitions['sd'];
            defs.forEach(def => {
                try {
                    const achieved = def.condition(activeUser, jenjang);
                    activeUser.badges[jenjang] = activeUser.badges[jenjang] || [];
                    if (achieved && !activeUser.badges[jenjang].includes(def.id)) {
                        activeUser.badges[jenjang].push(def.id);
                        playSound('badge');
                        spawnBadgeUnlock(def.id, def.title);
                        spawnConfetti(12);
                    }
                } catch (e) { /* ignore faulty condition */ }
            });
            saveData();
        }

        // Spawn badge unlock animation + add to UI
        function spawnBadgeUnlock(id, title, targetElementId) {
            try { renderAchievements(); } catch(e){}
            // announce to screen readers
            try { const ann = ariaAnnouncer(); if (ann) ann.textContent = `Prestasi terklaim: ${title}`; } catch(e){}
            // play badge sound if available
            try { playSound('badge'); } catch(e){}

            // small animated badge near header (fallback)
            const header = document.querySelector('header') || document.body;
            const badge = document.createElement('div'); badge.className = 'badge-pop';
            badge.style.position = 'fixed'; badge.style.top = '14px'; badge.style.right = '20px'; badge.style.zIndex = 600; badge.style.background = 'linear-gradient(90deg,#06b6d4,#3b82f6)'; badge.style.color = 'white'; badge.style.padding = '10px 14px'; badge.style.borderRadius = '12px'; badge.style.boxShadow = '0 8px 24px rgba(0,0,0,0.2)';
            badge.innerHTML = `<div style="font-weight:700;display:flex;gap:8px;align-items:center">🏆 <span style="font-size:14px">${title}</span></div>`;
            document.body.appendChild(badge);
            setTimeout(()=>{ badge.style.transform='translateY(-10px)'; badge.style.opacity='0'; }, 1700);
            setTimeout(()=>badge.remove(), 2200);

            // If a target element is provided, spawn focused confetti around it and pulse it
            if (targetElementId) {
                try {
                    const target = document.querySelector(`#achievement-${CSS.escape(targetElementId)}`) || document.querySelector(`[data-achievement-id="${targetElementId}"]`);
                    if (target) {
                        // add accessible label to target for screen readers
                        try { target.setAttribute('aria-live', 'polite'); target.setAttribute('aria-atomic','true'); } catch(e){}
                        // pulse the target
                        target.classList.add('unlocked-badge');
                        target.style.transition = 'box-shadow 320ms, transform 320ms';
                        target.style.transform = 'scale(1.04)';
                        setTimeout(()=> { target.style.transform = 'scale(1)'; }, 360);

                        // small focused confetti burst
                        const rect = target.getBoundingClientRect();
                        const centerX = rect.left + rect.width/2 + window.scrollX;
                        const centerY = rect.top + rect.height/2 + window.scrollY;
                        const colors = ['#f97316','#f59e0b','#34d399','#60a5fa','#a78bfa','#fb7185'];
                        for (let i=0;i<18;i++){
                            const el = document.createElement('div'); el.className='confetti-piece';
                            el.style.background = colors[Math.floor(Math.random()*colors.length)];
                            el.style.left = (centerX + (Math.random()*160 - 80)) + 'px';
                            el.style.top = (centerY + (Math.random()*120 - 60)) + 'px';
                            el.style.transform = `rotate(${Math.random()*360}deg)`;
                            el.style.width = (6 + Math.random()*10)+'px'; el.style.height = (8 + Math.random()*12)+'px';
                            el.style.position = 'absolute'; el.style.zIndex = 1400;
                            document.body.appendChild(el);
                            setTimeout(()=> el.remove(), 1700 + Math.random()*800);
                        }

                        // subtle body glow
                        document.body.classList.add('achievement-glow');
                        setTimeout(()=> document.body.classList.remove('achievement-glow'), 900);
                    }
                } catch(e) {}
            } else {
                // fallback full-screen confetti
                spawnConfetti(30);
            }
        }

        // Confetti spawn utility
        function spawnConfetti(count = 20) {
            const colors = ['#f97316','#f59e0b','#34d399','#60a5fa','#a78bfa','#fb7185'];
            for (let i=0;i<count;i++){
                const el = document.createElement('div'); el.className='confetti-piece';
                el.style.background = colors[Math.floor(Math.random()*colors.length)];
                el.style.left = (Math.random()*100)+'vw'; el.style.top = (Math.random()*-20)+'vh';
                el.style.transform = `rotate(${Math.random()*360}deg)`;
                el.style.width = (6 + Math.random()*12)+'px'; el.style.height = (8 + Math.random()*14)+'px';
                document.body.appendChild(el);
                setTimeout(()=> el.remove(), 2000 + Math.random()*600);
            }
        }

        // Level up popup
        function showLevelUp(text) {
            const el = document.createElement('div'); el.className='levelup-popup'; el.textContent = text;
            document.body.appendChild(el); setTimeout(()=> el.remove(), 2400);
        }

        // Daily missions simple generator
        function generateDailyMission() {
            if (!activeUser) return;
            const missions = [
                { id: 'm1', text: 'Selesaikan 1 kuis dari jenjangmu', goal: 1, reward: 30 },
                { id: 'm2', text: 'Tambahkan 1 favorit', goal: 1, reward: 20 },
                { id: 'm3', text: 'Buka 3 dunia berbeda', goal: 3, reward: 50 }
            ];
            const choice = missions[Math.floor(Math.random()*missions.length)];
            activeUser.dailyMission = { id: choice.id, text: choice.text, goal: choice.goal, progress: 0, reward: choice.reward, claimed: false };
            saveData();
            domElements.dailyMissionText.textContent = activeUser.dailyMission.text;
            domElements.missionProgressBar.style.width = `${(activeUser.dailyMission.progress/activeUser.dailyMission.goal)*100}%`;
        }
        generateDailyMission();

        // --- Timed Challenge Implementation ---
        let challengeState = { running: false, timeLeft: 60, score: 0, currentQuestion: null, totalAsked: 0 };

        function formatTime(sec) { const m = String(Math.floor(sec/60)).padStart(2,'0'); const s = String(sec%60).padStart(2,'0'); return `${m}:${s}`; }

        function pickChallengeQuestion() {
            // Try to pick a quiz from current jenjang's available questions; fallback to random across edukasiData
            const jen = activeUser && activeUser.jenjang ? activeUser.jenjang : 'sd';
            const duniaKeys = Object.keys((edukasiData[jen] && edukasiData[jen].dunia) || {});
            const pool = [];
            duniaKeys.forEach(dk => {
                const sm = edukasiData[jen].dunia[dk].subMateri || {};
                Object.values(sm).forEach(s => { if (s.kuis && s.kuis.length) pool.push({ q: s.kuis[Math.floor(Math.random()*s.kuis.length)], dari: dk }); });
            });
            if (pool.length === 0) {
                // fallback: search all jenjangs
                for (const jn in edukasiData) for (const dk in edukasiData[jn].dunia) for (const smk in (edukasiData[jn].dunia[dk].subMateri||{})) { const s = edukasiData[jn].dunia[dk].subMateri[smk]; if (s.kuis && s.kuis.length) pool.push({ q: s.kuis[Math.floor(Math.random()*s.kuis.length)], dari: dk }); }
            }
            if (pool.length === 0) return null;
            return pool[Math.floor(Math.random()*pool.length)];
        }

        function renderChallengeQuestion() {
            const area = domElements.challengeQuestionArea;
            area.innerHTML = '';
            const picked = pickChallengeQuestion();
            if (!picked) { area.innerHTML = '<em>Tidak ada pertanyaan tersedia.</em>'; return; }
            challengeState.currentQuestion = picked.q;
            const q = document.createElement('div');
            q.innerHTML = `<div class="text-lg font-medium">${picked.q.pertanyaan || picked.q.question}</div>`;
            const choices = picked.q.pilihan || picked.q.choices || [];
            const list = document.createElement('div'); list.className = 'grid gap-2 mt-3';
            choices.forEach((ch, idx) => {
                const btn = document.createElement('button');
                btn.className = 'p-3 rounded-lg bg-gray-100 hover:bg-gray-200 text-left';
                btn.textContent = ch;
                btn.addEventListener('click', () => handleChallengeAnswer(ch, btn));
                list.appendChild(btn);
            });
            area.appendChild(q); area.appendChild(list);
        }

        function handleChallengeAnswer(selected, btnEl) {
            if (!challengeState.running) return;
            const correct = (challengeState.currentQuestion.jawaban === selected) || (challengeState.currentQuestion.answer === selected);
            challengeState.totalAsked++;
            if (correct) { challengeState.score += 10; playSound('correct'); domElements.challengeFeedback.textContent = 'Benar! +10'; activeUser.stats.correctAnswers++; addPoints(5); } else { playSound('wrong'); domElements.challengeFeedback.textContent = 'Salah'; activeUser.stats.wrongAnswers++; }
            domElements.challengeScore.textContent = `Skor: ${challengeState.score}`;
            saveData();
            // small pause then next
            if (btnEl) { btnEl.classList.add(correct ? 'quiz-correct' : 'quiz-wrong'); setTimeout(()=> btnEl.classList.remove(correct ? 'quiz-correct' : 'quiz-wrong'), 700); }
            setTimeout(() => { domElements.challengeFeedback.textContent = ''; renderChallengeQuestion(); }, 600);
            // update mission progress for challenge-related missions
            updateMissionProgress(1);
        }

        function updateChallengeTimer() {
            domElements.challengeTimer.textContent = formatTime(challengeState.timeLeft);
            if (challengeState.timeLeft <= 0) { stopChallenge(); }
        }

        function startChallenge() {
            if (challengeState.running) return; challengeState.running = true; challengeState.timeLeft = 60; challengeState.score = 0; challengeState.totalAsked = 0; domElements.challengeScore.textContent = `Skor: 0`; renderChallengeQuestion(); updateChallengeTimer();
            timedChallengeInterval = setInterval(() => { challengeState.timeLeft--; updateChallengeTimer(); }, 1000);
        }

        function stopChallenge() {
            if (!challengeState.running) return; challengeState.running = false; clearInterval(timedChallengeInterval); timedChallengeInterval = null; domElements.challengeFeedback.textContent = `Selesai! Skor: ${challengeState.score}`; playSound('badge');
            // reward points based on score
            const reward = Math.max(10, Math.min(200, Math.floor(challengeState.score/2)));
            addPoints(reward);
            // record stat
            activeUser.stats.quizzesCompleted = (activeUser.stats.quizzesCompleted||0) + challengeState.totalAsked;
            saveData();
            // maybe award an achievement
            checkForBadges(activeUser.jenjang || 'sd');
        }

        // wire challenge buttons
        document.addEventListener('DOMContentLoaded', () => {
            const startBtn = document.getElementById('start-challenge-btn');
            const stopBtn = document.getElementById('stop-challenge-btn');
            if (startBtn) startBtn.addEventListener('click', startChallenge);
            if (stopBtn) stopBtn.addEventListener('click', stopChallenge);
        });

        domElements.claimMissionRewardBtn.addEventListener('click', () => {
            const m = activeUser.dailyMission; if (!m) return;
            if (m.progress >= m.goal && !m.claimed) { addPoints(m.reward); m.claimed = true; saveData(); showMascotTip(`Misi selesai! +${m.reward} Poin`); domElements.claimMissionRewardBtn.disabled = true; } else { showMascotTip('Misi belum selesai.'); }
        });

        // Keyboard shortcuts (F = favorites, S = shop, / focuses search)
        document.addEventListener('keydown', (e) => {
            if (e.key === 'f' || e.key === 'F') { renderFavorites(); showModal('favorites-modal'); }
            if (e.key === 's' || e.key === 'S') { showModal('shop-hub-modal'); }
            if (e.key === '/') { e.preventDefault(); domElements.searchBar.focus(); }
        });

        // Undo last points (simple stack)
        const pointsHistory = [];
        const originalAddPoints = addPoints;
        window.undoLastPoints = function() {
            const last = pointsHistory.pop(); if (!last) { showMascotTip('Tidak ada yang dibatalkan'); return; }
            activeUser.points = Math.max(0, activeUser.points - last); saveData(); updateUI(); showMascotTip('Perubahan poin dibatalkan');
        };
        // wrap addPoints to push history
        addPoints = function(amount, duniaId = null, withAnimation = true) { if (!activeUser || activeUser.settings.zenMode) return; pointsHistory.push(amount); activeUser.points += amount; if(withAnimation && amount > 0) showAnimation(`+${amount}`, 'point'); saveData(); updateUI(); };

        // Save points history length limit
        setInterval(()=>{ if(pointsHistory.length>50) pointsHistory.splice(0, pointsHistory.length-50); }, 60000);

        // Ensure settings tab theme buttons apply immediately (guarded)
        if (domElements.themeSelector && !domElements.themeSelector.dataset.listenersAttached) {
            domElements.themeSelector.querySelectorAll('button[data-theme]').forEach(btn => btn.addEventListener('click', (e)=>{ const t = btn.dataset.theme; activeUser.settings.theme = t; saveData(); applySettings(); showMascotTip(`Tema diubah: ${t}`); }));
            domElements.themeSelector.dataset.listenersAttached = '1';
        }

        // Achievements jenjang selector wiring
        const achSelect = document.getElementById('achievements-jenjang-select');
        if (achSelect) {
            achSelect.addEventListener('change', (e) => {
                renderAchievements(e.target.value);
            });
            // When opening achievements modal ensure selector uses current user's jenjang (guarded)
            if (!domElements.achievementsBtn.dataset.listenerAttached) {
                domElements.achievementsBtn.addEventListener('click', () => {
                    if (activeUser && activeUser.jenjang) achSelect.value = activeUser.jenjang;
                    renderAchievements(activeUser && activeUser.jenjang ? activeUser.jenjang : null);
                    showModal('achievements-modal');
                });
                domElements.achievementsBtn.dataset.listenerAttached = '1';
            }
            if (!domElements.closeAchievementsBtn.dataset.listenerAttached) {
                domElements.closeAchievementsBtn.addEventListener('click', hideModals);
                domElements.closeAchievementsBtn.dataset.listenerAttached = '1';
            }
        }

        // Search bar wiring: filter dunia as user types (debounced)
        if (domElements.searchBar) {
            let searchTimer = null;
            domElements.searchBar.addEventListener('input', (e) => {
                clearTimeout(searchTimer);
                const q = e.target.value || '';
                searchTimer = setTimeout(() => { renderDuniaMapWithFilter(q); }, 180);
            });
        }

        // Minor bug fixes: ensure selectedAvatarId fallback and shopData.customization existence
        if (!shopData.customization) shopData.customization = { items: {} };
        function showMascotTip(message) { domElements.mascotTipContainer.innerHTML = ''; const tipEl = document.createElement('div'); tipEl.className = 'mascot-tip'; tipEl.innerHTML = `<div class="w-12 h-12 mr-3">${mascotSVG}</div><p class="text-sm">${message}</p>`; domElements.mascotTipContainer.appendChild(tipEl); setTimeout(() => { tipEl.remove(); }, 6000); }

        // --- Accessibility helpers: focus trap & modal management ---
        const ariaAnnouncer = () => document.getElementById('aria-live-announcer');
        function trapFocus(modalEl) {
            if (!modalEl) return null;
            const focusable = modalEl.querySelectorAll('a[href], button:not([disabled]), textarea, input, select, [tabindex]:not([tabindex="-1"])');
            let first = focusable[0]; let last = focusable[focusable.length-1];
            function handleKey(e){ if (e.key === 'Tab') {
                if (focusable.length === 0) { e.preventDefault(); return; }
                if (e.shiftKey) {
                    if (document.activeElement === first) { e.preventDefault(); last.focus(); }
                } else {
                    if (document.activeElement === last) { e.preventDefault(); first.focus(); }
                }
            } else if (e.key === 'Escape') { hideModals(); }
            }
            document.addEventListener('keydown', handleKey);
            // return untrap function
            return () => { document.removeEventListener('keydown', handleKey); };
        }

        let currentModalTrap = null;
        let lastFocusedBeforeModal = null;
        // robust modal management implementation (renamed to enhanced* to avoid duplicate defs)
        function enhancedShowModal(id) {
            const modal = document.getElementById(id);
            if (!modal) return;
            // record last focused element
            lastFocusedBeforeModal = document.activeElement;
            // mark aria-hidden on other modals
            document.querySelectorAll('.modal-overlay').forEach(m => { if (m.id !== id) m.setAttribute('aria-hidden', 'true'); });
            modal.classList.add('active');
            modal.setAttribute('aria-hidden', 'false');
            // focus first focusable element inside modal
            setTimeout(()=>{
                const focusable = modal.querySelectorAll('a[href], button:not([disabled]), textarea, input, select, [tabindex]:not([tabindex="-1"])');
                if (focusable && focusable.length) focusable[0].focus(); else modal.focus();
                // apply focus trap
                if (currentModalTrap) currentModalTrap();
                currentModalTrap = trapFocus(modal);
            }, 60);
        }

        function enhancedHideModals() {
            document.querySelectorAll('.modal-overlay.active').forEach(m => {
                m.classList.remove('active'); m.setAttribute('aria-hidden', 'true');
            });
            if (currentModalTrap) { currentModalTrap(); currentModalTrap = null; }
            // return focus
            if (lastFocusedBeforeModal && typeof lastFocusedBeforeModal.focus === 'function') lastFocusedBeforeModal.focus();
        }
    // expose to global so earlier wrappers can call them safely
    window.enhancedShowModal = enhancedShowModal;
    window.enhancedHideModals = enhancedHideModals;
    // also keep backwards-compatible names
    window.showModal = enhancedShowModal;
    window.hideModals = enhancedHideModals;

        // spawn a floating confirmation near an element
        function spawnFloatingConfirm(targetEl, text) {
            const rect = targetEl.getBoundingClientRect();
            const confirmEl = document.createElement('div');
            confirmEl.className = 'shop-confirm';
            confirmEl.textContent = text;
            document.body.appendChild(confirmEl);
            // position near the element center
            confirmEl.style.left = (rect.left + rect.width/2) + 'px';
            confirmEl.style.top = (rect.top + rect.height/2) + 'px';
            setTimeout(() => { confirmEl.remove(); }, 1000);
        }

        // ---------------- New features: inventory, equip, favorites, history, autosave, tooltips ----------------
        function openInventory() {
            if (!activeUser) return;
            domElements.inventoryList.innerHTML = '';
            const inv = (activeUser.inventory || []).slice().reverse();
            if (inv.length === 0) domElements.inventoryList.innerHTML = '<p class="text-sm text-gray-500">Inventori kosong.</p>';
            inv.forEach((it, idx) => {
                const card = document.createElement('div'); card.className = 'p-3 rounded-xl bg-white';
                const name = it.item?.name || it.name || it.id;
                card.innerHTML = `<div class="font-semibold">${name}</div><div class="text-sm text-gray-500">${it.toko || ''}</div>`;
                const btnWrap = document.createElement('div'); btnWrap.className='mt-2 flex gap-2';
                const equipBtn = document.createElement('button'); equipBtn.className='px-2 py-1 bg-sky-500 text-white rounded'; equipBtn.textContent='Gunakan';
                equipBtn.addEventListener('click', ()=>{ equipItem(it); });
                btnWrap.appendChild(equipBtn);
                card.appendChild(btnWrap);
                domElements.inventoryList.appendChild(card);
            });
            hideModals(); showModal('inventory-modal');
        }

        function equipItem(it) {
            if (!activeUser) return;
            // simple equip: if it's a customization/theme apply it, if avatar, set avatarId
            if (it.toko === 'tokoAvatar' && it.id) {
                activeUser.avatarId = it.id; playSound('equip'); showMascotTip('Avatar dipakai!');
            }
            if (it.toko === 'customization' && it.id) {
                // apply theme by id -> if item contains theme key
                if (it.item && it.item.themeKey) {
                    activeUser.settings.theme = it.item.themeKey; applySettings(); showMascotTip('Tema diterapkan!');
                }
            }
            saveData(); updateUI();
        }

        // favorites toggle for shop items (non-persistent lightweight)
        function toggleShopFavorite(itemId) {
            activeUser.favorites = activeUser.favorites || [];
            if (activeUser.favorites.includes(itemId)) { activeUser.favorites = activeUser.favorites.filter(i=>i!==itemId); }
            else activeUser.favorites.push(itemId);
            saveData();
        }

        // record purchase history
        function recordPurchase(entry) {
            activeUser.purchaseHistory = activeUser.purchaseHistory || [];
            activeUser.purchaseHistory.push({ ts: Date.now(), entry });
            // keep last 50
            if (activeUser.purchaseHistory.length > 50) activeUser.purchaseHistory.splice(0, activeUser.purchaseHistory.length-50);
            saveData();
            renderPurchaseHistory();
        }

        function renderPurchaseHistory() {
            if (!domElements.purchaseHistoryList) return;
            domElements.purchaseHistoryList.innerHTML = '';
            const ph = (activeUser.purchaseHistory||[]).slice().reverse();
            ph.forEach(p => {
                const d = new Date(p.ts).toLocaleString();
                const div = document.createElement('div'); div.className='py-1 border-b border-gray-200'; div.textContent = `${d} — ${p.entry}`;
                domElements.purchaseHistoryList.appendChild(div);
            });
        }

        // autosave indicator heartbeat
        let autosaveTimer = null;
        function showAutosave() {
            domElements.autosaveIndicator.style.display = 'block';
            clearTimeout(autosaveTimer);
            autosaveTimer = setTimeout(()=> domElements.autosaveIndicator.style.display = 'none', 1400);
        }

        // tooltip helper
        const tooltipHost = document.getElementById('tooltip-host');
        function showTooltip(msg, x, y) { tooltipHost.textContent = msg; tooltipHost.style.left = (x+12) + 'px'; tooltipHost.style.top = (y+12) + 'px'; tooltipHost.style.display = 'block'; }
        function hideTooltip() { tooltipHost.style.display = 'none'; }

        // confirmation toggle from settings
        let confirmationsEnabled = true;
        function setConfirmationsEnabled(v) { confirmationsEnabled = !!v; }

        // --- Achievements & Missions Renderer ---
        function renderAchievements(selectedJenjang, filterMode) {
                const container = document.getElementById('achievements-list');
                container.innerHTML = '';
                if (!activeUser) {
                    container.innerHTML = '<div class="p-4">Belum ada prestasi (login terlebih dahulu).</div>';
                    return;
                }
                const badges = activeUser.badges || {};
                // default to active user's jenjang when not explicitly provided
                const defaultJenjang = (activeUser && activeUser.jenjang) ? activeUser.jenjang : 'sd';
                // determine filter mode (all | locked | unlocked)
                const filterSelect = document.getElementById('achievements-filter-select');
                const uiFilter = filterMode || (filterSelect ? filterSelect.value : 'all');
                const jenjangsToShow = selectedJenjang ? [selectedJenjang] : [defaultJenjang];
            jenjangsToShow.forEach(jenjang => {
                const group = document.createElement('div');
                group.className = 'p-3 rounded-lg';
                group.style.backgroundColor = 'var(--card-bg-color)';
                const titleWrap = document.createElement('div');
                titleWrap.className = 'flex items-center justify-between mb-2';
                const title = document.createElement('div');
                title.className = 'font-bold';
                title.textContent = jenjang.toUpperCase();
                const summary = document.createElement('div'); summary.className = 'text-sm text-gray-500';
                const earnedCount = (Array.isArray(badges[jenjang]) ? badges[jenjang].length : 0);
                summary.textContent = `${earnedCount} earned`;
                titleWrap.appendChild(title); titleWrap.appendChild(summary);
                group.appendChild(titleWrap);
                const list = document.createElement('div');
                list.className = 'grid grid-cols-2 gap-2';
                // Show definitions and dedupe
                const defs = (typeof achievementsDefinitions !== 'undefined' && achievementsDefinitions[jenjang]) ? achievementsDefinitions[jenjang] : [];
                if (defs.length === 0) {
                    const none = document.createElement('div'); none.className = 'col-span-2 text-sm text-gray-500'; none.textContent = 'Belum ada definisi prestasi untuk jenjang ini.'; list.appendChild(none);
                } else {
                    defs.forEach(def => {
                        const unlocked = Array.isArray(badges[jenjang]) && badges[jenjang].includes(def.id);
                        if (uiFilter === 'locked' && unlocked) return;
                        if (uiFilter === 'unlocked' && !unlocked) return;
                        const it = document.createElement('div');
                        it.id = `achievement-${def.id}`;
                        it.dataset.achievementId = def.id;
                        it.className = 'achievement-card';
                        if (!unlocked) it.classList.add('locked');
                        if (unlocked) it.classList.add('unlocked-badge');
                        it.setAttribute('title', def.title + (def.desc ? ' — ' + def.desc : ''));

                        const icon = document.createElement('div'); icon.className = 'achievement-icon'; icon.setAttribute('aria-hidden','true');
                        // add a subtle left accent on the card to reflect jenjang palette
                        try { const accent = (jenjangPalettes[jenjang] && jenjangPalettes[jenjang][0]) ? jenjangPalettes[jenjang][0] : null; if (accent) it.style.borderLeft = '6px solid '+accent; } catch(e){}
                        // prefer inline SVG provided in definition (trusted), otherwise create a fallback medal/star
                        if (def.iconSVG) {
                            const wrapper = document.createElement('div'); wrapper.className = 'logo-content';
                            wrapper.innerHTML = def.iconSVG;
                            icon.appendChild(wrapper);
                        } else {
                            // generate simple SVG fallback: use jenjang palette for consistent coloring
                            const palette = (jenjang && jenjangPalettes[jenjang]) ? jenjangPalettes[jenjang] : defaultPalette;
                            const fill = palette[(def.id||'').split('').reduce((s,c)=>s + c.charCodeAt(0), 0) % palette.length];
                            if (unlocked) {
                                icon.innerHTML = `<svg viewBox="0 0 64 64" xmlns="http://www.w3.org/2000/svg" aria-hidden="true"><defs><linearGradient id="g${def.id}" x1="0" x2="1"><stop offset="0" stop-color="#fff7ed"/><stop offset="1" stop-color="${fill}"/></linearGradient></defs><rect width="64" height="64" rx="12" fill="url(#g${def.id})"/><g transform="translate(8,8)"><path d="M24 4c-6 0-10 4-10 10 0 8 10 16 10 16s10-8 10-16c0-6-4-10-10-10z" fill="#fff" opacity="0.12"/><circle cx="24" cy="14" r="8" fill="#fff"/><text x="24" y="18" font-size="10" font-weight="700" text-anchor="middle" fill="${fill}">🏆</text></g></svg>`;
                            } else {
                                icon.innerHTML = `<svg viewBox="0 0 64 64" xmlns="http://www.w3.org/2000/svg" aria-hidden="true"><rect width="64" height="64" rx="12" fill="#fbf9f3"/><g transform="translate(8,8)"><path d="M24 2l6 10 12 2-9 8 2 12-11-6-11 6 2-12-9-8 12-2z" fill="${fill}"/></g></svg>`;
                            }
                        }
                        const body = document.createElement('div'); body.className = 'achievement-body';
                        const t = document.createElement('div'); t.className = 'achievement-title'; t.textContent = def.title;
                        const d = document.createElement('div'); d.className = 'achievement-desc'; d.textContent = def.desc || '';
                        body.appendChild(t); body.appendChild(d);

                        const meta = document.createElement('div'); meta.className = 'achievement-meta';
                        const progressWrap = document.createElement('div'); progressWrap.className = 'achievement-progress';
                        const progInner = document.createElement('i'); progInner.style.width = '0%'; progressWrap.appendChild(progInner);
                        const stateBadge = document.createElement('div'); stateBadge.className = 'achievement-badge'; stateBadge.textContent = unlocked ? '✓' : '';
                        const stateText = document.createElement('div'); stateText.className = 'text-sm text-right text-gray-500'; stateText.textContent = unlocked ? 'Terklaim' : 'Terkunci';

                        // try to show progress if measurable and not yet unlocked
                        if (!unlocked) {
                            const progress = calculateAchievementProgress(def, jenjang);
                            if (progress != null) {
                                progInner.style.width = Math.round(progress*100)+'%';
                            }
                        } else {
                            progInner.style.width = '100%';
                        }

                        // assemble (icon + body only for a clean stacked list)
                        it.appendChild(icon);
                        it.appendChild(body);
                        it.addEventListener('click', ()=>{ if (unlocked) showMascotTip(def.title + ' sudah diklaim'); else showMascotTip('Prestasi: ' + def.title); });
                        list.appendChild(it);
                    });
                }
                group.appendChild(list);
                container.appendChild(group);
            });

            // populate debug force-award select with available defs for chosen jenjang (if modal present)
            try {
                const forceJenSel = document.getElementById('force-award-jenjang');
                const forceSelect = document.getElementById('force-award-select');
                if (forceJenSel && forceSelect) {
                    const j = (selectedJenjang || ((activeUser && activeUser.jenjang) ? activeUser.jenjang : 'sd'));
                    const defs = (achievementsDefinitions && achievementsDefinitions[j]) ? achievementsDefinitions[j] : [];
                    forceSelect.innerHTML = '';
                    defs.forEach(d => { const o = document.createElement('option'); o.value = d.id; o.textContent = d.title; forceSelect.appendChild(o); });
                    forceJenSel.value = j;
                }
            } catch(e) {}
        }

        function forceAwardAchievement(achievementId, jenjang) {
            if (!activeUser) return;
            jenjang = jenjang || activeUser.jenjang || 'sd';
            activeUser.badges = activeUser.badges || {};
            activeUser.badges[jenjang] = activeUser.badges[jenjang] || [];
            if (!activeUser.badges[jenjang].includes(achievementId)) {
                activeUser.badges[jenjang].push(achievementId);
                saveData();
                spawnBadgeUnlock(achievementId, `Terklaim: ${achievementId}`, achievementId);
                renderAchievements(jenjang);
            } else {
                showMascotTip('Prestasi sudah dimiliki.');
            }
        }

        // Calculate progress for some achievement definitions (0..1) or null if unknown
        function calculateAchievementProgress(def, jenjang) {
            try {
                if (!activeUser) return null;
                // heuristics: check id for numbers
                if (/submateri/i.test(def.id)) {
                    const total = Object.keys(edukasiData[jenjang].dunia).reduce((acc,did)=>acc+Object.keys(edukasiData[jenjang].dunia[did].subMateri).length,0);
                    const done = Object.values((activeUser.progress && activeUser.progress[jenjang])||{}).reduce((acc,cur)=>acc + (Object.values(cur).filter(p=>p.done).length||0),0);
                    return total ? Math.min(1, done/Math.max(1, parseInt(def.id.match(/(\d+)/)?.[0]||total))) : null;
                }
                if (/points|poin|point/i.test(def.id)) {
                    const target = parseInt(def.id.match(/(\d+)/)?.[0]||0);
                    return target ? Math.min(1, (activeUser.points||0)/target) : null;
                }
                if (/dunia/i.test(def.id)) {
                    // count complete dunia
                    const totalD = Object.keys(edukasiData[jenjang].dunia).length;
                    let c=0; for (const d in edukasiData[jenjang].dunia){ const total=Object.keys(edukasiData[jenjang].dunia[d].subMateri).length; const done=Object.values((activeUser.progress&&activeUser.progress[jenjang]&&activeUser.progress[jenjang][d])||{}).filter(p=>p.done).length; if(done===total) c++; }
                    const target = parseInt(def.id.match(/(\d+)/)?.[0]||1);
                    return totalD ? Math.min(1, c/target) : null;
                }
            } catch (e) { return null; }
            return null;
        }

        // Render and manage daily mission UI
        function renderDailyMission() {
            if (!activeUser) return;
            const textEl = document.getElementById('daily-mission-text');
            const progressBar = document.getElementById('mission-progress-bar');
            const claimBtn = document.getElementById('claim-mission-reward-btn');
            // Ensure a structure
            if (!activeUser.dailyMission || !activeUser.dailyMission.id) {
                // simple auto-generate
                activeUser.dailyMission = { id: 'm1', text: 'Selesaikan 3 kuis hari ini', goal: 3, progress: 0, reward: 100, claimed: false };
            }
            const m = activeUser.dailyMission;
            textEl.textContent = m.text + ' (Hadiah: ' + m.reward + ' poin)';
            const pct = Math.min(100, Math.round((m.progress / m.goal) * 100));
            progressBar.style.width = pct + '%';
            progressBar.textContent = pct + '%';
            if (m.progress >= m.goal && !m.claimed) {
                claimBtn.disabled = false; claimBtn.classList.remove('disabled');
            } else {
                claimBtn.disabled = true; claimBtn.classList.add('disabled');
            }
            claimBtn.onclick = () => {
                if (!m || m.claimed) return;
                if (m.progress >= m.goal) {
                    addPoints(m.reward, null, true);
                    m.claimed = true;
                    claimBtn.disabled = true; claimBtn.classList.add('disabled');
                    showMascotTip('Misi terklaim! +'+m.reward+' poin');
                    saveData();
                }
            };
        }

        function updateMissionProgress(change = 1) {
            if (!activeUser || !activeUser.dailyMission) return;
            activeUser.dailyMission.progress = (activeUser.dailyMission.progress || 0) + change;
            if (activeUser.dailyMission.progress < 0) activeUser.dailyMission.progress = 0;
            // auto-claim if over goal and autosave
            saveData();
            // update UI when modal is open
            if (document.getElementById('daily-mission-modal').classList.contains('active')) renderDailyMission();
        }

    // keyboard shortcut to open inventory (guard: attach once)
    if (!document.body.dataset.inventoryShortcutAttached) {
        document.addEventListener('keydown', (e)=>{ if (e.key === 'i' || e.key === 'I') { openInventory(); } });
        document.body.dataset.inventoryShortcutAttached = '1';
    }

    // wire inventory button (guarded)
    if (domElements.inventoryBtn && !domElements.inventoryBtn.dataset.listenerAttached) { domElements.inventoryBtn.addEventListener('click', () => { openInventory(); }); domElements.inventoryBtn.dataset.listenerAttached = '1'; }

    // settings: confirmation toggle (if present in settings pane)
    if (domElements.confirmToggle && !domElements.confirmToggle.dataset.listenerAttached) { domElements.confirmToggle.addEventListener('change', (e)=> setConfirmationsEnabled(e.target.checked)); domElements.confirmToggle.dataset.listenerAttached = '1'; }

        // helper: trigger jenjang-change animation on header
        function triggerJenjangAnim() {
            const headerEl = document.querySelector('header');
            if (!headerEl) return;
            headerEl.classList.remove('jenjang-anim');
            // force reflow
            void headerEl.offsetWidth;
            headerEl.classList.add('jenjang-anim');
            setTimeout(() => headerEl.classList.remove('jenjang-anim'), 900);
        }

        // --- Event Listeners ---
        domElements.addNewUserBtn.addEventListener('click', () => { playSound('click'); setupNewUserScreen(); switchScreen('name-entry-screen'); });
        domElements.cancelNewUserBtn.addEventListener('click', () => { playSound('click'); initializeApp(); });
        domElements.nextToLevelBtn.addEventListener('click', () => { createNewUser(domElements.playerNameInput.value.trim(), selectedAvatarId); });
        domElements.playerNameInput.addEventListener('input', () => { domElements.nextToLevelBtn.disabled = !(domElements.playerNameInput.value.trim() && selectedAvatarId); });
    document.querySelectorAll('.jenjang-btn').forEach(b => b.addEventListener('click', (e) => {
        const chosen = e.currentTarget.dataset.jenjang;
        // show overlay
        const overlay = document.getElementById('jenjang-overlay'); overlay.classList.add('active');
        setTimeout(() => {
            overlay.classList.remove('active');
        }, 700);
        activeUser.jenjang = chosen;
        initializeProgressForJenjang(activeUser.jenjang);
        saveData();
        triggerJenjangAnim();
        // slight delay to let overlay show
        setTimeout(() => startSession(), 260);
    }));
        domElements.settingsBtn.addEventListener('click', () => { domElements.zenModeToggle.checked = activeUser.settings.zenMode; domElements.soundToggleBtn.textContent = activeUser.settings.soundOn ? '🔊' : '🔇'; domElements.musicToggleBtn.textContent = activeUser.settings.musicOn ? '🎵' : '🎶'; showModal('settings-modal'); });
        document.querySelectorAll('.settings-tab').forEach(tab => {
            tab.addEventListener('click', () => {
                document.querySelectorAll('.settings-tab').forEach(t => t.classList.remove('border-sky-500', 'text-sky-600'));
                tab.classList.add('border-sky-500', 'text-sky-600');
                document.querySelectorAll('.settings-tab-pane').forEach(pane => pane.style.display = 'none');
                document.getElementById('tab-' + tab.dataset.tab).style.display = 'block';
            });
        });
        domElements.closeSettingsBtn.addEventListener('click', hideModals);
        domElements.achievementsBtn.addEventListener('click', () => { 
            // when opening achievements, default the selector to active user's jenjang and render only that
            const sel = document.getElementById('achievements-jenjang-select');
            const targetJenjang = (activeUser && activeUser.jenjang) ? activeUser.jenjang : 'sd';
            if (sel) { sel.value = targetJenjang; }
            renderAchievements(targetJenjang); 
            showModal('achievements-modal'); 
        });
    domElements.closeAchievementsBtn.addEventListener('click', hideModals);
    const achSel = document.getElementById('achievements-jenjang-select');
    if (achSel) achSel.addEventListener('change', (e) => { renderAchievements(e.target.value); });
    const filterSel = document.getElementById('achievements-filter-select');
    if (filterSel) filterSel.addEventListener('change', () => { const sel = document.getElementById('achievements-jenjang-select'); renderAchievements(sel ? sel.value : undefined); });
        // wire debug force-award controls
        const forceBtn = document.getElementById('force-award-btn');
        const forceJen = document.getElementById('force-award-jenjang');
        const forceSel = document.getElementById('force-award-select');
        if (forceJen) forceJen.addEventListener('change', (ev) => { renderAchievements(ev.target.value); });
        if (forceBtn && forceSel && forceJen) {
            forceBtn.addEventListener('click', () => {
                const aid = forceSel.value; const j = forceJen.value;
                if (aid) forceAwardAchievement(aid, j);
            });
        }
        domElements.closeFunFactBtn.addEventListener('click', () => { hideModals(); renderSubMateri(currentDuniaId); switchScreen('submateri-screen'); });
        domElements.closeDailyBonusBtn.addEventListener('click', hideModals);
        domElements.backToWorldsBtn.addEventListener('click', () => { renderDuniaMap(); switchScreen('map-screen'); });
        domElements.backToSubmateriBtn.addEventListener('click', () => { renderSubMateri(currentDuniaId); switchScreen('submateri-screen'); });
        domElements.progressTreeToggle.addEventListener('change', () => renderSubMateri(currentDuniaId));
        domElements.zenModeToggle.addEventListener('change', (e) => { activeUser.settings.zenMode = e.target.checked; saveData(); updateUI(); });
    // sound/music toggles wired earlier with guards; no-op here to avoid duplicates
        domElements.reviewModeBtn.addEventListener('click', () => { renderFavorites(); showModal('favorites-modal'); });
        domElements.closeFavoritesBtn.addEventListener('click', hideModals);
        domElements.leaderboardBtn.addEventListener('click', () => { renderLeaderboard(); showModal('leaderboard-modal'); });
        domElements.closeLeaderboardBtn.addEventListener('click', hideModals);
    domElements.dailyMissionBtn.addEventListener('click', () => { renderDailyMission(); showModal('daily-mission-modal'); });
        domElements.closeDailyMissionBtn.addEventListener('click', hideModals);
        domElements.timedChallengeBtn.addEventListener('click', () => { /* Logic Tantangan Waktu */ showModal('timed-challenge-modal'); });
        domElements.closeTimedChallengeBtn.addEventListener('click', hideModals);
        document.getElementById('shop-hub-btn').addEventListener('click', () => showModal('shop-hub-modal'));
        document.getElementById('close-shop-hub-btn').addEventListener('click', hideModals);
    document.getElementById('open-avatar-shop').addEventListener('click', () => { hideModals(); showModal('avatar-shop-modal'); });
    document.getElementById('open-customization-shop').addEventListener('click', () => { hideModals(); renderShop('customization'); });
    document.getElementById('open-burunghantu-shop').addEventListener('click', () => { hideModals(); renderShop('tokoBurungHantu'); });
    document.getElementById('open-bonus-shop').addEventListener('click', () => { hideModals(); renderShop('tokoBonus'); });
        domElements.closeAvatarShopBtn.addEventListener('click', hideModals);
        // allow clicking the avatar in the header to open avatar shop (quick-change)
        const avatarHeader = document.getElementById('user-avatar-header');
        if (avatarHeader) avatarHeader.addEventListener('click', () => { hideModals(); showModal('avatar-shop-modal'); });

        // customize mascot modal wiring
        const closeMascotBtn = document.getElementById('close-customize-mascot');
        if (closeMascotBtn) closeMascotBtn.addEventListener('click', hideModals);
        document.querySelectorAll('.mascot-style-btn').forEach(btn => btn.addEventListener('click', (e) => {
            const style = e.currentTarget.dataset.style;
            showMascotTip(`Gaya maskot diterapkan: ${style}`);
            // placeholder: store style in activeUser.settings
            if (activeUser) { activeUser.settings.mascotStyle = style; saveData(); }
        }));
        domElements.saveNameBtn.addEventListener('click', () => { activeUser.name = domElements.editNameInput.value.trim(); saveData(); updateUI(); });
        domElements.changeJenjangSelect.addEventListener('change', (e) => { activeUser.jenjang = e.target.value; initializeProgressForJenjang(activeUser.jenjang); saveData(); triggerJenjangAnim(); renderDuniaMap(); });

        // ensure generic shop close buttons hide modals too
        document.querySelectorAll('.generic-shop-close-btn').forEach(btn => {
            btn.addEventListener('click', (ev) => { hideModals(); spawnFloatingConfirm(btn, 'Tutup toko'); });
        });
        domElements.resetProgressBtn.addEventListener('click', () => { showModal('confirm-reset-modal'); });
        domElements.cancelResetBtn.addEventListener('click', () => { hideModals(); showModal('settings-modal'); });
        domElements.confirmResetBtn.addEventListener('click', () => { activeUser.progress[activeUser.jenjang] = {}; activeUser.points = 0; saveData(); hideModals(); renderDuniaMap(); });
        domElements.closeStatsBtn.addEventListener('click', () => { hideModals(); showModal('leaderboard-modal'); });
        
        // audio debug wiring removed (moved to settings on demand)

        initializeApp();
    </script>
</body>
</html>
